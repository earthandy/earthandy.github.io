---
title: IOT通信技术
date: 2021-12-21 00:16:22
keywords: IOT,通信
categories: IOT
tags:
  - 通信
---

#### 无线通信技术的 4 个重要参数

##### 频段

无线通信当然用的是电磁波，在实际应用中，电磁波是按照频段来使用的。频段是指电磁波频率的一个范围，对应到频谱中就像是一段一段切割开。你看“频段”这个名词，是不是很形象？

![频谱分布图](https://s2.loli.net/2021/12/09/vxNEnkDtcA51is3.png)

上面这张图展示了整个[频谱的频段](http://www.c-fol.net/baike/content/3/1712.html)分布。图中的分段基于电磁波不同的特性，而通信技术则需要考虑不同的使用需求和管理，对无线电波做更进一步的分段。

在这个频谱图中，Wi-Fi 的频段是 2.412GHz-2.484GHz。这是一个非授权频段，其他的通信技术也可以使用，所以在后面你会看到蓝牙技术也基本是这个频率范围。理解了这一点，也许你就能明白，为什么 Wi-Fi 路由器和蓝牙耳机、键鼠，在某些情况下会相互干扰了。有没有什么办法能解决通信干扰呢？答案是肯定的，其中一种有效的方法是基于信道的跳频技术。

##### 信道

它是信息通过无线电波传送的具体通道介质。每种通信技术的频段会被划分、规划成多个[信道](https://en.wikipedia.org/wiki/List_of_WLAN_channels)来使用。比如，Wi-Fi 的频段被分为 14 个信道（中国可用的是 13 个信道，信道 14 排除在外）。这里需要注意的是，相邻信道的频段是存在重叠的。比如，Wi-Fi 的信道 1 频段是 2.401GHz～2.423GHz，信道 2 频段是 2.406GHz～2.428GHz。

##### 信道带宽

信道频段的最大值和最小值之差，就是信道覆盖的范围大小，也叫信道带宽。比如，Wi-Fi  信道 1 的带宽是 22MHz，它是由 2.423GHz 减去 2.401GHz 得到的。需要注意的是，22MHz 是信道 1 的实际带宽，而它的有效带宽只有 20MHz，因为其中有 2MHz 是隔离频带。隔离频带主要是起保护作用的，就像高速公路上的隔离带。

##### 传输速率

选择通信技术的时候，传输速率就是我们需要关注的重要指标。它是指数据传输的快慢，单位是比特 / 秒（bit per second，简记为 **bps**）。

不同的传输速率可以支撑不同的应用场景。比如，5G 峰值 20Gbps 的传输速率为移动 VR/AR 应用提供了技术可能。在 4G 时代，这种应用就会受到限制，我们只能在室内拖根线来感受 VR/AR 的魅力。

传输速率受很多因素的影响，比如信道带宽和频率。一般来说，带宽越大，传输速率就越大，就像路面越宽可以承载的通行车辆越多一样；频率比较高时，电磁环境相对比较干净、干扰少，传输速率会更高，就像道路更平坦自然可以通行更多车辆一样。

另外，为了提高传输速率，越来越多的**提高频段利用率**的技术也被开发出来并投入使用，比如正交频分复用。也许你对这个技术比较陌生，我再举一个更为人熟知的例子好了，**MIMO**（Multiple-Input Multiple-Output）技术，你可能在 Wi-Fi 路由器上或者手机宣传资料中见到过它，它是通过使用多重天线收发信号来提高传输速率的。

![无线通信4要素](https://s2.loli.net/2021/12/09/uMiHCBTqeFmG369.png)

实际应用中，不同的通信技术有不同的信道个数；同一种技术，不同的版本也会对信道做不同的划分。

#### Wi-Fi

[Wi-Fi](https://en.wikipedia.org/wiki/Wi-Fi#Versions) 是 IEEE 802.11 无线网络标准的商品名。所以，支持 Wi-Fi 功能的设备上，都会标注 “兼容 IEEE 802.11b/g/n 2.4GHz” 之类的说明。其中，802.11b、802.11g、802.11n 就是 Wi-Fi 的不同版本。

这种版本命名方式当然不够直观，所以 Wi-Fi 联盟从 2018 年开始推进数字版本号，比如，Wi-Fi 5、Wi-Fi 6。我在这里放了一张表格，展示了新旧版本号的对应关系。

![wifi](https://s2.loli.net/2021/12/09/4F69bw3KqsEWfZM.png)

Wi-Fi 网络分布广泛，在家里、在办公场所，包括很多公共区域都有覆盖。所以，它自然也成了很多智能设备的选择，尤其是**连接电源线、不需要关心功耗的设备**，往往优先考虑 Wi-Fi。

实践中有一个事情需要注意，那就是 **Wi-Fi 的配网**。之所以需要“Wi-Fi 配网绑定”这个操作流程，根本原因是，物联网设备不像手机、电脑，没有便利的信息输入手段，也没有完备的信息显示器件。因此，我们无法像在手机上一样，帮设备搜索、连接上 Wi-Fi 热点。相反，我们需要借助其他手段来完成两件事情：

1. Wi-Fi 设备需要连接上路由器（Wi-Fi 热点或者 AP）实现数据上传和远程控制，即获取到 Wi-Fi 热点的名称（称为 SSID）和密码。
2. 获取到 Wi-Fi 设备的 MAC 地址，或者设备生产时预存的信息，并与用户账号一起上传服务器完成绑定。

完成这两步之后，设备才可以联网使用。

##### 一键配网技术（SmartConfig）

一键配网技术的工作原理，是通过手机或 Wi-Fi 路由器发送 UDP 广播包的形式，将 Wi-Fi 的 SSID 和密码广播出去。Wi-Fi 设备在进入配网模式后，会将接收到的广播包进行解析，从而获取到 Wi-Fi 的 SSID 和密码，然后连接上路由器。同样地，Wi-Fi 设备连接上路由器后，也会广播自己的 MAC 地址，这样手机 App 就可以接收到设备的 MAC 地址完成绑定。

这个原理看着不复杂，但却有几个容易出错的地方：

1. 很多路由器不支持 UDP 广播，例如 Wi-Fi 放大器或者关闭 UDP 广播的路由器，会导致在发广播包这步就失败了。
2. 目前很多路由器已经支持 2.4GHz 和 5GHz 两个频段（Wi-Fi 4 之后），这两个频段的网络是相互隔离的。手机很可能连接的是 5GHz 频段，那包含 SSID 和密码的广播包也在 5GHz 频段，而目前所有 Wi-Fi 智能设备都只支持 2.4GHz 频段，这就导致无法收到广播包。
3. 2018 年之前的 Wi-Fi 产品（比如微信 AirKiss 2.0）存在广播包解析错误的问题，很可能发生解析的密码不正确的情况，导致无法连接路由器。
4. 路由器不支持局域网通信（比如路由器的访客网络），或者空间中有几个 SSID 相同的 Wi-Fi 热点，手机和 Wi-Fi 设备分别在不同的路由器下面，会导致设备即使连接上了路由器，但是手机无法获取设备信息的广播包的情况。

##### 设备热点配网技术

设备热点配网技术是让 Wi-Fi 设备先进入 Wi-Fi AP 的模式，也就是说，由设备创建出一个 Wi-Fi 热点，然后让手机连接到这个热点，接着把路由器 Wi-Fi 的 SSID 和密码发送给 Wi-Fi 设备，同时手机也可以直接获取到设备的 MAC 地址。

这种方式的麻烦之处在于，你需要手动输入路由器 Wi-Fi 的密码。在苹果手机上，你还需要进入设置界面，手动选择连接智能设备的 Wi-Fi 热点。

其他 Wi-Fi 配网技术还有零配置配网、蓝牙配网、手机热点配网和路由器配网等技术方式。[下图](https://help.aliyun.com/document_detail/97570.html)展示了各种配网技术中角色之间的关系，供你参考。

![配网](https://s2.loli.net/2021/12/09/8SArZ9fMdvwjckF.png)

#### BLE

连接电源线、不需要关心功耗的设备往往优先考虑 Wi-Fi，那么功耗要求严格的设备要怎么办呢？

BLE （Bluetooth Low Energy）是一个不错的选择。它的频段是非授权的 2.400GHz-2.4835GHz，采用 40 个带宽 2MHz 的通道。BLE也叫低功耗蓝牙，是对 Bluetooth 4.0 / 4.1 / 4.2 的统称。现在它已经成为低功耗物联网设备的首选，仅仅依靠一颗纽扣电池供电就可以工作数年。

而蓝牙 5 更是针对物联网增加了很多特性，比如 Mesh 组网、更远的通信距离、更快传输速率（BLE 4.2 的 2 倍）和更大数据承载量的广播包（BLE 4.2 的 8 倍），此外还有厘米级精度的定位功能。

除了这些，蓝牙技术还有一个优势，那就是应用实践非常广泛，是智能手机等设备的标配。因此，无论是从芯片模组的价格考虑，还是从生态的丰富度考虑，它都是电池供电的智能设备的理想选择。

BLE 的数据通信主要基于**广播包**和 **[GATT](https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt)** 协议。

连接参数的调节对于 BLE 设备的扫描和连接等影响很大。这些参数包括广播间隔、最大连接间隔、最小连接间隔和连接监听时间等，它们都可以在设备的固件开发中进行调整。比如广播间隔会影响扫描的响应速度，也会对设备的功耗有影响，所以需要平衡功耗和响应速度的不同需求，选择一个合适的值。

如果扫描连接体验需要非常流畅迅速，你可以选择 20ms 的间隔，但是这会增加设备的功耗，减少待机时间；如果你能够容忍一定的扫描等待时间，那么可以选择 1-2 秒的广播间隔来降低功耗。

如果你在 Android 手机上开发 BLE 相关的应用，还有两点是我想提醒你的。

一是不同品牌 Android 手机的芯片解决方案往往是不同的，它们的蓝牙协议栈实现也存在很大的差异。所以开发者需要针对不同的手机进行充分的测试，保证开发的应用在不同的手机上都可以正常运行。

二是因为基于 BLE 可以进行地理位置定位，所以从 Android 6.0 开始，进行 BLE 开发时需要请求位置权限。这一点经常被忽略，也是需要注意的。

#### 2G

2G 是相对早期的蜂窝通信技术，你可能觉得这个词听起来都已经有些年代感了。不过，在一些传输数据量不大的场景中，采用 2G 技术的联网设备还有不少，比如路灯控制器、冷链运输监测设备等。

但是，你在新产品的设计中要尽量避免使用 2G 模组，因为 2G 的退网已经不可避免。联通已经率先推进，移动也开始逐步实施，腾出的频段会用于发展 5G 网络通信。如果新产品仍然采用 2G 模组，未来无网可用时会非常麻烦，甚至在那之前你就会遇到很多因网络引起的产品体验问题。

#### [LTE-Cat1 & NB-IoT](http://www.gov.cn/zhengce/zhengceku/2020-05/08/content_5509672.htm)

那么，2G 的替代选择是什么呢？从目前国内通信产业的发展看，LTE-Cat1 和 NB-IoT 是你值得关注的选项。NB-IoT 模组的价格已经和 2G 模组基本持平；LTE-Cat1 的模组相比要贵一些，但是也要远低于 4G 模组的价格。

LTE-Cat1 有一个独特优势是网络覆盖，它属于 4G 网络的低速类别，可以直接使用我们国家完善的 4G 的网络设施。而 NB-IoT 虽然已经发展多年，但是目前网络覆盖仍然不够理想，这也限制了这些年 NB-IoT 的广泛应用。不过，NB-IoT 大概率会成为 5G 的重要组成部分。随着 5G 产业的发展，我相信 NB-IoT 仍然会广泛应用在低速率、广域网络的场景中。

LTE-Cat1 的带宽是 20MHz，上行速率 5Mbps，下行速率 10Mbps。它有良好的移动特性，功耗比 NB-IoT 大些，但是低于传统的 2G/3G 设备。所以它适合可穿戴设备、ATM 机、自助售货机和无人机等场景。这些场景对数据传输速率有一定要求，但是又不需要达到 4G 的水平。

NB-IoT 的带宽是 180KHz，上行速率 16.9Kbps，下行速率是 26Kbps，功耗很低。所以它不适合移动环境，但却很适合智能抄表、智能灯杆和烟感报警器等低数据速率的场景。

![LTE-NB](https://s2.loli.net/2021/12/10/qijXkv29Cx7rRla.png)

#### 5G

5G 被分为 3 个主要应用场景，分别对应 eMBB、uRLLC 和 mMTC 3 个标准：

1. **eMBB** 用于我们日常的手机移动通信，网络传输速率高主要就是指这个标准。
2. **uRLLC** 应用的场景是无人驾驶、远程手术等，所以强调的是极低时延，而且是稳定的时延和速率，这不难理解，如果远程做手术，那肯定不能出现卡顿和忽长忽短的时延。
3. **mMTC** 可以支持大规模设备的连接上网，适合智能门锁、烟感传感器、路灯等低速率、低成本、低功耗的物联网设备。

为物联网场景提供新的想象空间的，其实是 uRLLC 和 mMTC ，但是这两个标准还没有正式发布，真正部署的时间更是不确定。不过，这并没有影响物联网的落地，原因主要有两个：

1. 像智能门锁等场景可以选择 NB-IoT、LTE-Cat1 等已经成熟的蜂窝网络技术；
2. 物联网的场景非常多样，Wi-Fi、BLE、LoRa 等非蜂窝技术一样有用武之地。

#### 总结

1. 无线通信技术有 4 个重要的参数：频段、信道、带宽和传输速率。当遇到新的无线技术时，你可以把它们作为了解、分析的一个角度，进而更好地指导实践。
2. Wi-Fi 和 BLE 在移动互联网时代应用广泛，未来仍是理想的技术选择。连接电源线、不怎么关心功耗的设备往往优先考虑 Wi-Fi，而依靠电池供电、比较关心功耗的设备则更加适合 BLE。
3. 对于 Wi-Fi 智能设备来说，Wi-Fi 配网绑定是比较麻烦的事情，所以很多物联网平台和模组厂家推出了一键配网技术。但是因为其不能保证 100% 的成功率，设备热点配网技术可以作为备选方案一起提供，甚至也可以作为主选方案。
4. 2G 的退网已是趋势，在实践中可以考虑 LTE-Cat1 和 NB-IoT 两种蜂窝通信技术。对于非移动的、传输数据量很小的设备可以选择 NB-IoT；传输数据量更大，又不需要达到 4G 能力的设备可以考虑模组越来越成熟的 LTE-Cat1 技术。

![通信技术](https://s2.loli.net/2021/12/10/AaCfbrjNMJ9pTZ3.png)