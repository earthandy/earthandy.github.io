<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>The complete life cycle of a C program</title>
      <link href="/2022/04/08/the_complete_life_cycle_of_a_c_program/"/>
      <url>/2022/04/08/the_complete_life_cycle_of_a_c_program/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="Quick-review-of-C-core-syntax-with-a-program"><a href="#Quick-review-of-C-core-syntax-with-a-program" class="headerlink" title="Quick review of C core syntax with a program"></a>Quick review of C core syntax with a program</h4><p>There are many mature C compilers on the market to choose from, but different compilers may have differences in supported platforms (Unix-like, Windows) and C standards (C89, C99, C11, C17), so you need to choose Pay special attention to these issues. Both GCC and Clang used in this course support the latest C standard, C17, and both run on Unix-like and Windows systems.</p><p><a href="https://godbolt.org/z/sdxP66xP4">source code</a></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BOOL_TRUE</span>  <span class="token expression"><span class="token number">1</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BOOL_FALSE</span> <span class="token expression"><span class="token number">0</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">typename</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">_Generic</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">short</span><span class="token operator">:</span> </span><span class="token string">"unsigned short int"</span><span class="token expression"><span class="token punctuation">,</span></span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token operator">:</span> </span><span class="token string">"unsigned long int"</span><span class="token expression"><span class="token punctuation">,</span></span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">default</span><span class="token operator">:</span> </span><span class="token string">"unknown"</span><span class="token expression"><span class="token punctuation">)</span></span></span><span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token punctuation">{</span>HOST<span class="token punctuation">,</span>IP<span class="token punctuation">}</span> IP_ADDR_TYPE<span class="token punctuation">;</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>    <span class="token class-name">size_t</span> id<span class="token punctuation">;</span>    <span class="token class-name">uint16_t</span> port<span class="token punctuation">;</span>    bool closed<span class="token punctuation">;</span>    IP_ADDR_TYPE addr_type<span class="token punctuation">;</span>    <span class="token keyword">union</span> <span class="token punctuation">{</span>        <span class="token keyword">char</span> host_name<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">char</span> ip<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span> CONN<span class="token punctuation">;</span><span class="token keyword">inline</span> <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">findAddr</span><span class="token punctuation">(</span><span class="token keyword">const</span> CONN<span class="token operator">*</span> pip<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">assert</span><span class="token punctuation">(</span>pip <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> pip<span class="token operator">-&gt;</span>addr_type <span class="token operator">==</span> HOST<span class="token operator">?</span>pip<span class="token operator">-&gt;</span>host_name<span class="token operator">:</span>pip<span class="token operator">-&gt;</span>ip<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">static_assert</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONN<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0x400</span><span class="token punctuation">,</span><span class="token string">"the size of CONN object exceeds limit."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> CONN conns<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span>BOOL_TRUE<span class="token punctuation">,</span>IP<span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token punctuation">.</span>ip<span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">,</span>BOOL_FALSE<span class="token punctuation">,</span>IP<span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token punctuation">.</span>ip<span class="token operator">=</span> <span class="token string">"192.168.1.1"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8088</span><span class="token punctuation">,</span>BOOL_FALSE<span class="token punctuation">,</span>HOST<span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token punctuation">.</span>host_name<span class="token operator">=</span> <span class="token string">"http://localhost"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>conns<span class="token punctuation">)</span><span class="token operator">/</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span>            <span class="token string">"Port: %d\n"</span>            <span class="token string">"Host/Addr:%s\n"</span>            <span class="token string">"Internal type of `id` is: %s\n\n"</span><span class="token punctuation">,</span>            conns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>port<span class="token punctuation">,</span>            <span class="token function">findAddr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">typename</span><span class="token punctuation">(</span>conns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This code uses many language features spanning the K&amp;R C to C17 standard, creates multiple objects based on custom types, and prints information about these objects at the end of the program.</p><h5 id="Entry-Function"><a href="#Entry-Function" class="headerlink" title="Entry Function"></a>Entry Function</h5><p>All C programs use the <code>main</code> function as the entry function. The entry function refers to the function that will be called first in the code when the program starts running. In the <code>main</code> function, we can selectively access the external parameters passed by the user to the program when the program starts running through the actual parameters it receives.</p><p>The <code>main</code> function returns an <code>integer</code> at the end of execution, which is used to indicate the state of the program at the end of execution. Usually, the number <code>0</code> is returned to indicate that the program exits normally, and other numbers are returned to indicate abnormal exit. In order to keep the code readable, here we use the macro constant <code>EXIT_SUCCESS</code> defined in the standard library as the return value of the program exit. As the name implies, the actual value corresponding to this macro constant is the number <code>0</code>.</p><h5 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h5><p>Inside the <code>main</code> function, we use the “brace-enclosed lists” method to complete the initialization process of the array conns. And in the initialization list, we also use assigned initialization (set “designator” for the items in the initialization list) to explicitly specify the specific position of these items in the array. For example, the “[2]” corresponding to the first item here means that the item is set to the third element in the array conns (the index starts from <code>0</code>).</p><h5 id="Structure-and-Union"><a href="#Structure-and-Union" class="headerlink" title="Structure and Union"></a>Structure and Union</h5><p>Inside the array conns, there are several structure objects of type <code>CONN</code>. In the <code>C</code> language, Structures and Unions (sometimes called structures and unions) are often used to organize complex types of custom data. In a Structure, the corresponding data of all defined fields are arranged in the direction of memory contiguous; in a Union, only one of the defined fields can be “valid” at the same time.</p><p>Array-like parenthesized list initialization, as well as assignment initialization, is also used during initialization of the struct <code>CONN</code> object. But unlike the previous array initialization, the assignment here is for the member fields inside the Structure and Union type, so you need to use the “.” symbol to refer to a specific member, not the form used by the array.</p><h5 id="Control-Structure"><a href="#Control-Structure" class="headerlink" title="Control Structure"></a>Control Structure</h5><p>Use the <code>for</code> statement to loop through the contents of the array conns. In addition, commonly used control structures in <code>C</code> language include <code>switch</code> statement, <code>while</code> statement, and <code>goto</code> statement, etc.</p><h5 id="Pointer"><a href="#Pointer" class="headerlink" title="Pointer"></a>Pointer</h5><p>Pointers are one of the most dangerous but also the most powerful “weapons” in the <code>C</code> language. With the help of pointers, we can flexibly manipulate the memory resources that the program enjoys.</p><p>We pass the address of each element in the array conns to the function findAddr, which receives a constant pointer to an object of type CONN. So, with this pointer, we cannot modify the value of the object pointed to by the pointer inside the function. And this, to a certain extent, ensures that the function can only have the minimum permissions enough to complete its task.</p><h5 id="Macro"><a href="#Macro" class="headerlink" title="Macro"></a>Macro</h5><p>The compiler’s processing of <code>C</code> source code is divided into several stages, with macros being the first part to be processed. At the beginning of this code, we introduce some external dependencies required for the normal operation of the program through the macro instruction “#include”, which will be replaced when the program is compiled. Then, we define the corresponding macro constants and macro functions through the “#define” directive, and the macro function typename uses the _Generic keyword newly introduced by the C11 standard to implement macro-based generics.</p><h5 id="Assertion"><a href="#Assertion" class="headerlink" title="Assertion"></a>Assertion</h5><p>In <code>C</code> code, we usually use assertions to check some hypothetical condition that needs to support the normal operation of the program. When the condition is not satisfied, the program will be terminated when the program is compiled or run, and a corresponding error message will be thrown to the user.<code>C</code> language provides two types of assertions, static and dynamic. Static assertions are checked when the code is compiled, while dynamic assertions are checked when the assertion statement is executed during program execution.</p><h5 id="Function-Inlining"><a href="#Function-Inlining" class="headerlink" title="Function Inlining"></a>Function Inlining</h5><p>In the definition code of the function <code>findAddr</code>, we add a keyword named <code>inline</code> to it. By using this keyword, we can “advise” the compiler to directly replace the internal logic of the function at the calling location of the function, so as to reduce the overhead generated when the function is called. This method is usually used for functions whose function bodies are small and will be called multiple times to produce significant performance improvements.</p><h5 id="Other-Features"><a href="#Other-Features" class="headerlink" title="Other Features"></a>Other Features</h5><p>If you are unfamiliar with some of these features, you can choose to find and learn about specific topics directly on the <a href="https://www.geeksforgeeks.org/c-programming-language/?ref=ghm">GeeksforGeeks</a> website, or check out the introductory books 《C Primer Plus》.</p><h5 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h5><p><img src="c.png" alt="C syntax summary"></p><h4 id="C-programming-paradigm"><a href="#C-programming-paradigm" class="headerlink" title="C programming paradigm"></a>C programming paradigm</h4><p>Syntax details aside, in general, <code>C</code> is an “imperative” programming language, similar to <code>Java, C#, Go</code>, etc.</p><p><code>Imperative programming</code> is a programming paradigm that describes how a program should run using code statements that can change the state of the program. This approach focuses more on the specific steps that the computer needs to perform to complete the task.</p><p>Taking the <code>C</code> language as an example, the steps to solve this requirement may be as follows: use an array to construct a memory space that can store these numbers; use a loop control statement to check whether the numbers in the memory meet the requirements (that is, greater than 7) in turn; For numbers that meet the requirements, copy them into a new memory space and temporarily store them as the result.</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ARR_LEN</span> <span class="token expression"><span class="token number">5</span></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token keyword">int</span> arr<span class="token punctuation">[</span>ARR_LEN<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ARR_LEN<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// save this element somewhere else.</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Other languages are generally classified as “declarative” programming languages relative to imperative programming languages. Declarative programming is also a common programming paradigm. The difference is that this paradigm is more inclined to express the logic of the calculation, rather than the specific steps that the computer needs to perform to solve the problem.</p><p>For example, in the same requirement just now, when using a declarative programming language, the corresponding solution steps may be: build a container to store data; filter the container data according to the conditions, and return the data that meets the conditions as the result. Using <code>JavaScript</code> as an example, the corresponding code might look like this:</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">let</span> result <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token number">7</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>It can be seen that, compared to imperative programming, declarative programming is more inclined to express what should be done when solving a problem (build a container, filter), rather than how to do it (allocate memory, traverse, copy).</p><p>Generally speaking, the difference between an imperative programming language and a declarative programming language is mainly reflected in the degree of abstraction of the language features of the two compared to the computer instruction set. Among them, imperative programming languages have a lower level of abstraction, which means that the grammatical structures of such languages can be directly implemented by corresponding machine instructions. However, declarative programming languages have a higher degree of abstraction. Such languages are more inclined to describe program logic in a narrative way, and developers do not need to care about the implementation details behind the language at the machine instruction level. The two languages have their own application scenarios, and there is no such thing as good or bad.</p><h4 id="Compiling-and-running-C-programs"><a href="#Compiling-and-running-C-programs" class="headerlink" title="Compiling and running C programs"></a>Compiling and running C programs</h4><p>After writing a piece of <code>C</code> code, the next step is to compile this code. When executing the compilation command, in order to ensure the robustness of the program, we usually attach the parameter “-Wall” at the same time, so that the compiler can clearly point out the inappropriate use of all syntaxes in the program code.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gcc HelloWorld.c -o HelloWorld -Wall <span class="token operator">&amp;&amp;</span> ./HelloWorld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Generally speaking, the complete compilation process of C code can be divided into the following four stages:</p><p><img src="compilation-process.png" alt="Compilation Process"></p><p><img src="helloWorld-compilation-process.png" alt="HelloWorld Compilation Process"></p><ol><li><strong>Code preprocessing</strong>: The compiler will first remove all comments in the source code and process all macro instructions. These include macro expansion, macro substitution, and conditional compilation.</li><li><strong>Compilation and optimization</strong>: The compiler analyzes and optimizes the source code, and compiles it into the corresponding assembly format code, which contains the original <code>C</code> program logic described by assembly instructions.</li><li><strong>Assembly</strong>: The compiler will compile these assembly codes into an object file format with a certain format that can be used by the operating system.</li><li><strong>Linking</strong>: Through the linking process, the compiler will integrate all the object files currently required by the program, set the correct addresses of all calling functions in the program, and generate the corresponding binary executable file.</li></ol>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How the function is called in C Language</title>
      <link href="/2022/03/20/how_the_function_is_called_in_c_language/"/>
      <url>/2022/03/20/how_the_function_is_called_in_c_language/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>In programming languages, a function is a syntactic construct used to encapsulate reusable code. Functions can receive data from the external calling environment, and use these data to construct independent functional logic units in the form of compound statements in the function body. With the help of functions, we can split the implementation of a program into substeps and build the program in a structured way. This approach reduces repetitive code in the program and improves overall code readability and traceability through abstraction and replacement.</p><h4 id="Calling-conventions-for-C-functions"><a href="#Calling-conventions-for-C-functions" class="headerlink" title="Calling conventions for C functions"></a>Calling conventions for C functions</h4><p>The calling convention specifies a series of issues that need to be paid attention to when a function is called, such as: how to pass arguments to the called function, how to return the return value from the called function, how to manage registers, and how to manage stack memory, etc. The calling convention is not part of the C language standard, so in fact each compiler can use its own unique calling convention to implement the calling process of C functions. But correspondingly, this also leads to another problem: when a function with external linkage is used in multiple different compilation units, and the source files corresponding to these different compilation units are compiled by different compilers, then they each generate The object files may no longer be brought together and produce the final executable.</p><p>Fortunately for C, compilers running on the x86-64 platform basically choose to use several common de facto calling conventions, depending on the operating system. For Windows, for example, the compiler uses the proprietary Microsoft x64 or Vector calling convention. On Unix and Unix-like systems, a calling convention called the System V AMD64 ABI (hereafter “SysV”) is used.</p><p>Next, let’s see what important implementation details are specified in the SysV calling convention. In order to observe these contents more intuitively, let us first write a simple C code, and use the default optimization level on the x86-64 platform to generate its corresponding assembly code through GCC compilation. Specifically as shown in the figure below:</p><p><img src="C-function-call-sample-code.png" alt="C function call sample code"></p><p>In fact, in x86-64 machine instructions, function calls are done through the <code>call</code> instruction. After each function body is executed, it needs to exit the execution of the function through the <code>ret</code> instruction, and transfer the code execution flow to the next instruction of the previous function call instruction. You can intuitively feel this process through the following picture. Among them, the arrows mark the overall execution order of the code.</p><p><img src="C-language-function-call.png" alt="C language function call"></p><p>Next, let’s take a look at what the <code>SysV</code> calling convention specifies when a function is called.</p><h5 id="Parameter-Passing"><a href="#Parameter-Passing" class="headerlink" title="Parameter Passing"></a>Parameter Passing</h5><p>The first rule of the <code>SysV</code> calling convention is: when calling a function, for the actual parameters of integer and pointer types, the registers <code>rdi, rsi, rdx, rcx, r8, and r9</code> need to be used respectively, and the parameters are defined from left to right when the function is defined. value is passed in order. And if a function receives more than 6 parameters, the remaining parameters will be transferred through the stack memory. At this time, the extra parameters will be pushed into the stack one by one in the order <code>from right to left (RTL)</code>. You can verify this by looking at the assembly code in the red box on lines 30 to 40 to the right of the figure (example code for a C function call).</p><p>Here, before the function foo is called, the registers <code>edi and esi</code> are used to store the values of the local variables x and y, respectively, and the registers <code>edx, ecx, r8d, and r9d</code> are used to store the literal values 3, 4, 5, and 6. The other two literal value parameters 7 and 8 are placed in the stack memory directly through the push instruction. You need to pay attention to the order in which this instruction operates on them, because the parameters are guaranteed to be placed on the stack in right-to-left order. Also, since x and y are local variables, they are initially stored in stack memory.</p><p>In addition, for floating point parameters, the compiler will use additional <code>xmm0</code> to <code>xmm7</code>, a total of 8 registers for storage. For wider values, ymm and zmm registers may also be used instead of xmm registers. The <code>xmm, ymm, and zmm</code> registers mentioned above are all used by the extended instruction set called <code>AVX (Advanced Vector Extensions)</code> in the x86 instruction set architecture. These instruction sets are generally dedicated to floating-point calculations and SIMD-related processing.</p><h5 id="Return-Value-Passing"><a href="#Return-Value-Passing" class="headerlink" title="Return Value Passing"></a>Return Value Passing</h5><p>For the return value generated by the function call, the <code>SysV</code> calling convention also has corresponding rules: when the function call generates a return value of integer type and is less than or equal to 64 bits, it is passed through the register <code>rax</code>; when it is greater than 64 bits, less than or equal to 128 bits, Then use the registers rax and rdx to store the low 64 bits and high 64 bits of the return value respectively. You can refer to the code in the blue box on the right side of the figure (C function call sample code) 4, 21, 47 to verify this rule. These three lines of code deal with the return value of the functions bar, foo, and main respectively. It should be noted that for the return value of a composite type (such as a structure), the compiler may directly use the stack memory for “transit”.</p><p>For the return value of floating point type, similar to parameter passing, the compiler will use the xmm0 and xmm1 registers for storage by default. When the return value is too large, <code>ymm and zmm</code> are selectively used instead of the <code>xmm</code> register.</p><h5 id="Register-usage"><a href="#Register-usage" class="headerlink" title="Register usage"></a>Register usage</h5><p>The <code>SysV</code> calling convention also stipulates the use of registers: for registers <code>rbx, rbp, rsp, and r12 to r15</code>, if the called function needs to use them, the function needs to temporarily store the values in these registers before using them. and restore their values (callee-saved) before the function exits. For other registers, their values are saved and restored according to the needs of the caller (caller-saved).</p><h5 id="Stack-Cleanup"><a href="#Stack-Cleanup" class="headerlink" title="Stack Cleanup"></a>Stack Cleanup</h5><p>Each function needs to clean up the stack by itself before the end of the call. For example, in the code shown in the figure (C function call sample code), when the foo function is called, it allocates the corresponding space in the stack memory to store the value of the local variable n. After the function is executed and ready to exit, it needs to clean up the data allocated on the stack by itself. And this task can be done by the leave instruction.</p><p>In addition, the cleanup of the arguments passed in before the foo function is called is done by the calling function, which is the main function here. It can be seen that when the foo function call ends and the program execution flow returns to the next instruction of the previous call instruction, the program modifies the value of the rsp register through the add instruction. In this way, the main function cleans up the arguments passed to the function foo that were previously placed on the stack.</p><h5 id="Other-Conventions"><a href="#Other-Conventions" class="headerlink" title="Other Conventions"></a>Other Conventions</h5><p>In addition, the <code>SysV</code> calling convention has the following provisions:</p><ul><li>Before the function is called by the call instruction, it needs to ensure that the top of the stack is aligned with 16 bytes, that is, the address value (in bytes) of the top of the stack is a multiple of 16;</li><li>Reserve 128 bytes from the top of the stack as the “Red Zone”; the ed Zone is a fixed-length memory segment located on the top of the stack (low address direction), which can usually be called by the “leaf” function in the function stack. (i.e. functions that no longer call other functions) use. In this way, when additional stack memory is required, the process of adjusting the size of the stack memory first can be omitted under certain conditions.</li><li>Different from the calling process of the user function, the system call function needs to use the registers <code>rdi, rsi, rdx, r10, r8, r9</code> to pass parameters.</li></ul>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Organized the Data and Magnitude</title>
      <link href="/2022/03/19/how_data_and_magnitude_are_organized/"/>
      <url>/2022/03/19/how_data_and_magnitude_are_organized/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="Quantities-and-Data-in-C-Language"><a href="#Quantities-and-Data-in-C-Language" class="headerlink" title="Quantities and Data in C Language"></a>Quantities and Data in C Language</h4><p>Quantities can be roughly divided into variables and constants, where a variable refers to a quantity whose value can be changed many times throughout the life cycle of an application; while a constant is the opposite, after being defined cannot be modified again.</p><h5 id="Variable"><a href="#Variable" class="headerlink" title="Variable"></a>Variable</h5><p>The C language provides us with many language keywords to define the corresponding types of data. For example, in the following example, we successfully define multiple variables through the following steps:</p><ol><li>Use keywords such as <code>int</code> to specify the specific type of data;</li><li>Set a name for the data;</li><li>Use the “=” assignment operator to set a specific value for the data.</li></ol><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span> <span class="token keyword">char</span> y <span class="token operator">=</span> <span class="token string">'c'</span><span class="token punctuation">;</span> <span class="token keyword">double</span> z <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>The specific byte size occupied by variable types in the C language is also closely related to the hardware architecture where the program runs, which is also the difference between the C language and other high-level programming languages.</p><p>When the C language was originally designed, efficiency was a major consideration for the designers. Therefore, the C standard committee will refer to certain factors from the underlying hardware system when considering language design. For example, the C standard specifies that the size of the int type is the natural size recommended by the execution environment architecture. The so-called natural size can be simply understood as: for data of this size, the hardware system can process it with the highest efficiency. Therefore, different hardware systems have different corresponding natural sizes, which means that the same C variable type may have different sizes on different hardware systems.</p><p>In addition to being able to specify different data types for variables, in C, like most other statically typed languages, integer variables themselves need to be distinguished by their “signedness”. In short, there are actually two cases: if the type can only store positive numbers, it is an unsigned type; if both positive and negative numbers can be stored, it is a signed type. The difference in symbolism is beneficial to the optimization of the program for some specific scene requirements.</p><h5 id="Constant"><a href="#Constant" class="headerlink" title="Constant"></a>Constant</h5><p>In C, literal values that are written directly into source code by inlining are generally referred to as “constants”.</p><p>A quantity defined with the const keyword in the same syntax as a variable is defined, isn’t it also a constant? How is it different from literal constants?</p><p>Generally speaking, in the C language, the variable definition statement modified with the const keyword means that for these variables, we cannot modify the corresponding value or the value pointed to by the pointer in the subsequent program. Therefore, we prefer to call them “read-only variables” rather than constants. Of course, in the appearance of the program, the two have one thing in common: its value is determined the first time it appears, and it cannot be modified in subsequent programs.</p><p>One of the most important differences between read-only variables and literal constants is that read-only variables decorated with const do not have the property of “constant expressions”, so they cannot be used to represent the size of fixed-length arrays or used in case statements. Constant expressions themselves are evaluated when the program is compiled, whereas the values of read-only variables are only known when the program is actually running. Also, compilers generally do not inline read-only variables, so their evaluation does not qualify as a constant expression.</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token keyword">int</span> vx <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">int</span> vy <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> arr<span class="token punctuation">[</span>vx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// [error1]</span>  <span class="token keyword">switch</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> vx<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// [error2]</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Value matched!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Form-of-data-storage"><a href="#Form-of-data-storage" class="headerlink" title="Form of data storage"></a>Form of data storage</h4><p>When a computer looks at data, it does not distinguish its symbolic nature, and the difference in symbolic nature is only reflected in the specific use of computer instructions when manipulating data.</p><p>Computers do not distinguish between the symbolic nature of data, the difference in symbolic nature is only determined by how the computer instructions use the data. For example, in the C language, when a type of variable is cast, the underlying data does not change substantially, but only the way the program interprets this part of the data changes. Take this example:</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">signed</span> <span class="token keyword">char</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span>x<span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// output: 246.</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Among them, the signed integer variable x will store the signed number -10 in the complement form of the bit pattern 1111 0110, and if the sequence is interpreted according to the bit pattern of the unsigned integer, you can get the same result as the program running output , which is the unsigned integer value 246. In short, when the program performs type conversion, it will not affect the actual storage method of its underlying data.</p><p>In the C language, there is another noteworthy issue about data usage: the implicit conversion of variable types. As a weakly typed language, one of the major features of C language is that in some special cases, the actual type of the variable will be implicitly converted.</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"x is smaller than y."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"x is bigger than y."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// this branch is picked!</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>In fact, in the above code, before the program logic actually enters the conditional statement, the type of the variable x is first implicitly converted to unsigned int , which is an unsigned integer. According to the interpretation rules of data types, the bit pattern originally stored in -10’s complement will be interpreted as a very large positive integer, and this number is much larger than 1.</p><p>Like integers, when C language performs type conversion on floating-point numbers (whether implicit or explicit), it does not change the underlying floating-point data, but only changes the interpretation of the corresponding bit sequence from floating-point numbers. for other ways. In C, the double-precision floating-point type double has the highest precedence as an implicit type conversion. When a variable of that type exists in an expression, the computer first converts all other participating variables to that type before evaluating the expression.</p><h4 id="Where-the-data-is-stored"><a href="#Where-the-data-is-stored" class="headerlink" title="Where the data is stored"></a>Where the data is stored</h4><p>In the C language, through different syntax forms, we can define variables with different data types. These variables can be divided into local variables and global variables according to their definition locations. Further, by adding the static keyword, the variable can be marked as a static type to extend the lifetime of the variable and limit its visible scope to the current compilation unit, that is, the current source file; by adding the register keyword, it is also possible to suggest compilation The controller stores variable values in registers to improve its read and write performance.</p><p>For these variable forms mentioned above, the possible data storage locations are not the same. Based on the different syntax forms used when variables are defined, I have summarized the possible storage locations for variable data, as shown in the following table:</p><p><img src="C-language-data-storage-location.png" alt="C language data storage location"></p><p>It should be noted that the identifiers starting with “.” in the table and later in this lecture refer to the corresponding Section structure.</p><ol><li><strong>Initialized global variables and static variables</strong>：The values of these variables have the same life cycle as the application, and their values are usually stored in <code>.data</code> in the process <code>VAS (Virtual Address Space)</code>. Before an application is loaded and run normally, it needs to map the application code and the data of its related dependencies to a certain location in memory. This memory segment contains the data necessary for the normal operation of the application, that is, the process. the VAS. Section structures starting with “.”, such as <code>.data</code>, represent a specific location in the memory segment, and these Section structures provide various support for the normal operation of the application.</li><li><strong>Local variables</strong>：Generally speaking, these variables will be stored in registers or the stack memory of the application VAS, which method is used depends on the choice of the compiler.</li><li><strong>Others</strong>：Uninitialized global variables and static variables, as well as data contained in memory blocks directly created by standard library functions such as malloc and calloc, have different storage locations. They are stored in the .bss and heap memory of the process VAS respectively. Different types of constant data are also stored differently. As shown in the following table, due to the immutable characteristics of the constants themselves, they will be selectively stored in the <code>.rodata</code> and <code>.text</code> of the process VAS according to the size and type of the data. Among them, <code>.rodata</code> is used to store read-only data, and <code>.text</code> is usually used to store the code of the program itself.</li></ol><p><img src="Partial-data-storage-description.png" alt="Partial data storage description"></p><p>The general rule is that if the inlined constant value is large, it will be stored in .rodata separately, otherwise it will be directly inlined into the application code as the literal value of machine instructions (such as the most common <code>mov</code> instruction) parameter.</p>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Control Logic How Expressions And Statements Coordinate Program Execution</title>
      <link href="/2022/03/18/control_logic_how_expressions_and_statements_coordinate_program_execution/"/>
      <url>/2022/03/18/control_logic_how_expressions_and_statements_coordinate_program_execution/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="Expression"><a href="#Expression" class="headerlink" title="Expression"></a>Expression</h4><p>An expression is a grammatical structure consisting of a series of operators and operands. Generally speaking, the evaluation process of an expression is actually the process of recursively evaluating the expression and the sub-expressions it contains according to the precedence and associativity of the operators. From the point of view of compilation, the actual evaluation order of the operands involved in this process will be determined in the syntax analysis stage and reflected in the abstract syntax tree (AST, Abstract Syntax Tree) corresponding to the source code.</p><p>Expressions provide the ability to allow data to participate in different computations of multiple operators at the same time. By providing rules for operator precedence and associativity, expressions can control the orderly execution of the entire calculation process.</p><h4 id="Statement"><a href="#Statement" class="headerlink" title="Statement"></a>Statement</h4><p>Statements are the basic building blocks used to describe programs. Unlike expressions, a statement is the largest granularity unit that makes up a C program. Inside it, it can contain simple or complex expression structures, but it can also contain nothing. In addition to that, the statement returns no results when executed, but may have side effects.</p><p>In the C language, statements can be divided into five types: compound statements, expression statements, selection statements, iteration statements, and jump statements. But regardless of the type, the statements must end with a semicolon and be executed sequentially from top to bottom.</p><p>Among them, a compound statement refers to an area marked by curly braces “{}”. In this area, we can place declarations and statements, and the most common type of compound statement is the function body. Inside the function body, we can define variables and combine various other statements to implement the function’s functionality. An expression statement is a statement consisting of an expression followed by a semicolon, such as a function call statement or a variable assignment statement. Of course, the expression in the expression statement can also be empty, which makes it an empty statement consisting of only one “;”.</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">int</span> sum <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>   <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      sum <span class="token operator">=</span> <span class="token operator">-</span>sum<span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token keyword">return</span> sum<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="Select-Statement"><a href="#Select-Statement" class="headerlink" title="Select Statement"></a>Select Statement</h5><p>Similar to most other languages, in C, the select statement mainly refers to the statement composed of the two syntax structures <code>if…else</code> and <code>switch…case</code>. First look at the <code>if…else</code> statement:</p><p><img src="C-ifelse.png" alt="C language ifelse"></p><p>As can be seen from the assembly code in the red box, the value of the variable v is stored in the stack memory at the address of the value of the rbp register minus 4. The program uses multiple labels (such as .L2, .L3, etc.) to divide the processing logic corresponding to different branches, and the branch judgment process is completed by the instruction cmp and the conditional jump instructions je and jne. The overall logic of assembly code and C code is basically a one-to-one correspondence. Therefore, in this case, in order to keep the execution performance of the program as much as possible, you can put the conditional statement with a higher chance of hitting in the front position.</p><p>Next, let’s look at the <code>switch…case</code> statement.</p><p><img src="C-language-switchcase.png" alt="C language switchcase"></p><p>First, the assembly code will pass the cmp instruction to determine the value in the register eax, that is, whether the value of the variable v is greater than 60. If the judgment is established, the program will directly jump to the label .L2, and the number 4 will be used as the return value; if the condition is not established, the program will continue to execute. The code then generates a “token” value for participating in subsequent operators based on the value of the variable v. The steps to generate this value are as follows:</p><ol><li>Set the value of register <code>edx</code> to 1;</li><li>Set the value of register <code>ecx</code> to the value of variable v;</li><li>Shift the value in register <code>rdx</code> left by v bits (the value is extended to 64 bits);</li><li>Move the value in register <code>rdx</code> to rax for later use.</li></ol><p>Next, the program completes the first screening process for the value of the variable v. This process is easy to understand. If you expand the immediate operand 1154047404513689600 of the first line of instruction movabs in 64-bit binary, you will find that only the 50th and 60th bits are set.</p><p>The <code>and</code> instruction in the second line will “AND” the super-long immediate value with the token value obtained by shifting the value of the variable v before. If the result of the operation is not 0, it means that the 50th or 60th bit of the token value is definitely not 0, that is, the value of the variable v is 50 or 60. Otherwise, the value of the variable v does not meet the filter criteria of the case statement. At this point, I believe you have already understood the basic logic of screening.</p><p>However, branch filtering by means of “bitmap” does not cover all cases perfectly. For example, when the filter value of the case statement is too large to use the register to map, the compiler will “fall back” the implementation of <code>switch…case</code> to a similar way to <code>if…else</code> under the default optimization condition. That is to say, use cmp instructions and conditional jump instructions to filter and branch branches. Of course, which implementation strategy is adopted varies by compiler.</p><p>In addition to the implementation of the <code>if…else</code> and <code>switch…case</code> statements described above, under high optimization levels, the compiler may also use a method called “skip table” to implement these two conditional selection statements.</p><p><img src="Switchcase-optimization-in-C-language.png" alt="Switch case statement with high optimization in C language"></p><p><strong>The skip table is a conditional matching strategy that trades space for time.</strong></p><p>First, the assembly code marked in red subtracts the value of the variable v from the value of the smallest matching condition in the select statement, which is 10 in this case. Then, the program uses the cmp and ja instructions to determine whether the value of the variable v exceeds the difference between the maximum matching condition and the minimum matching condition in the select statement, which is 30 here. If so, the program jumps directly to label .LBB0_3 and returns the value 3.</p><p>Otherwise, the program uses the skip table to find the correct branch for the value of variable v. The so-called jump table is the address information that is stored in a continuous memory and can be used to assist in finding the correct target address. In the above example, the jump table starts at label .LJTI0_0. In this memory, the correct branch processing address corresponding to each integer value in the range of 10 to 40 of the filter value is continuously stored. The next blue code holds the value that the function needs to return when the skip table item 0 “hit”.</p><p>Suppose that when calling function foo, the value of the variable v passed in is 20. When the jmp instruction in the dotted box is executed, it will find its corresponding correct branch address in the jump table according to the value of v. Since the value in the rdi register here is 10 (20 - 10), the correct branch handle address is the value corresponding to the tenth entry in the jump table. It can be seen here that at the position of the .LJTI0_0 label + 80 bytes (.quad represents 8 bytes of data), it corresponds to the address of the label .LBB0_4. The location of this label is the correct branch processing address when the variable v has the value 20.</p><p>In addition to the common ways that these compilers implement branch statements mentioned above, depending on the specifics of the branch statement, the compiler may also employ some specialized optimizations for specific shapes of code. Even for the most “original” combination of cmp and conditional jump statements, the compiler will appropriately use optimization strategies such as “dichotomy” according to the conditions of the C source code to speed up the conditional screening process.</p><p>In summary, select statement compilers typically implement them in the form of bitmaps, skip tables, dichotomy-based tests, and conditional jump statements.</p><h5 id="Iteration-Statement"><a href="#Iteration-Statement" class="headerlink" title="Iteration Statement"></a>Iteration Statement</h5><p>In the C language, the iteration statement mainly includes three basic grammatical forms: <code>do…while</code>, for, while. Except for some differences in the execution details of these statements, the corresponding assembly implementation ideas are similar. Here I take the <code>do…while</code> statement as an example to explain, the specific code is as follows:</p><p><img src="Dowhile-statement-in-C-language.png" alt="Do while statement in C language"></p><p>It can be seen that before the actual conditional judgment on the variable v, the program has executed the printf function once, and this is the characteristic of the <code>do…while</code> statement compared with other iterative statements. The iterative process uses the .L2 label as the starting point for each iteration, and each iteration follows the rule of “execute the loop body first, and then judge the conditions”. The judgment of the condition and the execution transfer process are carried out by the instructions test and jne respectively.</p><p>Even at high optimization levels, the machine-level assembly implementations of these three basic iteration statements in C don’t differ significantly, but that doesn’t mean you can use them at will. At least for <code>do…while</code> and while , they differ in execution details, and if used indiscriminately, are likely to introduce unnecessary and hard-to-debug bugs into your program.</p><h5 id="Jump-Statement"><a href="#Jump-Statement" class="headerlink" title="Jump Statement"></a>Jump Statement</h5><p>Jump statements in C language mainly refer to those grammatical structures that can change the program execution flow. They mainly include the following four types:</p><ul><li>break statement;</li><li>continue statement;</li><li>return statement;</li><li>goto statement.</li></ul><p>In C code, most of the statements used to control the execution logic of the program are implemented through conditional jump statements. Through code analysis, the compiler can find the possible “jump-in points” and “jump-out points” in the program, and at the machine instruction level, use conditional jump instructions such as je to control the execution flow of the program to transfer between these points.</p>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CPU Working Mode</title>
      <link href="/2022/03/17/cpu_working_mode/"/>
      <url>/2022/03/17/cpu_working_mode/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="Real-Mode"><a href="#Real-Mode" class="headerlink" title="Real Mode"></a>Real Mode</h4><p>Real Mode is also known as real address mode. Real means real. This real is divided into two aspects. One is to run real instructions, without distinguishing the actions of instructions, and to directly execute the real functions of instructions. The address is real, and any address is sent to memory without restriction.</p><p><strong>Real Mode Registers</strong></p><p>Since the CPU completes the corresponding function according to the instruction, for example: ADD AX, CX; this instruction completes the addition operation. AX and CX are the operands of the ADD instruction, which can be understood as the two parameters of the ADD function. These two parameters’ function is to add the data in AX and CX. The operand of an instruction can be a register, a memory address, or a constant. In fact, it is usually a register. AX and CX are the registers in the x86 CPU. Let’s take a look at the registers of the x86 CPU in real mode. Each register in the table is 16 bits.</p><p><img src="Registers-in-real-mode.png" alt="Registers in real mode"></p><p><strong>Accessing Memory in Real Mode</strong></p><p>Although there are registers, data and instructions are stored in memory. Under normal circumstances, it is necessary to load data into registers to operate, and there is also the action of fetching instructions. All these need to access memory, and we know that accessing memory depends on the address value.</p><p>The question is, how is this value calculated? The calculation process is shown in the figure below.</p><p><img src="Memory-access-method-in-real-mode.png" alt="Memory access method in real mode"></p><p>Combined with the above figure, it can be found that all memory addresses are shifted left by 4 bits from the segment register, plus a value or constant in a general register to form an address, and then access the memory from this address. This is the famous segmented memory management model. It’s just important to note here that the code segment is determined by CS and IP, while the stack segment is determined by SS and SP segments.</p><p><strong>Real Mode Interrupt</strong></p><p>Interrupt is to suspend the execution of the current program, and instead jump to another specific address to run a specific code. In real mode, its implementation process is to save the CS and IP registers first, and then load the new CS and IP registers, so how is the interrupt generated?</p><p>In the first case, the interrupt controller sends an electronic signal to the CPU, and the CPU responds to this signal. The interrupt controller then sends the interrupt number to the CPU, which is a hardware interrupt.</p><p>The second case is that the CPU executes the INT instruction, which will be followed by a constant, which is the soft interrupt number. This condition is a software interrupt.</p><p>Whether it is a hardware interrupt or a software interrupt, it is a way for the CPU to respond to external events. In order to realize the interrupt, it is necessary to put an interrupt vector table in the memory, and the address and length of this table are pointed to by the specific register IDTR of the CPU. In real mode, an entry in the table consists of a code segment address and an offset within the segment, as shown in the following figure.</p><p><img src="Interrupt-vector-table.png" alt="Interrupt vector table"></p><p>With the interrupt number, the CPU can calculate the entry in the interrupt vector according to the information in the IDTR register, and then load the CS (load code segment base address) and IP (load code segment offset) registers, and finally respond interrupt.</p><p>Let’s write a Hello World application under DOS. This is an assembly code program working in real mode, with a total of 16 bits. The specific code is as follows:</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">data SEGMENT ;    hello  DB 'Hello World!$'data ENDScode SEGMENT ;    ASSUME CS:CODE,DS:DATAstart:    MOV AX,data                   MOV DS,AX        LEA DX,hello     MOV AH,09h       INT 21h          MOV AX,4C00h     INT 21h      code ENDSEND start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Most are operation registers, where <code>LEA</code> is an address fetch instruction, <code>MOV</code> is a data transfer instruction, and <code>INT</code> is an interrupt instruction.</p><h5 id="INT-21H-instruction-description-and-usage"><a href="#INT-21H-instruction-description-and-usage" class="headerlink" title="INT 21H instruction description and usage"></a>INT 21H instruction description and usage</h5><p>For example: keyboard input is required and echoed.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">MOV AH,01INT 21H<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Through these two instructions, the input characters will be stored in <code>AL</code>, and the value of <code>AH</code> needs to be obtained by looking up the table. The table is as follows:</p><table><thead><tr><th><strong>AH</strong></th><th><strong>Function</strong></th><th><strong>Call parameters</strong></th><th><strong>Return parameter</strong></th></tr></thead><tbody><tr><td>0</td><td>Program termination (same as INT 20H)</td><td>CS=block prefix</td><td></td></tr><tr><td>1</td><td>keyboard input and echo</td><td></td><td>AL=Enter character</td></tr><tr><td>2</td><td>show output</td><td>DL=output character</td><td></td></tr><tr><td>3</td><td>Asynchronous communication input</td><td></td><td>AL=input data</td></tr><tr><td>4</td><td>Asynchronous communication output</td><td>DL = output data</td><td></td></tr><tr><td>5</td><td>printer output</td><td>DL=output character</td><td></td></tr><tr><td>6</td><td>Direct console I/O</td><td>DL=FF (input) DL=Character (output)</td><td>AL=Enter character</td></tr><tr><td>7</td><td>keyboard input (no echo)</td><td></td><td>AL=Enter character</td></tr><tr><td>8</td><td>Keyboard input (no echo) to detect Ctrl-Break</td><td></td><td>AL=Enter character</td></tr><tr><td>9</td><td>Display string DS:DX=string address ‘$’ end string</td><td></td><td></td></tr><tr><td>0A</td><td>Keyboard input into the buffer DS:DX=the first address of the buffer (DS:DX)=the maximum number of characters in the buffer</td><td>(DS:DX+1)=Number of characters actually entered</td><td></td></tr><tr><td>0B</td><td>Check keyboard status</td><td></td><td>AL=00 with input AL=FF without input</td></tr><tr><td>0C</td><td>Clear the input buffer and request the specified input function</td><td>AL=input function number (1,6,7,8,A)</td><td></td></tr><tr><td>0D</td><td>Disk reset</td><td></td><td>clear file buffer</td></tr><tr><td>0E</td><td>Specifies the current default disk drive</td><td>DL=drive letter 0=A,1=B,…</td><td>AL=Number of drives</td></tr><tr><td>0F</td><td>open a file</td><td>DS:DX=FCB first address</td><td>AL=00 file found AL=FF file not found</td></tr><tr><td>10</td><td>close file</td><td>DS:DX=FCB first address</td><td>AL=00 The directory was modified successfully AL=FF The file was not found in the directory</td></tr><tr><td>11</td><td>Find the first directory entry DS:DX=FCB first address</td><td>AL=00 found AL=FF not found</td><td></td></tr><tr><td>12</td><td>Find the next directory entry</td><td>DS:DX=FCB first address (with * or ? in the file)</td><td>AL=00 found AL=FF not found</td></tr><tr><td>13</td><td>Delete Files</td><td>DS:DX=FCB first address</td><td>AL=00 Deleted successfully AL=FF Not found</td></tr><tr><td>14</td><td>sequential read</td><td>DS:DX=FCB first address</td><td>AL=00 read successfully =01 end of file, no data in record =02 insufficient DTA space =03 end of file, incomplete record</td></tr><tr><td>15</td><td>write sequentially</td><td>DS:DX=FCB first address</td><td>AL=00 Write successfully =01 Disk full =02 DTA space is not enough</td></tr><tr><td>16</td><td>build file</td><td>DS:DX=FCB first address</td><td>AL=00 build successfully =FF no disk space</td></tr><tr><td>17</td><td>file rename</td><td>DS:DX=FCB first address</td><td>(DS:DX+1)=old filename (DS:DX+17)=new filename</td></tr><tr><td>19</td><td>Get the current default disk drive</td><td></td><td>AL=default drive letter 0=A,1=B,2=C,…</td></tr><tr><td>1A</td><td>set DTA address</td><td>DS:DX=DTA address</td><td></td></tr><tr><td>1B</td><td>Get the default drive FAT information</td><td></td><td>AL=Number of sectors per cluster DS:BX=FAT identification byte CX=Physical sector size DX=Number of clusters of default drive</td></tr><tr><td>1C</td><td>Fetch any drive FAT information</td><td>DL=drive letter</td><td>Ditto</td></tr><tr><td>21</td><td>random read</td><td>DS:DX=FCB first address</td><td>AL=00 read successfully =01 end of file =02 buffer overflow =03 buffer full</td></tr><tr><td>22</td><td>random write</td><td>DS:DX=FCB first address</td><td>AL=00 write success =01 disk full =02 buffer overflow</td></tr><tr><td>23</td><td>Determining file size</td><td>DS:DX=FCB first address</td><td>AL=00 success (fill in FCB for file length) AL=FF not found</td></tr><tr><td>24</td><td>set random record number</td><td>DS:DX=FCB first address</td><td></td></tr><tr><td>25</td><td>set interrupt vector</td><td>DS:DX=interrupt vector AL=interrupt type number</td><td></td></tr><tr><td>26</td><td>Create a block prefix</td><td>DX=new block prefix</td><td></td></tr><tr><td>27</td><td>random block read</td><td>DS:DX=FCB first address CX=Number of records</td><td>AL=00 Read successfully =01 End of file =02 Buffer is too small, end of transmission =03 Buffer is not full</td></tr><tr><td>28</td><td>random block write</td><td>DS:DX=FCB first address CX=Number of records</td><td>AL=00 write success =01 disk full =02 buffer overflow</td></tr><tr><td>29</td><td>Analysis file name</td><td>ES:DI=FCB first address DS:SI=ASCIIZ string AL=Control analysis flag</td><td>AL=00 Standard file =01 Ambiguous file =02 Illegal drive letter</td></tr><tr><td>2A</td><td>take date</td><td></td><td>CX=year DH:DL=month:day (binary)</td></tr><tr><td>2B</td><td>Set Date CX:DH:DL=Year:Month:Day</td><td>AL=00 success =FF invalid</td><td></td></tr><tr><td>2C</td><td>take time</td><td></td><td>CH:CL=hour:minute DH:DL=second:1/100th of a second</td></tr><tr><td>2D</td><td>set time</td><td>CH:CL=hour:minute DH:DL=second:1/100th of a second</td><td>AL=00 success =FF invalid</td></tr><tr><td>2E</td><td>Set the disk automatic read and write flag</td><td>AL=00 turns off the flag AL=01 turns on the flag</td><td></td></tr><tr><td>2F</td><td>Get the first address of the disk buffer</td><td></td><td>ES:BX=buffer first address</td></tr><tr><td>30</td><td>Get the DOS version number</td><td></td><td>AH=release number, AL=version</td></tr><tr><td>31</td><td>end and stay</td><td>AL=return code DX=resident area size</td><td></td></tr><tr><td>33</td><td>Ctrl-Break detection</td><td>AL=00 get state =01 set state (DL) DL=00 close detection =01 open detection</td><td>DL=00 Disable Ctrl-Break detection =01 Enable Ctrl-Break detection</td></tr><tr><td>35</td><td>Fetch interrupt vector</td><td>AL=Interrupt Type</td><td>ES:BX=Interrupt Vector</td></tr><tr><td>36</td><td>Get free disk space</td><td>DL=drive letter 0=default,1=A,2=B,…</td><td>Success: AX=Number of sectors per cluster BX=Number of valid clusters CX=Number of bytes per sector DX=Number of total clusters Failure:AX=FFFF</td></tr><tr><td>38</td><td>Set/fetch country information</td><td>DS:DX=Information area first address</td><td>BX=Country code (International phone prefix code) AX=Error code</td></tr><tr><td>39</td><td>Create subdirectory (MKDIR)</td><td>DS:DX=ASCIIZ string address</td><td>AX=Error code</td></tr><tr><td>3A</td><td>Delete subdirectory (RMDIR)</td><td>DS:DX=ASCIIZ string address</td><td>AX=Error code</td></tr><tr><td>3B</td><td>Change current directory (CHDIR)</td><td>DS:DX=ASCIIZ string address</td><td>AX=Error code</td></tr><tr><td>3C</td><td>build file</td><td>DS:DX=ASCIIZ string address CX=file attribute</td><td>Success: AX=file code Error: AX=error code</td></tr><tr><td>3D</td><td>open a file</td><td>DS:DX=ASCIIZ string address AL=0 read=1 write=3 read/write</td><td>Success: AX=file code Error: AX=error code</td></tr><tr><td>3E</td><td>close file</td><td>BX=file code</td><td>Failed: AX=error code</td></tr><tr><td>3F</td><td>read file or device</td><td>DS:DX=Data buffer address BX=File code CX=Number of bytes read</td><td>Read successfully: AX=number of bytes actually read AX=0 has reached the end of the file Read error: AX=error code</td></tr><tr><td>40</td><td>write to file or device</td><td>DS:DX=data buffer address BX=file code CX=number of bytes written</td><td>Write successfully: AX=number of bytes actually written Write error:AX=error code</td></tr><tr><td>41</td><td>Delete Files</td><td>DS:DX=ASCIIZ string address</td><td>success: AX=00</td></tr><tr><td>42</td><td>Move the file pointer</td><td>BX=file code CX:DX=displacement AL=movement method (0: absolute displacement from the beginning of the file, 1: relative movement from the current position, 2: absolute displacement from the end of the file)</td><td>Success:DX:AX=new file pointer position Error:AX=error code</td></tr><tr><td>43</td><td>set/get file attributes</td><td>DS:DX=ASCIIZ string address AL=0 Get file attribute AL=1 Set file attribute CX=File attribute</td><td>Success: CX=File Properties Fail: CX=Error Code</td></tr><tr><td>44</td><td>Device file I/O control</td><td>BX=file code AL=0 get status =1 set status DX =2 read data =3 write data =6 get input status =7 get output status</td><td>DX=device information</td></tr><tr><td>45</td><td>Copy file code</td><td>BX=File code 1</td><td>Success: AX=file code 2 Failure: AX=error code</td></tr><tr><td>46</td><td>Manually copy the file code</td><td>BX=File code 1 CX=File code 2</td><td>Failed: AX=error code</td></tr><tr><td>47</td><td>Get the pathname of the current directory</td><td>DL=drive number DS:SI=ASCIIZ string address</td><td>(DS:SI)=ASCIIZ string Failed:AX=error code</td></tr><tr><td>48</td><td>Allocate memory space</td><td>BX=Apply for memory capacity</td><td>Success: AX= allocate memory first place Fail: BX= maximum available memory</td></tr><tr><td>49</td><td>Free up content space</td><td>ES = memory start segment address</td><td>Failed: AX=error code</td></tr><tr><td>4A</td><td>Adjust allocated chunks</td><td>ES=Original memory starting address BX=Re-applied capacity</td><td>Failed: BX=maximum free space AX=error code</td></tr><tr><td>4B</td><td>Assembly/Execution Program</td><td>DS:DX=ASCIIZ string address ES:BX=First address of parameter area AL=0 Load execution AL=3 Load not executed</td><td>Failed: AX=error code</td></tr><tr><td>4C</td><td>end with return code</td><td>AL=return code</td><td></td></tr><tr><td>4D</td><td>get return code</td><td></td><td>AX=return code</td></tr><tr><td>4E</td><td>Find the first matching file</td><td>DS:DX=ASCIIZ string address CX=property</td><td>AX=Error code(02,18)</td></tr><tr><td>4F</td><td>Find the next matching file</td><td>DS:DX=ASCIIZ string address (with ? or * in the file name)</td><td>AX=Error code(18)</td></tr><tr><td>54</td><td>Disk automatic read and write mark</td><td></td><td>AL=Current flag value</td></tr><tr><td>56</td><td>file rename</td><td>DS:DX=ASCIIZ string (old) ES:DI=ASCIIZ string (new)</td><td>AX=Error code(03,05,17)</td></tr><tr><td>57</td><td>Set/fetch file date and time</td><td>BX=file code AL=0 read AL=1 set (DX:CX)</td><td>DX:CX=date and time failed:AX=error code</td></tr><tr><td>58</td><td>get/set allocation strategy code</td><td>AL=0 fetch code AL=1 set code (BX)</td><td>Success: AX=policy code Fail: AX=error code</td></tr><tr><td>59</td><td>get extended error code</td><td></td><td>AX=Extended Error Code BH=Error Type BL=Suggested Action CH=Error Location</td></tr><tr><td>5A</td><td>create temporary files</td><td>CX=file attribute DS:DX=ASCIIZ string address</td><td>Success: AX=file code Fail: AX=error code</td></tr><tr><td>5B</td><td>create new file</td><td>CX=file attribute DS:DX=ASCIIZ string address</td><td>Success: AX=file code Fail: AX=error code</td></tr><tr><td>5C</td><td>control file access</td><td>AL=00 block =01 open BX=file code CX:DX=file displacement SI:DI=file length</td><td>Failed: AX=error code</td></tr><tr><td>62</td><td>Take the block prefix</td><td></td><td>BX=PSP address</td></tr></tbody></table><h4 id="Protected-Mode"><a href="#Protected-Mode" class="headerlink" title="Protected Mode"></a>Protected Mode</h4><p>As the scale of software continues to increase, it requires higher computing power and larger memory capacity. The memory is large, the first problem to be solved is the addressing problem, because 16-bit registers can only represent 216 addresses at most, so the CPU’s registers and arithmetic units must be expanded to 32-bit.</p><p><strong>Protected Mode Register</strong></p><p>Compared with Real Mode, Protected Mode adds some control registers and segment registers, expands the bit width of general-purpose registers, all general-purpose registers are 32-bit, and the lower 16 bits can be used alone, and the lower 16 bits can be split into two 8-bit registers, as shown in the table below.</p><p><img src="Register-composition-in-protected-mode.png" alt="Register composition in protected mode"></p><p><strong>Protected Mode Privilege Level</strong></p><p>In order to distinguish which instructions (such as in, out, cli) and which resources (such as registers, I/O ports, memory addresses) can be accessed, the CPU implements privilege levels. The privilege level is divided into 4 levels, R0~R3. The number of instructions executed by each privilege level is different. R0 can execute all instructions, and R1, R2, and R3 decrease in turn, and they can only execute a subset of the number of instructions at the previous level. The memory access is achieved by the cooperation of the segment descriptor and the privilege level mentioned later. As shown below:</p><p><img src="CPU-Privilege-Diagram.png" alt="CPU Privilege Diagram"></p><p>The above ring diagram, from the outside to the inside, can not only reflect the size of power, but also how much each privilege level controls access to resources, and can also reflect the inclusion relationship between each privilege level. R0 has the most power and can access low-privilege resources, but not vice versa.</p><p><strong>Protected Mode Segment Descriptor</strong></p><p>So far, memory is still a segmentation model. To protect memory, it can be converted into segment protection. Due to the expansion of the CPU, the 32-bit segment base address and segment offset, as well as some other information, must not fit in the 16-bit segment register. If you can’t put it down, you need to find memory to borrow space, and then encapsulate the information describing a segment into a segment descriptor of a specific format, and put it in memory. The format is as follows:</p><p><img src="protected-mode-segment-descriptor.png" alt="Protected Mode Segment Descriptor"></p><p>A segment descriptor has 64-bit 8-byte data, which includes segment base address, segment length, segment permissions, segment type (can be system segment, code segment, data segment), whether the segment is readable and writable, executable, etc. Although the data distribution is a bit messy, this is due to historical reasons. Multiple segment descriptors form a global segment descriptor table in memory, whose base address and length are indicated by the CPU and GDTR registers. As shown below:</p><p><img src="Global-Segment-Descriptor-Table.png" alt="Global Segment Descriptor Table"></p><p>The segment register no longer stores the segment base address, but the index of the specific segment descriptor. When accessing a memory address, the index in the segment register will first find the segment descriptor in the memory in combination with the GDTR register, and then judge whether the access would succeed according to the segment information. </p><p><strong>Protected Mode Segment Selector</strong></p><p>The segment registers CS, DS, ES, SS, FS, GS store not only the descriptor index of a memory segment, but are actually composed of shadow registers, segment descriptor indexes, descriptor table indexes and permission levels. As shown below:</p><p><img src="Protected-Mode-Segment-Selector.png" alt="Protected Mode Segment Selector"></p><p>The shadow register in the above figure is operated by hardware and is invisible to system programmers. It is a cache of segment descriptors designed by hardware to reduce performance loss. Otherwise, each memory access must go to the memory to look up the table, then the performance penalty is huge, and the shadow registers are exactly 64 bits, which hold 8 bytes of segment descriptor data.</p><p>The reason why the lower three bits can put TI and RPL is because the segment descriptor is 8-byte aligned, and the lower 3 bits of each index are 0, like 1000, 10000, 11000. So the lower 3 bits can be used for other things, here they are used to put TI and RPL. Since we don’t need to pay attention to the LDT and only need to use the GDT global descriptor table, TI is always set to 0.</p><p>Usually, the RPL (Request Privilege Level) in CS and SS constitutes the CPL (Current Privilege Level), so it is often RPL=CPL, and then the CPL indicates what authority the initiating visitor needs to access the target segment. When the CPL is greater than the target segment DPL, the CPU prohibits access, and only when the CPL is less than or equal to the target segment DPL (Descriptor Privilege Level) can access.</p><p><strong>Protected Mode Flat Model</strong></p><p>The segmentation model has many flaws. In fact, modern operating systems use the paging model. However, the x86 CPU cannot directly use the paging model, but must decide whether to enable paging according to needs under the premise of the segmentation model. Because this is a rule of the hardware, the programmer cannot change it. But we can simplify the design to make segmentation a “fake”, which is the flat model of protected mode.</p><p>The CPU 32-bit registers can only generate addresses with a size of 4GB at most, and the length of a segment can only be 4GB, so we set the base address of all segments to 0, the length of the segment to 0xFFFFF, and the granularity of the segment length to 4KB, so that all segments point to the same (0~4GB-1) byte address space. The segment length needs to be matched with the G bit. If the G bit is 1, the segment length is equal to 0xfffff 4KB.</p><p><strong>Protected Mode Interrupt</strong></p><p>In Real Mode, the CPU doesn’t need to do permission checks, so it can just load the CS:IP register with the value in the interrupt vector table. The interrupt in protected mode requires permission checking and privilege level switching, so it is necessary to expand the information of the interrupt vector table, that is, each interrupt is represented by an interrupt gate descriptor, which can also be referred to as an interrupt gate. The character still has its own format, as shown in the following figure:</p><p><img src="Interrupt-Gate-Descriptor-in-Protected-Mode.png" alt="Interrupt Gate Descriptor in Protected Mode"></p><p>Similarly, to implement interrupts in protected mode, there must also be an interrupt vector table in memory, which is also pointed to by the IDTR register, but the entry in the interrupt vector table becomes the interrupt gate descriptor, as shown in the following figure:</p><p><img src="Segment-Interrupt-Table-in-Protected-Mode.png" alt="Segment Interrupt Table in Protected Mode"></p><p>After an interrupt is generated, the CPU processes the interrupt in the following order:</p><ol><li>The CPU first checks whether the interrupt number is greater than the last interrupt gate descriptor. The x86 CPU supports a maximum of 256 interrupt sources (ie interrupt number: 0~255), and then checks the descriptor type (whether it is an interrupt gate or a trap gate), whether it is a system descriptor and does it exist in memory.</li><li>Next, check the segment descriptor pointed to by the segment selector in the interrupt gate descriptor.</li><li>Finally, do the permission check. If the CPL is less than or equal to the DPL of the interrupt gate, and the CPL is greater than or equal to the DPL of the segment descriptor pointed to by the segment selector in the interrupt gate, it points to the DPL of the segment descriptor. Further, if the CPL is equal to the DPL of the segment selector in the interrupt gate pointing to the segment descriptor, it means that the same-level authority does not perform stack switching, otherwise, it performs stack switching. If stack switching is performed, SS and ESP with specific permissions need to be loaded from TSS, and of course, the segment descriptor pointed to by the segment selector in SS must be checked.</li><li>After completing this series of checks, the CPU will load the target code segment selector in the interrupt gate descriptor into the CS register, and load the target code segment offset into the EIP register.</li></ol><p><strong>Switch to Protected Mode</strong></p><p>The x86 CPU will automatically enter the real mode after the first power-on and every reset. To enter the protected mode, the programmer needs to write code to switch from the real mode to the protected mode. The steps to switch to protected mode are as follows:</p><p>The first step is to prepare the global segment descriptor table, the code is as follows.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">GDT_START:knull_dsc: dq 0kcode_dsc: dq 0x00cf9e000000ffffkdata_dsc: dq 0x00cf92000000ffffGDT_END:GDT_PTR:GDTLEN  dw GDT_END-GDT_START-1GDTBASE  dd GDT_START<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The second step is to load and set the GDTR register to point to the global segment descriptor table.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">lgdt [GDT_PTR]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>The third step is to set the CR0 register to enable protection mode.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">;open PEmov eax, cr0bts eax, 0                      ; CR0.PE =1mov cr0, eax         <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>The fourth step is to perform a long jump and load the CS segment register, that is, the segment selector.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">jmp dword 0x8 :_32bits_mode <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Why do long jumps? This is because we cannot directly or indirectly move a data to the CS register, because when the protected mode is just turned on, the CS shadow register is still the value in real mode, so we need to tell the CPU to load new segment information .</p><p>Next, the CPU finds that the value of the 0th bit of the CRO register is 1, it will find the global descriptor table according to the instruction of GDTR, and then load the new segment descriptor information into the CS shadow register according to the index value 8. Of course, here The premise is that a series of legitimate checks are carried out. So far, the CPU has really entered the protected mode, and the CPU also has 32-bit processing capabilities.</p><h4 id="Long-Mode"><a href="#Long-Mode" class="headerlink" title="Long Mode"></a>Long Mode</h4><p>Long Mode, also known as <code>AMD64</code>, because this standard was first defined by AMD, it enables the CPU to have 64-bit processing capabilities on the existing basis, which can not only complete 64-bit data operations, but also address 64-bit addresses space. This is even more important on large computers, which typically have several hundred gigabytes of physical memory.</p><p><strong>Long Mode Register</strong></p><p>Compared with the Protected Mode, the Long Mode adds some general-purpose registers and expands the bit width of the general-purpose registers. All general-purpose registers are 64 bits, and the lower 32 bits can be used separately. The lower 32 bits can be split into a lower 16-bit register, and the lower 16 bits can be split into two 8-bit registers, as shown in the following table:</p><p><img src="Registers-in-long-mode.png" alt="Registers in Long Mode"></p><p><strong>Long Mode Segment Descriptor</strong></p><p>Long Mode still has most of the features of protected mode, such as privilege levels and permission checks. The same part will not be repeated, and only the differences between long mode and protected mode will be explained here. Let’s take a look at the format of the paragraph description in the long mode, as shown in the following figure:</p><p><img src="Segment-descriptor-in-long-mode.png" alt="Segment Descriptor in Long Mode"></p><p>In Long Mode, the CPU no longer checks the segment base address and segment length, and only performs related checks on DPL. This check process is the same as in protected mode. When L=1 and D/B=0 in the descriptor, it is a 64-bit code segment, and DPL is still a privilege level of 0~3. Then there are multiple segment descriptions in memory to form a global segment descriptor table, also pointed to by the CPU’s GDTR register. The long mode weakens the segment mode management, and only retains the check of the permission level, ignoring the segment base address and segment length, and the address check is handed over to the MMU.</p><p><strong>Long Mode Interrupt</strong></p><p>In the Protection Mode, in order to realize the permission check of the interrupt, the interrupt gate descriptor is implemented. The corresponding segment selector and its offset in the segment are stored in the interrupt gate descriptor, as well as the DPL permission. If the permission check passes, use The corresponding segment selector and its intra-segment offset are loaded into the CS:EIP registers.</p><p>The Long Mode supports 64-bit memory addressing, so it is necessary to modify and expand the interrupt gate descriptor. Let’s take a look at the format of the interrupt gate descriptor in the long mode, as shown in the following figure:</p><p><img src="Segment-interrupt-Gate-Descriptor-in-Long-Mode.png" alt="Segment Interrupt Gate Descriptor in Long Mode"></p><p>Combined with the above figure, we can see the format change of the interrupt gate descriptor in long mode.</p><ol><li>First, in order to support the 64-bit addressing interrupt gate descriptor, 8 bytes are added to the original basis to store the high 32-bit value of the target segment offset.</li><li>Second, the code segment descriptor corresponding to the target code segment selector must be a 64-bit code segment.</li><li>The <code>IST</code> in the last is the <code>IST</code> pointer in the 64-bit <code>TSS</code>.</li></ol><p>The Long Mode also has an interrupt gate descriptor table in memory, but the entry in the table (as shown in the figure above) is 16 bytes in size, supports up to 256 interrupt sources, and checks the response to interrupts and related permissions. Protected mode is the same and will not be repeated here.</p><p><strong>Switch to Long Mode</strong></p><p>We can either switch directly from Real Mode to Long Mode, or switch from Protected Mode to Long Mode. The steps to switch to Long Mode are as follows.</p><p>The first step is to prepare the long-mode global segment descriptor table.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">ex64_GDT:null_dsc:  dq 0c64_dsc:dq 0x0020980000000000  d64_dsc:dq 0x0000920000000000 eGdtLen   equ $ - null_dsc eGdtPtr:dw eGdtLen - 1      dq ex64_GDT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The second step is to prepare the MMU page table in long mode. This is to enable paging mode. When switching to long mode, paging must be enabled. Think about it, the segment base address and segment length have not been checked in long mode, so the memory The address space is not protected.</p><p>In the Long Mode, the protection of the memory address space is handed over to the MMU. The MMU relies on the page table to convert the address. The page table is stored in the memory in a specific format, and its address is pointed to by the CR3 register of the CPU.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">mov eax, cr4bts eax, 5  mov cr4, eax mov eax, PAGE_TLB_BADR mov cr3, eax<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The third step is to load the GDTR register to point to the global segment description table:</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">lgdt [eGdtPtr]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>The fourth step is to turn on the long mode. To turn on the protected mode and the paging mode at the same time, the MSR register is defined when the long mode is implemented, and the special instructions rdmsr and wrmsr need to be used for reading and writing. The address of the IA32_EFER register is 0xC0000080, its 8th bit determines whether long mode is enabled.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">mov ecx, IA32_EFERrdmsrbts eax, 8 wrmsrmov eax, cr0bts eax, 0  bts eax, 31mov cr0, eax <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The fifth step is to jump, load the CS segment register, and refresh its shadow register.</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">jmp 08:entry64 <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>The process of switching to Long Mode and switching protected mode is similar, but the segment descriptors that need to be prepared are different, and it is necessary to pay attention to turning on Protected Mode and Paging Mode at the same time.</p>]]></content>
      
      
      <categories>
          
          <category> System </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OS </tag>
            
            <tag> Real Mode </tag>
            
            <tag> Protected Mode </tag>
            
            <tag> Long Mode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>System kernel</title>
      <link href="/2022/03/07/system_kernel/"/>
      <url>/2022/03/07/system_kernel/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="System-kernel"><a href="#System-kernel" class="headerlink" title="System kernel"></a>System kernel</h4><p>From an abstract point of view, the kernel is the manager of computer resources, of course, the management of resources is to allow applications to use resources. Since the kernel is the manager of resources, let’s first take a look at what resources are in the computer, and then through the induction of resources, we can deduce what should be in the big black box of the kernel.</p><p>Computer resources can be roughly divided into two types of resources, one is hardware resources, the other is software resources. Let’s take a look at the hardware resources first, as follows:</p><ol><li><strong>Bus</strong>，it is responsible for connecting various other devices and is the basis for the work of other devices.</li><li><strong>CPU</strong>，the central processing unit, is responsible for executing programs and processing data operations.</li><li><strong>Memory</strong>，it is responsible for storing code and data at runtime.</li><li><strong>Hard disk</strong>，it is responsible for long-term storage of user file data.</li><li><strong>Network card</strong>，it is responsible for the communication between the computers.</li><li><strong>Graphics card</strong>，it is responsible for display work.</li><li><strong>Various I/O devices</strong>，such as monitors, printers, keyboards, mice, etc.</li></ol><p>A typical internal structure diagram of a computer is given below, as follows:</p><p><img src="Classical-Computer-Architecture.png" alt="Classical Computer Architecture"></p><p>The software resources in the computer can be represented as various forms of data in the computer. Such as various files, software programs, etc. As the manager of hardware resources and software resources, the internal composition of the kernel is roughly as follows:</p><ol><li><strong>Manage CPU</strong>，Since the CPU executes the program, and the kernel abstracts the runtime program into a process, it is also called process management.</li><li><strong>Manage memory</strong>，Since both programs and data occupy memory, which is a very precious resource, so the kernel must allocate and release memory very carefully.</li><li><strong>Manage hard disks</strong>，The hard disk mainly stores user data, and the kernel abstracts the user data into files, that is, management files. The files need to be organized reasonably to facilitate users to find and read and write, so a file system is formed.</li><li><strong>Manage graphics cards</strong>，The graphics card is responsible for displaying information, and now the operating system supports GUI (graphical user interface), and managing the graphics card naturally becomes the graphics system in the kernel.</li><li><strong>Manage network cards</strong>，The network card mainly completes network communication. Network communication requires various communication protocols. Finally, a network protocol stack is formed in the kernel, also known as network components.</li><li><strong>Manage various I/O devices</strong>，We often refer to keyboards, mice, printers, monitors, etc. as I/O (input and output) devices, which are abstracted into I/O managers in the kernel.</li></ol><p>In addition to these necessary components, the kernel also has components such as security components according to different functions. The most worth mentioning is that due to the different performance of various computer hardware, different hardware models, different hardware types, and different hardware manufacturers, the kernel needs to write corresponding codes in order to manage and control these hardwares. Usually, such codes are called for the driver. Hardware manufacturers can write different drivers according to their different hardware and add them to the kernel.</p><h5 id="Macro-kernel-structure"><a href="#Macro-kernel-structure" class="headerlink" title="Macro kernel structure"></a>Macro kernel structure</h5><p>The macro kernel structure, the simplest applicable, is also the earliest kernel structure. The macro kernel is to compile the above code such as process management code, memory management code, various I/O device management code, file system code, graphics system code and other functional module codes, and finally linked together to form one large executable program.</p><p>This large program contains all the codes that implement and support these functions, and provides some interfaces to the user application software. These interfaces are the so-called system API functions. This large program will run in the processor’s privileged mode, which is often referred to as macrokernel mode. The structure is shown in the figure below.</p><p><img src="Macro-kernel-structure.png" alt="Macro kernel structur"></p><p>Although the diagram is layer by layer, this does not mean that they are hierarchically related, just that they are linked together. In order to understand the working principle of the macro kernel, let’s look at an example. The macro kernel provides the service process of the memory allocation function, as follows:</p><ol><li>The application calls the API (application programming interface) function for memory allocation.</li><li>The processor switches to privileged mode and starts running the kernel code.</li><li>The memory management code in the kernel allocates a block of memory according to a specific algorithm.</li><li>Return the first address of the allocated memory block to the API function of memory allocation.</li><li>The API function of memory allocation returns, the processor starts to run the application program in user mode, the application program gets the first address of a piece of memory, which can be used then.</li></ol><p>The macro-kernel structure in the above figure has obvious shortcomings, because it has no modularity, no extensibility, no portability, and is highly coupled together. Once one of the components has a vulnerability, all components in the kernel may have problems. Developing a new feature also requires recompiling, linking, and installing the kernel. In fact, this original macro kernel structure is no longer used. The only advantage of this kind of macro kernel is the performance, because in the kernel, these components can call each other, and the performance is very high.</p><h5 id="Microkernel-structure"><a href="#Microkernel-structure" class="headerlink" title="Microkernel structure"></a>Microkernel structure</h5><p>The microkernel architecture is just the opposite of the macrokernel architecture. It advocates that the kernel has as few functions as possible: only process scheduling, interrupt handling, memory space mapping, inter-process communication and other functions.</p><p>Developers make the actual process management, memory management, device management, file management and other service functions into service processes. They are the same as user application processes, but they are very special that the functions provided by the macro kernel are exclusively performed by these service processes in the microkernel architecture. The microkernel defines a good mechanism for interprocess communication - messages. To request a related service, the application sends a message corresponding to the service to the microkernel, and the microkernel forwards the message to the related service process, and then the service process completes the related service. The programming model of the service process is to process messages from other processes in a loop to complete related service functions. Its structure is as follows:</p><p><img src="Microkernel-Structure.png" alt="Microkernel Structure"></p><p>In order to understand the engineering principle of the microkernel, let’s take a look at the service process of the microkernel providing the memory allocation function, as follows:</p><ol><li>The application sends the message of memory allocation. The function for sending the message is provided by the microkernel, which is equivalent to the system API. The API (application program interface) of the microkernel is quite small. In extreme cases, only two APIs are required, one for receiving messages, and another for sending messages.</li><li>The processor switches to privileged mode and starts running the kernel code.</li><li>The microkernel code stops the current process and determines to whom the message is sent according to the data in the message packet. The message of allocating memory is of course sent to the memory management service process.</li><li>The memory management service process receives the message and allocates a block of memory.</li><li>The memory management service process will also return the address of the allocated memory block to the kernel in the form of a message, and then continue to wait for the next message.</li><li>The microkernel returns a message containing the memory block address to the application that sent the memory allocation message.</li><li>The processor starts to run the application program in user mode, the application program gets the first address of a piece of memory, and then it can be used.</li></ol><p>Although the architecture implementation of the microkernel is different, the general process is the same as above. The same is to allocate memory, turning a few corners under the microkernel, and the messages that come and go bring a lot of overhead. Of course, the switching overhead of each service process is not small. This greatly reduces system performance.</p><p>But the microkernel has many advantages. First of all, the system structure is quite clear and conducive to collaborative development. Secondly, the system has good portability, and the amount of microkernel code is very small, so it is not difficult to rewrite the entire kernel. Finally, the microkernel has quite good scalability and extensibility, because those system functions are only one process, and one service process can be removed at any time to reduce system functions, or several service processes can be added to enhance system functions.</p><p>The representative works of microkernel are MACH, MINIX, and L4 systems. These systems are all microkernels, but they are not commercial-grade systems. Commercial-grade systems do not use microkernels mainly because of poor performance.</p><h4 id="Common-operating-system-kernels"><a href="#Common-operating-system-kernels" class="headerlink" title="Common operating system kernels"></a>Common operating system kernels</h4><h5 id="Linux-kernel"><a href="#Linux-kernel" class="headerlink" title="Linux kernel"></a>Linux kernel</h5><p>The basic idea of Linux is that everything is a file: each file has a definite purpose, including user data, commands, configuration parameters, hardware devices, etc. For the operating system kernel, all are treated as various types of files. Linux supports multiple users, and each user has his own special rights to his own files, which ensures that each user does not affect each other. Multitasking is one of the most important features of modern operating systems. Linux allows multiple programs to run simultaneously and independently.<br>The internal structure of Linux, as shown below.</p><p><img src="Linux-kernel.png" alt="Linux kernel"></p><p>The above figure is roughly divided into five important components, and each component is divided into many modules running through various levels from top to bottom, and each module has important functions and data structures.</p><p><img src="Five-Components-Linux.png" alt="Five Components of Linux"></p><p>Linux belongs to a typical macro-kernel architecture.</p><h5 id="Darwin-XNU-kernel"><a href="#Darwin-XNU-kernel" class="headerlink" title="Darwin-XNU kernel"></a>Darwin-XNU kernel</h5><p>Darwin is an open source operating system developed by Apple in 2000. Darwin is at the heart of the macOS and iOS operating systems. Darwin uses a microkernel (Mach) and corresponding firmware to support different processor platforms and provide the original basic services of the operating system. The upper-level functional system services and tools are integrated with those provided by the BSD system. Apple has also developed a large number of libraries, frameworks and services for it, but they all work in userland and closed source. Let’s take a look at Darwin’s architecture as a whole.</p><p><img src="Darwin-kernel.png" alt="Darwin kernel"></p><p>Apparently it has two kernel layers - the Mach layer and the BSD layer. The Mach kernel is a classic microkernel developed by Carnegie Mellon University, which is intended to provide the most basic operating system services to achieve high performance, security, and scalability, while BSD is a UNIX-like operating system, a complete set of operating system services, developed by Berkeley University.</p><p>So how does the application use the services of the Darwin system? The application will request the services of the Darwin system through the frameworks and libraries of the user layer, that is, call the Darwin system API.</p><p>When calling the Darwin system API, an API number is passed in, and this number is used to index the function that Mach falls into the interrupt service table. At this time, if the API number is less than 0, it indicates that the request is for the service of the Mach kernel. If the API number is greater than 0, it indicates that the service is requested for the BSD kernel, which provides a complete set of standard POSIX interfaces.</p><p>There is also an important component in Mach, Libkern, which is a library that provides many low-level operation functions and supports the C++ runtime environment. IOKit also depends on this library, and manages all device drivers and kernel function extension modules. Driver developers can use the C++ object-oriented method to develop drivers. This method is very elegant. You can find a mature driver to inherit it as a parent class. If you want to implement a certain function, you can overload the function in it, at the same time, other drivers are inherited, which greatly saves memory and greatly reduces the possibility of bugs.</p><h5 id="Windows-NT-kernel"><a href="#Windows-NT-kernel" class="headerlink" title="Windows NT kernel"></a>Windows NT kernel</h5><p>Windows NT is a network operating system launched by Microsoft in 1993 for workstations, network servers and mainframe computers. It can also be used as a PC operating system. It is a new operating system developed from scratch and applies all the characteristics of modern hardware, “NT” refers to “new technology” (New Technology).</p><p>The NT core is very clear in design, and the degree of coupling between the boundaries between components is very low. Let’s take a look at the NT kernel architecture diagram and see how the NT kernel is “grand and grand”. As shown below:</p><p><img src="Windows-kernel.png" alt="Windows NT kernel"></p><p>Microsoft itself defines a small kernel on the HAL layer. Below the small kernel is the hardware abstraction layer HAL. The advantage of this HAL is that different hardware platforms can transplant the system as long as they provide the corresponding HAL. Above the small kernel are various kernel components, which Microsoft calls kernel executives, which perform services related to processes, memory, configuration, I/O file caching, power supply, and plug-and-play, security, and more. Each executive body is independent of each other, and only provides the corresponding interface to the outside world. Other executive bodies need to communicate with other executive bodies through the kernel-mode callable interface or request them to complete corresponding functional services. All device drivers and file systems are managed uniformly by the I/O manager. Drivers can be stacked to form an I/O driver stack, and function requests are encapsulated into I/O packets, which are processed layer by layer in the stack. The graphics subsystem that Windows prides itself on is also in the kernel.</p><p>Obviously, the layers in the NT kernel are distinct, and each executive body is independent of each other. This “high cohesion, low coupling” feature is an important criterion for testing whether a software project is excellent. And all of these can be proved by Microsoft’s public WRK code. If you think the WRK code is too small, you can also take a look at REACT OS, the so-called “open source version” of NT.</p>]]></content>
      
      
      <categories>
          
          <category> System </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Kernel </tag>
            
            <tag> Linux </tag>
            
            <tag> Mac OS </tag>
            
            <tag> Windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Computer&#39;s Knowledge You need to know</title>
      <link href="/2022/03/05/you_should_know_about_computer/"/>
      <url>/2022/03/05/you_should_know_about_computer/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="Data-unit"><a href="#Data-unit" class="headerlink" title="Data unit"></a>Data unit</h4><p>A <code>bit</code> is the smallest unit of storage in a computer, and each bit can store a binary code value of 0 or 1.</p><p>A <code>byte</code> is usually a storage unit composed of eight bits. In a computer, a byte is the smallest addressable unit, which means that when the CPU uses data, it can assign a corresponding independent address to each byte of memory in bytes.</p><p>The size of the <code>word</code> is not fixed. The size of a word may be a power of 2, such as 16-bit, 32-bit, or 12-bit, 27-bit and other uncommon sizes. This is mainly because the concept of word is directly related to the specific processor or hardware architecture, and it is not the same as the more general and unified concept of data volume such as bit and byte.</p><p>Words are the natural unit of data used in processor design, and generally, this size is reflected in many aspects of computer architecture and related operations. For example, the capacity of most registers in the processor is the same size as a word. The largest memory block that can be operated by a single instruction of the processor is generally the size of a word, and the address used to specify a specific location in the memory is generally used to process The natural word of the device is width.</p><h4 id="Assembly-language"><a href="#Assembly-language" class="headerlink" title="Assembly language"></a>Assembly language</h4><p>In computer programming, assembly language is a low-level programming language, and the instructions used by the language are closely related to the specific platform. This means that assembly languages designed for different CPU architectures cannot be shared and are not portable. Assembly code can be converted by assembler (such as as) to obtain binary executable code. Unlike high-level programming languages, assembly languages have basically no abstractions over machine instructions. Therefore, by observing the assembly code of a program, we can learn about each specific step of the program in detail.</p><h4 id="Registers-in-the-instruction-set"><a href="#Registers-in-the-instruction-set" class="headerlink" title="Registers in the instruction set"></a>Registers in the instruction set</h4><p>A register is sometimes called a “register file”, and you can think of it simply as a set of on-chip high-speed memory hardware provided by the CPU that can be used to store data. Typically, registers can be implemented using SRAM. SRAM is a high-speed random access memory, which stores the data of each bit in a corresponding “bistable” memory, thereby maintaining strong anti-interference ability and faster data access speed. In the entire computer architecture, registers have the fastest data access speed and the lowest latency.</p><p>Generally speaking, the registers we use in assembly code may not have an exact one-to-one correspondence with the physical registers on the CPU, and the CPU will use additional methods to ensure the dynamic correspondence between them. These registers involved in the program running process can generally be divided into: general purpose registers, status registers, system registers, and AVX and SSE registers used to support floating-point number calculations and SIMD.</p><p>Among these registers, general purpose registers are generally used to store temporary data generated during program operation, and these registers can be used as ordinary registers in most cases. In some special cases, they may be used to store information such as instruction calculation results, system call numbers, and memory addresses related to stack frames. The status register is generally used to store status information related to the execution result of the instruction, such as whether the execution of the instruction causes a carry, whether the calculation result is 0, etc. System registers are generally used by the operating system, and these registers describe information related to virtual memory, interrupts, CPU mode, etc.</p><p>Under the x86-64 architecture, a total of 16 general-purpose registers are defined in the CPU instruction set architecture (ISA). These registers can store up to 4 words, that is, 64-bit long data. In assembly code, we can use the aliases corresponding to different parts of each register to specifically access their lower 8 bits, lower 16 bits, lower 32 bits, and the full 64 bits of data. For the specific names of these registers, you can refer to the following picture:</p><p><img src="Architecture-Register-Map.png" alt="x86-64 Architecture Register Map"></p><p>Here is an example of the ebx register we encountered before: observing the above figure, we can see that through ebx, we can access data with a size of 32 bits, which is the lower 32 bits of the register rbx. Therefore, the full 64-bit data of this register can be accessed directly using rbx. And using bx and bl, the lower 16 bits and lower 8 bits of the register can be accessed accordingly.</p><p>In addition, it should be noted that we can read and write data in different locations of the same register through different register aliases. When an instruction needs to rewrite the lower 16-bit or lower 8-bit data of the register, the data on other bits in the register will not be modified. When the instruction needs to rewrite the data of the lower 32 bits of the register, the data of the upper 32 bits will be reset at the same time, that is, set to zero.</p><h4 id="Form-of-data-storage"><a href="#Form-of-data-storage" class="headerlink" title="Form of data storage"></a>Form of data storage</h4><p>For most computers, the two’s-complement format is usually used internally to store signed integers, the directly corresponding binary bit format is used to store unsigned integers, and the IEEE-754 standard encoding format is used to store floating point numbers, that is, decimals. In fact, when a computer processes data, it does not distinguish its symbolic nature, which is only reflected in the specific use of computer instructions when operating data.</p><h5 id="Two’s-complement"><a href="#Two’s-complement" class="headerlink" title="Two’s-complement"></a>Two’s-complement</h5><p>One advantage of using two’s complement to store signed integers is that when the CPU performs addition and subtraction calculations for signed numbers, it does not need to use multiple low-level addition circuits due to the different signs of the addends, which can reduce circuit design. The burden, on the other hand, can also reduce the physical size of the CPU.</p><p>The actual value represented by one’s complement is obtained by summing the value of its negative weight bit and the value of the positive weight bit, where the negative weight bit corresponds to the sign bit of the most significant bit (MSB), that is, the binary value of this bit is in Negative values are accumulated during calculation. The remaining bits correspond to the positive weight bits together, that is, the binary values corresponding to these bits are accumulated as positive values during calculation. How exactly should it be calculated? Let’s look at a simple example.</p><p>Suppose we have a set of two’s complement “1101”, how should we get its corresponding signed integer value? In order, we first calculate that the value of the negative weight bit corresponding to the complement is -8, and the value of the positive weight bit is 5, so the actual value corresponding to the complement is -3 (-8+5). The specific calculation steps can refer to the following figure (B2T in the figure represents “Binary to Two’s-complement”, that is, “two’s complement”):</p><p><img src="Two-complement.png" alt="Two's complement"></p><p>When calculating a negative weight bit, its weight should take a negative value, and a positive weight bit should take a positive value. Through the above calculation process, you can clearly see that for a 4-bit complement, what are the maximum and minimum values it can represent. When calculating the maximum value, the symbol position is set to 0, and the other bits are set to 1, and the maximum value that can be represented is 7. When calculating the minimum value, the symbol position is set to 1, and the other bits are set to 0, and the minimum value -8 can be obtained. Negative integer values can represent 1 more range than positive integers, an important feature of all signed integers.</p><p>First, let’s calculate the four’s complement corresponding to the signed integer 3, we can get a binary sequence “0011”. Add this binary sequence to the binary sequence 1101 corresponding to the above -3, and the sequence “10000” can be obtained by carrying, which can represent the unsigned positive integer 16.</p><p>Therefore, we can conclude that for a non-negative number x, we can use 2w−x to compute the w-bit representation of −x. Applying the above example, we can get “In the case of four’s complement, for the non-negative number 3, the bit pattern of the signed number -3 can be represented by the bit pattern of the unsigned number 13 (ie 16−3)” The conclusion is that the two bit patterns are the same. The English name of complement is a summary of the relationship between x, −x and 2w.</p><p>Therefore, the English name of the complement is Two’s-complement, which can be literally translated as “the complement to the number 2”.</p><h5 id="IEEE-754"><a href="#IEEE-754" class="headerlink" title="IEEE-754"></a>IEEE-754</h5><p>IEEE-754 is a floating-point number standard adopted by many hardware floating-point computing units (FPUs). This standard solves many problems in hardware implementation of floating-point numbers, making it more portable. For IEEE-754, a feature worth introducing is its storage format design for floating-point numbers, so that the computer can simply use the sorting function for integers to sort floating-point numbers.</p><p>For example, for a binary sequence of unsigned numbers, the value of 0010 must be less than 1000 (2 &lt; 8). This is fine for a computer to judge. For the 8-bit floating-point numbers (4 order bits, 3 decimal bits) binary sequences 0 0001 001 and 0 1110 111 based on IEEE-754 encoding, it is also very simple to judge the size. Except for the leftmost sign bit, the remaining bits are directly compared as unsigned integer sequence values, and the result is also applicable to the corresponding floating-point number sequence.</p><p><img src="IEEE-754-storage-format.png" alt="IEEE-754 storage format diagram"></p><h4 id="Turing-machine"><a href="#Turing-machine" class="headerlink" title="Turing machine"></a>Turing machine</h4><p>The famous Alan Turing. Among his many contributions, a very important one is to propose an ideal machine: the Turing machine. Turing machine is an abstract model, it is like this: there is an infinitely long paper tape, there are infinite small grids on the paper tape, relevant information is written in the small grids, there is a read head on the paper tape, the reading head can Do related operations according to the information in the small grid of the paper tape and can move back and forth. Use the Turing machine to perform the calculation of “1+1=2”. After we define the read head to read “+”, move the read head twice in turn and read the data in the grid. Finally, the read head calculates and writes the result into the first In the next grid of the two data, the whole process is as follows:</p><p><img src="Turing-machine-calculation-process.png" alt="Turing machine calculation process"></p><p>This ideal model is good, but an ideal is an ideal after all. To become a reality, we have to think of other ways.</p><h4 id="Von-Neumann-Architecture"><a href="#Von-Neumann-Architecture" class="headerlink" title="Von Neumann Architecture"></a>Von Neumann Architecture</h4><p>Von Neumann proposed that electronic computers use a binary number system and store programs, and execute them in sequence.<br>A computer constructed according to the von Neumann architecture must have the following functions:</p><p>• Loading programs and data into a computer;<br>• Must have long-term memory of the program, the intermediate results of the data and the final operation results;<br>• Complete various data processing such as arithmetic, logical operation and data transmission;<br>• Control the direction of the program according to the needs, and can control the coordinated operation of the various parts of the machine according to the instructions;<br>• Ability to display processed data results to users as required.</p><p>In order to complete the above functions, the computer must have five basic components:</p><p>• Input devices for loading data and programs;<br>• Memory for remembering programs and data;<br>• Calculator for data processing;<br>• Controllers that control program execution;<br>• An output device that displays processing results.</p><p>According to von Neumann’s theory, we only need to replace several components of the Turing machine with electronic devices, and we can turn into an electronic computer with the smallest core, as shown in the following figure:</p><p><img src="Von-Neumann-computer-structure.png" alt="Von Neumann computer structure"></p><p>Is it very simple? This time we found that the read head no longer moves back and forth, but relies on the address bus to find the corresponding “paper tape grid”. Reading and writing data is completed by the data bus, and the control of the action is the responsibility of the control bus.</p><h4 id="Computer-screen"><a href="#Computer-screen" class="headerlink" title="Computer screen"></a>Computer screen</h4><p>The computer screen display is often the output of the graphics card. There are many forms of graphics cards: the integrated display on the motherboard is called the integrated display, the core display built in the CPU chip, and the independent display connected through the PCIE interface. To display characters on the screen, we need to program the graphics card.</p><p>In fact, no matter what graphics card is on our PC, they all support a standard called VESA, which has two working modes: character mode and graphics mode. In order to be compatible with this standard, graphics cards have to provide a firmware program called VGABIOS.</p><p>Next, let’s take a look at the details of how the graphics card’s character mode works. It divides the screen into 24 lines, each line has 80 characters, and maps these (24*80) locations to the memory starting at 0xb8000 address, each two bytes corresponds to a character, one of which is the ASCII code of the character , and the other byte is the color value of the character. As shown below:</p><p><img src="computer-graphics-card-text-mode.png" alt="Computer Graphics Card Text Mode"></p><p>Understand the working details of the character mode of the graphics card, we can write our own printf function, the code is as follows:</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">_strwrite</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> string<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">char</span><span class="token operator">*</span> p_strdst <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0xb8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//指向显存的开始地址</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>string<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token operator">*</span>p_strdst <span class="token operator">=</span> <span class="token operator">*</span>string<span class="token operator">++</span><span class="token punctuation">;</span>    p_strdst <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token function">_strwrite</span><span class="token punctuation">(</span>fmt<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The code is very simple, the printf function directly calls the _strwrite function, and the _strwrite function sets each character in the string into the video memory starting at address 0xb8000 in turn, and p_strdst adds 2 each time, which is also to skip characters space for color information.</p>]]></content>
      
      
      <categories>
          
          <category> Computer </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Basic </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goodbye CentOS Say Hi Rocky</title>
      <link href="/2022/03/03/goodbye_centos_say_hi_rocky/"/>
      <url>/2022/03/03/goodbye_centos_say_hi_rocky/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Support for CentOS ends in 2021, but the project lives on as Rocky Linux.</p><p><img src="linux.png" alt="Linux"></p><h4 id="Rocky-Linux-is-a-rock-solid-distribution"><a href="#Rocky-Linux-is-a-rock-solid-distribution" class="headerlink" title="Rocky Linux is a rock solid distribution"></a>Rocky Linux is a rock solid distribution</h4><p>Rocky Linux is a godsend for Linux enthusiasts like me who are grieving the disappearance of CentOS 8.0 but don’t really like Fedora. This release is the most reliable introductory release I’ve seen. CentOS users switching to Rocky Linux will be pleasantly surprised by the distro’s familiar look and feel. New Linux users will also have no problem navigating and traversing Rocky Linux.<br>The Linux community has responded positively and supported the distribution. Shortly after Rocky Linux was released, a subreddit was created, <a href="https://www.reddit.com/r/RockyLinux">/r/RockyLinux</a>, which now has nearly 6,000 users. Here’s how to install and configure Rocky Linux.</p><h4 id="Minimum-requirements-for-installing-Rocky-Linux"><a href="#Minimum-requirements-for-installing-Rocky-Linux" class="headerlink" title="Minimum requirements for installing Rocky Linux"></a>Minimum requirements for installing Rocky Linux</h4><p>Below are the minimum requirements to install Rocky Linux 8.5.<br>• 2 GB RAM or more<br>• 20 GB hard drive or larger<br>• 2 CPUs / vCPU (1.1 GHz processor)<br>• Internet access (optional)<br>• Bootable media (USB or DVD)</p><p>Further reading: <a href="https://www.makeuseof.com/what-is-rocky-linux/">What is Rocky Linux and should you consider it?</a></p><h4 id="Download-Rocky-Linux-and-create-a-USB-drive"><a href="#Download-Rocky-Linux-and-create-a-USB-drive" class="headerlink" title="Download Rocky Linux and create a USB drive"></a>Download Rocky Linux and create a USB drive</h4><p>Follow these instructions to download Rocky Linux and create a bootable USB drive.</p><ol><li>Open a browser and navigate to <a href="https://rockylinux.org/download">rockylinux.org/download</a>.</li><li>Click Save File.</li><li>After downloading the files, create a Rocky Linux bootable USB from your machine. If you’re not sure how to do this, see below:<br>a. <a href="https://www.makeuseof.com/windows-11-create-bootable-usb-drive/">How to create a Windows 11 bootable USB drive</a><br>b. <a href="https://www.makeuseof.com/create-bootable-usb-drive-with-etcher-linux/">How to Make a Bootable USB Drive with Etcher in Linux</a><br>c. <a href="https://www.makeuseof.com/tag/how-to-boot-a-linux-live-usb-stick-on-your-mac/">How to create and boot a Linux USB drive on a Mac</a><br>Once the installation media has been created, you can proceed.</li></ol><h4 id="Rocky-Linux-Installation-Instructions"><a href="#Rocky-Linux-Installation-Instructions" class="headerlink" title="Rocky Linux Installation Instructions"></a>Rocky Linux Installation Instructions</h4><p>Follow these instructions to successfully install Rocky Linux 8.5</p><ol><li>Insert the Rocky Linux bootable USB you created into the target PC/Laptop.</li><li>Start or restart the computer to boot from the USB drive. Once you see the Rocky Linux splash screen, select Install Rocky Linux.</li></ol><p><img src="rocky-linux-start-up.png" alt="Rocky Linux Start up"></p><ol start="3"><li>Click your preferred language when prompted, and then click Continue.</li><li>In the Installation Summary window, select Installation Destination.</li></ol><p><img src="rocky-install-summary.png" alt="Rocky Install Summary"></p><p>Select your target hard drive and click Finish.<br>5. Select Network and Hostname, then connect to your network connection. Click Finish.</p><p><img src="rocky-network.png" alt="Rocky Network"></p><ol start="6"><li>Select Installation Source and select your Rocky Linux bootable USB if not already selected.</li><li>Select Software Selection and select the desired base environment and additional software. Click Finish when you are satisfied with your selections.</li></ol><p><img src="rocky-software-selection.png" alt="Rocky Software Selection"></p><ol start="8"><li>Select the Root password from the Installation Summary window. Enter and verify your desired password. Click Finish.</li><li>Select Create User from the Installation Summary window. Enter your desired response. Click Finish.</li></ol><p><img src="rocky-create-user.png" alt="Rocky Create User"></p><ol start="10"><li>Please be patient while installing Rocky Linux on your laptop/PC.</li><li>After the installation is complete, click Reboot System. Remove the Rocky Linux bootable USB drive when prompted. Press <enter></enter></li><li>After the system restarts, click Licensing Information in the Initial Setup window</li><li>Read the license agreement, scroll to the bottom, and check I accept the license agreement. Click Finish.</li></ol><p><img src="rocky-installation.png" alt="Rocky Installation"></p><ol start="14"><li>Click Finish Configuration.</li></ol><h4 id="Post-installation-configuration-steps-for-Rocky-Linux"><a href="#Post-installation-configuration-steps-for-Rocky-Linux" class="headerlink" title="Post-installation configuration steps for Rocky Linux"></a>Post-installation configuration steps for Rocky Linux</h4><p>After Rocky Linux boots for the first time, you will need to complete some configuration steps.</p><ol><li>Log in to the Rocky Linux installation using the user (and password) you created earlier.</li></ol><p><img src="rocky-login.png" alt="Rocky Login"></p><ol start="2"><li>After the system restarts, click Licensing Information in the Initial Setup window</li><li>Read the license agreement, scroll to the bottom, and check I accept the license agreement. Click Finish.</li><li>Click Finish Configuration.</li><li>Log in to your Rocky Linux installation.</li><li>Select your desired language on the welcome screen. Click Next.</li><li>Repeat typing the screen. Click Next.</li><li>On the Privacy screen, choose whether you want to turn Location Services on or off. Click Next.</li></ol><p><img src="rocky-privacy.png" alt="Rocky Privacy"></p><ol start="9"><li>Select the online account you want to connect to and enter your credentials, or click Skip.</li><li>Click Get Started with Rocky Linux.</li></ol><p><img src="rocky-ready-go.png" alt="Rocky Ready Go"></p><ol start="11"><li>Congratulations, you have successfully installed Rocky Linux 8 on your laptop/PC!<br>Whenever you install a new release, your priority is to update your system to make sure any security updates are applied as well as software on OS updates. Fire up your terminal and update your repository with the following command (enter your root password if prompted):</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum check-update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>After the yum check-update command completes, enter the following command to update your operating system and all installed software:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> yum update<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>After the sudo yum update command completes, exit the terminal with the following command:</p><h4 id="Improve-DNF-speed-for-Rocky-Linux-8-5"><a href="#Improve-DNF-speed-for-Rocky-Linux-8-5" class="headerlink" title="Improve DNF speed for Rocky Linux 8.5"></a>Improve DNF speed for Rocky Linux 8.5</h4><p>Dandified YUM, better known as DNF, is a package manager for RPM-based Linux distributions that install, update, and remove packages. It was originally introduced in Fedora 18 in a testable state (i.e. Tech Preview), but it has been Fedora’s default package manager since Fedora 22. The package manager in Rocky Linux is also RPM (Red Hat Package Manager). Package managers allow Linux users to install, update, and remove software.<br>After installing and updating and upgrading a new Rocky 8.5 installation, it is recommended that you increase the DNF speed. First backup the dnf.conf file.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">cp</span> /etc/dnf/dnf.conf /etc/dnf/dnf/bak<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Next, edit the dnf.conf file:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/dnf/dnf.conf<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>You can now increase DNF speed by adding parallel downloads by adding the following to the bottom of your dnf.conf file:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">max_parallel_downloads</span><span class="token operator">=</span><span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Note that it is recommended that users start with 10, but you can increase it to a different number, such as 15, 20, etc. It is recommended to do this with caution. To enable the fastest mirror, add this line below max_parallel_downloads=10.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token assign-left variable">fastestmirror</span><span class="token operator">=</span>True<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Save the updated /etc/dnf.conf file, then exit nano.<br>A restart or restart of any services is required as these changes take effect immediately.</p><h4 id="Migrating-to-Rocky-Linux-8-5"><a href="#Migrating-to-Rocky-Linux-8-5" class="headerlink" title="Migrating to Rocky Linux 8.5"></a>Migrating to Rocky Linux 8.5</h4><p>Existing CentOS 8.5, Alma Linux 8.5, RHEL 8.5, or Oracle Linux 8.5 users can easily migrate to Rocky Linux using the following procedure.<br>First, download the Rocky Linux migration script. The safest way is to download the migration script via git.<br>Type in your terminal. Install git by entering the following command (if prompted for a root password):</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> dnf <span class="token function">install</span> <span class="token function">git</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Next, clone the rocky-tools repository with the following command:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">git</span> clone https://github.com/rocky-linux/rocky-tools.git<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>You can also download the migration script via the curl command (although this is a less secure method):</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">curl</span> https://raw.githubusercontent.com/rocky-linux/rocky-tools/main/migrate2rocky/migrate2rocky.sh -o migrate2rocky.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Now that you have the migration script, you can execute it and start the migration. However, first, you have to give the owner of the script file execute permission via the command:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">chmod</span> u+x migrate2rocky.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Finally, we will execute the script:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> ./migrate2rocky.sh -r<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>(Note that the ‘-r’ option instructs the script to install everything. Please be patient while the migration script completes. When done, exit the terminal.</p>]]></content>
      
      
      <categories>
          
          <category> Linux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> Rocky </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Container&#39;s Knowledge You need to know</title>
      <link href="/2022/03/02/container_s_knowledge_you_need_to_know/"/>
      <url>/2022/03/02/container_s_knowledge_you_need_to_know/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>The ins and outs of the “Container” technology:</p><ul><li>The rise of Container technology stems from the popularization of <code>PaaS</code> technology;</li><li>The Docker project released by Docker Company has a milestone significance;</li><li>The Docker project solves the fundamental problem of application packaging through “container images”;</li><li>he container itself has no value, what is valuable is the “container orchestration”.</li></ul><p>Containers are actually a sandbox technology. As the name suggests, a sandbox is a technology that can “package” your application like a container. In this way, applications and applications will not interfere with each other because there is a boundary; and applications that are packed into containers can also be easily moved around, which is the ideal state of <code>PaaS</code>.</p><h3 id="Realizing-the-“Boundary”"><a href="#Realizing-the-“Boundary”" class="headerlink" title="Realizing the “Boundary”"></a>Realizing the “Boundary”</h3><p>Suppose, now you want to write a small program that calculates addition. The input required by this program comes from a file, and the result after the calculation is completed is output to another file.</p><p>Since computers only know 0s and 1s, no matter which language is written this code, it needs to be translated into binary files in some way in order to run in the computer operating system. In order to make these codes run normally, we often need to provide them with data, such as the input files required by our addition program. These data plus the binary file of the code itself, placed on the disk, is what we usually call a “program”, also called the executable image of the code (executable image).</p><p>Then, we can run this “program” on the computer.</p><p>First, the operating system finds that the input data is stored in a file from the “program”, so the data is loaded into memory and ready for use. At the same time, the operating system has read the instruction to calculate the addition. At this time, it needs to instruct the CPU to complete the addition operation. The CPU cooperates with memory to perform addition calculations, and uses registers to store values, and memory stacks to store executed commands and variables. At the same time, there are still open files in the computer, and various I/O devices are constantly calling to modify their state.</p><p>In this way, once a “program” is executed, it changes from a binary file on disk to a collection of information such as data in computer memory, values in registers, instructions in stacks, opened files, and the state of various devices. After such a program runs, the sum of the computer execution environment is: process.</p><p>Therefore, for a process, its static performance is a program, which usually stays on the disk quietly; once it runs, it becomes the sum of the data and state in the computer, which is its dynamic performance .</p><p>The core function of container technology is to create a “boundary” for a process by constraining and modifying the dynamic performance of the process.</p><p>For most Linux containers such as Docker, Cgroups technology is the main method used to create constraints, while Namespace technology is the main method used to modify the process view.</p><h4 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h4><p>The way Namespace is used is also very interesting: it is really just an optional parameter for Linux to create a new process. We know that the system call to create a process in a Linux system is clone(), and when we use the clone() system call to create a new process, we can specify the CLONE_NEWPID parameter in the parameters, such as:</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> pid <span class="token operator">=</span> <span class="token function">clone</span><span class="token punctuation">(</span>main_function<span class="token punctuation">,</span> stack_size<span class="token punctuation">,</span> CLONE_NEWPID <span class="token operator">|</span> SIGCHLD<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>At this time, the newly created process will “see” a brand new process space, and in this process space, its PID is 1. The reason why I say “see” is because this is just a “gaze”. In the real process space of the host, the PID of this process is still a real value, such as 100.</p><p>In addition to the PID Namespace we just used, the Linux operating system also provides Namespaces such as Mount, UTS, IPC, Network, and User, which are used to “obfuscate” various process contexts.</p><p>For example, Mount Namespace is used to allow the isolated process to only see the mount point information in the current Namespace; Network Namespace is used to allow the isolated process to see the network devices and configurations in the current Namespace.</p><p>This is the most basic implementation principle of Linux containers.</p><p>Therefore, the concept of Docker container, which sounds mysterious and mysterious, is actually a set of Namespace parameters that need to be enabled for this process when creating a container process. In this way, the container can only “see” the resources, files, devices, states, or configurations defined by the current Namespace. For the host and other unrelated programs, it is completely invisible. Therefore, a container is actually a special process.</p><p>When it comes to the idea of “dividing a separate space for the process”, I believe you will definitely think of virtual machines. Also, you should have seen a comparison chart of virtual machines and containers as below before.</p><p><img src="Virtual-machine-VS-container.png" alt="Virtual Machine VS Container"></p><p>On the left side of this picture, the working principle of the virtual machine is drawn. Among them, the software called Hypervisor is the most important part of the virtual machine. It simulates various hardware required to run an operating system through hardware virtualization, such as CPU, memory, I/O devices, and so on. Then, it installs a new operating system, the Guest OS, on these virtual hardware. In this way, the user’s application process can run in this virtual machine, and it can only see the files and directories of the Guest OS and the virtual devices in this machine. This is why virtual machines can also act to isolate different application processes from each other.</p><p>On the right side of the picture, the Hypervisor is replaced with a piece of software called Docker Engine. This is why many people refer to the Docker project as a “lightweight” virtualization technology, which actually puts the concept of a virtual machine on a container.</p><p>However, this statement is not rigorous.</p><p>After understanding how namespaces work, you will understand that unlike real virtual machines, when using Docker, there is no real “Docker container” running inside the host. The Docker project helps users start the original application process, but when creating these processes, Docker adds various Namespace parameters to them. At this time, these processes will feel that they are the No. 1 process in their respective PID Namespaces, and can only see the directories and files mounted in their respective Mount Namespaces, and can only access network devices in their respective Network Namespaces, as if running In a “container”, isolated from the world.</p><p>In this comparison diagram of virtual machine and container technology, Docker Engine or any container management tools should not be placed in the same position as the hypervisor, because they are not responsible for the isolation environment of the application process like the hypervisor, nor do they create any entity’s “container”. It is the host operating system itself that is really responsible for the isolation environment. Docker should be drawn at the same level as the application and next to it. This means that the user’s application process running in the container, like other processes on the host, is uniformly managed by the host operating system, but these isolated processes have additionally set Namespace parameters. The role played by the Docker project here is more of a bypass-style auxiliary and management work.</p><p>Compared with virtualization technology, the isolation mechanism based on Linux Namespace also has many shortcomings. The main problem is that the isolation is not complete.</p><ol><li>First of all, since the container is just a special process running on the host, the operating system kernel of the same host is still used between multiple containers.</li><li>Secondly, in the Linux kernel, there are many resources and objects that cannot be namespaced, the most typical example is: time. This means that if the program in your container modifies the time using the settimeofday(2) system call, the time of the entire host will be modified accordingly, which is obviously not in line with user expectations. Compared with the freedom of tossing around in a virtual machine, when deploying an application in a container, “what can be done and what cannot be done” is a problem that users must consider. So set ReadOnly when mounting localtime.</li></ol><p>The container is a single process. For example, I have an image that integrates jdk, netstat, ping, etc. Although the container starts with a java process, I can enter the container to execute various commands, such as netstat, etc. Are these commands running while the container is running?<br>is running. But they are not controlled by docker, like wild children. So single process means that not only one process can be run, but only one process is controllable.</p><h4 id="Cgroups"><a href="#Cgroups" class="headerlink" title="Cgroups"></a>Cgroups</h4><p>The full name of Linux Cgroups is Linux Control Group. Its main function is to limit the upper limit of resources that a process group can use, including CPU, memory, disk, network bandwidth, and so on. In addition, Cgroups can prioritize, audit, and suspend and resume processes.</p><p>In Linux, the operation interface exposed by Cgroups to users is the file system, that is, it is organized in the form of files and directories under the <code>/sys/fs/cgroup</code> path of the operating system. On an Ubuntu 16.04 machine, I can display them with the mount command, which is:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">mount</span> -t cgroup cpuset on /sys/fs/cgroup/cpuset <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,cpuset<span class="token punctuation">)</span>cpu on /sys/fs/cgroup/cpu <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,cpu<span class="token punctuation">)</span>cpuacct on /sys/fs/cgroup/cpuacct <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,cpuacct<span class="token punctuation">)</span>blkio on /sys/fs/cgroup/blkio <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,blkio<span class="token punctuation">)</span>memory on /sys/fs/cgroup/memory <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,memory<span class="token punctuation">)</span><span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>As you can see, there are many subdirectories such as cpuset, cpu, and memory under <code>/sys/fs/cgroup</code>, also called subsystems. These are the types of resources that my machine can currently limit by Cgroups. Under the resource type corresponding to the subsystem, you can see the specific methods that this type of resource can be restricted. For example, for the CPU subsystem, we can see the following configuration files, this command is:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ls</span> /sys/fs/cgroup/cpucgroup.clone_children cpu.cfs_period_us cpu.rt_period_us  cpu.shares notify_on_releasecgroup.procs      cpu.cfs_quota_us  cpu.rt_runtime_us cpu.stat  tasks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>If you are familiar with Linux CPU management, you will notice keywords like <code>cfs_period</code> and <code>cfs_quota</code> in its output. These two parameters need to be used in combination and can be used to limit a process to a total of <code>cfs_quota</code> of CPU time within a period of time of <code>cfs_period</code>.</p><p>And how to use such a configuration file?</p><p>You need to create a directory under the corresponding subsystem, for example, we now enter the <code>/sys/fs/cgroup/cpu</code> directory:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@ubuntu:/sys/fs/cgroup/cpu$ <span class="token function">mkdir</span> containerroot@ubuntu:/sys/fs/cgroup/cpu$ <span class="token function">ls</span> container/cgroup.clone_children cpu.cfs_period_us cpu.rt_period_us  cpu.shares notify_on_releasecgroup.procs      cpu.cfs_quota_us  cpu.rt_runtime_us cpu.stat  tasks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>This directory is called a “control group”. You will find that the operating system will automatically generate the resource limit file corresponding to the subsystem in the newly created container directory. Now, we execute such a script in the background:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token keyword">while</span> <span class="token builtin class-name">:</span> <span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">:</span> <span class="token punctuation">;</span> <span class="token keyword">done</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">226</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Obviously, it executes an infinite loop that can eat up the computer’s CPU to 100%, and based on its output, we can see that the process ID (PID) of this script running in the background is 226. In this way, we can use the top command to confirm whether the CPU is full:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">top</span>%Cpu0 :100.0 us, <span class="token number">0.0</span> sy, <span class="token number">0.0</span> ni, <span class="token number">0.0</span> id, <span class="token number">0.0</span> wa, <span class="token number">0.0</span> hi, <span class="token number">0.0</span> si, <span class="token number">0.0</span> st<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>As you can see in the output, the CPU usage has reached 100% (%Cpu0 : 100.0 us). At this time, by viewing the files in the container directory, we can see that the CPU quota in the container control group has no limit (ie: -1), and the CPU period is the default 100 ms (100000 us):</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us -1$ <span class="token function">cat</span> /sys/fs/cgroup/cpu/container/cpu.cfs_period_us <span class="token number">100000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Next, we can set limits by modifying the contents of these files. For example, to write 20 ms (20000 us) to the cfs_quota file in the container group:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token number">20000</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Combined with the previous introduction, you should be able to understand the meaning of this operation. It means that in every 100 ms, the process limited by the control group can only use 20 ms of CPU time, which means that this process can only use up to 20 ms of CPU time. 20% CPU bandwidth.</p><p>Next, we write the PID of the restricted process into the tasks file in the container group, and the above settings will take effect for the process:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token number">226</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/cpu/container/tasks <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>We can check it out with the <code>top</code> command:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">top</span>%Cpu0 <span class="token builtin class-name">:</span> <span class="token number">20.3</span> us, <span class="token number">0.0</span> sy, <span class="token number">0.0</span> ni, <span class="token number">79.7</span> id, <span class="token number">0.0</span> wa, <span class="token number">0.0</span> hi, <span class="token number">0.0</span> si, <span class="token number">0.0</span> st<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>It can be seen that the CPU usage of the computer immediately dropped to 20% (%Cpu0 : 20.3 us).</p><p>Except for the CPU subsystem, each subsystem of Cgroups has its own unique resource limitation capabilities, such as:</p><ul><li>blkio，which sets I/O limits for block devices, generally used for devices such as disks；</li><li>cpuset，which allocates separate CPU cores and corresponding memory nodes for processes;</li><li>memory，which sets a limit on memory usage for a process.</li></ul><p>The design of Linux Cgroups is relatively easy to use. To understand it simply and rudely, it is a combination of a subsystem directory and a set of resource limit files. For Linux container projects such as Docker, they only need to create a control group (that is, create a new directory) for each container under each subsystem, and then after starting the container process, fill in the PID of the process to the corresponding Control group tasks file on it.</p><p>As for what value to fill in the resource files under these control groups, it depends on the parameters specified by the user when executing <code>docker run</code>, such as this command:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ docker run -it --cpu-period<span class="token operator">=</span><span class="token number">100000</span> --cpu-quota<span class="token operator">=</span><span class="token number">20000</span> ubuntu /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>After starting the container, we can confirm by checking the contents of the resource limit file in the “docker” control group in the CPU subsystem under the Cgroups file system:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> /sys/fs/cgroup/cpu/docker/5d5c9f67d/cpu.cfs_period_us <span class="token number">100000</span>$ <span class="token function">cat</span> /sys/fs/cgroup/cpu/docker/5d5c9f67d/cpu.cfs_quota_us <span class="token number">20000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>This means that this Docker container can only use 20% of the CPU bandwidth.</p><p>A running Docker container is actually an application process with multiple Linux Namespaces enabled, and the amount of resources that this process can use is limited by the configuration of Cgroups.<br>This is also a very important concept in container technology, namely: the container is a “single process” model.</p><p>Since the essence of a container is a process, the user’s application process is actually the process with PID=1 in the container, and it is also the parent process of all other subsequently created processes. This means that in a container, you can’t run two different applications at the same time, unless you can find a common PID=1 program in advance to act as the parent process of two different applications, which is why many people will Use software such as systemd or supervisord instead of the application itself as the startup process of the container. But this is because the design of the container itself is to hope that the container and the application can have the same life cycle. This concept is very important for container orchestration. Otherwise, once there is a situation similar to “the container is running normally, but the application in it has already been suspended”, the orchestration system will be very troublesome to deal with.<br>Similar to the case of Namespace, Cgroups also have many imperfections in their ability to limit resources. The most mentioned issue is naturally the <code>/proc</code> file system.</p><p>As we all know, the <code>/proc</code> directory under Linux stores a series of special files that record the current kernel running state. Users can access these files to view information about the system and currently running processes, such as CPU usage, memory usage, etc. These files are also the primary source of data for the top command to view system information.</p><p>However, if you execute the <code>top</code> command in the container, you will find that the information it displays is actually the CPU and memory data of the host, not the data of the current container. The reason for this problem is that the <code>/proc</code> file system does not know what resource restrictions the user has placed on the container through Cgroups, that is, the <code>/proc</code> file system does not understand the existence of Cgroups restrictions.</p><p>In the production environment, this problem must be corrected, otherwise the information such as the number of CPU cores and available memory read by the application in the container is the data on the host, which will bring great confusion and confusion to the operation of the application. risk. This is also a common problem encountered by containerized applications in the enterprise, and it is another disadvantage of containers compared to virtual machines.</p><p>Of course, the CPU and memory seen by commands such as top in the container are information about the host. <strong><a href="https://github.com/lxc/lxcfs">lxcfs</a></strong> can solve this problem.</p><p>Principle: <code>top</code> obtains data from the <code>/prof/stats</code> directory, so in principle, the container does not need to mount this directory of the host. lxcfs implements this function by mounting the host’s <code>/var/lib/lxcfs/proc/memoinfo</code> file to the <code>/proc/meminfo</code> location of the Docker container. When the process in the container reads the content of the corresponding file, the FUSE implementation of LXCFS will read the correct memory limit from the Cgroup corresponding to the container. This enables the application to obtain the correct resource constraint settings. In the kubernetes environment, it can also be used, run lxcfs in ds mode, and automatically inject the proc information that is sought into the container.</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Container </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java Immutable objects</title>
      <link href="/2022/02/26/java_immutable_objects/"/>
      <url>/2022/02/26/java_immutable_objects/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Introduce"><a href="#Introduce" class="headerlink" title="Introduce"></a>Introduce</h3><p>Immutable objects are simply objects whose state (the object’s data) cannot change after construction. Examples of immutable objects from the JDK include String and Integer.</p><h3 id="Immutable-Object-Advantage"><a href="#Immutable-Object-Advantage" class="headerlink" title="Immutable Object Advantage"></a>Immutable Object Advantage</h3><ul><li>are simple to construct, test, and use</li><li>are automatically thread-safe and have no synchronization issues</li><li>don’t need a copy constructor</li><li>don’t need an implementation of clone</li><li>allow hashCode to use lazy initialization, and to cache its return value</li><li>don’t need to be copied defensively when used as a field</li><li>make good Map keys and Set elements (these objects must not change state while in the collection)</li><li>have their class invariant established once upon construction, and it never needs to be checked again</li><li>always have “failure atomicity” (a term used by Joshua Bloch): if an immutable object throws an exception, it’s never left in an undesirable or indeterminate state</li></ul><h3 id="How-can-I-make-a-Object-Immutable"><a href="#How-can-I-make-a-Object-Immutable" class="headerlink" title="How can I make a Object Immutable"></a>How can I make a Object Immutable</h3><ul><li>ensure the class cannot be overridden - make the class final, or use static factories and keep constructors private</li><li>make fields private and final</li><li>force callers to construct an object completely in a single step, instead of using a no-argument constructor combined with subsequent calls to setXXX methods (that is, avoid the Java Beans convention)</li><li>do not provide any methods which can change the state of the object in any way - not just setXXX methods, but any method which can change state</li><li>if the class has any mutable object fields, then they must be defensively copied when they pass between the class and its caller</li></ul><p><strong>It’s interesting to note that BigDecimal is technically not immutable, since it’s not final.</strong></p><h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span><span class="token punctuation">;</span><span class="token comment">/*** Planet is an immutable class, since there is no way to change* its state after construction.*/</span><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">Planet</span> <span class="token punctuation">{</span>  <span class="token keyword">public</span> <span class="token class-name">Planet</span> <span class="token punctuation">(</span><span class="token keyword">double</span> aMass<span class="token punctuation">,</span> <span class="token class-name">String</span> aName<span class="token punctuation">,</span> <span class="token class-name">Date</span> aDateOfDiscovery<span class="token punctuation">)</span> <span class="token punctuation">{</span>     fMass <span class="token operator">=</span> aMass<span class="token punctuation">;</span>     fName <span class="token operator">=</span> aName<span class="token punctuation">;</span>     <span class="token comment">//make a private copy of aDateOfDiscovery</span>     <span class="token comment">//this is the only way to keep the fDateOfDiscovery</span>     <span class="token comment">//field private, and shields this class from any changes that </span>     <span class="token comment">//the caller may make to the original aDateOfDiscovery object</span>     fDateOfDiscovery <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>aDateOfDiscovery<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment">/**  * Returns a primitive value.  *  * The caller can do whatever they want with the return value, without   * affecting the internals of this class. Why? Because this is a primitive   * value. The caller sees its "own" double that simply has the  * same value as fMass.  */</span>  <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">getMass</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> fMass<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment">/**  * Returns an immutable object.  *  * The caller gets a direct reference to the internal field. But this is not   * dangerous, since String is immutable and cannot be changed.  */</span>  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> fName<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token comment">//  /**</span><span class="token comment">//  * Returns a mutable object - likely bad style.</span><span class="token comment">//  *</span><span class="token comment">//  * The caller gets a direct reference to the internal field. This is usually dangerous, </span><span class="token comment">//  * since the Date object state can be changed both by this class and its caller.</span><span class="token comment">//  * That is, this class is no longer in complete control of fDate.</span><span class="token comment">//  */</span><span class="token comment">//  public Date getDateOfDiscovery() {</span><span class="token comment">//    return fDateOfDiscovery;</span><span class="token comment">//  }</span>  <span class="token comment">/**  * Returns a mutable object - good style.  *   * Returns a defensive copy of the field.  * The caller of this method can do anything they want with the  * returned Date object, without affecting the internals of this  * class in any way. Why? Because they do not have a reference to   * fDate. Rather, they are playing with a second Date that initially has the   * same data as fDate.  */</span>  <span class="token keyword">public</span> <span class="token class-name">Date</span> <span class="token function">getDateOfDiscovery</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>fDateOfDiscovery<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment">// PRIVATE</span>  <span class="token comment">/**  * Final primitive data is always immutable.  */</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">double</span> fMass<span class="token punctuation">;</span>  <span class="token comment">/**  * An immutable object field. (String objects never change state.)  */</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> fName<span class="token punctuation">;</span>  <span class="token comment">/**  * A mutable object field. In this case, the state of this mutable field  * is to be changed only by this class. (In other cases, it makes perfect  * sense to allow the state of a field to be changed outside the native  * class; this is the case when a field acts as a "pointer" to an object  * created elsewhere.)  */</span>  <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Date</span> fDateOfDiscovery<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Object </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Looking at IoT from a data perspective</title>
      <link href="/2022/02/24/iot_data_perspective/"/>
      <url>/2022/02/24/iot_data_perspective/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="Looking-at-IoT-from-a-data-perspective"><a href="#Looking-at-IoT-from-a-data-perspective" class="headerlink" title="Looking at IoT from a data perspective"></a>Looking at IoT from a data perspective</h4><p><img src="IOT-Data-Perspective.png" alt="IOT Data Perspective"></p><h5 id="The-first-step-data-collection-from-a-data-source"><a href="#The-first-step-data-collection-from-a-data-source" class="headerlink" title="The first step: data collection from a data source"></a>The first step: data collection from a data source</h5><p>Data collection from data sources is to realize various data digitization tasks through various IoT devices. At the same time, it may also be necessary to temporarily store the data and prepare for the uploading of the data.</p><p>Because there are various types of data, such as temperature, humidity, formaldehyde content, as well as images, sounds, vibrations, etc., the equipment that collects these data also has obvious diversity.</p><p>In addition to the software and hardware development involved in traditional embedded systems, sensors are the key components that need to be focused on in this part. With the development of the Internet of Things, new applications are emerging, such as wearable devices for monitoring human heart rate and blood oxygen saturation, and optical sensors for measuring soil reflectivity and plant color in smart agriculture.</p><p>After collecting the data, you need to use the network to transmit the data to the cloud server.</p><h5 id="Step-2-Data-Transfer"><a href="#Step-2-Data-Transfer" class="headerlink" title="Step 2: Data Transfer"></a>Step 2: Data Transfer</h5><p>Data transmission is to report the collected data to the cloud platform quickly and reliably. The technical difficulty here is to achieve high concurrency. Because the number of IoT devices is huge and they are constantly generating data, the massive amount of data poses a challenge to the performance of cloud platforms. Only with the ability of high concurrency can the cloud platform effectively and reliably realize data transmission. The realization of high concurrency requires the help of distributed architecture design and the use of related technologies such as load balancing, message queue, and cache.</p><h5 id="Step-3-Data-Storage"><a href="#Step-3-Data-Storage" class="headerlink" title="Step 3: Data Storage"></a>Step 3: Data Storage</h5><p>After the data transfer is completed, the problem you have to face is the storage of massive data.</p><p>For example, a shared bicycle will generate 1MB of data a day, and if it is calculated based on the number of 20 million vehicles, 20TB of new data will be generated every day. In a smart city system, an 8-megapixel camera can generate 3.6GB of data in an hour. In a city, the data volume of cameras alone can reach hundreds of petabytes a month.</p><p>In addition to a large amount of data, the types of data are also very rich. They can be roughly divided into three categories, which require different storage methods:</p><ol><li><p>Structured data</p></li><li><p>Semi-structured data</p></li><li><p>Unstructured data</p></li></ol><h6 id="Structured-data"><a href="#Structured-data" class="headerlink" title="Structured data"></a>Structured data</h6><p>For example, the relationship between users and devices, user information, device parameters, etc., are still suitable for relational databases. Based on relational databases, we can easily implement “add, delete, modify, and check” data, and can easily implement transaction operations to ensure that data operations meet the <code>ACID </code>characteristics (that is, Atomic, Consistency, Isolation, and Durability).</p><p>In order to meet the challenges of big data on computing and read and write performance, database systems need to use the power of distributed architecture (horizontal expansion), then you can use distributed databases.</p><p>Distributed relational database</p><p>The initial practice in the industry is to sub-database and sub-table, and then use database middleware to realize functions such as association query, primary key avoidance duplication, paging query, and transaction consistency. However, there are many drawbacks to this method. For example, database and table sharding need to be carefully designed according to the characteristics of business data, and this operation of database and sharding will definitely involve very troublesome data migration; the efficiency of executing SQL through a middleware is not high; Transaction consistency is difficult to guarantee, and it is often necessary to achieve “eventual consistency” in applications.</p><p>To solve these problems, distributed relational databases appeared. It is also often referred to as a NewSQL database. Its advantages are mainly reflected in the following three aspects.</p><ol><li><p>High scalability. NewSQL inherently supports data sharding, supports dynamic addition of nodes, and does not require troublesome data migration, so it can easily meet the storage requirements when data continues to grow.</p></li><li><p>High concurrency. Compared with the disk-based design of a stand-alone relational database, NewSQL makes better use of memory in design, so SQL execution efficiency is very high. In terms of transaction support, NewSQL has efficient distributed transaction features. Therefore, it can realize the reading and writing of massive data, as well as the query and update of a large number of users.</p></li><li><p>High availability. NewSQL uses Paxos or Raft protocol to achieve multi-copy storage, and also supports automatic selection of master nodes, which ensures that the failover time of the database is very short.</p></li></ol><p>Therefore, for scenarios that require strongly consistent transactions (such as payment transactions in the shared bicycle IoT system), and scenarios that require complex queries based on relational models (for example, the query of lost bicycles in shared bicycles involves user information table, bicycle information table, and riding record table), when the single-machine relational database can no longer meet the needs of big data, the distributed relational database can be considered. Especially when the previous business has been developed based on the relational database and is running in the actual service environment, the distributed relational database is simply a boon for business developers. In this case, if you want to use other types of databases which does not support the SQL language, the business code needs to be modified and adjusted a lot.</p><p>In practice, open-source options for distributed databases include <a href="https://pingcap.com/zh/product/#SelectProduct">TiDB</a>、[CockroachDB, etc. as well as commercial products, such as Alibaba’s <a href="https://www.oceanbase.com/">OceanBase</a>.</p><p>In addition, sensor devices in the Internet of Things continuously generate new data over time. To store this type of data, you can choose a time-series database for higher read, write and query performance.</p><p><strong>Time series database</strong></p><p>The solution of a distributed relational database is obtained from the perspective of increasing capacity. So, can we find other solutions from the perspective of simplifying the problem?</p><p>One such scenario is the application system of sensors in IoT, such as sensors monitoring temperature and humidity conditions in cold storage. These sensors will continuously report data according to a certain period (for example, once every 1 minute). Such data is arranged in chronological order to form a series of data points, so it is called time-series data.</p><p>Time series data has the following characteristics in terms of reading, writing, storage, and analysis and processing:</p><ol><li><p>Time series data is continuously written, generally using a fixed frequency, and there is no obvious change in the amount of writing. The number is very large, and the demand for concurrent writes is high. However, the data is rarely updated, and the old data is basically not required to be updated except for modification in special cases.</p></li><li><p>There are few reads of time series data. Compared with the high concurrency and high frequency of writes, the read requirements are mainly for data analysis applications, and the concurrent access volume of analysis applications is relatively small.</p></li><li><p>Time series data is highly time-sensitive. Generally, the newer the data, the greater the value, and the old data will lose value quickly.</p></li><li><p>The data analysis of time series data is mainly concerned with new data, and the probability of old data being queried and analyzed is not high. Older data is generally a coarse-grained read analysis. And when it is analyzed, it is generally based on the time range reading analysis, and the probability of reading a certain record is very small.</p></li></ol><p>Based on the characteristics of time series data structures and applications, time-series databases have been developed by people, which have become very popular with the application of the Internet of Things in recent years. Time series database simplifies many unnecessary functions of the relational database, such as using <code>LSM tree </code>with low read performance instead of B+ tree storage structure. It focuses on supporting high-concurrency data writing, adopts a higher compression ratio compression algorithm to support the storage of massive data, reduces storage costs, and supports efficient grouping and aggregation computing of massive data through methods such as preprocessing.</p><p>What are the specific products of the sequence database?</p><p>The first is open source software, you can choose products like <a href="https://www.influxdata.com/">InfluxDB</a>， <a href="http://kairosdb.github.io/">KairosDB,</a> and <a href="http://opentsdb.net/">OpenTSDB</a></p><p>In addition, cloud service companies generally develop their own time-series databases, such as <a href="https://www.aliyun.com/product/hitsdb?spm=a2c4g.11174283.h2v3icoap.114.42341426br5G1P">Alibaba’s TSDB</a> and Amazon’s AWS Timestream. Among them, TSDB also extends support for spatial information to handle requirements such as geofencing and spatial trajectories.</p><h6 id="Semi-structured-data"><a href="#Semi-structured-data" class="headerlink" title="Semi-structured data"></a>Semi-structured data</h6><p>Such as <strong>JSON-structured data, logging</strong>, etc. The storage of these data generally adopts NoSQL database products.</p><p>Semi-structured data contains related markup that separates semantic elements and stratifies records and fields. For example, the curly brackets “{}”, the square brackets “[]”, the colon “:”, the comma “,” in JSON format data JSON are to separate semantic elements, the content before each colon is the field, and the following is the record.</p><p>The characteristic of semi-structured data is that its structure is not fixed, and entities belonging to the same class can have different properties, which shows that it has good scalability. Also, even if they are grouped together, the order of the properties doesn’t matter. These characteristics determine that it is difficult for us to establish the structure and relationship of semi-structured data according to the data model of relational database. In addition to JSON, common semi-structured data is XML, etc. In application systems, log files are typical semi-structured data.</p><p>To store semi-structured data more efficiently, we can choose a NoSQL database. It is stored in key-value pairs, and the structure is not fixed, and each tuple can have different fields. Each tuple can add some of its own key-value pairs as needed, so that the database is not limited to a fixed structure, which can reduce some time and space overhead.</p><p>In fact, we know that SQL is just an interface for manipulating database data, so the “No” in NoSQL really means No Relational, and the professional name should be a non-relational database.</p><p>Because the non-relational database no longer emphasizes data consistency, does not support transaction operations, and no longer pays attention to complex relational table queries, it has better processing performance for massive data, and the stored data format is richer and easy to expand. Some non-relational databases use memory to store data in order to support faster query speeds.</p><p>There are also many open source products for non-relational databases, such as <a href="https://couchdb.apache.org/">CouchDB</a>、<a href="https://redis.io/">Redis</a>、<a href="https://hbase.apache.org/">HBase</a>、<a href="https://cassandra.apache.org/_/index.html">Cassandra</a>, etc. You can choose based on your familiarity and ecological support. Commercial options also include products such as <a href="https://www.mongodb.com/">MongoDB</a> and <a href="https://www.oracle.com/cloud/sign-in.html?redirect_uri=https://cloud.oracle.com/zh_CN/nosql">Oracle NoSQL</a>.</p><h6 id="Unstructured-data"><a href="#Unstructured-data" class="headerlink" title="Unstructured data"></a>Unstructured data</h6><p>Unstructured data does not have a predefined data model and cannot be represented simply by the two-dimensional table structure of the database. Its format is very diverse, and the standard is not uniform. For large-scale storage of this type of data, we can only use distributed file systems.</p><p>Such as video, audio, and other data. They are generally stored in the form of files, and the widely used distributed file system  <strong><a href="https://hadoop.apache.org/docs/r1.0.4/cn/hdfs_design.html">HDFS</a></strong> in the Hadoop system is a commonly used option. Other distributed file systems include <a href="https://gitee.com/fastdfs100/fastdfs">FastDFS</a> and <a href="https://ceph.com/en/">Ceph</a>.</p><p><img src="data-storage-solution.png" alt="Data storage solution"></p><p>The realization of massive data storage lays a solid foundation for data processing.</p><h6 id="Data-Migration-Tool"><a href="#Data-Migration-Tool" class="headerlink" title="Data Migration Tool"></a>Data Migration Tool</h6><p>The migration of data is more troublesome and needs to be avoided as much as possible in the design stage. However, there are some data migration needs that you may not be able to avoid. For example, you need to import the data in the MySQL database in the running system into the NoSQL database HBase for analysis and processing using big data technology.</p><p>For such a requirement, we have to use tools to complete it. The  <a href="https://sqoop.apache.org/">Sqoop</a> project is a relatively well-known tool. It bridges the gap between Hadoop’s big data storage systems and relational databases. With Sqoop, you can easily import MySQL data into HBase. In addition, Sqoop adopts a plug-in architecture called Connector. Different Connectors can also connect to different data sources, and you can also customize a dedicated Connector according to your own needs to complete some special migration work. Therefore, Sqoop can also complete migration tasks between NoSQL databases (such as CouchDB) and file storage systems (such as FTP).</p><p><img src="sqoop.png" alt="sqoop"></p><p>Of course, Sqoop also has a disadvantage, that is, it is not suitable for incremental data update, also known as CDC (Change Data Capture). If the method of regularly scanning the entire table based on Sqoop is used, the execution will be inefficient and the delay will be serious. At this time, LinkedIn’s open-source <a href="https://github.com/linkedin/databus">Databus</a> project can be considered, or Alibaba’s <a href="https://github.com/alibaba/canal">Canal</a>, both of which are based on analyzing database log files to efficiently implement incremental data updates.</p><h5 id="Data-Processing"><a href="#Data-Processing" class="headerlink" title="Data Processing"></a>Data Processing</h5><p>In the data processing stage, your ability to process massive data is very tested, and you need to use a big data computing engine. The processing of big data can be divided into two categories according to the application scenarios:</p><ol><li><p>Batch processing, as the name suggests, is a method of uniformly processing batches of data. Batch processing is suitable for non-real-time processing of massive static data, and the latency is relatively high. It is also called offline computing. It is mainly used in scenarios such as offline reporting and historical data aggregation. For example, if we need to know the total riding time and distance of shared bicycles in a month, and the bicycle with the farthest riding distance, we need to aggregate the data of all bicycles to obtain the desired results. The calculation process of batch processing may take a long time, minutes, hours, or even days.</p></li><li><p>Stream processing is the real-time processing and calculation of data streams. Compared with batch processing, it has the characteristics of low latency, which can generally reach the level of milliseconds or even microseconds. This can meet the needs of massive data for high throughput processing capacity. It is mainly used for real-time monitoring, trend prediction, real-time recommendation, and other scenarios. For example, the real-time judgment of temperature and humidity data based on high and low thresholds requires stream processing.</p></li></ol><h6 id="The-classic-idea-of-batch-processing-MapReduce’s-divide-and-conquer"><a href="#The-classic-idea-of-batch-processing-MapReduce’s-divide-and-conquer" class="headerlink" title="The classic idea of batch processing: MapReduce’s divide and conquer"></a>The classic idea of batch processing: MapReduce’s divide and conquer</h6><p>First, Google (Google) published a <a href="https://users.soe.ucsc.edu/~sbrandt/221/Papers/DataManagement/dean-osdi04.pdf">paper</a> on a distributed computing framework in 2004 based on internal company practices. This paper proposes the design idea of the MapReduce computing framework, which is mainly used to solve the index generation problem of massive web pages. Next, the developers of the open-source search engine project Nutch developed an open-source  <a href="https://hadoop.apache.org/docs/r1.2.1/mapred_tutorial.html">Hadoop MapReduce</a> implementation based on this design idea.</p><p>Specifically, it is to divide the data into multiple copies of the same size, then create multiple tasks accordingly, and process these data fragments in parallel. This process is defined as the Map process; then, the calculation results generated in the Map process are generated. The final summary is performed to generate output results, and this process is defined as the Reduce process. The combination of these two processes is MapReduce.</p><h6 id="An-efficient-open-source-framework-for-batch-processing-Spark-aiming-to-be-“lightning-as-fast”"><a href="#An-efficient-open-source-framework-for-batch-processing-Spark-aiming-to-be-“lightning-as-fast”" class="headerlink" title="An efficient open-source framework for batch processing: Spark aiming to be “lightning as fast”"></a>An efficient open-source framework for batch processing: <a href="https://spark.apache.org/">Spark</a> aiming to be “lightning as fast”</h6><p>How does Spark create an efficient framework?</p><p>First of all, in terms of the computing model, Spark abandoned the two process models of MapReduce and adopted the <code>DAG</code> (Directed Acyclic Graph, directed acyclic graph) model. Using DAG to describe the data processing process should be said to reflect the essence of the data processing process. In this way, on the one hand, developers can describe complex computing logic more easily, and on the other hand, the computing framework can more easily automatically optimize the entire data flow, such as avoiding repeated calculations.</p><p>Second, Spark’s data access makes full use of memory.</p><p>Its data shards are called Partitions. Then it proposes the concept of <code>RDD</code> (Resilient Distributed Datasets) based on Partition. The so-called “elasticity” means that data can be stored on a disk or in memory, and the storage location can be dynamically adjusted according to memory usage. This improves computational efficiency.</p><h6 id="Stream-Processing-Open-Source-Frameworks-Storm-Spark-Streaming-and-Flink"><a href="#Stream-Processing-Open-Source-Frameworks-Storm-Spark-Streaming-and-Flink" class="headerlink" title="Stream Processing Open Source Frameworks: Storm, Spark Streaming, and Flink"></a>Stream Processing Open Source Frameworks: Storm, Spark Streaming, and Flink</h6><p>One of the earliest representatives is the <a href="https://storm.apache.org/">Storm</a> framework developed by the social networking company Twitter. An important concept of Storm is the data stream (Stream). Compared with the batch processing method for data blocks, the so-called stream processing is the processing method for data streams. Storm describes Stream as an infinite sequence of tuples. Stream is generated from a faucet (Spout), that is, the Spout converts the data to be processed into a Stream composed of Tuples. Then Stream is processed by the adapter (Bolt) to output a new Stream. Among them, the processing of Bolt can be any operation such as filtering, function operation, and Join. You can see the example flowchart below:</p><p><img src="storm-topology.png" alt="Storm Topology"></p><p>The Spout, Bolt, and Stream in the picture together constitute another important concept in Storm, Topology. You should be able to see that Topology is a DAG (Directed Acyclic Graph). What is running in the Storm framework is each topology, and because it is stream processing, it will continue to run until it is manually terminated.</p><p>The open-source framework for stream processing that basically appeared at the same time as Storm is  <a href="https://spark.apache.org/streaming/">Spark Streaming</a>. Spark Streaming converts data streams into small RDDs. These small pieces of RDD form a streamed sequence of RDDs, called a <strong>DStream</strong>, so its stream processing is called “micro-batching”.</p><p><img src="spark-stream.png" alt="Spark stream"></p><p>Obviously, its real-time performance depends on the size of each small RDD, and the real-time performance is not as good as the Storm framework; however, this method also makes its throughput capacity greater than Storm. Overall, you can think of Spark (including Spark Streaming) as a block-based data model that provides both batch and stream processing capabilities.</p><p><strong><a href="https://flink.apache.org/">Flink</a></strong> uses data blocks as a special data stream and provides batch processing capabilities by reading and processing data blocks from persistent storage systems such as files in a Stream (stream) manner. On this basis, Flink provides a unified batch and stream processing framework, which is the so-called “stream-batch integration” data processing framework.</p><p>Although Flink has not been around for a long time, with its excellent design, its performance is very strong, and its latency can be as low as microseconds. It is an ideal choice for scenarios with high real-time computing performance requirements. In the industry, Alibaba Cloud and Tencent Cloud support Flink very well; many companies are also gradually trying to use Flink to replace the Storm framework in practice.</p><p><img src="data-processing-framework.png" alt="Data Processing Framework"></p><h5 id="Step-5-Data-Application"><a href="#Step-5-Data-Application" class="headerlink" title="Step 5: Data Application"></a>Step 5: Data Application</h5><p>The data application is at the top of the whole system and is the ultimate goal of the IoT system. The core point of our focus is to create value through data, and the basis of realization is various algorithms.</p><h4 id="How-does-data-generate-value"><a href="#How-does-data-generate-value" class="headerlink" title="How does data generate value?"></a>How does data generate value?</h4><p>There are four ways to generate value from data:</p><ol><li><p>Visualization</p></li><li><p>Dig</p></li><li><p>Forecast</p></li><li><p>Control Decisions</p></li></ol><p>The most straightforward approach is visualization, also known as chart analysis. Visualizations can very intuitively show people what the data means. For example, if the geographical location of a shared bicycle is given to the user with latitude and longitude coordinates, it is tantamount to not giving this information; and if it is displayed in the form of a cursor on the map, the user can immediately know the position and distance of the bicycle relative to him. Similarly, there are curves and bar charts to represent data trends, pie charts to represent percentage data, and network diagrams to represent the relationship between things, etc. They all provide ideal presentation means for raw data and analysis result data.</p><p>A step further than chart analysis is mining analysis. We can analyze the laws and associations of data based on various algorithms. This method is based on various ready-made models or customized models, which can extract hidden laws and connections from the data that cannot be seen by manual analysis.</p><p>Another advanced approach is predictive analytics. As we accumulate more data and experience, we can use algorithms to build predictive models. When newly collected data is fed into the model, we can predict future conditions.</p><p>The last method is to control the decision. IoT devices may have actuators that IoT systems can control based on business goals. The control decision is calculated based on the collected data based on the algorithm.</p><h4 id="What-are-the-algorithms-that-can-be-used-for-data-analysis"><a href="#What-are-the-algorithms-that-can-be-used-for-data-analysis" class="headerlink" title="What are the algorithms that can be used for data analysis?"></a>What are the algorithms that can be used for data analysis?</h4><p>Mining analysis, predictive analysis, and control decision-making use various algorithms of statistical analysis, machine learning, including artificial intelligence. These algorithms fall into two categories: supervised learning and unsupervised learning.</p><ol><li><p>Supervised learning algorithms require us, like conscientious parents, to explicitly tell it “what is right” and “what is wrong”.</p></li><li><p>Unsupervised learning algorithms are faced with “shepherd” parents and need to distinguish the “outliers” in the data by themselves.</p></li></ol><p>Common supervised learning algorithms include decision trees and SVM (support vector machine) algorithms. Decision trees are similar to the expert systems I described above; the SVM algorithm is a classification algorithm that can also be used for linear and nonlinear regression problems, such as building user profiles based on riding habits.</p><p>Unsupervised learning algorithms include the <code>K-means algorithm</code> and so on. The K-means algorithm is a clustering algorithm. For example, based on the number of times and time periods of shared bicycles, we can distinguish between faulty and normal bicycles.</p><p>In short, a principle of using algorithms is that you must first analyze the characteristics of the data, grasp the general tendency, and then choose the appropriate algorithm according to the goals you want to achieve.</p><p><img src="IoT-data-technology-system.png" alt="IoT Data Technology System"></p>]]></content>
      
      
      <categories>
          
          <category> IOT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> data </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IoT Gateways: The Bridge Between Devices and Cloud Platforms</title>
      <link href="/2022/02/22/iot_gateways_the_bridge_between_devices_and_cloud_platforms/"/>
      <url>/2022/02/22/iot_gateways_the_bridge_between_devices_and_cloud_platforms/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="IoT-Gateways-The-Bridge-Between-Devices-and-Cloud-Platforms"><a href="#IoT-Gateways-The-Bridge-Between-Devices-and-Cloud-Platforms" class="headerlink" title="IoT Gateways: The Bridge Between Devices and Cloud Platforms"></a>IoT Gateways: The Bridge Between Devices and Cloud Platforms</h4><p>For example, a cold storage temperature and humidity monitoring system has been designed, which is based on <code>LoRa</code> communication technology. We know that the environment of cold storage is very complex.</p><p>Generally speaking, the cellular network signal inside the warehouse is very poor, and even often there is no network signal at all, for two reasons. First, in order to enhance the thermal insulation performance, the warehouse walls are made thicker than ordinary walls; the second is that the warehouses are usually located in the suburbs of the city, which are relatively remote.<br>In addition, due to various situations such as full warehouses and empty warehouses, the signal environment of the warehouse is changeable. Therefore, if the monitoring equipment deployed inside the cold storage is directly connected to the cellular network, reliable and stable communication cannot be achieved at all.<br>In this case, the solution you can choose is to deploy an IoT gateway that has a stable network signal, so that the monitoring equipment in the cold storage can use <code>LoRa</code>, a technology with strong penetration ability and a communication range of several kilometers in an open environment. Communicate with the gateway to indirectly realize the networking of devices.</p><p><img src="Cold-storage-IoT-gateway.png" alt="Cold storage IoT gateway"></p><p>The IoT gateway is becoming an indispensable role in the entire IoT system. It is becoming more and more important as a bridge between IoT devices and cloud platforms.</p><h4 id="Protocol-conversion-the-key-to-building-bridges"><a href="#Protocol-conversion-the-key-to-building-bridges" class="headerlink" title="Protocol conversion: the key to building bridges"></a>Protocol conversion: the key to building bridges</h4><p>When <code>BLE</code>, <code>ZigBee,</code> and <code>LoRa</code> devices communicate with the gateway, the gateway needs to parse out data based on open or internal private protocols; then the gateway uses the connection protocol with the cloud platform to organize data and complete data transmission.<br>This process naturally requires the gateway device to be able to support different communication technologies. A schematic diagram of the structure of a gateway communication interface is given below.</p><p><img src="Gateway-Protocol-Conversion.png" alt="Gateway Protocol Conversion"></p><p>The upper part is called the “northbound interface” and the lower part is called the “southbound interface”. This is a common saying in the industry.<br><strong>The northbound interface</strong> needs to be connected to the Internet, so the usual choices are <code>RJ45 Ethernet</code> port, optical fiber interface, <code>Wi-Fi</code> and <code>4G</code>, <code>NB-IoT,</code> and other cellular network modules.<br><strong>The southbound interface</strong> is used to connect IoT devices. In addition to the wireless technology interfaces such as <code>BLE</code>, <code>ZigBee</code>, <code>LoRa</code>, and <code>Wi-Fi</code> just mentioned, <code>RJ45 Ethernet</code>, <code>RS232</code>, <code>RS485,</code> and other wired interfaces are also commonly used on industrial personal computers (Industrial Personal Computer).</p><p>It should be noted here that the interface type and the number of each gateway device are not fixed, because gateway products generally determine several different specifications and models according to application scenarios. Different types of gateways need to support different types of protocols and the conversion of different numbers of protocols, so the protocol conversion function of the gateway generally adopts the software architecture of plug-ins.<br>The secondary development capability of the plug-in mechanism is very important. On the one hand, it allows us to dynamically and flexibly configure the protocol conversion function according to the interface; on the other hand, it can also facilitate us to develop the parsing function of private protocols.<br>For example, devices that communicate with gateways through <code>BLE</code>, <code>ZigBee,</code> or <code>LoRa</code> technology usually use private application layer protocols, which requires us to write parsing codes based on the private protocols defined during device architecture design.<br>As for IoT devices connected to the gateway using <code>RJ45</code> network port or <code>Wi-Fi</code>, in addition to using proprietary protocols based on <code>TCP</code> or <code>UDP</code>, standard protocols such as <code>MQTT</code> or <code>CoAP</code> may also be used. At this time, we need to deal with the format of these protocols.<br>In addition, standard protocols often used in industrial computers and PLCs (Programmable Logic Controllers) include <code>Modbus</code>, <code>ProfiBus</code>, <code>OPC UA</code>, and <code>BACnet</code>.</p><h4 id="Other-functions-of-the-gateway"><a href="#Other-functions-of-the-gateway" class="headerlink" title="Other functions of the gateway"></a>Other functions of the gateway</h4><p>After protocol conversion, the gateway obtains data in a common format. For these data, the gateway also needs to persist and temporarily store the data.<br>The storage function of the gateway can prevent the loss of device data due to temporary network failures and other reasons. In addition, the configuration information of the gateway and the device also needs to be stored in the gateway, so that the device can be quickly read during the operation.<br>At the same time, data security is also very important. The IoT gateway needs to do the following things:</p><ol><li>Perfect local authentication. In this way, the software or data of the gateway device can be prevented from being arbitrarily modified.</li><li>The gateway ensures encrypted transmission of data. Because many IoT devices have the very weak computing power and do not have the ability to encrypt data, gateways are needed to ensure the encryption and decryption of data or control commands.</li><li>The gateway can support operator private network access, or support VPN (Virtual Private Network, virtual private network) technology. The advantage of VPN technology is to establish an encrypted channel based on the Internet network. This not only ensures the safety and reliability of data transmission but also lowers the cost of establishing a dedicated line. Commonly used VPN protocols include IPsec, OpenVPN, etc.</li></ol><p>In addition to the protocol conversion, storage function, and security management mentioned above, IoT gateways generally have functional modules such as device management, gateway configuration, and over-the-air upgrades.</p><h4 id="Data-analysis-on-the-gateway"><a href="#Data-analysis-on-the-gateway" class="headerlink" title="Data analysis on the gateway"></a>Data analysis on the gateway</h4><p>The industry has begun to try to sink some computing services on the cloud platform to “edge devices” close to where the data occurs. This is the origin of edge computing, and the IoT gateway is the key to the most lightweight solution in edge computing.<br>Edge devices, such as IoT gateways, complete preliminary data processing and computing tasks that require timely response; while cloud platforms are responsible for data analysis that requires large-scale data and complex computing, as well as overall coordination and control.<br>Specifically, the cloud platform migrates some computing tasks of the original cloud computing model to network edge devices; network edge devices (such as routers, mobile network base stations, etc.) perform data processing and data analysis tasks near the data source. In this way, the computing load of the cloud computing center is reduced, the pressure of IOT on network bandwidth is reduced, and the efficiency of data processing is improved.<br>Benefits of the edge computing model:</p><ol><li><strong>Low latency</strong>. The data only needs to be transmitted from the generation device to the edge device, and does not need to go through other networks. Due to the short transmission distance, the network latency is low.</li><li><strong>Save the backbone network bandwidth</strong>. Alleviate network congestion caused by massive data transmission. Especially like the proprietary networks of some banks, their bandwidth is very limited and can only be used to transmit critical data.</li><li><strong>Computational availability is good</strong>. The path length of data in the network is significantly shortened, and the unavailability of computing services caused by network fluctuations will be reduced.</li><li><strong>Better privacy</strong>. Since the edge device is close to the user, the user’s private data no longer needs to be uploaded to the cloud platform. Therefore, in the edge computing scenario, the user’s privacy can also be better protected.</li></ol><h5 id="The-Impact-of-Edge-Computing-on-Gateways"><a href="#The-Impact-of-Edge-Computing-on-Gateways" class="headerlink" title="The Impact of Edge Computing on Gateways"></a>The Impact of Edge Computing on Gateways</h5><p>Changes in the technical architecture generally place new demands on the system. The impact of edge computing on gateways is mainly reflected in three aspects:</p><ol><li>First, in order to better run edge computing tasks in the gateway, the gateway needs to support virtualization technology, which is usually implemented by container technology in current practice. Containers are naturally lightweight and portable, making them ideal for developers to quickly test applications, and for maintainers to deploy and update applications on a large scale on the gateway. In addition, container technology is also more conducive to gateways using container automatic operation and maintenance platform technology, such as <code>Kubernetes</code>, to implement functions such as application orchestration.</li><li>Secondly, due to the uncertainty of the network environment, the gateway needs to have a certain autonomy. When the communication between the gateway and the cloud platform is interrupted, this situation should not affect the computing task of the gateway processing data, and the management of IoT devices.</li><li>Finally, because of the introduction of edge computing, we need to implement the task of data analysis and processing on the gateway side. The hardware resources of the gateway are very diverse, and the business requirements are also very different, so it becomes more important to provide a unified development framework on the gateway. A development framework can provide developers with a consistent API and interoperability of components. In this way, developers can implement business functions more efficiently, and it is easier to collaborate with other vendors.</li></ol><p>Gateway architecture diagram after adding edge computing capabilities:</p><p><img src="Gateway-Architecture.png" alt="Gateway Architecture"></p><h4 id="How-to-realize-edge-computing"><a href="#How-to-realize-edge-computing" class="headerlink" title="How to realize edge computing?"></a>How to realize edge computing?</h4><p>First, let’s talk about the Organization for Standardization. At present, there are three main standards organizations promoting edge computing, namely:</p><ol><li> <a href="https://www.lfedge.org/">LF Edge</a> (Linux Foundation Edge) under Linux Foundation and <a href="https://www.cncf.io/">CNCF</a> (Cloud Native Computing Foundation) dedicated to promoting Cloud Native</li><li><a href="https://iot.eclipse.org/">Eclipse IoT</a> project under Eclipse Foundation.</li><li><a href="https://www.openstack.org/">OpenStack Foundation</a></li></ol><p><strong>Container technology</strong>: There is mainly the <a href="https://kubeedge.io/zh/">KubeEdge</a>. Its main idea is to extend Kubernetes from the cloud to edge devices to facilitate the orchestration and scheduling of applications on edge gateways, and to realize collaborative data processing between cloud and edge devices.<br><strong>Development framework</strong>: The more well-known <a href="https://cn.edgexfoundry.org/">EdgeX Foundry</a> is positioned to provide a general edge computing framework for the Industrial Internet of Things. To this end, it adapts many protocols and provides standard API interfaces.<br>A project dedicated to the smart home space is <a href="https://www.lfedge.org/projects/homeedge/">Home Edge</a>, an open source project contributed by Samsung to accelerate edge deployment of smart home devices.</p><h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><p>With more and more IoT application scenarios, IoT gateways are becoming “edge centers”. It has become a very important part of the “cloud, edge, and terminal” architecture of the Internet of Things (ie, cloud platform, edge, and terminal). In the architecture design and functional development of the IoT gateway, the contents that need to be paid attention to are:</p><ol><li>The IoT gateway is the bridge between the device and the cloud platform. The gateway has various southbound and northbound interfaces. Therefore, the protocol conversion function is a function that must be included. It ensures the reliable upload of IoT device data and the effective execution of cloud platform control commands.</li><li>Pay attention to the realization of the basic functions of the gateway. These functions include functional modules such as storage function, security management, device management, gateway configuration, and over-the-air upgrade. They not only ensure the safe and reliable transmission of data but also provide support for remote maintenance.</li><li>The ability of the gateway to support edge computing needs to be determined according to the business scenario. Edge computing has three impacts on the architecture of IoT gateways: <ul><li><strong>Container technology</strong>. The application of container technology is helpful for developers to quickly develop and test applications, and it is also convenient for maintainers to deploy and update applications on the gateway on a large scale. At the same time, based on the container automatic operation and maintenance platform technology, functions such as application orchestration can be realized. </li><li><strong>Autonomous ability</strong>. It can ensure the normal execution of the data analysis and processing tasks of the gateway when the network environment is unstable. </li><li><strong>Development framework</strong>. The development framework is beneficial to the development work of developers and is also beneficial to the cooperation and interoperability of various components.</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> IOT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Gateway </tag>
            
            <tag> LoRa </tag>
            
            <tag> BLE </tag>
            
            <tag> ZigBee </tag>
            
            <tag> NB-IoT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IoT Communication Protocol</title>
      <link href="/2022/02/21/iot_communication_protocol/"/>
      <url>/2022/02/21/iot_communication_protocol/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Publish-Subscribe-Protocol"><a href="#Publish-Subscribe-Protocol" class="headerlink" title="Publish-Subscribe Protocol"></a>Publish-Subscribe Protocol</h3><h4 id="MQTT"><a href="#MQTT" class="headerlink" title="MQTT"></a>MQTT</h4><p>The MQTT (MQ Telemetry Transport) protocol is a lightweight network protocol developed by IBM in 1999. It adopts a publish-subscribe communication model. It has three main features:</p><ol><li>The binary message content encoding format is adopted, so the payload content such as binary data, JSON and pictures can be easily transmitted.</li><li>The protocol header is very compact, and the protocol interaction is also simple, which ensures that the network transmission traffic is small.</li><li>Supports 3 QoS (Quality of Service) levels, which is convenient for applications to choose flexibly according to different scenarios.</li></ol><p>What is QoS? It refers to the negotiation between the communicating parties about the reliability of message transmission.</p><p>QoS level 0, the message is only sent once, and the message may be lost;<br>QoS level 1, the sender will receive feedback to ensure the delivery of the message, but the message may be repeated.<br>QoS level 2, through multiple interactions between sender and receiver, it is guaranteed that there is one and only one message.<br>The MQTT protocol is very suitable for remote devices with limited computing power, low network bandwidth, and unstable signals, so it has become the de facto network protocol standard for IoT systems.</p><h4 id="AMQP"><a href="#AMQP" class="headerlink" title="AMQP"></a>AMQP</h4><p>In addition to the MQTT protocol, there are other network protocols that use a publish-subscribe model, such as the AMQP protocol. Although the AMQP protocol has a huge feature set and is relatively heavy, it is not suitable for IoT devices with limited computing resources and strict power consumption requirements, but it can meet the reliability and scalability requirements of the background system. Therefore, it is widely used in the platform system of IOT. For example, the RabbitMQ message middleware widely used in distributed systems is based on AMQP.<br>Like MQTT, AMQP is also based on the TCP protocol, uses a binary message format, and supports 3 QoS levels as well. The two versions, AMQP 1.0 and AMQP 0.9.1, which are widely used now, are very different in design. When you query data or apply the two versions of the AMQP protocol, you must pay attention to the version to avoid using the wrong one.</p><h3 id="Request-response-Pattern"><a href="#Request-response-Pattern" class="headerlink" title="Request-response Pattern"></a>Request-response Pattern</h3><p>Request-response Pattern<br>There are many benefits of the publish-subscribe model, but there are exceptions to everything, and there are some IoT use cases that are not suitable for this model. For example, there are smart express cabinets in the community now. After you enter the pickup code, the server will send an opening instruction to the corresponding cabinet door. In a publish-subscribe model, the server knows that the command was sent successfully, but it has no way of knowing if the cabinet door was opened or not. In the cases, you need to enable the cabinet door to feedback the execution result of the command to the server. Of course, you can also ask the server to subscribe to a “door closed” topic message, and then wait for the door to publish this message. But this is very cumbersome and not direct enough. In this scenario, another communication pattern comes in handy, and that is the request-response pattern.<br>The request-response pattern has two roles, one is the client (Client) and the other is the server (Server). A client is a party that requests data or services. The server is used to receive client requests and provide corresponding data or services. After the server receives the request, it will obtain the data, process the resource data (such as the database), prepare the response, and then return it to the client.<br>The request-response pattern is a stateless way of communication where each complete request-response is independent of each other. If further subdivided, it can also be divided into two types: synchronous and asynchronous. You can see this picture below.</p><p><img src="Request-response-Protocol.png" alt="Request-response Protocol"></p><h4 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h4><p>HTTP is a typical representative of the request-response pattern. The HTTP/2 protocol also introduces an asynchronous request-response mode, where the client can set different priorities for requests, and the server can decide which request to respond to first according to the priority. Although the message format of the HTTP protocol is very heavy, the message header alone can reach the size of KB, which is not suitable for embedded devices with limited resources. But on some IoT devices with sufficient computing resources and network resources, the HTTP protocol is still an option. Moreover, it is compatible with existing Web systems and can utilize existing Web server resources.</p><h4 id="CoAP"><a href="#CoAP" class="headerlink" title="CoAP"></a>CoAP</h4><p>CoAP (Constrained Application Protocol) protocol, like HTTP protocol, CoAP protocol also has GET, POST, PUT, DELETE and other methods and response status codes, and uses URI instead of Topic to identify resources as well. For example, we need to access the resource bedroom/temp under the server iotdemo.com. The complete resource address is:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">coap://iotdemo.com:5683/bedroom/temp <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>CoAP messages are in binary format and support two QoS levels of acknowledgment and unacknowledged messages. Confirmable message (Confirmable Message) is similar to QoS 1 of MQTT protocol, non-confirmable message (Non-confirmable Message) corresponds to QoS 0 level of MQTT protocol.<br>In addition, the transport layer protocol based on the CoAP protocol is UDP, not the TCP protocol of HTTP and MQTT protocols, so the computing resource requirements for the device are lower. Sensor devices generally only need to upload data and do not need to receive control commands from the server at any time, which shows that the CoAP protocol is suitable for battery-powered sensor devices.</p><h4 id="LwM2M"><a href="#LwM2M" class="headerlink" title="LwM2M"></a>LwM2M</h4><p>LwM2M (Lightweight M2M) protocol. The LwM2M protocol is defined on top of the CoAP protocol, but it goes further than message transmission. Because it standardizes the device model based on IPSO (IP-base Smart Object), it provides a set of lightweight device management and interaction interface protocols.<br>Currently, the main implementations of the LwM2M protocol are Wakaama in C language and Leshan in Java language, which are relatively few in application. The application scenarios of the CoAP protocol are also suitable for the LwM2M protocol. If you want to implement device management more conveniently based on the CoAP protocol, you can consider the LwM2M protocol.</p><h3 id="Coexistence-of-Communication-Modes"><a href="#Coexistence-of-Communication-Modes" class="headerlink" title="Coexistence of Communication Modes"></a>Coexistence of Communication Modes</h3><p>MQTT 5.0 adds new features of the request-response pattern; AMQP version 1.0 also defines the request-response pattern. As for the CoAP protocol, the new draft version (Draft) also adds a publish-subscribe model feature. The coexistence of communication modes in this network protocol greatly facilitates the application in specific scenarios compared to the design of a single mode, and represents the development direction of a network protocol.</p><h3 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h3><p>IoT applications are complex and comprehensive systems that require you to understand the features and limitations of different network protocols and make appropriate choices for different parts of the system. These selection principles, I summarize into the following three points:</p><ol><li>IoT devices usually need to run in an environment where the network is not very reliable, and there are also many limitations in terms of power consumption, volume, and computing resources, so we can consider using MQTT and CoAP protocols in the development of the device.</li><li>Fast and reliable message forwarding is required between the various services of the cloud platform. In this case, the AMQP protocol can be selected.</li><li>Some applications require a RESTful architecture compatible with the Web system, such as opening the resource capabilities in IOT through REST for other applications to call. In this case, HTTP and CoAP protocols are suitable choices.</li></ol><p><img src="Summary-of-Network-Protocols.png" alt="Summary of Network Protocols"></p>]]></content>
      
      
      <categories>
          
          <category> IOT，Protocol </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MQTT </tag>
            
            <tag> Protocol </tag>
            
            <tag> AMQP </tag>
            
            <tag> HTTP </tag>
            
            <tag> CoAP </tag>
            
            <tag> LwM2M </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Experience the MQTT protocol of IOT</title>
      <link href="/2022/02/18/experience_the_mqtt_protocol_of_iot/"/>
      <url>/2022/02/18/experience_the_mqtt_protocol_of_iot/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="MQTT-Introduction"><a href="#MQTT-Introduction" class="headerlink" title="MQTT Introduction"></a>MQTT Introduction</h4><p>The MQTT (MQ Telemetry Transport) protocol is a lightweight network protocol developed by IBM in 1999. It adopts a publish-subscribe communication model. It has three main features：</p><ol><li>The binary message content encoding format is adopted, so the payload content such as binary data, JSON and pictures can be easily transmitted</li><li>The protocol header is very compact, and the protocol interaction is also simple, which ensures that the network transmission traffic is small.</li><li>Supports 3 QoS (Quality of Service) levels, which is convenient for applications to choose flexibly according to different scenarios.</li></ol><p>The MQTT protocol is very suitable for remote devices with limited computing power, low network bandwidth, and unstable signals, so it has become the de facto network protocol standard for IoT systems.</p><h4 id="MQTT’s-own-“gene”-is-very-powerful"><a href="#MQTT’s-own-“gene”-is-very-powerful" class="headerlink" title="MQTT’s own “gene” is very powerful"></a>MQTT’s own “gene” is very powerful</h4><p>The ecological perfection of MQTT and the excellent design of the protocol itself make the MQTT protocol the “first language” of IoT devices.</p><h5 id="Publish-subscribe-model-that-fits-most-application-scenarios-of-IOT"><a href="#Publish-subscribe-model-that-fits-most-application-scenarios-of-IOT" class="headerlink" title="Publish-subscribe model that fits most application scenarios of IOT"></a>Publish-subscribe model that fits most application scenarios of IOT</h5><p>Using the publish-subscribe model, the MQTT protocol has many advantages, such as allowing a sensor data to trigger a series of actions; temporary offline caused by network instability will not affect work; it is convenient to dynamically adjust the system scale according to demand, etc. This makes it meet the needs of most IoT scenarios.</p><h5 id="Lightweight-features-that-meet-the-needs-of-resource-constrained-devices-in-IoT"><a href="#Lightweight-features-that-meet-the-needs-of-resource-constrained-devices-in-IoT" class="headerlink" title="Lightweight features that meet the needs of resource-constrained devices in IoT"></a>Lightweight features that meet the needs of resource-constrained devices in IoT</h5><p>MQTT is a lightweight network protocol, which is also an important reason for its popularity in IoT systems. After all, a large number of IoT devices are devices with limited computing resources and low network bandwidth. This “lightweight” manifests itself in two ways.</p><p>On the one hand, MQTT messages are encoded in a binary format, rather than a textual representation like the HTTP protocol. In this text transmitted by the HTTP protocol, each character occupies 1 byte. And if you use the MQTT protocol, one byte can represent a lot of content. The image below shows the format of the MQTT fixed header, which is only 2 bytes long:</p><p><img src="https://s2.loli.net/2022/02/18/sAh6zWTlj2ctdi1.png" alt="MQTT Protocol Format"></p><p>The first byte is divided into high 4 bits (4 to 7) and low 4 bits (0 to 3); the low 4 bits are the data packet identification bits, each of which can represent different meanings; the high 4 bits are the identification bits for different packet types. The second byte indicates the total number of bytes in the packet header and the message body, and the highest bit indicates whether there is a third byte, and together with the second byte indicates the total number of bytes. If there is a third byte, then its highest bit indicates whether there is a fourth byte, together with the second byte and the third byte to indicate the total number of bytes. By analogy, there may also be a fourth byte and a fifth byte, but this part representing the number of bytes of the variable header and message body can only reach the <strong>five byte</strong> at most, so it can be the maximum packet length represented is 256MB.</p><p>For example, a CONNECT type packet requesting a connection establishment requires 14 bytes in the header; the PUBLISH type packet header of a message is only 2 to 4 bytes long.</p><p>On the other hand, the specific interaction process design reflected in the message is very simple, so there are very few types of interactive messages in MQTT.</p><p><img src="https://s2.loli.net/2022/02/18/NnstaDGAg1LYMxu.png" alt="MQTT Message Type"></p><p>As can be seen from the table, MQTT 3.1.1 defines a total of 14 types of data packets, which correspond to values from 1 to 14 in the upper 4 bits of the first byte.</p><h5 id="Always-pay-attention-to-the-optimized-design-of-IoT-devices-with-low-power-consumption-requirements"><a href="#Always-pay-attention-to-the-optimized-design-of-IoT-devices-with-low-power-consumption-requirements" class="headerlink" title="Always pay attention to the optimized design of IoT devices with low power consumption requirements"></a>Always pay attention to the optimized design of IoT devices with low power consumption requirements</h5><p>In addition to making the protocol lightweight enough, the MQTT protocol also pays great attention to the optimized design of low power consumption, which is mainly reflected in the optimization of energy consumption and communication times.</p><p>For example, the MQTT protocol has a Keepalive mechanism. Its function is to allow both parties to discover in time when the connection between the Client and the Broker is interrupted, and to re-establish the MQTT connection to ensure reliable transmission of topic messages. The working principle of this mechanism is that both the Client and the Broker judge whether a message is transmitted between the two parties within a period of time based on the length of time determined by the Keepalive. This Keepalive time length is set when the Client establishes the connection. If the time exceeds this time length and the two parties do not receive new data packets, it is determined that the connection is disconnected.</p><p>Although Keepalive requires that data packets must be transmitted for a period of time, the actual situation is that it is impossible for Client and Broker to transmit topic messages all the time. What should we do?</p><p>The solution for the MQTT protocol is that two message types, PINGREQ and PINGRESP, are defined. None of them have variable headers and message bodies, which means they are only 2 bytes in size. Client and Broker can meet the requirements of the Keepalive mechanism by sending PINGREQ and PINGRESP messages respectively. I guess you have also figured out that it would be a waste of power and network resources to keep sending messages like this “dumbly” on a regular basis. Therefore, if there is data transmission between the Client and the Broker within the Keepalive time period, the Keepalive mechanism will also count it, so there is no need to judge by sending PINGREQ and PINGRESP messages.</p><p>In addition to the Keepalive mechanism, the repeated topic feature in MQTT 5.0 can also help us save network resources. When a client sends a message on a topic repeatedly, it can set the topic name length to 0 from the second time, so that the broker will automatically process the message according to the last topic. This situation is very common for sensor devices, so this feature is very practical in the work.</p><h5 id="Multiple-service-quality-levels-for-the-ever-changing-network-environment-in-IOT"><a href="#Multiple-service-quality-levels-for-the-ever-changing-network-environment-in-IOT" class="headerlink" title="Multiple service quality levels for the ever-changing network environment in IOT"></a>Multiple service quality levels for the ever-changing network environment in IOT</h5><p>The MQTT protocol is designed with 3 different QoS (Quality of Service) levels. You can choose flexibly according to the scenario to ensure reliable communication in different environments.</p><p>What is QoS? It refers to the negotiation between the communicating parties about the reliability of message transmission.</p><p><strong>QoS level 0</strong>, the message is only sent once, and the message may be lost;</p><p><strong>QoS 1 level</strong>, the sender will receive feedback to ensure the delivery of the message, but the message may be repeated；</p><p><strong>QoS level 2</strong>, through multiple interactions between sender and receiver, it is guaranteed that there is one and only one message.</p><p><img src="MQTT_QoS.png" alt="MQTT QoS"></p><p>It can be seen that the process of QoS 0 and QoS 1 is relatively simple; while QoS 2 has a relatively complicated process in order to ensure one and only one reliable transmission. Normally, QoS 2 has 4 interactions of PUBLISH, PUBREC, PUBREL and PUBCOMP. As for the “abnormal situation”, the sender needs to send the message repeatedly. For example, if the PUBREC message is not received for a period of time, the PUBLISH message needs to be sent again. Note, however, that the “duplicate” flag in the message should be set to 1 at this time, so that the receiver can handle it correctly. Likewise, if the PUBCOMP message is not received, the sender needs to send the PUBREL message again.</p><h5 id="Supports-data-security-that-is-increasingly-valued-in-IoT-applications"><a href="#Supports-data-security-that-is-increasingly-valued-in-IoT-applications" class="headerlink" title="Supports data security that is increasingly valued in IoT applications"></a>Supports data security that is increasingly valued in IoT applications</h5><p>Speaking of secure transmission, first we need to verify whether the Client has permission to access the MQTT Broker. In order to control the client’s access, MQTT provides a username/password mechanism. In the process of establishing a connection, it can filter valid connection requests by judging the correctness of the user name and password. However, this mechanism alone cannot guarantee data security during network communication. Because in the way of clear text transmission, not only device data, but even user names and passwords may be intercepted from the network by others and leaked, so others can disguise as legitimate devices to send data. Therefore, we also need the support of communication encryption technology. The MQTT protocol supports SSL/TLS encrypted communication. With SSL/TLS encryption, MQTT is converted to MQTTS. This is somewhat similar to the relationship between HTTP and HTTPS.</p><h4 id="Experience-MQTT"><a href="#Experience-MQTT" class="headerlink" title="Experience MQTT"></a>Experience MQTT</h4><h5 id="Simple-experience-of-MQTT-with-hbmqt"><a href="#Simple-experience-of-MQTT-with-hbmqt" class="headerlink" title="Simple experience of MQTT with hbmqt"></a>Simple experience of MQTT with hbmqt</h5><p>The first step is to install hbmqtt, which is an open source Python-based MQTT Broker software, just including some tools we need to use. Compared to other options, this software is very easy to install because it is available in Python’s PYPI repositories, so you can install it with the <code>pip</code> command. This is also the main reason for choosing to use it. However, it should be noted that <code>hbmqtt</code> is implemented based on Python3, so the pip3 tool is used here.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip3 <span class="token function">install</span> hbmqtt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>After the installation is complete, we can use the two command line tools <code>hbmqtt_sub</code> and <code>hbmqtt_pub</code> provided in <code>hbmqtt</code>. By the name, you should also be able to see that hbmqtt_sub can act as a subscriber; hbmqtt_pub can act as a publisher of messages.</p><p>As for the broker between subscribers and publishers, that is, MQTT Broker, we use <a href="https://test.mosquitto.org/">Eclipse’s free and open online Broker service</a>. Open the link, you can see the introduction information about the port, both encrypted and non-encrypted methods are supported, and there is also a Websocket-based implementation, which is very beneficial for front-end web-based applications.</p><p>We first use the unencrypted method of port <code>1883</code>, and then determine a topic (Topic) for message transmission. The topic determines the category of the message and is used for message filtering. For example, the message we want to test later can be set to <code>/mqtt/test</code>.</p><p>Next, we can subscribe to this topic message by entering the following command in the terminal interface of the computer:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hbmqtt_sub --url mqtt://test.mosquitto.org:1883 -t /mqtt/test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Now, we start another terminal interface and publish a message on the topic <code>/mqtt/test</code> through hbmqtt_pub:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hbmqtt_pub --url mqtt://test.mosquitto.org:1883 -t /mqtt/test -m Hello,World<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="Build-your-own-MQTT-Broker-for-in-depth-experience"><a href="#Build-your-own-MQTT-Broker-for-in-depth-experience" class="headerlink" title="Build your own MQTT Broker for in-depth experience"></a>Build your own MQTT Broker for in-depth experience</h5><p><strong>Using <a href="https://docs.vernemq.com/">VerneMQ</a> as MQTT Broker</strong></p><p>The first step is to install VerneMQ using docker.</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run -p <span class="token number">1883</span>:1883 -e <span class="token string">"DOCKER_VERNEMQ_ACCEPT_EULA=yes"</span> -e <span class="token string">"DOCKER_VERNEMQ_ALLOW_ANONYMOUS=on"</span> --name vernemqtt -d vernemq/vernemq<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>The second step is to use <code>VSCode</code> to connect VerneMQ and install the <code>VsMqtt</code> plugin.</p><p><img src="https://s2.loli.net/2021/12/10/MbhGoytjguXYNLq.png" alt="Using VSCode to connect VerneMQ"></p><p>The client code of MQTT has been implemented, and now we can use <a href="(http://www.eclipse.org/paho/index.php?page=downloads.php)">the Eclipse Paho project</a>.</p>]]></content>
      
      
      <categories>
          
          <category> IOT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MQTT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Deep Dive into use Node js third-party Packages</title>
      <link href="/2022/02/07/a_deep_dive_into_use_node_js_third_party_packages/"/>
      <url>/2022/02/07/a_deep_dive_into_use_node_js_third_party_packages/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="What-is-a-Package"><a href="#What-is-a-Package" class="headerlink" title="What is a Package?"></a>What is a Package?</h3><p>A package in Node.js contains all the files you need for a module.</p><p>Modules are JavaScript libraries you can include in your project.</p><h3 id="Download-a-Package"><a href="#Download-a-Package" class="headerlink" title="Download a Package"></a>Download a Package</h3><p>Downloading a package is very easy.</p><p>Open the command line interface and tell NPM to download the package you want.</p><p>I want to download a package called <a href="https://www.npmjs.com/package/follow-redirects">follow-redirects</a>:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i follow-redirects<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Test-the-Package-On-Runkit"><a href="#Test-the-Package-On-Runkit" class="headerlink" title="Test the Package On Runkit"></a>Test the Package On <a href="https://npm.runkit.com/">Runkit</a></h3><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> followRedirects <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"follow-redirects"</span><span class="token punctuation">)</span><span class="token keyword">const</span> <span class="token punctuation">{</span> http<span class="token punctuation">,</span> https <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'follow-redirects'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> http<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://bit.ly/900913'</span><span class="token punctuation">,</span> <span class="token parameter">response</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  response<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token parameter">chunk</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>RunKit notebooks completely remove the friction of trying new ideas. With one click you’ll have a sandboxed</p><p>JavaScript environment where you can instantly switch node versions, use every npm module without having to wait to install it, and even visualize your results. No more configuration, just straight to coding.</p><h3 id="Something-Else-Important-Maybe-You-need"><a href="#Something-Else-Important-Maybe-You-need" class="headerlink" title="Something Else Important Maybe You need"></a>Something Else Important Maybe You need</h3><h4 id="Find-and-automatically-fix-open-source-vulnerabilities"><a href="#Find-and-automatically-fix-open-source-vulnerabilities" class="headerlink" title="Find and automatically fix open source vulnerabilities"></a>Find and automatically fix open source vulnerabilities</h4><p>Use the Snyk Online tools you can get the Package Health Score.</p><p>Let get the follow-redirects’s Health Score:</p><p><img src="https://s2.loli.net/2022/02/07/BTkonPMtacC4LRQ.png" alt="Follow-redirects's vulnerabilities"></p><p>You can get more detail info about package follow-redirects’s vulnerabilities on the <a href="https://snyk.io/advisor/npm-package/follow-redirects">Snyk page</a>.</p><h4 id="Modify-the-third-party-package’s-Code-and-use-it-directly"><a href="#Modify-the-third-party-package’s-Code-and-use-it-directly" class="headerlink" title="Modify the third-party package’s Code and use it directly"></a>Modify the third-party package’s Code and use it directly</h4><ol><li>Fork the code to you github</li><li>Change the code and push it to you github</li><li>Use this commond <code>npm install [your github name]/[package name]</code> in your project</li></ol><p>For example, My GitHub is <a href="https://github.com/earthandy">earthandy</a> and I want to use <a href="https://github.com/earthandy/hexo-generator-amp">hexo-generator-amp</a> which I forked from <a href="https://github.com/tea3">tea3</a>, just use:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> earthandy/hexo-generator-amp --save<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Node.js </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NPM </tag>
            
            <tag> Node.js </tag>
            
            <tag> RunKit </tag>
            
            <tag> Snyk </tag>
            
            <tag> github </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter Challenge the Twitter App</title>
      <link href="/2022/01/29/flutter_challenge_the_twitter_app/"/>
      <url>/2022/01/29/flutter_challenge_the_twitter_app/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Flutter Challenges will attempt to recreate a particular app UI or design in Flutter.</p><p>This challenge will attempt the home screen of the Twitter Android app. Note that the focus will be on the UI rather than actually fetching data from a backend server.</p><h3 id="Understanding-the-app-structure"><a href="#Understanding-the-app-structure" class="headerlink" title="Understanding the app structure"></a>Understanding the app structure</h3><p><img src="https://s2.loli.net/2022/01/29/xJ36F7ZfvRMwAyN.jpg" alt="app structure"></p><p>The Twitter app has 4 main pages controlled by a Bottom Navigation Bar.</p><p>They are:</p><ol><li>Home(Displays tweets in your feed)</li><li>Search(Search people,organisations,etc)</li><li>Notifications(Notifications and mentions)</li><li>Messages(Private messages)</li></ol><p>The BottomNavigationBar has for tabs to go to each of these pages.</p><p>In our app,we’ll have four different pages and we’ll just change the pages when an item on the BottomNavigationBar is tapped.</p><h3 id="Setting-up-the-project"><a href="#Setting-up-the-project" class="headerlink" title="Setting up the project"></a>Setting up the project</h3><p>After creating a Flutter project(I’ve named it twitter_ui),clear out the default code in the project until you’re left with this:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge Twitter'</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The HomePage will have a Scaffold that will hold our main BottomNavigationBar and whatever page is currently active.</p><h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><p>Because the Bottom Navigation Bar is main widget used to navigate,let’s try that first.</p><p>Here’s how the BottomNavigationBar looks like:</p><p><img src="https://s2.loli.net/2022/01/29/2DhUmRibuzsJdQP.jpg" alt="twitter_bottom_navigation">Because we don’t have the exact icons used in the app,we’ll go with the <a href="https://pub.dartlang.org/packages/font_awesome_flutter">Font Flutter Awesome Package.</a>Add the dependency in the pubspec.yaml and add</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:font_awesome_flutter/font_awesome_flutter.dart'</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>to the main.dart.</p><p>The BottomNavigationBar code comes down to:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">bottomNavigationBar<span class="token punctuation">:</span> <span class="token function">BottomNavigationBar</span><span class="token punctuation">(</span>        items<span class="token punctuation">:</span> <span class="token punctuation">[</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>FontAwesomeIcons<span class="token punctuation">.</span>home<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>FontAwesomeIcons<span class="token punctuation">.</span>search<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>FontAwesomeIcons<span class="token punctuation">.</span>bell<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>FontAwesomeIcons<span class="token punctuation">.</span>envelope<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            selectedPageIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        currentIndex<span class="token punctuation">:</span> selectedPageIndex<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Add this to the HomePage.</p><p>Notice when we set the color of the icons,we check if the icon is selected and then assign colors.In the twitter app,selected icon is blue and let’s set unselected ones to blueGrey.</p><p>We define a integer called selectedPageIndex which stores the index of the page selected. In the onTop function,we set the variable to the new index. It is wrapped in a setState() call as we need a refresh of the page to re-render the AppBar.</p><p>Here is our Bottom Navigation Bar:</p><p><img src="https://s2.loli.net/2022/01/29/eXKnm96vGH3c8fS.png" alt="twitter_appbar"></p><h3 id="Setting-Up-The-Pages"><a href="#Setting-Up-The-Pages" class="headerlink" title="Setting Up The Pages"></a>Setting Up The Pages</h3><p>Let’s set up the four basic pages which will be displayed when the respective icons are clicked.</p><p>We set up four pages (in different files) like this:</p><p>For the user feed(home) page:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">UserFeedPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _UserFeedPageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_UserFeedPageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_UserFeedPageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>UserFeedPage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Similarly we set up the Search,Notification and Messages Page.</p><p>Again in the base page,we import all these pages and set up a list of these pages.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">var</span> pages <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">UserFeedPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">SearchPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">NotificationPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">MessagesPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>And in the Scaffold,we set</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">body<span class="token punctuation">:</span>pages<span class="token punctuation">[</span>selectPageIndex<span class="token punctuation">]</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>which sets the body to display the page.</p><p>So till now,this is the MyHomePage base widget:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:font_awesome_flutter/font_awesome_flutter.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:twitter_ui/messages_page.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:twitter_ui/notification_page.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:twitter_ui/search_page.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:twitter_ui/user_feed_page.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge Twitter'</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> selectedPageIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> pages <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">UserFeedPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">SearchPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">NotificationPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">MessagesPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> pages<span class="token punctuation">[</span>selectedPageIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>      bottomNavigationBar<span class="token punctuation">:</span> <span class="token function">BottomNavigationBar</span><span class="token punctuation">(</span>        items<span class="token punctuation">:</span> <span class="token punctuation">[</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>              title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>home<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>              title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>search<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>              title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>bell<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>              title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>envelope<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        currentIndex<span class="token punctuation">:</span> selectedPageIndex<span class="token punctuation">,</span>        onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            selectedPageIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Now,we’ll recreate the pages themselves.</p><h3 id="Creating-the-User-Feed-Page"><a href="#Creating-the-User-Feed-Page" class="headerlink" title="Creating the User Feed Page"></a>Creating the User Feed Page</h3><p><img src="https://s2.loli.net/2022/01/29/cBPEJlmnF5RDqp3.jpg" alt="User Feed Page"></p><p>There are two elements in the page:The AppBar and the list of tweets.</p><p>First let’s make the AppBar,It has a user profile picture and a black title with a white background.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>          <span class="token string">'Home'</span><span class="token punctuation">,</span>          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        leading<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">35.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>We’ll use an icon instead of a profile picture.</p><p>Now,we need to create the list of tweets.For this we use a ListView.builder().</p><p>Let’s take a look at the list item.</p><p><img src="https://s2.loli.net/2022/01/29/paZkK4fCVImis9v.jpg" alt="check_list_view_item"></p><p>First,we’ll have a column with a row and a divider you see at the bottom.</p><p>Inside the row,we’ll have the user icon and another column.</p><p>The column will hold a row for tweet information,a text with the tweet itself,an image and another row for actions to take on tweet(like,comment,etc.).</p><p>For brevity,we’ll exclude the image for now,but adding it is as simple as adding an image in a row.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:font_awesome_flutter/font_awesome_flutter.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">UserFeedPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _UserFeedPageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_UserFeedPageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_UserFeedPageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>UserFeedPage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>          <span class="token string">'Home'</span><span class="token punctuation">,</span>          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        leading<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">35.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>        itemCount<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>        itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>          TweetItemModel tweet <span class="token operator">=</span> TweetHelper<span class="token punctuation">.</span><span class="token function">getTweet</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>              <span class="token function">Padding</span><span class="token punctuation">(</span>                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                  crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                  children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                        Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span>                        size<span class="token punctuation">:</span> <span class="token number">60.0</span><span class="token punctuation">,</span>                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Expanded</span><span class="token punctuation">(</span>                      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                        mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                              mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                                <span class="token function">Expanded</span><span class="token punctuation">(</span>                                  child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                                    child<span class="token punctuation">:</span> <span class="token function">RichText</span><span class="token punctuation">(</span>                                      text<span class="token punctuation">:</span> <span class="token function">TextSpan</span><span class="token punctuation">(</span>children<span class="token punctuation">:</span> <span class="token punctuation">[</span>                                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>                                            text<span class="token punctuation">:</span> tweet<span class="token punctuation">.</span>username<span class="token punctuation">,</span>                                            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                                fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w600<span class="token punctuation">,</span>                                                fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">,</span>                                                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>                                            text<span class="token punctuation">:</span> <span class="token string">' '</span> <span class="token operator">+</span> tweet<span class="token punctuation">.</span>twitterHandle<span class="token punctuation">,</span>                                            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                                fontSize<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">,</span>                                                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                        <span class="token function">TextSpan</span><span class="token punctuation">(</span>                                            text<span class="token punctuation">:</span> <span class="token string">'${tweet.time}'</span><span class="token punctuation">,</span>                                            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                                fontSize<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">,</span>                                                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                      overflow<span class="token punctuation">:</span> TextOverflow<span class="token punctuation">.</span>ellipsis<span class="token punctuation">,</span>                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                                  flex<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token function">Expanded</span><span class="token punctuation">(</span>                                  flex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>                                  child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                    child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>expand_more<span class="token punctuation">,</span>                                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span>                              <span class="token punctuation">]</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>tweet<span class="token punctuation">.</span>tweet<span class="token punctuation">,</span>                                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                              mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>                              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                                <span class="token function">Icon</span><span class="token punctuation">(</span>FontAwesomeIcons<span class="token punctuation">.</span>comment<span class="token punctuation">,</span>                                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token function">Icon</span><span class="token punctuation">(</span>FontAwesomeIcons<span class="token punctuation">.</span>retweet<span class="token punctuation">,</span>                                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token function">Icon</span><span class="token punctuation">(</span>FontAwesomeIcons<span class="token punctuation">.</span>heart<span class="token punctuation">,</span>                                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token function">Icon</span><span class="token punctuation">(</span>FontAwesomeIcons<span class="token punctuation">.</span>shareAlt<span class="token punctuation">,</span>                                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">)</span><span class="token punctuation">,</span>                              <span class="token punctuation">]</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span>                  <span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>FontAwesomeIcons<span class="token punctuation">.</span>featherAlt<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">TweetItemModel</span> <span class="token punctuation">{</span>  String tweet<span class="token punctuation">;</span>  String username<span class="token punctuation">;</span>  String time<span class="token punctuation">;</span>  String twitterHandle<span class="token punctuation">;</span>  <span class="token function">TweetItemModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>tweet<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>username<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>twitterHandle<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">TweetHelper</span> <span class="token punctuation">{</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> tweets <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">TweetItemModel</span><span class="token punctuation">(</span>        <span class="token string">"Inviting computer science students to register for the latest event in computer technology."</span><span class="token punctuation">,</span>        <span class="token string">"Google Devs"</span><span class="token punctuation">,</span>        <span class="token string">"3m"</span><span class="token punctuation">,</span>        <span class="token string">"@GoogleDevsIndia"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">TweetItemModel</span><span class="token punctuation">(</span>        <span class="token string">"Developing a large, complex app that needs a microservice architecture? @crichardson. Read on to learn how to  decompose an application into services "</span><span class="token punctuation">,</span>        <span class="token string">"Java"</span><span class="token punctuation">,</span>        <span class="token string">"5m"</span><span class="token punctuation">,</span>        <span class="token string">"@java"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">TweetItemModel</span><span class="token punctuation">(</span>        <span class="token string">"The Samsung Galaxy S9 is in the record books now, but it's not likely that Samsung will be celebrating this particular milestone. https://www.androidauthority.com/samsung-galaxy-s9-history-887809/ … #samsung #samsunggalaxys9 by: C. Scott Brown"</span><span class="token punctuation">,</span>        <span class="token string">"Android Authority"</span><span class="token punctuation">,</span>        <span class="token string">"30m"</span><span class="token punctuation">,</span>        <span class="token string">"@AndroidAuth"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">TweetItemModel</span><span class="token punctuation">(</span>        <span class="token string">"Inviting computer science students to register for the latest event in computer technology."</span><span class="token punctuation">,</span>        <span class="token string">"Google Devs India"</span><span class="token punctuation">,</span>        <span class="token string">"3m"</span><span class="token punctuation">,</span>        <span class="token string">"@GoogleDevsIndia"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> TweetItemModel <span class="token function">getTweet</span><span class="token punctuation">(</span>int position<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> tweets<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s2.loli.net/2022/01/29/smJuvCbcL4ESNPM.png" alt="list"></p><p>This is the recreated page for the Twitter user feed. The fact that recreating andy UI is fast and easy in Flutter is a testament to its development speed and customisability at the same time.These are two things that rarely go together.</p><p>The main.dart code is follow:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:font_awesome_flutter/font_awesome_flutter.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:twitter_ui/messages_page.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:twitter_ui/notification_page.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:twitter_ui/search_page.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:twitter_ui/user_feed_page.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge Twitter'</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> selectedPageIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> pages <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">UserFeedPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">SearchPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">NotificationPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">MessagesPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      body<span class="token punctuation">:</span> pages<span class="token punctuation">[</span>selectedPageIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>      bottomNavigationBar<span class="token punctuation">:</span> <span class="token function">BottomNavigationBar</span><span class="token punctuation">(</span>        items<span class="token punctuation">:</span> <span class="token punctuation">[</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>              title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>home<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>              title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>search<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>              title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>bell<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>              title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>envelope<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> selectedPageIndex <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blueGrey<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        currentIndex<span class="token punctuation">:</span> selectedPageIndex<span class="token punctuation">,</span>        onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            selectedPageIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Twitter </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter Challenge The Whatsapp App</title>
      <link href="/2022/01/29/flutter_challenge_the_whatsapp_app/"/>
      <url>/2022/01/29/flutter_challenge_the_whatsapp_app/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://s2.loli.net/2022/01/29/gXrMsFU5ELHwamO.jpg" alt="whatsapp"></p><p>Flutter Challenges will attempt to recreate a particular app UI or design in Flutter.</p><p>This challengs will attempt the home screen of the Whatsapp Android app.<br>Note that the focus will be on the UI rather than actually fetching messages.</p><h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><p>The WhatsApp home screen consists of</p><ol><li>An AppBar with a search action and an menu</li><li>Four tabs in the bottom of the AppBar</li><li>A camera tab to take a photo</li><li>A FloatingActionButton for multiple purposes</li><li>A “Chats” tab to view all conversations</li><li>A “Status” tab to view all statuses</li><li>A “Calls” tab to view all past calls</li></ol><h3 id="Setting-up-the-Project"><a href="#Setting-up-the-Project" class="headerlink" title="Setting up the Project"></a>Setting up the Project</h3><p>Let’s make a Flutter project named whatsapp_ui and remove all the default code leaving just a blank screen with the default app bar.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge WhatsApp'</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'WhatsApp'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>            mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="The-AppBar"><a href="#The-AppBar" class="headerlink" title="The AppBar"></a>The AppBar</h3><p>The AppBar has the title of the app,and the two actions:Search and a menu.</p><p>Adding that to the AppBar,</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">AppBar <span class="token function">buildAppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>        <span class="token string">'WhatsApp'</span><span class="token punctuation">,</span>        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">,</span> fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w600<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      actions<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>        <span class="token function">Padding</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Padding</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>more_vert<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>      backgroundColor<span class="token punctuation">:</span> whatsAppGreen<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This is the result of the code:</p><p><img src="https://s2.loli.net/2022/01/29/orcmUBxXzMRiN42.png" alt="whatsapp_appbar"></p><p>Now moving on to</p><h3 id="The-Tabs"><a href="#The-Tabs" class="headerlink" title="The Tabs"></a>The Tabs</h3><p>The tabs are a simple extension to the AppBar and Flutter makes it extremely easy to implement them.</p><p>The AppBar has a “bottom” field which holds our tabs:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">bottom<span class="token punctuation">:</span> <span class="token function">TabBar</span><span class="token punctuation">(</span>        tabs<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>camera_alt<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'CHATS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'STATUS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'CALLS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        indicatorColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Also,we need a TabController for this to work.</p><p>Create a new TabController.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">TabController tabController<span class="token punctuation">;</span> <span class="token metadata symbol">@override</span> <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   tabController <span class="token operator">=</span> <span class="token function">TabController</span><span class="token punctuation">(</span>vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Now add that controller to the “controller” field of both the TabBar.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">bottom<span class="token punctuation">:</span> <span class="token function">TabBar</span><span class="token punctuation">(</span>        tabs<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>camera_alt<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'CHATS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'STATUS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'CALLS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        indicatorColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>        controller<span class="token punctuation">:</span> tabController<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>And for the TabBarView</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">body<span class="token punctuation">:</span> <span class="token function">TabBarView</span><span class="token punctuation">(</span>          controller<span class="token punctuation">:</span> tabController<span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>camera_alt<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Chat Screen'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Status Screen'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Center</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Call Screen'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s2.loli.net/2022/01/29/Apd1TzuUV9fqCIG.png" alt="whatsapp_home"></p><p>Now before going to the individual pages,we’ll add the pages that the tabs represent. Switch the existing “body” code of the Scaffold with above code.</p><p>The children represent the pages that the tabs are an entire page is a Text widget for now.</p><h3 id="Floating-Action-Button"><a href="#Floating-Action-Button" class="headerlink" title="Floating Action Button"></a>Floating Action Button</h3><p>The Floating Action Button changes depending on which page is on screen.</p><p>First add a Floating Action Button in the Scaffold.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span> fabIcon<span class="token punctuation">,</span>        backgroundColor<span class="token punctuation">:</span> whatsAppGreenLight<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The “fabIcon” field simply stores which icon to display because we need to change which icon is displayed according to the screen displayed.</p><p>To listen to tab selected changes,attach a listener to the TabController.<br>When tab controller realises the page has changed,change the FAB icon.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">tabController <span class="token operator">=</span> <span class="token function">TabController</span><span class="token punctuation">(</span>vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">switch</span> <span class="token punctuation">(</span>tabController<span class="token punctuation">.</span>index<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">:</span>              <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">1</span><span class="token punctuation">:</span>              fabIcon <span class="token operator">=</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">2</span><span class="token punctuation">:</span>              fabIcon <span class="token operator">=</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>camera_enhance<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token keyword">case</span> <span class="token number">3</span><span class="token punctuation">:</span>              fabIcon <span class="token operator">=</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>call<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">break</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s2.loli.net/2022/01/29/eywHKPz38fbdMDQ.png" alt="whatsapp_tab_change">Moving on,</p><h3 id="The-Chat-Screen"><a href="#The-Chat-Screen" class="headerlink" title="The Chat Screen"></a>The Chat Screen</h3><p>The Chat Screen has a list of messages we need to display.To make a list of messages,we use a ListView.builder() and construct our items.</p><p>Let’s take a look at the list item for the chat screen.</p><p><img src="https://s2.loli.net/2022/01/29/yJLAVmEPtw3poX5.png" alt="whatsapp_list_chat"></p><p>The outer most widget is a row of one icon and another row.</p><p>Inside the second row is a column consisting of one row and one text widget.</p><p>The row has the title and message date.</p><p>Let’s construct a Chat Item Model as a class for storing the details of the list item.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">ChatItemModel</span> <span class="token punctuation">{</span>  String name<span class="token punctuation">;</span>  String mostRecentMessage<span class="token punctuation">;</span>  String messageDate<span class="token punctuation">;</span>  <span class="token function">ChatItemModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mostRecentMessage<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageDate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Right now,I’ve omitted adding a profile picture for brevity.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">ListView <span class="token function">buildChatListView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>          itemCount<span class="token punctuation">:</span> ChatHelper<span class="token punctuation">.</span>itemCount<span class="token punctuation">,</span>          itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>            ChatItemModel chatItem <span class="token operator">=</span> ChatHelper<span class="token punctuation">.</span><span class="token function">getChatItem</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                <span class="token function">Padding</span><span class="token punctuation">(</span>                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                    children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                      <span class="token function">Icon</span><span class="token punctuation">(</span>                        Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span>                        size<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token function">Expanded</span><span class="token punctuation">(</span>                        child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                            crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                              <span class="token function">Row</span><span class="token punctuation">(</span>                                mainAxisAlignment<span class="token punctuation">:</span>                                    MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                                  <span class="token function">Text</span><span class="token punctuation">(</span>                                    chatItem<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                      fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                                      fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span>                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token function">Text</span><span class="token punctuation">(</span>chatItem<span class="token punctuation">.</span>messageDate<span class="token punctuation">,</span>                                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">,</span>                                      <span class="token punctuation">)</span><span class="token punctuation">)</span>                                <span class="token punctuation">]</span><span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                              <span class="token function">Padding</span><span class="token punctuation">(</span>                                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>chatItem<span class="token punctuation">.</span>mostRecentMessage<span class="token punctuation">,</span>                                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">,</span>                                      fontSize<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">,</span>                                    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                              <span class="token punctuation">)</span>                            <span class="token punctuation">]</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>After creating the first list this is the result:</p><p><img src="https://s2.loli.net/2022/01/29/IuvhHoFUynm7XpQ.png" alt="whatsapp_chat_listview"></p><p>The other tabviews are very same as the chats’s tab. So we don’t talk about it.<br>The final code is here:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge WhatsApp'</span><span class="token punctuation">,</span>      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span>    <span class="token keyword">with</span> SingleTickerProviderStateMixin <span class="token punctuation">{</span>  Color whatsAppGreen <span class="token operator">=</span> Color<span class="token punctuation">.</span><span class="token function">fromRGBO</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">126</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  Color whatsAppGreenLight <span class="token operator">=</span> Color<span class="token punctuation">.</span><span class="token function">fromRGBO</span><span class="token punctuation">(</span><span class="token number">37</span><span class="token punctuation">,</span> <span class="token number">211</span><span class="token punctuation">,</span> <span class="token number">102</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  TabController tabController<span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    tabController <span class="token operator">=</span> <span class="token function">TabController</span><span class="token punctuation">(</span>vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> length<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">buildAppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">TabBarView</span><span class="token punctuation">(</span>        controller<span class="token punctuation">:</span> tabController<span class="token punctuation">,</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>camera_alt<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Scaffold</span><span class="token punctuation">(</span>            body<span class="token punctuation">:</span> <span class="token function">buildChatListView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">,</span>              backgroundColor<span class="token punctuation">:</span> whatsAppGreenLight<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Scaffold</span><span class="token punctuation">(</span>            body<span class="token punctuation">:</span> <span class="token function">buildStatusListView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>camera_enhance<span class="token punctuation">)</span><span class="token punctuation">,</span>              backgroundColor<span class="token punctuation">:</span> whatsAppGreenLight<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Scaffold</span><span class="token punctuation">(</span>            body<span class="token punctuation">:</span> <span class="token function">buildCallsListView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>call<span class="token punctuation">)</span><span class="token punctuation">,</span>              backgroundColor<span class="token punctuation">:</span> whatsAppGreenLight<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  ListView <span class="token function">buildCallsListView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>      itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>        CallItemModel callItemModel <span class="token operator">=</span> CallHelper<span class="token punctuation">.</span><span class="token function">getCallItem</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span>                    size<span class="token punctuation">:</span> <span class="token number">64.0</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Expanded</span><span class="token punctuation">(</span>                    child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                        mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Column</span><span class="token punctuation">(</span>                            crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                              <span class="token function">Row</span><span class="token punctuation">(</span>                                mainAxisAlignment<span class="token punctuation">:</span>                                    MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                                  <span class="token function">Text</span><span class="token punctuation">(</span>                                    callItemModel<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                        fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                                        fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token punctuation">]</span><span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                              <span class="token function">Padding</span><span class="token punctuation">(</span>                                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                                  callItemModel<span class="token punctuation">.</span>dateTime<span class="token punctuation">,</span>                                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span><span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">]</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Icon</span><span class="token punctuation">(</span>                            Icons<span class="token punctuation">.</span>call<span class="token punctuation">,</span>                            color<span class="token punctuation">:</span> whatsAppGreen<span class="token punctuation">,</span>                          <span class="token punctuation">)</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      itemCount<span class="token punctuation">:</span> CallHelper<span class="token punctuation">.</span>itemCount<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  ListView <span class="token function">buildStatusListView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>      itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>        StatusItemModel statusItemModel <span class="token operator">=</span> StatusHelper<span class="token punctuation">.</span><span class="token function">getStatusItem</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span>                    size<span class="token punctuation">:</span> <span class="token number">64.0</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Expanded</span><span class="token punctuation">(</span>                    child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Row</span><span class="token punctuation">(</span>                            mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                              <span class="token function">Text</span><span class="token punctuation">(</span>                                statusItemModel<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                    fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                                    fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">]</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                              statusItemModel<span class="token punctuation">.</span>dateTime<span class="token punctuation">,</span>                              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>      itemCount<span class="token punctuation">:</span> StatusHelper<span class="token punctuation">.</span>itemCount<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  ListView <span class="token function">buildChatListView</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>      itemCount<span class="token punctuation">:</span> ChatHelper<span class="token punctuation">.</span>itemCount<span class="token punctuation">,</span>      itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>        ChatItemModel chatItem <span class="token operator">=</span> ChatHelper<span class="token punctuation">.</span><span class="token function">getChatItem</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span>                    size<span class="token punctuation">:</span> <span class="token number">64</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Expanded</span><span class="token punctuation">(</span>                    child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Row</span><span class="token punctuation">(</span>                            mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                              <span class="token function">Text</span><span class="token punctuation">(</span>                                chatItem<span class="token punctuation">.</span>name<span class="token punctuation">,</span>                                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                  fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                                  fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span><span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                              <span class="token function">Text</span><span class="token punctuation">(</span>chatItem<span class="token punctuation">.</span>messageDate<span class="token punctuation">,</span>                                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">)</span>                            <span class="token punctuation">]</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>chatItem<span class="token punctuation">.</span>mostRecentMessage<span class="token punctuation">,</span>                                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">,</span>                                  fontSize<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  AppBar <span class="token function">buildAppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>        <span class="token string">'WhatsApp'</span><span class="token punctuation">,</span>        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">,</span> fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w600<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      actions<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>        <span class="token function">Padding</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Padding</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>more_vert<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>      backgroundColor<span class="token punctuation">:</span> whatsAppGreen<span class="token punctuation">,</span>      bottom<span class="token punctuation">:</span> <span class="token function">TabBar</span><span class="token punctuation">(</span>        tabs<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>camera_alt<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'CHATS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'STATUS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Tab</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'CALLS'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        indicatorColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>        controller<span class="token punctuation">:</span> tabController<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">ChatItemModel</span> <span class="token punctuation">{</span>  String name<span class="token punctuation">;</span>  String mostRecentMessage<span class="token punctuation">;</span>  String messageDate<span class="token punctuation">;</span>  <span class="token function">ChatItemModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mostRecentMessage<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>messageDate<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">ChatHelper</span> <span class="token punctuation">{</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> chatList <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">ChatItemModel</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Lunch in the evening?"</span><span class="token punctuation">,</span> <span class="token string">"16/07/2018"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">ChatItemModel</span><span class="token punctuation">(</span><span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token string">"Sure"</span><span class="token punctuation">,</span> <span class="token string">"16/07/2018"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">ChatItemModel</span><span class="token punctuation">(</span><span class="token string">"Jane"</span><span class="token punctuation">,</span> <span class="token string">"Meet this week?"</span><span class="token punctuation">,</span> <span class="token string">"16/07/2018"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">ChatItemModel</span><span class="token punctuation">(</span><span class="token string">"Ned"</span><span class="token punctuation">,</span> <span class="token string">"Received!"</span><span class="token punctuation">,</span> <span class="token string">"16/07/2018"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">ChatItemModel</span><span class="token punctuation">(</span><span class="token string">"Steve"</span><span class="token punctuation">,</span> <span class="token string">"I'll come too!"</span><span class="token punctuation">,</span> <span class="token string">"16/07/2018"</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> ChatItemModel <span class="token function">getChatItem</span><span class="token punctuation">(</span>int position<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> chatList<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> itemCount <span class="token operator">=</span> chatList<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">StatusItemModel</span> <span class="token punctuation">{</span>  String name<span class="token punctuation">;</span>  String dateTime<span class="token punctuation">;</span>  <span class="token function">StatusItemModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dateTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">StatusHelper</span> <span class="token punctuation">{</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> statusList <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">StatusItemModel</span><span class="token punctuation">(</span><span class="token string">"Jane"</span><span class="token punctuation">,</span> <span class="token string">"Yesterday, 11:21 PM"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">StatusItemModel</span><span class="token punctuation">(</span><span class="token string">"Jack"</span><span class="token punctuation">,</span> <span class="token string">"Yesterday, 10:22 PM"</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> StatusItemModel <span class="token function">getStatusItem</span><span class="token punctuation">(</span>int position<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> statusList<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> itemCount <span class="token operator">=</span> statusList<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">CallItemModel</span> <span class="token punctuation">{</span>  String name<span class="token punctuation">;</span>  String dateTime<span class="token punctuation">;</span>  <span class="token function">CallItemModel</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dateTime<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">CallHelper</span> <span class="token punctuation">{</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> callList <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">CallItemModel</span><span class="token punctuation">(</span><span class="token string">"Alice"</span><span class="token punctuation">,</span> <span class="token string">"Today, 3:39 PM"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">CallItemModel</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">,</span> <span class="token string">"Today, 4:41 PM"</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> CallItemModel <span class="token function">getCallItem</span><span class="token punctuation">(</span>int position<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> callList<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> itemCount <span class="token operator">=</span> callList<span class="token punctuation">.</span>length<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Whatsapp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter Challenge The Medium App</title>
      <link href="/2022/01/29/flutter_challenge_the_medium_app/"/>
      <url>/2022/01/29/flutter_challenge_the_medium_app/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://s2.loli.net/2022/01/29/MCo5YvxiU1Irez7.jpg" alt="Medium"></p><p>Flutter Challenges will attempt to recreate a particular app UI or design in Flutter.</p><p>Today we’ll attempt to create the home screen of the Medium app. Note that the focus will be on the UI rather than actually fetching articles.</p><h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><p>Before developing a design,identify the components required to make the screen in any framework.</p><p>The app screen has a drawer,a notification and search option,and a list of articles.</p><p>Let’s take a look at the article</p><p><img src="https://s2.loli.net/2022/01/29/RJxgzZ6sTXfHavr.jpg" alt="medium_article"></p><p>At the very top,the article has a text which gives you relevance as to why it’s there. For example,if it’s based on your reading history or if it’s from a category you follow.</p><p>Below that is the title of the article iteself,which is bold and black as to stand out.</p><p>Below the title is the author of the article,date of publishing,and how long the article is estimated to take to read.</p><p>On the right hand side is the article image and a bookmark button for saving it for later.</p><h3 id="Setting-up-the-app"><a href="#Setting-up-the-app" class="headerlink" title="Setting up the app"></a>Setting up the app</h3><p>Create a new Flutter,example:”medium_app_ui”.</p><p>Remove the code for the counter app until you only remain with the a Scaffold with an AppBar.</p><p>Before we move on to the list,let’s contruct the AppBar according to the Medium design.</p><p>As of now,the appBar is blue. We need to change the app bar to black. The actions on the appBar are notifications and search.Doing these changes:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Home'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>        actions<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>notifications_none<span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>          <span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>After this,we need to adjust a few icons and add a drawer.To add a drawer without and content,simply add.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">drawer<span class="token punctuation">:</span> <span class="token function">Drawer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>to your Scaffold.</p><p>Here is the code and resulting AppBar.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge Medium'</span><span class="token punctuation">,</span>      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>          <span class="token string">'Home'</span><span class="token punctuation">,</span>          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w400<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>        actions<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>notifications_none<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>          mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s2.loli.net/2022/01/29/hPK217XRMC6DkQb.png" alt="medium_appbar_final"></p><p>So far,so good.</p><p>Let’s create a class to store articles named NewsArticle.dart</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">NewsArticale</span> <span class="token punctuation">{</span>  String categoryTitle<span class="token punctuation">;</span>  String title<span class="token punctuation">;</span>  String author<span class="token punctuation">;</span>  String date<span class="token punctuation">;</span>  String readTime<span class="token punctuation">;</span>  String imageAssetName<span class="token punctuation">;</span>  <span class="token function">NewsArticale</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>categoryTitle<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>author<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>date<span class="token punctuation">,</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>readTime<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageAssetName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>For now,they’re just hardcoded articles.</p><h3 id="Creating-the-List"><a href="#Creating-the-List" class="headerlink" title="Creating the List"></a>Creating the List</h3><p>To create a repeating list in Flutter,we use ListView.builder().</p><p>In the image,the cards are over a grey background.</p><p>Let’s analyse the card components themselves.</p><p><img src="https://s2.loli.net/2022/01/29/6zaMcvoVA4D7F2C.jpg" alt="medium_analyse"></p><p>There’s a class named NewsHelper which provides the hard-coded articles.</p><p>The final item is build like this:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                  crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                  children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                    <span class="token function">Text</span><span class="token punctuation">(</span>                      article<span class="token punctuation">.</span>categoryTitle<span class="token punctuation">,</span>                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black38<span class="token punctuation">,</span>                          fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">12.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                        mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Flexible</span><span class="token punctuation">(</span>                            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                              article<span class="token punctuation">.</span>title<span class="token punctuation">,</span>                              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>                                fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            flex<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Flexible</span><span class="token punctuation">(</span>                            flex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                              height<span class="token punctuation">:</span> <span class="token number">80.0</span><span class="token punctuation">,</span>                              width<span class="token punctuation">:</span> <span class="token number">80.0</span><span class="token punctuation">,</span>                              child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>                                  <span class="token string">'assets/'</span> <span class="token operator">+</span> article<span class="token punctuation">.</span>imageAssetName<span class="token punctuation">,</span>                                  fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Row</span><span class="token punctuation">(</span>                      mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                        <span class="token function">Column</span><span class="token punctuation">(</span>                          crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                            <span class="token function">Text</span><span class="token punctuation">(</span>                              article<span class="token punctuation">.</span>author<span class="token punctuation">,</span>                              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token function">Text</span><span class="token punctuation">(</span>                              article<span class="token punctuation">.</span>date <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> article<span class="token punctuation">.</span>readTime<span class="token punctuation">,</span>                              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">,</span>                                fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">]</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>bookmark_border<span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span>                  <span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Designing-the-Drawer"><a href="#Designing-the-Drawer" class="headerlink" title="Designing the Drawer"></a>Designing the Drawer</h3><p>This is how the drawer looks on the Medium app:</p><p><img src="https://s2.loli.net/2022/01/29/OkC8M7JFP2EYgvX.jpg" alt="medium_drawer"></p><p>The Drawer is simply a Column with a list of elements and an Image at the top. The top white portion can be represented by one container and the bottom half by another.</p><p>Here is my drawer code:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Drawer</span><span class="token punctuation">(</span>      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Container</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token number">64.0</span><span class="token punctuation">,</span> <span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">90.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'John Doe'</span><span class="token punctuation">,</span>                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'See profile'</span><span class="token punctuation">,</span>                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Expanded</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black12<span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">40.0</span><span class="token punctuation">,</span> <span class="token number">16.0</span><span class="token punctuation">,</span> <span class="token number">40.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                  crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                  children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Home'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Audio'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span>                          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Bookmarks'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span>                          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Interests'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Become a member'</span><span class="token punctuation">,</span>                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>teal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span>                          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'New Story'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Stats'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Drafts'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Expanded</span><span class="token punctuation">(</span>                      child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                        alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>bottomLeft<span class="token punctuation">,</span>                        child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                          mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                            <span class="token function">Icon</span><span class="token punctuation">(</span>                              Icons<span class="token punctuation">.</span>account_box<span class="token punctuation">,</span>                              size<span class="token punctuation">:</span> <span class="token number">64.0</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token function">Text</span><span class="token punctuation">(</span>                              <span class="token string">'Setting'</span><span class="token punctuation">,</span>                              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Help'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                          <span class="token punctuation">]</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span>                  <span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s2.loli.net/2022/01/29/dgj5S7vHtLyBQM1.png" alt="medium_my_drawer"></p><p>Here is the final code:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge Medium'</span><span class="token punctuation">,</span>      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">buildAppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">buildBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      drawer<span class="token punctuation">:</span> <span class="token function">buildDrawer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  Drawer <span class="token function">buildDrawer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Drawer</span><span class="token punctuation">(</span>      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Container</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token number">64.0</span><span class="token punctuation">,</span> <span class="token number">32.0</span><span class="token punctuation">,</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">90.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'John Doe'</span><span class="token punctuation">,</span>                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'See profile'</span><span class="token punctuation">,</span>                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Expanded</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black12<span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">40.0</span><span class="token punctuation">,</span> <span class="token number">16.0</span><span class="token punctuation">,</span> <span class="token number">40.0</span><span class="token punctuation">,</span> <span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                  crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                  children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Home'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Audio'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span>                          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Bookmarks'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span>                          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Interests'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Become a member'</span><span class="token punctuation">,</span>                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>teal<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span>                          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'New Story'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Stats'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Drafts'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Expanded</span><span class="token punctuation">(</span>                      child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                        alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>bottomLeft<span class="token punctuation">,</span>                        child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                          mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                            <span class="token function">Icon</span><span class="token punctuation">(</span>                              Icons<span class="token punctuation">.</span>account_box<span class="token punctuation">,</span>                              size<span class="token punctuation">:</span> <span class="token number">64.0</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token function">Text</span><span class="token punctuation">(</span>                              <span class="token string">'Setting'</span><span class="token punctuation">,</span>                              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Help'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                          <span class="token punctuation">]</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span>                  <span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  Center <span class="token function">buildBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>      itemCount<span class="token punctuation">:</span> NewsHelper<span class="token punctuation">.</span>articleCount<span class="token punctuation">,</span>      itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>contex<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>        NewsArticle article <span class="token operator">=</span> NewsHelper<span class="token punctuation">.</span><span class="token function">getArticle</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">Padding</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Text</span><span class="token punctuation">(</span>                    article<span class="token punctuation">.</span>categoryTitle<span class="token punctuation">,</span>                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black38<span class="token punctuation">,</span>                        fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                        fontSize<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">12.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                      mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                        <span class="token function">Flexible</span><span class="token punctuation">(</span>                          child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                            article<span class="token punctuation">.</span>title<span class="token punctuation">,</span>                            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                              fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>                              fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          flex<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token function">Flexible</span><span class="token punctuation">(</span>                          flex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>                          child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                            height<span class="token punctuation">:</span> <span class="token number">80.0</span><span class="token punctuation">,</span>                            width<span class="token punctuation">:</span> <span class="token number">80.0</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>                                <span class="token string">'assets/'</span> <span class="token operator">+</span> article<span class="token punctuation">.</span>imageAssetName<span class="token punctuation">,</span>                                fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span>                      <span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Row</span><span class="token punctuation">(</span>                    mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                    children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                      <span class="token function">Column</span><span class="token punctuation">(</span>                        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Text</span><span class="token punctuation">(</span>                            article<span class="token punctuation">.</span>author<span class="token punctuation">,</span>                            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                              fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Text</span><span class="token punctuation">(</span>                            article<span class="token punctuation">.</span>date <span class="token operator">+</span> <span class="token string">'.'</span> <span class="token operator">+</span> article<span class="token punctuation">.</span>readTime<span class="token punctuation">,</span>                            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">,</span>                              fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>bookmark_border<span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  AppBar <span class="token function">buildAppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>        <span class="token string">'Home'</span><span class="token punctuation">,</span>        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>          fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w400<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>      actions<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>        <span class="token function">Padding</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>notifications_none<span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Padding</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">NewsArticle</span> <span class="token punctuation">{</span>  String categoryTitle<span class="token punctuation">;</span>  String title<span class="token punctuation">;</span>  String author<span class="token punctuation">;</span>  String date<span class="token punctuation">;</span>  String readTime<span class="token punctuation">;</span>  String imageAssetName<span class="token punctuation">;</span>  <span class="token function">NewsArticle</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>categoryTitle<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>author<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>date<span class="token punctuation">,</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>readTime<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>imageAssetName<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">NewsHelper</span> <span class="token punctuation">{</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> articleCount <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> categoryTitles <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">"SPACE"</span><span class="token punctuation">,</span>    <span class="token string">"FROM YOUR NETWORK"</span><span class="token punctuation">,</span>    <span class="token string">"BASED ON YOUR READING HISTORY"</span><span class="token punctuation">,</span>    <span class="token string">"DATA SCIENCE"</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> titles <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">"Sorry, Methane and 'Organics' On Mars Are Not Evidence For Life"</span><span class="token punctuation">,</span>    <span class="token string">"A crash course on Serverless APIs with Express and MongoDB"</span><span class="token punctuation">,</span>    <span class="token string">"What happened Gmail?"</span><span class="token punctuation">,</span>    <span class="token string">"A year as a Data Scientist right after college: An honest review"</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> authorNames <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">"Ethan Siegal"</span><span class="token punctuation">,</span>    <span class="token string">"Adnan Rahic"</span><span class="token punctuation">,</span>    <span class="token string">"Avi Ashkenazi"</span><span class="token punctuation">,</span>    <span class="token string">"Abhishek Parkbhakar"</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"15 Jun"</span><span class="token punctuation">,</span> <span class="token string">"15 hours ago"</span><span class="token punctuation">,</span> <span class="token string">"27 Apr"</span><span class="token punctuation">,</span> <span class="token string">"14 Jun"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> readTimes <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">"7 min read"</span><span class="token punctuation">,</span>    <span class="token string">"14 min read"</span><span class="token punctuation">,</span>    <span class="token string">"8 min read"</span><span class="token punctuation">,</span>    <span class="token string">"8 min read"</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> <span class="token keyword">var</span> imageAssetName <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token string">"mars.jpeg"</span><span class="token punctuation">,</span>    <span class="token string">"cars.jpeg"</span><span class="token punctuation">,</span>    <span class="token string">"gmail.jpeg"</span><span class="token punctuation">,</span>    <span class="token string">"umbrella.jpeg"</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">static</span> <span class="token function">getArticle</span><span class="token punctuation">(</span>int position<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">NewsArticle</span><span class="token punctuation">(</span>        categoryTitles<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span>        titles<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span>        authorNames<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span>        date<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span>        readTimes<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span>        imageAssetName<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Medium </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter Challenge TODO App</title>
      <link href="/2022/01/28/flutter_challenge_todo_app/"/>
      <url>/2022/01/28/flutter_challenge_todo_app/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://s2.loli.net/2022/01/28/TxizVj9dLcrOu72.png" alt="todo"></p><p>This challenge is based on a design on Dribbble by Jae-song,Jeong.</p><p>Link:<a href="https://dribbble.com/shots/3812962-iPhone-X-Todo-Concept"> https://dribbble.com/shots/3812962-iPhone-X-Todo-Concept</a></p><p>Flutter Challenges will attempt to recreate a particular app UI or design in Flutter.</p><p><img src="https://s2.loli.net/2022/01/28/P3ztK5yqwMaZC9L.png" alt="todo_ui_final"></p><p>This challenge will attempt the home screen of the app design.Note that the foucs will be on the UI rather than actually fetching data from a backend.</p><p>Before starting,take a look at the design at the link given above or at <a href="https://cdn.dribbble.com/users/1200964/screenshots/3812962/attachments/861450/todo_concept_iphonex_60fps.mp4">this link.</a></p><h3 id="Understanding-the-app-structure"><a href="#Understanding-the-app-structure" class="headerlink" title="Understanding the app structure"></a>Understanding the app structure</h3><p>The design is a concept for implementing a TODO app. It has three main parts:</p><ol><li>The AppBar</li><li>The User Details</li><li>The Card List</li><li>The Color Transition when the list is scrolled</li></ol><h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><p>Let’s create a Flutter Project named todo_app_ui and clear the default code until we’re left with this:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge TODO'</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'TODO'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        centerTitle<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>We’ll go from top to bottom when recreating thr UI to make it simpler.</p><p>So first up,</p><h3 id="The-App-Bar"><a href="#The-App-Bar" class="headerlink" title="The App Bar"></a>The App Bar</h3><p>This is the AppBar of the design:</p><p><img src="https://s2.loli.net/2022/01/28/8NOpeduoqXlF53z.png" alt="todo_appbar"></p><p>It consists of a drawer,a centered title and a search action.</p><p>Let’s try to code the appBar:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>          <span class="token string">'TODO'</span><span class="token punctuation">,</span>          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        backgroundColor<span class="token punctuation">:</span> appColors<span class="token punctuation">[</span>cardIndex<span class="token punctuation">]</span><span class="token punctuation">,</span>        centerTitle<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        actions<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        elevation<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>My appColors list holds the background colors needed for each card index.<br>The card index is simply the index of the card in focus,0 for now.</p><p>To add a drawer icon,simply add</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">drawer<span class="token punctuation">:</span><span class="token function">Drawer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>to the Scaffold. This not only adds a drawer icon to your AppBar,but also adds a fully functional drawer.</p><p>Also,I’ve set the Scaffold background color to the same color as the AppBar.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">backgroundColor<span class="token punctuation">:</span>appColors<span class="token punctuation">[</span>cardIndex<span class="token punctuation">]</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Here’s our AppBar:</p><p><img src="https://s2.loli.net/2022/01/28/ltbxHpXgRhKIU9y.png" alt="ourappbar"></p><p>So far,so good.</p><h3 id="User-Details"><a href="#User-Details" class="headerlink" title="User Details"></a>User Details</h3><p>Below the AppBar is some text,welcoming them to the app and mentioning the number of things remaining on the list.</p><p><img src="https://s2.loli.net/2022/01/28/3sjESUMhTaym6kw.png" alt="todo_user_details"></p><p>The layout is simple enough to understand:A Column of an Icon and 3 text elements.</p><p>The code of this part comes down to:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Column</span><span class="token punctuation">(</span>        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span>                <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">64.0</span><span class="token punctuation">,</span> vertical<span class="token punctuation">:</span> <span class="token number">32.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span>                        size<span class="token punctuation">:</span> <span class="token number">45.0</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">16.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hello,Jane.'</span><span class="token punctuation">,</span>                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">30.0</span><span class="token punctuation">,</span>                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span>                    <span class="token string">'Looks like feel good.'</span><span class="token punctuation">,</span>                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span>                    <span class="token string">'You have 3 tasks to do today.'</span><span class="token punctuation">,</span>                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Note:That Row() was simply add to expand the Column to the full with of the phone.It has no other relevance to the layout.</p><p>Recreated user details and text:</p><p><img src="https://s2.loli.net/2022/01/28/MP8SB9HqhT6tZIf.png" alt="user_detail"></p><p>Note:We’ll just combine the data text with the card list in a container,so we’ll add it later.</p><p>Moving on to the main part:</p><h3 id="The-Card-List"><a href="#The-Card-List" class="headerlink" title="The Card List"></a>The Card List</h3><p>The Card List is a list of cards which denote the category of the notes(Person,Work, Home).To make this list,we’ll use a ListView.builder().</p><p><img src="https://s2.loli.net/2022/01/28/6FyBhlTzjIk2Pe4.png" alt="card_list"></p><p>Let’s analyse the Card elements.</p><p>The Card has a Column with:</p><ol><li>A Row for the icons</li><li>Two Texts for displaying number of tasks and category</li><li>Progress Bar for displaying the progress of the category of tasks</li></ol><p>Also,in the design,the list does not scroll normally,rather it only scrolls on swipe and goes one position ahead or behind.So what we’ll do is,we’ll disable scrolling and write a GestureRecognizer to recognise swipes on cards and then go to the next card index.</p><p>Trying to recreate it:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>      physics<span class="token punctuation">:</span> <span class="token function">NeverScrollableScrollPhysics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      itemCount<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>      controller<span class="token punctuation">:</span> scrollController<span class="token punctuation">,</span>      itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                width<span class="token punctuation">:</span> <span class="token number">250.0</span><span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                  crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                  mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                  children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                        mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Icon</span><span class="token punctuation">(</span>                            cardsList<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>icon<span class="token punctuation">,</span>                            color<span class="token punctuation">:</span> appColors<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Icon</span><span class="token punctuation">(</span>                            Icons<span class="token punctuation">.</span>more_vert<span class="token punctuation">,</span>                            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>                                horizontal<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">,</span> vertical<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                                <span class="token string">'${cardsList[position].tasksRemaining} Tasks'</span><span class="token punctuation">,</span>                                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>                                horizontal<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">,</span> vertical<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                              <span class="token string">'${cardsList[position].cardTitle}'</span><span class="token punctuation">,</span>                              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                fontSize<span class="token punctuation">:</span> <span class="token number">28.0</span><span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">LinearProgressIndicator</span><span class="token punctuation">(</span>                              value<span class="token punctuation">:</span> cardsList<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>taskCompletion<span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span>                  <span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>                  borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          onHorizontalDragEnd<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>details<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>pixelsPerSecond<span class="token punctuation">.</span>dx <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>cardIndex <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                cardIndex<span class="token operator">--</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>cardIndex <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  cardIndex<span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>              <span class="token punctuation">}</span>                        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              scrollController<span class="token punctuation">.</span><span class="token function">animateTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cardIndex<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256.0</span><span class="token punctuation">,</span>                  duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  curve<span class="token punctuation">:</span> Curves<span class="token punctuation">.</span>fastOutSlowIn<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>We also have a scroll controller to animate the list which we initialise like this:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">ScrollController scrollController<span class="token punctuation">;</span><span class="token metadata symbol">@override</span><span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> scrollController <span class="token operator">=</span> <span class="token function">ScrollController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>If you notice,the list has “physics” set to NeverScrollablePhysics. This inhibits scrolling of the list itself as we don’t want it to scroll. There is also a GestureDetector wrapped around the list recognise when the user swipes on the list. Take a look at the “horizontalDragEnd:” component.When the drag ends,we check if the swipe was a left swipe or right swipe and update the index accordingly.We then animate the list to scroll to that index in 500ms.I also have a cardList[] which stores the information about the cards and sets it.</p><p>Now let’s deal with animating the backgroundcolors when the card is swiped.</p><h3 id="The-Color-Transition"><a href="#The-Color-Transition" class="headerlink" title="The Color Transition"></a>The Color Transition</h3><p>For a color transition we need three things:</p><ol><li>An AnimationController to trigger an animation.</li><li>A CurvedAnimation to defined how the values change.</li><li>A ColorTween to define start and end colors.</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">AnimationController animationController<span class="token punctuation">;</span>ColorTween colorTween<span class="token punctuation">;</span>CurvedAnimation curvedAnimation<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Declare these variables above the initState() method.</p><p>Second,we declare a “currentColor” variable to store the current color of the background and also set the appBar and scaffoldBackground to currenColor.</p><p>The main change comes in the onHorizontalDragEnd method.When the horizontal swipe ends,we have to trigger the color change animation.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">onHorizontalDragEnd<span class="token punctuation">:</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span> animationController <span class="token operator">=</span>        <span class="token function">AnimationController</span><span class="token punctuation">(</span>vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    curvedAnimation <span class="token operator">=</span> <span class="token function">CurvedAnimation</span><span class="token punctuation">(</span>        parent<span class="token punctuation">:</span> animationController<span class="token punctuation">,</span> curve<span class="token punctuation">:</span> Curves<span class="token punctuation">.</span>fastOutSlowIn<span class="token punctuation">)</span><span class="token punctuation">;</span>    animationController<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        currentColor <span class="token operator">=</span> colorTween<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>curvedAnimation<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>details<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>pixelsPerSecond<span class="token punctuation">.</span>dx <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>cardIndex <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        cardIndex<span class="token operator">--</span><span class="token punctuation">;</span>        colorTween <span class="token operator">=</span> <span class="token function">ColorTween</span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> currentColor<span class="token punctuation">,</span> end<span class="token punctuation">:</span> appColors<span class="token punctuation">[</span>cardIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>cardIndex <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        cardIndex<span class="token operator">++</span><span class="token punctuation">;</span>        colorTween <span class="token operator">=</span> <span class="token function">ColorTween</span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> currentColor<span class="token punctuation">,</span> end<span class="token punctuation">:</span> appColors<span class="token punctuation">[</span>cardIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      scrollController<span class="token punctuation">.</span><span class="token function">animateTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cardIndex<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256.0</span><span class="token punctuation">,</span>          duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> curve<span class="token punctuation">:</span> Curves<span class="token punctuation">.</span>fastOutSlowIn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    colorTween<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>curvedAnimation<span class="token punctuation">)</span><span class="token punctuation">;</span>    animationController<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>We first initialise our animation controller,the animation itself and the color tween based on whether it was swiped left or right(If swiped left,we want to go from current to next color,whereas if it was swiped right we want to go from<br>current to the color before).</p><p>When the animation is running,we set the currentColor to the values of the animation.</p><p>The whole code is here:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge TODO'</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      debugShowCheckedModeBanner<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token keyword">with</span> TickerProviderStateMixin <span class="token punctuation">{</span>  <span class="token keyword">var</span> appColors <span class="token operator">=</span> <span class="token punctuation">[</span>    Color<span class="token punctuation">.</span><span class="token function">fromRGBO</span><span class="token punctuation">(</span><span class="token number">231</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    Color<span class="token punctuation">.</span><span class="token function">fromRGBO</span><span class="token punctuation">(</span><span class="token number">99</span><span class="token punctuation">,</span> <span class="token number">138</span><span class="token punctuation">,</span> <span class="token number">223</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    Color<span class="token punctuation">.</span><span class="token function">fromRGBO</span><span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> <span class="token number">194</span><span class="token punctuation">,</span> <span class="token number">173</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> cardIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>  ScrollController scrollController<span class="token punctuation">;</span>  <span class="token keyword">var</span> currentColor <span class="token operator">=</span> Color<span class="token punctuation">.</span><span class="token function">fromRGBO</span><span class="token punctuation">(</span><span class="token number">231</span><span class="token punctuation">,</span> <span class="token number">129</span><span class="token punctuation">,</span> <span class="token number">109</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> cardsList <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">CardItemModel</span><span class="token punctuation">(</span><span class="token string">"Personal"</span><span class="token punctuation">,</span> Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0.83</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">CardItemModel</span><span class="token punctuation">(</span><span class="token string">"Work"</span><span class="token punctuation">,</span> Icons<span class="token punctuation">.</span>work<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0.24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">CardItemModel</span><span class="token punctuation">(</span><span class="token string">"Home"</span><span class="token punctuation">,</span> Icons<span class="token punctuation">.</span>home<span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0.32</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  AnimationController animationController<span class="token punctuation">;</span>  ColorTween colorTween<span class="token punctuation">;</span>  CurvedAnimation curvedAnimation<span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    scrollController <span class="token operator">=</span> <span class="token function">ScrollController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      backgroundColor<span class="token punctuation">:</span> currentColor<span class="token punctuation">,</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>          <span class="token string">'TODO'</span><span class="token punctuation">,</span>          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        backgroundColor<span class="token punctuation">:</span> currentColor<span class="token punctuation">,</span>        centerTitle<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        actions<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        elevation<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>          crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">buildHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">buildTaskCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      drawer<span class="token punctuation">:</span> <span class="token function">Drawer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  Padding <span class="token function">buildHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Padding</span><span class="token punctuation">(</span>      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">64.0</span><span class="token punctuation">,</span> vertical<span class="token punctuation">:</span> <span class="token number">32.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>          crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>vertical<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">45.0</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">16.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hello,Jane.'</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                    fontSize<span class="token punctuation">:</span> <span class="token number">30.0</span><span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Text</span><span class="token punctuation">(</span>              <span class="token string">'Looks like feel good.'</span><span class="token punctuation">,</span>              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Text</span><span class="token punctuation">(</span>              <span class="token string">'You have 3 tasks to do today.'</span><span class="token punctuation">,</span>              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  Column <span class="token function">buildTaskCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>      crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>        <span class="token function">Padding</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">64.0</span><span class="token punctuation">,</span> vertical<span class="token punctuation">:</span> <span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span>              <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'TODAY: JUL 21,2018'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Container</span><span class="token punctuation">(</span>          height<span class="token punctuation">:</span> <span class="token number">350</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>            physics<span class="token punctuation">:</span> <span class="token function">NeverScrollableScrollPhysics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            itemCount<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>            controller<span class="token punctuation">:</span> scrollController<span class="token punctuation">,</span>            scrollDirection<span class="token punctuation">:</span> Axis<span class="token punctuation">.</span>horizontal<span class="token punctuation">,</span>            itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>                    child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                      width<span class="token punctuation">:</span> <span class="token number">250.0</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                        mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                              mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>                              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                                <span class="token function">Icon</span><span class="token punctuation">(</span>                                  cardsList<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>icon<span class="token punctuation">,</span>                                  color<span class="token punctuation">:</span> appColors<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token function">Icon</span><span class="token punctuation">(</span>                                  Icons<span class="token punctuation">.</span>more_vert<span class="token punctuation">,</span>                                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">,</span>                                <span class="token punctuation">)</span><span class="token punctuation">,</span>                              <span class="token punctuation">]</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                              crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                                <span class="token function">Padding</span><span class="token punctuation">(</span>                                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>                                      horizontal<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">,</span> vertical<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                                      <span class="token string">'${cardsList[position].tasksRemaining} Tasks'</span><span class="token punctuation">,</span>                                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>grey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token function">Padding</span><span class="token punctuation">(</span>                                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>                                      horizontal<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">,</span> vertical<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                                    <span class="token string">'${cardsList[position].cardTitle}'</span><span class="token punctuation">,</span>                                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                                      fontSize<span class="token punctuation">:</span> <span class="token number">28.0</span><span class="token punctuation">,</span>                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token function">Padding</span><span class="token punctuation">(</span>                                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                  child<span class="token punctuation">:</span> <span class="token function">LinearProgressIndicator</span><span class="token punctuation">(</span>                                    value<span class="token punctuation">:</span> cardsList<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>taskCompletion<span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span>                              <span class="token punctuation">]</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>                        borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                onHorizontalDragEnd<span class="token punctuation">:</span> handleDrag<span class="token punctuation">,</span>                onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token function">print</span><span class="token punctuation">(</span>cardIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">void</span> <span class="token function">handleDrag</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>    animationController <span class="token operator">=</span>        <span class="token function">AnimationController</span><span class="token punctuation">(</span>vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    curvedAnimation <span class="token operator">=</span> <span class="token function">CurvedAnimation</span><span class="token punctuation">(</span>        parent<span class="token punctuation">:</span> animationController<span class="token punctuation">,</span> curve<span class="token punctuation">:</span> Curves<span class="token punctuation">.</span>fastOutSlowIn<span class="token punctuation">)</span><span class="token punctuation">;</span>    animationController<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        currentColor <span class="token operator">=</span> colorTween<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>curvedAnimation<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>details<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>pixelsPerSecond<span class="token punctuation">.</span>dx <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>cardIndex <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        cardIndex<span class="token operator">--</span><span class="token punctuation">;</span>        colorTween <span class="token operator">=</span> <span class="token function">ColorTween</span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> currentColor<span class="token punctuation">,</span> end<span class="token punctuation">:</span> appColors<span class="token punctuation">[</span>cardIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>cardIndex <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        cardIndex<span class="token operator">++</span><span class="token punctuation">;</span>        colorTween <span class="token operator">=</span> <span class="token function">ColorTween</span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> currentColor<span class="token punctuation">,</span> end<span class="token punctuation">:</span> appColors<span class="token punctuation">[</span>cardIndex<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      scrollController<span class="token punctuation">.</span><span class="token function">animateTo</span><span class="token punctuation">(</span><span class="token punctuation">(</span>cardIndex<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">256.0</span><span class="token punctuation">,</span>          duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> curve<span class="token punctuation">:</span> Curves<span class="token punctuation">.</span>fastOutSlowIn<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    colorTween<span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>curvedAnimation<span class="token punctuation">)</span><span class="token punctuation">;</span>    animationController<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">CardItemModel</span> <span class="token punctuation">{</span>  String cardTitle<span class="token punctuation">;</span>  IconData icon<span class="token punctuation">;</span>  int tasksRemaining<span class="token punctuation">;</span>  double taskCompletion<span class="token punctuation">;</span>  <span class="token function">CardItemModel</span><span class="token punctuation">(</span>      <span class="token keyword">this</span><span class="token punctuation">.</span>cardTitle<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>icon<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>tasksRemaining<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>taskCompletion<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TODO </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flutter Challenge The YouTube App</title>
      <link href="/2022/01/28/flutter_challenge_to_youtube/"/>
      <url>/2022/01/28/flutter_challenge_to_youtube/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://s2.loli.net/2022/01/29/D2a79b6t4BoxEZu.jpg" alt="youtobe"></p><p>Flutter Challenges will attempt to receate a particular app UI or design in Flutter.</p><p>This challenge will attempt the Home screen and the Video Detail screen (The screen where the video actually plays) of the Youtube app including the animation.</p><p>This challenge will be slightly more complex than my previous ones but the result is that much better for the same.</p><h3 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h3><p>The YouTube app comprises of:</p><p>a) The Home Screen which contains:</p><ol><li>The AppBar with 3 actions</li><li>The User Video Feed</li><li>The Bottom Navigation Bar</li></ol><p>b) The Video Detail Screen which contains:</p><ol><li>The main video player which can shrink to let users look at their feed (PIP)</li><li>Recommendations for users based on the current video</li></ol><h3 id="Setting-up-the-project"><a href="#Setting-up-the-project" class="headerlink" title="Setting up the project"></a>Setting up the project</h3><p>Let’s make a Flutter project and remove all the default code leaving just a blank screen with the default app bar.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge YouTube'</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>            mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Making-the-AppBar"><a href="#Making-the-AppBar" class="headerlink" title="Making the AppBar"></a>Making the AppBar</h3><p>The AppBar has the YouTube logo and name on the left and three actions,i.e. record,search and open profile on the right.</p><p>The AppBar can be recreated as:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>          title<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>            mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>              <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>youtube<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token function">Padding</span><span class="token punctuation">(</span>                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                  <span class="token string">'YouTube'</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>                    letterSpacing<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span>                    fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w700<span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          actions<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                Icons<span class="token punctuation">.</span>videocam<span class="token punctuation">,</span>                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This is what the recreated AppBar looks like:</p><p><img src="https://s2.loli.net/2022/01/28/KZUcRx8uLgMVr4l.png" alt="youtube_appbar"></p><p><strong>Note:</strong> For the YouTube logo,I’ve used the FontFlutterAwesome icons <a href="https://pub.dartlang.org/packages/font_awesome_flutter#-readme-tab-">available as a package on Dart pub.</a></p><p>Let’s move on to the Bottom Navigation Bar,</p><h3 id="Creating-the-BottomNavigationBar"><a href="#Creating-the-BottomNavigationBar" class="headerlink" title="Creating the BottomNavigationBar"></a>Creating the BottomNavigationBar</h3><p>The bottom navigation bar has 5 items in it and is pretty straightforward to recreate in Flutter.We use the bottomNavigationBar parameter of the Scaffold.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">bottomNavigationBar<span class="token punctuation">:</span> <span class="token function">BottomNavigationBar</span><span class="token punctuation">(</span>        items<span class="token punctuation">:</span> <span class="token punctuation">[</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>home<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Home"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              FontAwesomeIcons<span class="token punctuation">.</span>fire<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Trending"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>subscriptions<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Subscriptions"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>email<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Inbox"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>folder<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Library"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        type<span class="token punctuation">:</span> BottomNavigationBarType<span class="token punctuation">.</span>fixed<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Note:</strong> We need to specify a fixed BottomNavigationBarType because for 4+ items,the default type is shifting to avoid overcrowding.</p><p>The result is:</p><p><img src="https://s2.loli.net/2022/01/28/tbrTi7SdzasBLCm.png" alt="youtube_navigation_bar"></p><h3 id="The-User-Video-Feed"><a href="#The-User-Video-Feed" class="headerlink" title="The User Video Feed"></a>The User Video Feed</h3><p>The User Video Feed is a list of items consisting of recommended videos, Let’s take a look at the list item:</p><p><img src="https://s2.loli.net/2022/01/28/ouIpVg8vZNfiG1L.png" alt="youtube_user_video_feed"></p><p>The list item consists of a Column with an image and a Row of information about the video.The Row consists of an image,a Column of the title and pubisher and a menu button.</p><p>To create a list in Flutter,we use a ListView.builder().Recreating the list items, we come to:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:flutterchallenge/VideoItemModel.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:font_awesome_flutter/font_awesome_flutter.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge YouTube'</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> videos <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">VideoItemModel</span><span class="token punctuation">(</span>        <span class="token string">"Gordon Ramsay Cooked For Vladimir Putin"</span><span class="token punctuation">,</span>        <span class="token string">"The Late Show with Stephen Colbert\n1.1M views.2 weeks ago"</span><span class="token punctuation">,</span>        <span class="token string">"assets/images/youtube/youtube_one.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">VideoItemModel</span><span class="token punctuation">(</span>        <span class="token string">"Hailee Steinfeld, Alesso - Let Me Go"</span><span class="token punctuation">,</span>        <span class="token string">"Hailee Steinfeld\n57M views.8 months ago"</span><span class="token punctuation">,</span>        <span class="token string">"assets/images/youtube/youtube_two.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">VideoItemModel</span><span class="token punctuation">(</span>        <span class="token string">"Charlie Puth - Look At Me Now"</span><span class="token punctuation">,</span>        <span class="token string">"Lyricwood\n4.7M views.4 months ago"</span><span class="token punctuation">,</span>        <span class="token string">"assets/images/youtube/youtube_three.jpg"</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>        title<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>          mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Icon</span><span class="token punctuation">(</span>              FontAwesomeIcons<span class="token punctuation">.</span>youtube<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                <span class="token string">'YouTube'</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>                  letterSpacing<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span>                  fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w700<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        actions<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>videocam<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>        itemCount<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>        itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>              <span class="token function">Row</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Expanded</span><span class="token punctuation">(</span>                    child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>                      videos<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>imagePath<span class="token punctuation">,</span>                      fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token function">Padding</span><span class="token punctuation">(</span>                padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                  crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                  children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                    <span class="token function">Expanded</span><span class="token punctuation">(</span>                      child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                        Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span>                        size<span class="token punctuation">:</span> <span class="token number">40.0</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                      flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Expanded</span><span class="token punctuation">(</span>                      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Padding</span><span class="token punctuation">(</span>                            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>bottom<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                              videos<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>                              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Text</span><span class="token punctuation">(</span>                            videos<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>publisher<span class="token punctuation">,</span>                            style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                      flex<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Expanded</span><span class="token punctuation">(</span>                      flex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>more_vert<span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      bottomNavigationBar<span class="token punctuation">:</span> <span class="token function">BottomNavigationBar</span><span class="token punctuation">(</span>        items<span class="token punctuation">:</span> <span class="token punctuation">[</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>home<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Home"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              FontAwesomeIcons<span class="token punctuation">.</span>fire<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Trending"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>subscriptions<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Subscriptions"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>email<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Inbox"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>folder<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Library"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        type<span class="token punctuation">:</span> BottomNavigationBarType<span class="token punctuation">.</span>fixed<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here videos is simply a list of the video details like titles and publishers.</p><p>This is how the recreated home screen looks like:</p><p><img src="https://s2.loli.net/2022/01/28/uzvyTHjwr8gZRSE.png" alt="home_screen"></p><p>Now,we’ll move on to the slightly harder part,the video detail screen.</p><h3 id="Creating-the-Video-Detail-Screen"><a href="#Creating-the-Video-Detail-Screen" class="headerlink" title="Creating the Video Detail Screen"></a>Creating the Video Detail Screen</h3><p>The video detail screen is the screen which actually displays videos in the YouTube app. The hightlight of the screen is that we can shrink the video and it keeps on playing on the bottom right side of the screen.For this article,we’ll focus on the shrinking animation instead of actually playing a video.</p><p>Notice,the screen is not a different page,but more of an overlay onto the existing screen.So,we’ll use the Stack widget to overlay the screen instead.</p><p>So at the background,we’ll have our home screen and on the top will be our video page.</p><h3 id="Building-the-Floating-Video-Player-Picture-in-picture"><a href="#Building-the-Floating-Video-Player-Picture-in-picture" class="headerlink" title="Building the Floating Video Player (Picture-in-picture)"></a>Building the Floating Video Player (Picture-in-picture)</h3><p>To build the floating video player which can expand to fill the whole screen,we use a LayoutBuilder to fit the screen perfectly.</p><p>Before going ahead we define a few values,namely,what size the video player will be when shrunk and expanded.We don’t set the width for the expanded player,instead,we take it from the Layout Builder.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">var</span> currentAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>topCenter<span class="token punctuation">;</span>  <span class="token keyword">var</span> minVideoHeight <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> minVideoWidth <span class="token operator">=</span> <span class="token number">150.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> maxVideoHeight <span class="token operator">=</span> <span class="token number">200.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> maxVideoWidth <span class="token operator">=</span> <span class="token number">250.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> currentVideoHeight <span class="token operator">=</span> <span class="token number">200.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> currentVideoWidth <span class="token operator">=</span> <span class="token number">200.0</span><span class="token punctuation">;</span>  bool isInSmallMode <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here,”small mode” is when the video player is shrunk.</p><p>The LayoutBuilder which builds the VideoDetail Screen can be written as:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">LayoutBuilder</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> constraints<span class="token punctuation">)</span> <span class="token punctuation">{</span>      maxVideoWidth <span class="token operator">=</span> constraints<span class="token punctuation">.</span>biggest<span class="token punctuation">.</span>width<span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isInSmallMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>        currentVideoWidth <span class="token operator">=</span> maxVideoWidth<span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>end<span class="token punctuation">,</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Expanded</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Align</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>isInSmallMode <span class="token operator">?</span> <span class="token number">8.0</span> <span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span>                  child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                    width<span class="token punctuation">:</span> currentVideoWidth<span class="token punctuation">,</span>                    height<span class="token punctuation">:</span> currentVideoHeight<span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>                      videos<span class="token punctuation">[</span>videoIndexSelected<span class="token punctuation">]</span><span class="token punctuation">.</span>imagePath<span class="token punctuation">,</span>                      fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  onVerticalDragEnd<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>details<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>pixelsPerSecond<span class="token punctuation">.</span>dy <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        isInSmallMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>details<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>pixelsPerSecond<span class="token punctuation">.</span>dy <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                  <span class="token punctuation">}</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              alignment<span class="token punctuation">:</span> currentAlignment<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            flex<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          currentAlignment <span class="token operator">==</span> Alignment<span class="token punctuation">.</span>topCenter              <span class="token operator">?</span> <span class="token function">Expanded</span><span class="token punctuation">(</span>                  flex<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                    child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                        <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token function">Padding</span><span class="token punctuation">(</span>                          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>                            child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Video Recommendation'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token function">Padding</span><span class="token punctuation">(</span>                          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>                            child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Video Recommendation'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token function">Padding</span><span class="token punctuation">(</span>                          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>                            child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Video Recommendation'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span>              <span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Notice how we’re getting the maximum screen width and then using that instead of using our first arbitrary value for maximum screen width.</p><p>We have attached a GestureDetector to detect swips on the screen so that we can shrink and expand it accordingly.Let’s create the animations.</p><h3 id="Animating-the-Video-Detail-Screen"><a href="#Animating-the-Video-Detail-Screen" class="headerlink" title="Animating the Video Detail Screen"></a>Animating the Video Detail Screen</h3><p>When we animate,we need to take care of two things:</p><ol><li>Bringing the video from top to the bottom right.</li><li>Changing the size of the video and making it smaller.</li></ol><p>For these things,we use two Tweens,an AlignmentTween and a Tween and construct two separate animations which will run concurrently.</p><pre class="line-numbers language-none"><code class="language-none">AnimationController alignmentAnimationController;  Animation alignmentAnimation;  AnimationController videoViewController;  Animation videoViewAnimation;  @override  void initState() {    super.initState();    alignmentAnimationController =        AnimationController(vsync: this, duration: Duration(seconds: 1))          ..addListener(() {            setState(() {              currentAlignment = alignmentAnimation.value;            });          });    alignmentAnimation =        AlignmentTween(begin: Alignment.topCenter, end: Alignment.bottomRight)            .animate(CurvedAnimation(                parent: alignmentAnimationController,                curve: Curves.fastOutSlowIn));    videoViewController =        AnimationController(vsync: this, duration: Duration(seconds: 1))          ..addListener(() {            setState(() {              currentVideoWidth = (maxVideoWidth * videoViewAnimation.value) +                  (minVideoHeight * (1.0 - videoViewAnimation.value));              currentVideoHeight = (maxVideoHeight * videoViewAnimation.value) +                  (minVideoHeight * (1.0 - videoViewAnimation.value));            });          });    videoViewAnimation =        Tween&lt;double&gt;(begin: 1.0, end: 0.0).animate(videoViewController);  }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>We trigger these animations when our video player is swiped up or down.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">onVerticalDragEnd<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>details<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>pixelsPerSecond<span class="token punctuation">.</span>dy <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        isInSmallMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                        alignmentAnimationController<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        videoViewController<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>details<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>pixelsPerSecond<span class="token punctuation">.</span>dy <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        alignmentAnimationController<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        videoViewController<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>                          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                            isInSmallMode <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                  <span class="token punctuation">}</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This is the final result of the code:</p><p><img src="https://s2.loli.net/2022/01/28/mMlwiQB8Z2GXRPx.png" alt="youtube_final"></p><p>This is the final code:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:flutterchallenge/VideoItemModel.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:font_awesome_flutter/font_awesome_flutter.dart'</span><span class="token punctuation">;</span><span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>      title<span class="token punctuation">:</span> <span class="token string">'Flutter Challenge YouTube'</span><span class="token punctuation">,</span>      theme<span class="token punctuation">:</span> <span class="token function">ThemeData</span><span class="token punctuation">(</span>        primarySwatch<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      home<span class="token punctuation">:</span> <span class="token function">MyHomePage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">MyHomePage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _MyHomePageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_MyHomePageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">&gt;</span> <span class="token keyword">with</span> TickerProviderStateMixin <span class="token punctuation">{</span>  <span class="token keyword">var</span> videos <span class="token operator">=</span> <span class="token punctuation">[</span>    <span class="token function">VideoItemModel</span><span class="token punctuation">(</span>        <span class="token string">"Gordon Ramsay Cooked For Vladimir Putin"</span><span class="token punctuation">,</span>        <span class="token string">"The Late Show with Stephen Colbert\n1.1M views.2 weeks ago"</span><span class="token punctuation">,</span>        <span class="token string">"assets/images/youtube/youtube_one.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">VideoItemModel</span><span class="token punctuation">(</span>        <span class="token string">"Hailee Steinfeld, Alesso - Let Me Go"</span><span class="token punctuation">,</span>        <span class="token string">"Hailee Steinfeld\n57M views.8 months ago"</span><span class="token punctuation">,</span>        <span class="token string">"assets/images/youtube/youtube_two.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">VideoItemModel</span><span class="token punctuation">(</span>        <span class="token string">"Charlie Puth - Look At Me Now"</span><span class="token punctuation">,</span>        <span class="token string">"Lyricwood\n4.7M views.4 months ago"</span><span class="token punctuation">,</span>        <span class="token string">"assets/images/youtube/youtube_three.jpg"</span><span class="token punctuation">)</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> currentAlignment <span class="token operator">=</span> Alignment<span class="token punctuation">.</span>topCenter<span class="token punctuation">;</span>  <span class="token keyword">var</span> minVideoHeight <span class="token operator">=</span> <span class="token number">100.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> minVideoWidth <span class="token operator">=</span> <span class="token number">150.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> maxVideoHeight <span class="token operator">=</span> <span class="token number">200.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> maxVideoWidth <span class="token operator">=</span> <span class="token number">250.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> currentVideoHeight <span class="token operator">=</span> <span class="token number">200.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> currentVideoWidth <span class="token operator">=</span> <span class="token number">200.0</span><span class="token punctuation">;</span>  bool isInSmallMode <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> videoIndexSelected <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>  AnimationController alignmentAnimationController<span class="token punctuation">;</span>  Animation alignmentAnimation<span class="token punctuation">;</span>  AnimationController videoViewController<span class="token punctuation">;</span>  Animation videoViewAnimation<span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    alignmentAnimationController <span class="token operator">=</span>        <span class="token function">AnimationController</span><span class="token punctuation">(</span>vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              currentAlignment <span class="token operator">=</span> alignmentAnimation<span class="token punctuation">.</span>value<span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    alignmentAnimation <span class="token operator">=</span>        <span class="token function">AlignmentTween</span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>topCenter<span class="token punctuation">,</span> end<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>bottomRight<span class="token punctuation">)</span>            <span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token function">CurvedAnimation</span><span class="token punctuation">(</span>                parent<span class="token punctuation">:</span> alignmentAnimationController<span class="token punctuation">,</span>                curve<span class="token punctuation">:</span> Curves<span class="token punctuation">.</span>fastOutSlowIn<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    videoViewController <span class="token operator">=</span>        <span class="token function">AnimationController</span><span class="token punctuation">(</span>vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>          <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              currentVideoWidth <span class="token operator">=</span> <span class="token punctuation">(</span>maxVideoWidth <span class="token operator">*</span> videoViewAnimation<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">+</span>                  <span class="token punctuation">(</span>minVideoHeight <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> videoViewAnimation<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              currentVideoHeight <span class="token operator">=</span> <span class="token punctuation">(</span>maxVideoHeight <span class="token operator">*</span> videoViewAnimation<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">+</span>                  <span class="token punctuation">(</span>minVideoHeight <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">1.0</span> <span class="token operator">-</span> videoViewAnimation<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    videoViewAnimation <span class="token operator">=</span>        Tween<span class="token operator">&lt;</span>double<span class="token operator">&gt;</span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>videoViewController<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>        title<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>          mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Icon</span><span class="token punctuation">(</span>              FontAwesomeIcons<span class="token punctuation">.</span>youtube<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                <span class="token string">'YouTube'</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>                  letterSpacing<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1.0</span><span class="token punctuation">,</span>                  fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w700<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        actions<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>videocam<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span>children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>        <span class="token function">Center</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>            itemCount<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>            itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span>                onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    videoIndexSelected <span class="token operator">=</span> position<span class="token punctuation">;</span>                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                  children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                    <span class="token function">Row</span><span class="token punctuation">(</span>                      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                        <span class="token function">Expanded</span><span class="token punctuation">(</span>                          child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>                            videos<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>imagePath<span class="token punctuation">,</span>                            fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span>                      <span class="token punctuation">]</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Padding</span><span class="token punctuation">(</span>                      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                          <span class="token function">Expanded</span><span class="token punctuation">(</span>                            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                              Icons<span class="token punctuation">.</span>account_circle<span class="token punctuation">,</span>                              size<span class="token punctuation">:</span> <span class="token number">40.0</span><span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Expanded</span><span class="token punctuation">(</span>                            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                                <span class="token function">Padding</span><span class="token punctuation">(</span>                                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>bottom<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                                    videos<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span>                                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token function">Text</span><span class="token punctuation">(</span>                                  videos<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">.</span>publisher<span class="token punctuation">,</span>                                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token punctuation">)</span><span class="token punctuation">,</span>                              <span class="token punctuation">]</span><span class="token punctuation">,</span>                              crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            flex<span class="token punctuation">:</span> <span class="token number">9</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token function">Expanded</span><span class="token punctuation">(</span>                            flex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>more_vert<span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">]</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span>                  <span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        videoIndexSelected <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span>            <span class="token operator">?</span> <span class="token function">LayoutBuilder</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> constraints<span class="token punctuation">)</span> <span class="token punctuation">{</span>                maxVideoWidth <span class="token operator">=</span> constraints<span class="token punctuation">.</span>biggest<span class="token punctuation">.</span>width<span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isInSmallMode<span class="token punctuation">)</span> <span class="token punctuation">{</span>                  currentVideoWidth <span class="token operator">=</span> maxVideoWidth<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">return</span> <span class="token function">Column</span><span class="token punctuation">(</span>                  crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>end<span class="token punctuation">,</span>                  children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                    <span class="token function">Expanded</span><span class="token punctuation">(</span>                      child<span class="token punctuation">:</span> <span class="token function">Align</span><span class="token punctuation">(</span>                        child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                          padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>isInSmallMode <span class="token operator">?</span> <span class="token number">8.0</span> <span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                          child<span class="token punctuation">:</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span>                            child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                              width<span class="token punctuation">:</span> currentVideoWidth<span class="token punctuation">,</span>                              height<span class="token punctuation">:</span> currentVideoHeight<span class="token punctuation">,</span>                              child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span>                                videos<span class="token punctuation">[</span>videoIndexSelected<span class="token punctuation">]</span><span class="token punctuation">.</span>imagePath<span class="token punctuation">,</span>                                fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                            onVerticalDragEnd<span class="token punctuation">:</span> <span class="token punctuation">(</span>details<span class="token punctuation">)</span> <span class="token punctuation">{</span>                              <span class="token keyword">if</span> <span class="token punctuation">(</span>details<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>pixelsPerSecond<span class="token punctuation">.</span>dy <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                  isInSmallMode <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                                  alignmentAnimationController<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                  videoViewController<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>details<span class="token punctuation">.</span>velocity<span class="token punctuation">.</span>pixelsPerSecond<span class="token punctuation">.</span>dy <span class="token operator">&lt;</span>                                  <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                  alignmentAnimationController<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                  videoViewController<span class="token punctuation">.</span><span class="token function">reverse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                                      isInSmallMode <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                              <span class="token punctuation">}</span>                            <span class="token punctuation">}</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                        alignment<span class="token punctuation">:</span> currentAlignment<span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                      flex<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                    currentAlignment <span class="token operator">==</span> Alignment<span class="token punctuation">.</span>topCenter                        <span class="token operator">?</span> <span class="token function">Expanded</span><span class="token punctuation">(</span>                            flex<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>                            child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                              child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                                  <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token function">Padding</span><span class="token punctuation">(</span>                                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                    child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>                                      child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                                        padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Video Recommendation'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token function">Padding</span><span class="token punctuation">(</span>                                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                    child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>                                      child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                                        padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Video Recommendation'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token function">Padding</span><span class="token punctuation">(</span>                                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                    child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>                                      child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                                        padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Video Recommendation'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                                <span class="token punctuation">]</span><span class="token punctuation">,</span>                              <span class="token punctuation">)</span><span class="token punctuation">,</span>                              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                            <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span>                        <span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token function">Row</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">]</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">)</span>            <span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      bottomNavigationBar<span class="token punctuation">:</span> <span class="token function">BottomNavigationBar</span><span class="token punctuation">(</span>        items<span class="token punctuation">:</span> <span class="token punctuation">[</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>home<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Home"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              FontAwesomeIcons<span class="token punctuation">.</span>fire<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Trending"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>subscriptions<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Subscriptions"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>email<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Inbox"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">BottomNavigationBarItem</span><span class="token punctuation">(</span>            icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>folder<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">"Library"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black54<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>        type<span class="token punctuation">:</span> BottomNavigationBarType<span class="token punctuation">.</span>fixed<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> YouTube </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>The Flutter Series:Basic Widgets and Layout</title>
      <link href="/2022/01/28/the_flutter_series_basic_widgets_and_layout/"/>
      <url>/2022/01/28/the_flutter_series_basic_widgets_and_layout/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Layouts-in-Flutter"><a href="#Layouts-in-Flutter" class="headerlink" title="Layouts in Flutter"></a>Layouts in Flutter</h3><p>Layouts in Flutter consist of a hierarchy of widgets with the outer widgets usually deal with aligment and structure whereas the inner elements are usually the visible elements on the page itself,like buttons and images,etc.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Center</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>   mainAxisAlignment<span class="token punctuation">:</span>MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>   children<span class="token punctuation">:</span><span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>    <span class="token function">Text</span><span class="token punctuation">(</span>    <span class="token string">'You have pushed the button this many times:'</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">Text</span><span class="token punctuation">(</span>    <span class="token string">'$_counter'</span><span class="token punctuation">,</span>    style<span class="token punctuation">:</span>Theme<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>textTheme<span class="token punctuation">.</span>display1<span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token punctuation">]</span>  <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>In this example,there are three widgets:<strong>Center,Column</strong> and <strong>Text.</strong></p><p>The <strong>Center</strong> and <strong>Column</strong> deal with structuring and aligning the elements inside them whereas the <strong>Text</strong> is the only directly visible element in the app for a user.</p><p>A widget usually has properties for changing alignment,styles and attributes.</p><p>Let us now dive into individual widgets and see what they do.</p><p>We will split widgets into two rough categories:</p><ol><li><strong>Visible Element Widgets</strong></li><li><strong>Structuring and Alignment Widgets</strong></li></ol><h3 id="Visible-Element-Widgets"><a href="#Visible-Element-Widgets" class="headerlink" title="Visible Element Widgets"></a>Visible Element Widgets</h3><p>These are a few commonly used Widgets</p><ol><li><strong>Text</strong></li></ol><p>A Text widget simply holds some text.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Text</span><span class="token punctuation">(</span>  <span class="token string">'Hello World!'</span><span class="token punctuation">,</span>  textAlign<span class="token punctuation">:</span> TextAlign<span class="token punctuation">.</span>center<span class="token punctuation">,</span>  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The text can be aligned using the <em>textAlign</em> property.The style property allows customisation of the text including font,font size,font weight,color,letter spacing and a whole lot more.</p><ol start="2"><li><strong>Button</strong></li></ol><p>A Button widget allows a user to perform some action on click.Flutter does not have a direct “Button” widget,instead,it has types of button like a FlatButton and a RaiseButton.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">FlatButton</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Click here'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> onPressed<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// Do something here</span> <span class="token punctuation">}</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The FlatButton does not stand out from the surrounding:</p><p><img src="https://s2.loli.net/2022/01/28/Ye9PM3WQCB8OELl.png" alt="FlatButton"></p><p>The onPressed property allows some action to be performed when the button is clicked.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"> <span class="token function">RaisedButton</span><span class="token punctuation">(</span>  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Click here'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  elevation<span class="token punctuation">:</span> <span class="token number">5.0</span><span class="token punctuation">,</span>  onPressed<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token comment">//Do something here</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The RasiedButton is raised from the environment:</p><p><img src="https://s2.loli.net/2022/01/28/Vx8W6hfQ9M3nqoP.png" alt="RasiedButton"></p><p>Changing the elevation of the RasiedButton changes how much it stands out.</p><ol start="3"><li><strong>Image</strong></li></ol><p>The Image widget holds an image and can fetch it from multiple sources like assets or even directly from a URL.In normal native Android this would have required a secondary library like Picasso.</p><ol start="4"><li><strong>Icon</strong></li></ol><p>The icon widget is a container for an icon in Flutter.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Icon</span><span class="token punctuation">(</span> Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span> size<span class="token punctuation">:</span><span class="token number">36.0</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>It also contains a size attribute to enlarge the icon.</p><p><img src="https://s2.loli.net/2022/01/28/Gp2RCrBkdJ9eFuf.png" alt="icon"></p><h3 id="Structuring-and-Alignment-Widgets"><a href="#Structuring-and-Alignment-Widgets" class="headerlink" title="Structuring and Alignment Widgets"></a>Structuring and Alignment Widgets</h3><ol><li><strong>Column</strong></li></ol><p>A Column is a widget which arranges all its children widgets in a vertical stack. It can space the widgets according to the <strong>mainAxisAlignment</strong> and <strong>crossAxisAlignment</strong> property.Here the “main axis” is the vertical axis and the “cross axis” is the horizontal axis.</p><p>Lets construct a column of 3 text widget.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Column</span><span class="token punctuation">(</span> mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span> chilren<span class="token punctuation">:</span><span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The column has 3 text widgets inside it and the mainAxisAlignment is set to ‘center’.</p><p>This is how it looks like:</p><p><img src="https://s2.loli.net/2022/01/28/JrO7DMRd1jKaoPV.png" alt="center"></p><p>Because of the mainAxisAlignment being center,it centers all the widgets.<br>Let’s try something else.Let’s set mainAxisAlignment to spaceBetween.</p><p><img src="https://s2.loli.net/2022/01/28/DQeMIa5ngqVCYZm.png" alt="spaceBetween"></p><p>Now they’re too far apart,let’s try spaceEvenly.</p><p><img src="https://s2.loli.net/2022/01/28/3iVoZbQPkBf51jx.png" alt="spaceEvenly"></p><p>To space it in between the left and right sides of the screen,you have to use <strong>crossAxisAlignment</strong>.</p><ol start="2"><li><strong>Row</strong></li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Row</span><span class="token punctuation">(</span> mainAxisAlignment<span class="token punctuation">:</span>MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>A Row is the same as a column but constructs a horizontal row of widgets rather than a column.The main difference here is the main axis is the horizontal axis rather than the vertical one. The cross axis is the veritcal axis.</p><p><img src="https://s2.loli.net/2022/01/28/vi8PXchljEWRbNd.png" alt="Row"></p><ol start="3"><li><strong>Center</strong></li></ol><p>A Center widget simply centers the child inside it.All the previous examples included rows and columns that were inside a center widget. If the column was not inside a center widget,it would shift to the left.Here’s an example:</p><p>Column without a center widget:</p><p><img src="https://s2.loli.net/2022/01/28/qdQ9ebl6OcGgCL5.png" alt="Column without a center widget"></p><p>Column with a center widget:</p><p><img src="https://s2.loli.net/2022/01/28/3iVoZbQPkBf51jx.png" alt="Column with a center widget"></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Center</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>  mainAxisAlignment<span class="token punctuation">:</span>MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>  children<span class="token punctuation">:</span><span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>   <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>A Center widget simply takes a child and centers it in the available space it is in.</p><ol start="4"><li><strong>Padding</strong></li></ol><p>Unlike in normal Android development wehere every view has its own padding attribute, padding is a widget that wraps other widgets to give them padding in all or specified directions.</p><p>This gives the text widget a padding of 8.0 in all directions.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Padding</span><span class="token punctuation">(</span> padding<span class="token punctuation">:</span><span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Padding in specific directions is also allowed.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Padding</span><span class="token punctuation">(</span> padding<span class="token punctuation">:</span><span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">,</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> child<span class="token punctuation">:</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Element 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li><strong>Scaffold</strong></li></ol><p>A Scaffold Widget provides a framework for adding common material design elements such as <strong>AppBar,Drawer,Floating Action Buttons,Bottom Navigation,etc.</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Scaffold</span><span class="token punctuation">(</span> appBar<span class="token punctuation">:</span><span class="token function">AppBar</span><span class="token punctuation">(</span>  title<span class="token punctuation">:</span><span class="token function">Text</span><span class="token punctuation">(</span>widget<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> body<span class="token punctuation">:</span><span class="token function">Center</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> floatingActionButton<span class="token punctuation">:</span><span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>  child<span class="token punctuation">:</span><span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">,</span>  onPressed<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Adding material elements becomes easier using a Scaffold.</p><p><img src="https://s2.loli.net/2022/01/28/Cw7YEGZf4MThVxl.png" alt="Scaffold"></p><ol start="6"><li><strong>Stack</strong></li></ol><p>A Stack is used to overlap widgets,like a button on a background gradient. A Stack is a very important widget.</p><p>These are the basic widgets required to make a decent functioning app in Flutter.Flutter also allows you to make your own widgets if you need any other functionality added or if you want to reuse some repeating widget pattern.</p><p>For the complete list of Flutter widgets,visit <a href="https://flutter.dev/docs/development/ui/widgets">this link.</a></p>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Basic Widgets </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Deep Dive Into Inbuilt Animation in Flutter</title>
      <link href="/2022/01/28/a_deep_dive_into_inbuilt_animation_in_flutter/"/>
      <url>/2022/01/28/a_deep_dive_into_inbuilt_animation_in_flutter/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Implicitly-Animated-Widgets-in-Flutter"><a href="#Implicitly-Animated-Widgets-in-Flutter" class="headerlink" title="Implicitly Animated Widgets in Flutter"></a>Implicitly Animated Widgets in Flutter</h3><p>Animations are quite easy to do in Flutter and a lot of complexity can be achieved with a lot of less effort than native Android.This is usually achieved through ways like defining an <strong>Animation</strong> + an <strong>AnimationController</strong>.But there are <strong>inbuilt widgets</strong> which even reduce this and make animations as easy as <strong>simply changing values!</strong></p><h3 id="AnimatedContainer"><a href="#AnimatedContainer" class="headerlink" title="AnimatedContainer"></a>AnimatedContainer</h3><p><img src="https://s2.loli.net/2022/01/28/c92uStq6mHPlR5o.gif" alt="animated container"></p><p>An AnimatedContainer automatically transitions to the values defined(colors,size etc.)instead of just instantaneously changing to them.The GIF given above is an example of an AnimatedContainer.</p><p>The code will be:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> myColor <span class="token operator">=</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">;</span>  <span class="token keyword">var</span> myHeight <span class="token operator">=</span> <span class="token number">150.0</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> myWidth <span class="token operator">=</span> <span class="token number">150.0</span><span class="token punctuation">;</span>  bool isShrine <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>      child<span class="token punctuation">:</span> <span class="token function">AnimatedContainer</span><span class="token punctuation">(</span>        duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span>            <span class="token function">ButtonBar</span><span class="token punctuation">(</span>alignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">RaisedButton</span><span class="token punctuation">(</span>            elevation<span class="token punctuation">:</span> <span class="token number">5.0</span><span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>              <span class="token string">'Animate!'</span><span class="token punctuation">,</span>              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                  fontSize<span class="token punctuation">:</span> <span class="token number">15.0</span><span class="token punctuation">,</span>                  fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isShrine<span class="token punctuation">)</span> <span class="token punctuation">{</span>                myColor <span class="token operator">=</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">;</span>                myHeight <span class="token operator">=</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">;</span>                myWidth <span class="token operator">=</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">;</span>              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                myColor <span class="token operator">=</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">;</span>                myHeight <span class="token operator">=</span> <span class="token number">150.0</span><span class="token punctuation">;</span>                myWidth <span class="token operator">=</span> <span class="token number">150.0</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>              isShrine <span class="token operator">=</span> <span class="token operator">!</span>isShrine<span class="token punctuation">;</span>              <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        color<span class="token punctuation">:</span> myColor<span class="token punctuation">,</span>        height<span class="token punctuation">:</span> myHeight<span class="token punctuation">,</span>        width<span class="token punctuation">:</span> myWidth<span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>In normal cases,you would define a controller and a <strong>Tween</strong> and a <strong>ColorTween</strong> to achieve the animation in the GIF above. But with <strong>AnimatedContainer</strong>,all you have to do is:</p><ol><li><strong>Set a duration for the animation</strong></li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li><strong>Change values (Change color and size to your values)</strong></li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">myColor <span class="token operator">=</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">;</span>myHeight <span class="token operator">=</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">;</span>myWidth <span class="token operator">=</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="3"><li><strong>setState()</strong></li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>No controller.No Tweens</strong></p><p>The moment you change the values of myColor,myHeight,myWidth and setState(),the container <strong>automatically transitions to the values</strong> instead of <strong>changing directly to that value.</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">onPressed<span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> myColor <span class="token operator">=</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">;</span> myHeight <span class="token operator">=</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">;</span> myWidth <span class="token operator">=</span> MediaQuery<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>At the beginning,myColor was set Colors.blue.When we change it to Colors.green and setState to rebuild it,it transitions from blue to green without any Tweens used.(<strong>Note:Tweens are used implicitly but do not need to be user defined.</strong>)</p><p>From what I’ve seen,a lot of developers don’t seem to be aware of these implicitly animated widgets and waste time when it’s not necessary. Obviously there will be cases where you might want a different kind of behaviour,but<br>most times,AnimatedContainer does the job.</p><h3 id="Hero-Animations"><a href="#Hero-Animations" class="headerlink" title="Hero Animations"></a>Hero Animations</h3><p><img src="https://s2.loli.net/2022/01/28/BUhAtDWfa54dQei.gif" alt="Hero Animations"></p><p>A Hero animation makes an element from one page “fly” to the second and automatically adjust to the size of the same element on the second page.This makes something like a list in an app which has a detail page that much more interesting.</p><p>Flutter makes it incredibly easy to implement Hero Animation.All you have to do is <strong>wrap the element you want to make a ‘Hero’ with a Hero widget and supplu to it a tag.</strong><br>If you want to do this in a list,you need to supply a different tag for each element, which I just usually set to “hero” + position of element in the list.</p><p>The code will be:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Padding</span><span class="token punctuation">(</span>            padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">InkWell</span><span class="token punctuation">(</span>                onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  Navigator<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>                      context<span class="token punctuation">,</span>                      <span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span>                          builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">HeroDetailPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>                splashColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>                    children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                      <span class="token function">Expanded</span><span class="token punctuation">(</span>                        child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>                          tag<span class="token punctuation">:</span> <span class="token string">'heroTag'</span><span class="token punctuation">,</span>                          child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>                            height<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>                          <span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token function">Expanded</span><span class="token punctuation">(</span>                        child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                          child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Red'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span>                    <span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">HeroDetailPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      body<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Expanded</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>              tag<span class="token punctuation">:</span> <span class="token string">'heroTag'</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Expanded</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>              <span class="token string">'This is the color red.'</span><span class="token punctuation">,</span>              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">30.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>That’s it!</p><p>The colored container automatically files and expands to the latter’s size.</p><h3 id="AnimatedCrossFade"><a href="#AnimatedCrossFade" class="headerlink" title="AnimatedCrossFade"></a>AnimatedCrossFade</h3><p><img src="https://s2.loli.net/2022/01/28/zq6O2vwoPE7cpG4.gif" alt="AnimatedCrossFade"></p><p>A CrossFade is a <strong>smooth transition from one widget to another</strong> with a given duration.Flutter makes this easy using a AnimatedCrossFade widget.</p><p>This is how an AnimatedCrossFade is defined:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">AnimatedCrossFade</span><span class="token punctuation">(</span> firstChild<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>Your first element here<span class="token punctuation">,</span> secondChild<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>Element after transition<span class="token punctuation">,</span> crossFadeState<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>State of the transition<span class="token punctuation">,</span> duration<span class="token punctuation">:</span><span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>We supply:</p><ol><li><strong>The widget before transition</strong></li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">firstChild<span class="token punctuation">:</span><span class="token function">Container</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span><span class="token function">Padding</span><span class="token punctuation">(</span>  padding<span class="token punctuation">:</span><span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  child<span class="token punctuation">:</span><span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span><span class="token number">200.0</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span><span class="token number">200.0</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li><strong>The widget after transition</strong></li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">secondChild<span class="token punctuation">:</span><span class="token function">Container</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span><span class="token function">Padding</span><span class="token punctuation">(</span>  padding<span class="token punctuation">:</span><span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  child<span class="token punctuation">:</span><span class="token function">FlutterLogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span><span class="token number">100.0</span><span class="token punctuation">,</span> width<span class="token punctuation">:</span><span class="token number">200.0</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li><strong>The state of transition (If the transition has happened already or not)</strong></li></ol><p>(Here,firstStateEnabled is a boolean we can change to change the state.)</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">crossFadeState<span class="token punctuation">:</span>firstStateEnabled<span class="token operator">?</span>CrossFadeState<span class="token punctuation">.</span>showFirst<span class="token punctuation">:</span>CrossFadeState<span class="token punctuation">.</span>showSecond<span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="4"><li><strong>The duration of the transition</strong></li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">duration<span class="token punctuation">:</span><span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>This amount of code is enough to give us the above example.The transition is simply triggered by changing the crossFadeState.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> firstStateEnabled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>          mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">AnimatedCrossFade</span><span class="token punctuation">(</span>              firstChild<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>                width<span class="token punctuation">:</span> <span class="token number">200.0</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              secondChild<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                  padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">FlutterLogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                height<span class="token punctuation">:</span> <span class="token number">200.0</span><span class="token punctuation">,</span>                width<span class="token punctuation">:</span> <span class="token number">200.0</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              crossFadeState<span class="token punctuation">:</span> firstStateEnabled                  <span class="token operator">?</span> CrossFadeState<span class="token punctuation">.</span>showFirst                  <span class="token punctuation">:</span> CrossFadeState<span class="token punctuation">.</span>showSecond<span class="token punctuation">,</span>              duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>milliseconds<span class="token punctuation">:</span> <span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">32.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">RaisedButton</span><span class="token punctuation">(</span>                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                  <span class="token string">'Trigger crossfade'</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                    fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span>                    fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    firstStateEnabled <span class="token operator">=</span> <span class="token operator">!</span>firstStateEnabled<span class="token punctuation">;</span>                  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Note:If the two children are of different sizes then it automatically transitions from one size to the other.</strong></p><p><img src="https://s2.loli.net/2022/01/28/t5rB9cU2ZhQnz8p.gif" alt="AnimatedCrossFade"></p><h3 id="AnimatedOpacity"><a href="#AnimatedOpacity" class="headerlink" title="AnimatedOpacity"></a>AnimatedOpacity</h3><p><img src="https://s2.loli.net/2022/01/28/gXuJyKpZEU4dbtO.gif" alt="AnimatedOpacity"></p><p>AnimatedOpacity animates changes in opacity,i.e. how visible a widget is.An Opacity of 0 makes a widget completely transparent,while a 1 opacity is fully visible.</p><p>AnimatedOpacity is declared as:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">AnimatedOpacity</span><span class="token punctuation">(</span> opacity<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>Your variable holding opacity value<span class="token punctuation">,</span> duration<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>Duration of the transition<span class="token punctuation">,</span> child<span class="token punctuation">:</span><span class="token function">FlutterLogo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Staying similar to the last few widgets,in AnimatedOpacity,you change the opacity and setState and it <strong>automatically animates the opacity change.</strong></p><p>In the above example,it is declared as:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">AnimatedOpacity</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span><span class="token function">FlutterLogo</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span><span class="token number">100.0</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> opacity<span class="token punctuation">:</span>myOpacity<span class="token punctuation">,</span> duration<span class="token punctuation">:</span><span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>When the button is clicked,it simply changes opacity and sets state.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">onPressed</span><span class="token punctuation">(</span> myOpacity <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>The above example’s code is here:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">var</span> myOpacity <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>          mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Padding</span><span class="token punctuation">(</span>              padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">AnimatedOpacity</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">FlutterLogo</span><span class="token punctuation">(</span>                  size<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                opacity<span class="token punctuation">:</span> myOpacity<span class="token punctuation">,</span>                duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">RaisedButton</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                <span class="token string">'Click here to change opacity'</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                  fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span>                  fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                myOpacity <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>                <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Animation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Deep Dive Into Stack and IndexedStack in Flutter</title>
      <link href="/2022/01/28/a_deep_dive_into_stack_and_indexedstack_in_flutter/"/>
      <url>/2022/01/28/a_deep_dive_into_stack_and_indexedstack_in_flutter/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>A <strong>Stack</strong> widget allows us to make multiple widgets overlay each other.This not only allows brilliant custom designs but also some really cool animations.</p><p>There are two main types of Stacks:</p><ol><li><strong>Stack</strong></li><li><strong>IndexedStack</strong></li></ol><p>Let’s explore the use of Stacks.</p><h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><p>The Stack widget allows us to put up multiple layers of widgets onto the screen.</p><p>The widget takes multiple children and orders them from bottom to top.So the first item is the bottommost and the last is the topmost.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Stack</span><span class="token punctuation">(</span> children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>  <span class="token function">BottomWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">MiddleWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">TopWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>A visual representation of the layers of the Stack:</p><p>This size of the <em>Stack</em> is the size of the largest member in the layar,So if the bottom layer covers the complete screen then the size of the <em>Stack</em> is the complete screen.</p><p>Each member in the stack needs to be positioned or aligned,or else it ends up in the top left corner bu default.</p><p>As an example,let’s take three containers of shrinking size:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>              height<span class="token punctuation">:</span> <span class="token number">300.0</span><span class="token punctuation">,</span>              width<span class="token punctuation">:</span> <span class="token number">300.0</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>              height<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>              width<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This gives us:</p><p><img src="https://s2.loli.net/2022/01/28/QdJ37lO2R6ot5MZ.png" alt="stack_layout_default"></p><p>If you notice,the containers which are smaller have a lot more area to go to and hence default to top left.To change this,you can align or position your widget using the <strong>Align</strong> or <strong>Positioned</strong> widget.</p><p>An <strong>Align</strong> widget usually takes widget to extreme positions.So for example,if we enter top-right,we need to add extra padding to keep it neat and tidy. A <strong>Positioned</strong> widget combines these two things and lets us keep one <strong>Postioned</strong> widget instead of an <strong>Align</strong> and <strong>Padding</strong>.We will see how in a while.</p><p>We’ll alter our example to use <strong>Align</strong> and <strong>Postitioned</strong>.Let’s simply wrap our containers in an <strong>Align</strong> and then a <strong>Positioned</strong> widget.</p><p><strong>Note:</strong> <strong>Positioned</strong> has to be a child of a <strong>Stack</strong>.There cannot be another widget in between the stack and the widget.</p><p>To simply align a widget:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Align</span><span class="token punctuation">(</span> alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>topRight<span class="token punctuation">,</span> child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>  height<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>  width<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here we align it to the top right.Usually,this isn’t what we actually want since we need some padding to the container from the edges.We can either use padding with <strong>Align</strong> or <strong>Positioned</strong> for more fine-grained control.</p><p><strong>Positioned</strong> has multiple types,we’ll focus on the default. It accepts values from all four sides telling the child how far it should be away from that respective side.If no values is given,it shrinks to the lowest possible<br>size.</p><p>Here,we give a value to the top and right.In effect,what this means is that the child will be 40.0 away from top and right and no other constraints on the other sides.Hence,it is also aligned to the top and right sides by definition.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Positioned</span><span class="token punctuation">(</span>             right<span class="token punctuation">:</span> <span class="token number">40.0</span><span class="token punctuation">,</span>             top<span class="token punctuation">:</span> <span class="token number">40.0</span><span class="token punctuation">,</span>             child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>               color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>               height<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>               width<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>             <span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This gives us:</p><p>Hence,<strong>Positioned</strong> is a better widget to use in a <strong>Stack</strong> than <strong>Align + Padding</strong> but there’s no real harm in either. There are also other types of <strong>Positioned</strong>.A few of them are:</p><h4 id="Positioned-fill"><a href="#Positioned-fill" class="headerlink" title="Positioned.fill()"></a>Positioned.fill()</h4><p>Sets top,right,bottom,left to 0.0 by default unless override. Hence,it fills the screen by default since distance from all four sides is 0.0.</p><h4 id="Positioned-formRect"><a href="#Positioned-formRect" class="headerlink" title="Positioned.formRect()"></a>Positioned.formRect()</h4><p>Creates a Positioned object from a given Rect.</p><p>Before we move on to creating somthing with <strong>Stack</strong>,let’s take a look at the second type.</p><h3 id="IndexedStack"><a href="#IndexedStack" class="headerlink" title="IndexedStack"></a>IndexedStack</h3><p>An <strong>IndexedStack</strong> is a stack where only one element is displyed at one time by its index.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">IndexedStack</span><span class="token punctuation">(</span> index<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>  <span class="token function">BottomWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">MidWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">TopWidget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>It takes children like a usual <strong>Stack</strong> but in contrast to it,only displays one child at one time.In away,it’s not a stack and more of a way to easily switch between children when you need to.</p><p>Let’s see an example:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">IndexedStack</span><span class="token punctuation">(</span>          index<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Container</span><span class="token punctuation">(</span>              alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>bottomLeft<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>              height<span class="token punctuation">:</span> <span class="token number">300.0</span><span class="token punctuation">,</span>              width<span class="token punctuation">:</span> <span class="token number">300.0</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>              height<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>              width<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>When we wrap the same elements with <strong>IndexedStack</strong> and give it the <strong>index</strong> 0,it shows the bottommost child.</p><p>The upper two children are not shown as the <strong>index</strong> is 0.</p><p><strong>Note:</strong> The size is still the size of the largest element.</p><p><strong>IndexedStack</strong> also directly takes an <strong>alignment</strong> parameter and aligns all children accordingly.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">IndexedStack</span><span class="token punctuation">(</span>          index<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Container</span><span class="token punctuation">(</span>              alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>bottomLeft<span class="token punctuation">,</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>              height<span class="token punctuation">:</span> <span class="token number">300.0</span><span class="token punctuation">,</span>              width<span class="token punctuation">:</span> <span class="token number">300.0</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>              height<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>              width<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>          alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>topRight<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Let’s-make-something-with-Stack"><a href="#Let’s-make-something-with-Stack" class="headerlink" title="Let’s make something with Stack"></a>Let’s make something with Stack</h3><p>This is a relatively straightforward example of where we can use a <strong>Stack</strong>. An image here is overlaid by a card which is positioned at the bottom center.</p><h4 id="Step-1-Add-a-Stack"><a href="#Step-1-Add-a-Stack" class="headerlink" title="Step 1) Add a Stack"></a>Step 1) Add a Stack</h4><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Stack</span><span class="token punctuation">(</span> children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Step-2-Add-a-background"><a href="#Step-2-Add-a-background" class="headerlink" title="Step 2) Add a background"></a>Step 2) Add a background</h4><p>Here,I’m simply using a container with an image inside it</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Container</span><span class="token punctuation">(</span> decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>  image<span class="token punctuation">:</span> <span class="token function">DecorationImage</span><span class="token punctuation">(</span>   image<span class="token punctuation">:</span> <span class="token function">AssetImage</span><span class="token punctuation">(</span><span class="token string">'images/new_york.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>   fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>fitHeight<span class="token punctuation">,</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Step-3-Add-a-card-on-top-with-the-details"><a href="#Step-3-Add-a-card-on-top-with-the-details" class="headerlink" title="Step 3) Add a card on top with the details"></a>Step 3) Add a card on top with the details</h4><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Card</span><span class="token punctuation">(</span>            elevation<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">,</span>            shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>              borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                <span class="token function">Padding</span><span class="token punctuation">(</span>                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'New York'</span><span class="token punctuation">,</span>                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span> fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token function">Padding</span><span class="token punctuation">(</span>                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                      <span class="token string">'Lorem Ipsum is simply dummy text of the printing and'</span>                      <span class="token string">"typesetting industry.Lorem Ipsum has been the industry's standard"</span>                      <span class="token string">'dummy text ever since the 1500s,when an unknown printer took a '</span>                      <span class="token string">'galley of type and scrambled it to make a type sspecimen book,'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span>              <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Step-4-Position-the-card-correctly"><a href="#Step-4-Position-the-card-correctly" class="headerlink" title="Step 4) Position the card correctly"></a>Step 4) Position the card correctly</h4><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Positioned</span><span class="token punctuation">(</span>            bottom<span class="token punctuation">:</span> <span class="token number">48.0</span><span class="token punctuation">,</span>            left<span class="token punctuation">:</span> <span class="token number">10.0</span><span class="token punctuation">,</span>            right<span class="token punctuation">:</span> <span class="token number">10.0</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>              elevation<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">,</span>              shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>                borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'New York'</span><span class="token punctuation">,</span>                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                            fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span> fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                        <span class="token string">'Lorem Ipsum is simply dummy text of the printing and'</span>                        <span class="token string">"typesetting industry.Lorem Ipsum has been the industry's standard"</span>                        <span class="token string">'dummy text ever since the 1500s,when an unknown printer took a '</span>                        <span class="token string">'galley of type and scrambled it to make a type sspecimen book,'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>And we’re done!</p><p>The final code is:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      body<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Container</span><span class="token punctuation">(</span>            decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>                image<span class="token punctuation">:</span> <span class="token function">DecorationImage</span><span class="token punctuation">(</span>                    image<span class="token punctuation">:</span> <span class="token function">AssetImage</span><span class="token punctuation">(</span><span class="token string">'assets/images/new_york.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>fitHeight<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Positioned</span><span class="token punctuation">(</span>            bottom<span class="token punctuation">:</span> <span class="token number">48.0</span><span class="token punctuation">,</span>            left<span class="token punctuation">:</span> <span class="token number">10.0</span><span class="token punctuation">,</span>            right<span class="token punctuation">:</span> <span class="token number">10.0</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>              elevation<span class="token punctuation">:</span> <span class="token number">8.0</span><span class="token punctuation">,</span>              shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>                borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'New York'</span><span class="token punctuation">,</span>                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                            fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span> fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                        <span class="token string">'Lorem Ipsum is simply dummy text of the printing and'</span>                        <span class="token string">"typesetting industry.Lorem Ipsum has been the industry's standard"</span>                        <span class="token string">'dummy text ever since the 1500s,when an unknown printer took a '</span>                        <span class="token string">'galley of type and scrambled it to make a type sspecimen book,'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Stack </tag>
            
            <tag> IndexedStack </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Deep Dive Into PageView In Flutter</title>
      <link href="/2022/01/28/a_deep_dive_into_pageview_in_flutter/"/>
      <url>/2022/01/28/a_deep_dive_into_pageview_in_flutter/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Exploring-PageViews"><a href="#Exploring-PageViews" class="headerlink" title="Exploring PageViews"></a>Exploring PageViews</h3><p>A <strong>PageView</strong> is a widget which generates <strong>scrollable</strong> pages on the screen.This can either be a fixed list of pages or a builder function which builds repeating pages.<strong>PageView</strong> acts similar to a <strong>ListView</strong> in the sense of constructing elements.</p><p>The types of PageView are:</p><ol><li><strong>PageView</strong></li><li><strong>PageView.builder</strong></li><li><strong>PageView.custom</strong></li></ol><h3 id="PageView-Default-constructor"><a href="#PageView-Default-constructor" class="headerlink" title="PageView (Default constructor)"></a>PageView (Default constructor)</h3><p>This type takes a fixed list of children (pages) and makes them scrollable.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">PageView</span><span class="token punctuation">(</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">Container</span><span class="token punctuation">(</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Page 1'</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                      fontSize<span class="token punctuation">:</span> <span class="token number">35.0</span><span class="token punctuation">,</span>                      fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Container</span><span class="token punctuation">(</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>cyan<span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Page 2'</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                      fontSize<span class="token punctuation">:</span> <span class="token number">35.0</span><span class="token punctuation">,</span>                      fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">Container</span><span class="token punctuation">(</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>deepPurple<span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Page 3'</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                      fontSize<span class="token punctuation">:</span> <span class="token number">35.0</span><span class="token punctuation">,</span>                      fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The above code produces the following result:</p><h3 id="PageView-builder"><a href="#PageView-builder" class="headerlink" title="PageView.builder"></a>PageView.builder</h3><p>This constructor takes a <strong>itemBuilder</strong> function and an <strong>itemCount</strong> similar to <strong>ListView.builder</strong>.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">PageView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span> itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span>position<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">_buildPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>_ <span class="token punctuation">}</span><span class="token punctuation">,</span> itemCount<span class="token punctuation">:</span> listItemCount<span class="token punctuation">,</span><span class="token comment">// Can be null</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Like a <em>ListView.builder</em>,this builds children on demand.</p><p>If the <em>itemCount</em> is set to null (not set),an infinited list of pages can be generated.</p><p><em>For example,this code:</em></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">PageView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span> itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span>position<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>   color<span class="token punctuation">:</span> position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token operator">?</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">:</span>Colors<span class="token punctuation">.</span>cyan<span class="token punctuation">,</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>Gives an infinite list of pages with alternating pink and cyan colors:</em></p><blockquote><p>Note:<em>PageView.custom</em> works the same way as <em>ListView.custom</em> (Disussed in earlier)<br>Deep Dive) and we will not be discussing it here.</p></blockquote><h3 id="Orientation"><a href="#Orientation" class="headerlink" title="Orientation"></a>Orientation</h3><p>All types of Page Views can have <strong>horizontal</strong> or <strong>vertically</strong> scrolling pages.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">PageView</span><span class="token punctuation">(</span> children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>  <span class="token comment">// Add children here</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> scrollDirection<span class="token punctuation">:</span> Axis<span class="token punctuation">.</span>vertical<span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The above code gives us:</p><h3 id="PageSnapping"><a href="#PageSnapping" class="headerlink" title="PageSnapping"></a>PageSnapping</h3><p>Page Snapping allows us to keep the page at intermediate values,This is done by switching off the <strong>pageSnapping</strong> attribute.In this case the page will not scroll to an integer position and behave like a normal <em>ListView</em>.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">PageView</span><span class="token punctuation">(</span> children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>  <span class="token comment">//Add children here</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> pageSnapping<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ScrollPhysics"><a href="#ScrollPhysics" class="headerlink" title="ScrollPhysics"></a>ScrollPhysics</h3><p>A <em>PageView</em> can have custom scrolling behavior in the same way as <em>ListViews</em>.<br>We will not repeat different types of <a href="https://api.flutter.dev/flutter/widgets/ScrollPhysics-class.html">ScrollPhysics</a> since it is discussed in the ListView Deep Dive.</p><p><em>ScrollPhysics</em> can be changed using the pyhsics parameter:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">PageView</span><span class="token punctuation">(</span> children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>  <span class="token comment">// Add children here</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> physics<span class="token punctuation">:</span> <span class="token function">BoundcingScrollPhysics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Controlling-a-PageView"><a href="#Controlling-a-PageView" class="headerlink" title="Controlling a PageView"></a>Controlling a PageView</h3><p>A PageView can be programmatically controlled by attaching a <strong>PageController</strong>.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token comment">// OutSide build method</span>PageController controller <span class="token operator">=</span> <span class="token function">PageController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// Inside builder method</span><span class="token function">PageView</span><span class="token punctuation">(</span> controller<span class="token punctuation">:</span> controller<span class="token punctuation">,</span> children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>  <span class="token comment">// Add children here</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The scroll position,current page,etc can be checked using the controller.</p><blockquote><p>**Note:**The <em>controller.currentPage</em> returns a double value.For example,when<br>the page is being swiped the value goes from 1 to 2 gradually and does not<br>instantly jump to 2.</p></blockquote><h3 id="Add-Custom-Transitions-to-PageViews"><a href="#Add-Custom-Transitions-to-PageViews" class="headerlink" title="Add Custom Transitions to PageViews"></a>Add Custom Transitions to PageViews</h3><p>Let’s discuss adding a few custom transition to the pages using <strong>Transform</strong> + <strong>PageView</strong>. This part will use the <strong>Transform</strong> widget extensively.</p><h4 id="Transition-1"><a href="#Transition-1" class="headerlink" title="Transition 1"></a>Transition 1</h4><p><strong>The setup</strong></p><p>We first use a basic <em>PageView.builder</em></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">PageView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span> controller<span class="token punctuation">:</span> controller<span class="token punctuation">,</span> itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span>position<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token punctuation">}</span><span class="token punctuation">,</span> itemCount<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Let’s have 10 items for now.</p><p>We use a <strong>PageController</strong> and a variable which holds the value of the <strong>currentPage</strong>.</p><p><strong>Defining the PageController and variables:</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">PageController controller <span class="token operator">=</span> <span class="token function">PageController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">var</span> currentPageValue <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>Updating the variable when the PageView is scrolled.</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">controller<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  currentPageValue <span class="token operator">=</span> controller<span class="token punctuation">.</span>page<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Finally,we construct the <strong>PageView</strong>.</p><p><strong>Now,let’s check for three conditions:</strong></p><ol><li>If the page is the page being swiped from</li><li>If the page is the page being swiped to</li><li>If the page is a page off screen</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  PageController controller <span class="token operator">=</span> <span class="token function">PageController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> currentPageValue <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    controller<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        currentPageValue <span class="token operator">=</span> controller<span class="token punctuation">.</span>page<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> PageView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>        controller<span class="token punctuation">:</span> controller<span class="token punctuation">,</span>        itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>            color<span class="token punctuation">:</span> position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                <span class="token string">"Page"</span><span class="token punctuation">,</span>                style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        itemCount<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Now we return the same page but wrapped in a <strong>Transform</strong> widget to transform our pages when we swipe it.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  PageController controller <span class="token operator">=</span> <span class="token function">PageController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> currentPageValue <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    controller<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        currentPageValue <span class="token operator">=</span> controller<span class="token punctuation">.</span>page<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> PageView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>        controller<span class="token punctuation">:</span> controller<span class="token punctuation">,</span>        itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> currentPageValue<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>              position <span class="token operator">==</span> currentPageValue<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Transform</span><span class="token punctuation">(</span>              transform<span class="token punctuation">:</span> Matrix4<span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">rotateX</span><span class="token punctuation">(</span>currentPageValue <span class="token operator">-</span> position<span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                color<span class="token punctuation">:</span> position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                    <span class="token string">"Page $position"</span><span class="token punctuation">,</span>                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                  <span class="token string">"Page $position"</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        itemCount<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here,we transform the page <strong>being swipe from</strong> and the <strong>page being swiped to</strong>.</p><p><strong>currentPageValue.floor()</strong> gives us the page on the left and<br><strong>currentPageValue.floor()+1</strong> gives us the page on the right</p><p>In this example,we rotate the page on the <strong>X</strong> direction as it is swiped by a value of <strong>currentPageValue</strong> minus the <strong>index</strong> in radiants.You can amplify the effect by multiplying this value.</p><p>We can tweak this transform and alignment of transform to give us multiple types<br>of new page transitions.</p><h4 id="Transition-2"><a href="#Transition-2" class="headerlink" title="Transition 2"></a>Transition 2</h4><p>Similar code structure,just with a different transformation:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  PageController controller <span class="token operator">=</span> <span class="token function">PageController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> currentPageValue <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    controller<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        currentPageValue <span class="token operator">=</span> controller<span class="token punctuation">.</span>page<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> PageView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>        controller<span class="token punctuation">:</span> controller<span class="token punctuation">,</span>        itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> currentPageValue<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>              position <span class="token operator">==</span> currentPageValue<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Transform</span><span class="token punctuation">(</span>              transform<span class="token punctuation">:</span> Matrix4<span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">rotateY</span><span class="token punctuation">(</span>currentPageValue <span class="token operator">-</span> position<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">rotateZ</span><span class="token punctuation">(</span>currentPageValue <span class="token operator">-</span> position<span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                color<span class="token punctuation">:</span> position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                    <span class="token string">"Page $position"</span><span class="token punctuation">,</span>                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                  <span class="token string">"Page $position"</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        itemCount<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here,we rotate around both <strong>Y</strong> and <strong>Z</strong> axes.</p><h4 id="Transition-3"><a href="#Transition-3" class="headerlink" title="Transition 3"></a>Transition 3</h4><p>This is a similar type of transition last time but with a 3-D effect added.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  PageController controller <span class="token operator">=</span> <span class="token function">PageController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> currentPageValue <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    controller<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        currentPageValue <span class="token operator">=</span> controller<span class="token punctuation">.</span>page<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> PageView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>        controller<span class="token punctuation">:</span> controller<span class="token punctuation">,</span>        itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> currentPageValue<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>              position <span class="token operator">==</span> currentPageValue<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Transform</span><span class="token punctuation">(</span>              transform<span class="token punctuation">:</span> Matrix4<span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">setEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.004</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">rotateY</span><span class="token punctuation">(</span>currentPageValue <span class="token operator">-</span> position<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">rotateZ</span><span class="token punctuation">(</span>currentPageValue <span class="token operator">-</span> position<span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                color<span class="token punctuation">:</span> position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                    <span class="token string">"Page $position"</span><span class="token punctuation">,</span>                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                  <span class="token string">"Page $position"</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        itemCount<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This line</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">setEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0.004</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>gives the pages a 3-D like effect.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  PageController controller <span class="token operator">=</span> <span class="token function">PageController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> currentPageValue <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    controller<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        currentPageValue <span class="token operator">=</span> controller<span class="token punctuation">.</span>page<span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> PageView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>        controller<span class="token punctuation">:</span> controller<span class="token punctuation">,</span>        itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> currentPageValue<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span>              position <span class="token operator">==</span> currentPageValue<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Transform</span><span class="token punctuation">(</span>              alignment<span class="token punctuation">:</span> Alignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>              transform<span class="token punctuation">:</span> Matrix4<span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">setEntry</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">rotateY</span><span class="token punctuation">(</span>currentPageValue <span class="token operator">-</span> position<span class="token punctuation">)</span>                <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">rotateZ</span><span class="token punctuation">(</span>currentPageValue <span class="token operator">-</span> position<span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                color<span class="token punctuation">:</span> position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                    <span class="token string">"Page $position"</span><span class="token punctuation">,</span>                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>              color<span class="token punctuation">:</span> position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">?</span> Colors<span class="token punctuation">.</span>blue <span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                  <span class="token string">"Page $position"</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        itemCount<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>You can get it,Only let Transform add <strong>alignment</strong> parameter and change the <strong>setEntry’s</strong> value.A lot types can be created by simply changing rotation angles,axes,alignments and translations.</p><h3 id="Demo-App-using-PageView"><a href="#Demo-App-using-PageView" class="headerlink" title="Demo App using PageView"></a>Demo App using PageView</h3><p>To demonstrate a simple app using <strong>PageView</strong> in Flutter,Somebody created an example app to study words for the GRE.This app displays and lets the user save the hardest words using SQLite to save them.It also has Text-To-Speech for pronouncing the word itself.</p><p>You can find this app <a href="https://github.com/deven98/FlutterGREWords">here</a>.</p>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PageView </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Deep Dive Into the Draggable&amp;DragTarget Widget in Flutter</title>
      <link href="/2022/01/28/a_deep_dive_into_the_draggable_in_flutter/"/>
      <url>/2022/01/28/a_deep_dive_into_the_draggable_in_flutter/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Exploring-Draggable-and-DragTargets"><a href="#Exploring-Draggable-and-DragTargets" class="headerlink" title="Exploring Draggable and DragTargets"></a>Exploring Draggable and DragTargets</h3><p><strong>Draggable</strong> and <strong>DragTarget</strong> allows us drag a widget across screen.First we<br>will look at the basics of <strong>Draggables</strong> and <strong>DragTargets</strong> then dive into details<br>of customizing them.</p><p><img src="https://s2.loli.net/2022/01/28/2HWGpLJr1hweUuE.gif" alt="dragger_demo"></p><h3 id="Draggable"><a href="#Draggable" class="headerlink" title="Draggable"></a>Draggable</h3><p>A “Draggable” makes a widget movable around the screen.Let’s use a chess<br>knight as our example.</p><p><img src="https://s2.loli.net/2022/01/28/wWzj6AnXlsY4agC.gif" alt="dragger_games"></p><p>The code for this is relatively straightforward:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Draggable</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span><span class="token function">WhiteKnight</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> feedback<span class="token punctuation">:</span><span class="token function">WhiteKnight</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> childWhenDragging<span class="token punctuation">:</span><span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>There are three main parts to the <strong>Draggable</strong> widget:</p><ol><li><strong>Child:</strong> The child parameter is the widget that will be displayed when the<br>draggable is stationary.</li><li><strong>Feedback:</strong> The feedback is the widget that will be displayed when the<br>widget is being dragged.</li><li><strong>Child When Dragging:</strong> The childWhenDragging parameter takes the widget<br><strong>to display in the original place of child</strong> when the widget is being dragged.</li></ol><p>In the example above,we have a white knight as the child.When the knight is being<br>dragged,we show an empty <em>Container</em> in its place.</p><h4 id="Let’s-customize-the-widget"><a href="#Let’s-customize-the-widget" class="headerlink" title="Let’s customize the widget"></a>Let’s customize the widget</h4><p>First,let’s change the <strong>feedback</strong> parameter.</p><p>In the example below,we change the feedback parameter to a white bishop. Now,when the widget is not being dragged,a white knight is shown however as you start dragging,our bishop is shown.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Draggable</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span><span class="token function">WhiteKnight</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> feedback<span class="token punctuation">:</span><span class="token function">WhiteBishop</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> childWhenDragging<span class="token punctuation">:</span><span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Result of the above code:<br><img src="https://s2.loli.net/2022/01/28/cU1vAyl2CGJBQYe.gif" alt="draggable_feedback"></p><p>Now let’s move on to the third parameter,<strong>childWhenDragging</strong>.This takes a widget to be displayed in the original position of child as the widget is being dragged.</p><p>We’ll display a white rook when the widget is being dragged:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Draggable</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span><span class="token function">WhiteKnight</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> feedback<span class="token punctuation">:</span><span class="token function">WhiteBishop</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> childWhenDragging<span class="token punctuation">:</span><span class="token function">WhiteRook</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This becomes:</p><p><img src="https://s2.loli.net/2022/01/28/MGEkBuhPjfT1Ivm.gif" alt="draggable_childwhendragging"></p><h4 id="Restricting-motion-for-Draggables"><a href="#Restricting-motion-for-Draggables" class="headerlink" title="Restricting motion for Draggables"></a>Restricting motion for Draggables</h4><p>Setting the <strong>axis</strong> parameter helps us restrict motion in one dimension only. <strong>Axis.horizontal</strong> makes the feedback widget only move in the horizontal axis.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Draggable</span><span class="token punctuation">(</span> axis<span class="token punctuation">:</span> Axis<span class="token punctuation">.</span>horizontal<span class="token punctuation">,</span> child<span class="token punctuation">:</span> <span class="token function">WhiteKnight</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> feedback<span class="token punctuation">:</span> <span class="token function">WhiteBishop</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> childWhenDragging<span class="token punctuation">:</span><span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://s2.loli.net/2022/01/28/4lOLS2TojEpUNfG.gif" alt="draggable_axis"></p><p>Similarly,we also have <strong>Axis.vertical</strong> for vertical movement.</p><h4 id="Adding-data-to-Draggable"><a href="#Adding-data-to-Draggable" class="headerlink" title="Adding data to Draggable"></a>Adding data to Draggable</h4><p>Data can be attached to a <em>Draggable</em>.This is useful to us since we use <em>Draggables</em> and <em>DragTargets</em>.</p><p>Considering our example,if we were to have multiple chess pieces,each piece would need to have unique data associated with it.Pieces would need properties such as color(White,Black) and type(ie:Rook,Bishop,Knight).</p><p>Below shows an example of how data can be attached to a <em>Draggable</em> for use with <em>DragTarget</em>.</p><p>We will take a look at this more in-depth in the <strong>DragTarget</strong> section.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Draggable</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span><span class="token function">WhiteKnight</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> feedback<span class="token punctuation">:</span><span class="token function">WhiteKnight</span><span class="token punctuation">(</span>  size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> childWhenDragging<span class="token punctuation">:</span><span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span><span class="token punctuation">[</span>  <span class="token string">'White'</span><span class="token punctuation">,</span>  <span class="token string">'Knight'</span>  <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Callbacks"><a href="#Callbacks" class="headerlink" title="Callbacks"></a>Callbacks</h4><p>The <em>Draggable</em> widget supplies callbacks for actions on the widget.</p><p>These callbacks are:<br><strong>onDragStarted:</strong> This is called when a drag is started on a widget.<br><strong>onDragEnd:</strong> This is called when a drag is ended on a widget.<br><strong>onDragCompleted:</strong> When a <em>Draggable</em> is dragged to a <em>DragTarget</em> and<br>accepted,this callback is called.We will look at <em>DragTarget</em> is in the next section.<br><strong>onDragCancelled:</strong> When a <em>Draggable</em> does not reach a <em>DragTarget</em> or is rejected, this callback is fired.</p><h3 id="DragTarget"><a href="#DragTarget" class="headerlink" title="DragTarget"></a>DragTarget</h3><p>While a <em>Draggable</em> allows a widget to be dragged,a <strong>DragTarget provides a destination for the draggable</strong>.</p><p>For example,in chess,<strong>a chess piece is a draggable</strong> whereas <strong>a square box on the chessboard is a drag target</strong>.</p><p><img src="https://s2.loli.net/2022/01/28/BIQkgFsKiOy3UNA.gif" alt="dragtarget_chess"></p><p>Here,the knight is accepted by the <em>DragTarget</em></p><p>The code for this example goes:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">bool accepted <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token function">DargTarget</span><span class="token punctuation">(</span>  builder<span class="token punctuation">:</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> candidateData<span class="token punctuation">,</span>rejectedData<span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> accepted<span class="token operator">?</span> <span class="token function">WhiteKnight</span><span class="token punctuation">(</span>size<span class="token punctuation">:</span><span class="token number">90.0</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  onWillAccept<span class="token punctuation">:</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  onAccept<span class="token punctuation">:</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>   accepted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>NB: The DragTarget is surrounded by a black colored container which is not shown in the code for brevity.</strong></p><p>Let’s look at the parameters of the <strong>DragTarget</strong> more detail.</p><p><strong>Note:</strong> The “data” in the following sections refers to the <strong>data</strong> parameter of the <em>Draggable</em>.</p><h4 id="Builder"><a href="#Builder" class="headerlink" title="Builder"></a>Builder</h4><p>The builder builds the actual widget inside the <em>DragTarget</em>.This function is called every time a <em>Draggable</em> is hovered over the <em>DragTarget</em> or is dropped onto it.</p><p>The function has three parameters,<strong>context,candidateData</strong> and <strong>rejectedData</strong>.</p><p><strong>candidateData</strong> is the data of a <em>Draggable</em> whilst it is hovering over the <em>DragTarget</em>, ready for acceptance by <em>DragTarget</em>. <strong>Note:</strong> It’s List <strong>Generics</strong> must same the<br>Draggable’s <em>data</em> parameter’s data type.</p><p><strong>rejectedData</strong> is the data of a <em>Draggable</em> hovering over a <em>DragTarget</em> at moment it is<br>not accepted.</p><p><strong>Note that both of there are dealing with Draggables which are hovering over the DragTarget. At this point,they are not dropped onto it yet.</strong></p><p>Now,how does the <em>DragTarget</em> know what to accept?</p><h4 id="onWillAccept"><a href="#onWillAccept" class="headerlink" title="onWillAccept"></a>onWillAccept</h4><p><strong>onWillAccept</strong> is a function which gives us the <em>Draggable</em> data for us to decide whether to accept or reject it.</p><p>This is where the <em>data</em> we attached onto the <em>Draggable</em> becomes important. We use the data passed to accept or reject specific <em>Draggables</em>.</p><p>For example if our Draggable is:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Draggable</span><span class="token punctuation">(</span> data<span class="token punctuation">:</span><span class="token string">'Knight'</span><span class="token punctuation">,</span> <span class="token comment">//...</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Then we can do:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">DragTarget</span><span class="token punctuation">(</span> <span class="token comment">//...</span> onWillAccept<span class="token punctuation">:</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">return</span> data <span class="token operator">==</span> <span class="token string">'Knight'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This will only accept the <em>Draggable</em> if the data is “Knight”.</p><p>This function is called when the <em>Draggable</em> is first hovered ovet the <em>DragTarget</em>.</p><h4 id="onAccept"><a href="#onAccept" class="headerlink" title="onAccept"></a>onAccept</h4><p>If the <em>Draggable</em> is dropped onto the <em>DragTarget</em> and <em>onWillAccept</em> returns true, then <em>onAccept</em> is called.</p><p><em>onAccept</em> also gives us the data of the <em>Draggable</em> and is usually used for storing the <em>Draggable</em> dropped over <em>DragTarget</em>.</p><h4 id="onLeave"><a href="#onLeave" class="headerlink" title="onLeave"></a>onLeave</h4><p>This was not implemented in the example.<em>onLeave</em> is called when a <em>Draggable</em> is hovered over the <em>DragTarget</em> and leaves without being dropped.</p><h3 id="A-Demo"><a href="#A-Demo" class="headerlink" title="A Demo"></a>A Demo</h3><p>Let’s create a simple demo app where the user is given a number and they are<br>required to sort it as either “even” or “odd”.Depending on the choice,we will<br>then display a message stating whether the choice is correct or wrong.</p><p>Source code:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'dart:math'</span> <span class="token operator">as</span> math<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span>    <span class="token keyword">with</span> TickerProviderStateMixin <span class="token punctuation">{</span>  GlobalKey<span class="token operator">&lt;</span>ScaffoldState<span class="token operator">&gt;</span> scaffoldKey <span class="token operator">=</span> <span class="token function">GlobalKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  int value<span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    value <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      key<span class="token punctuation">:</span> scaffoldKey<span class="token punctuation">,</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>          mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">Draggable</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                width<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>                height<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pinkAccent<span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'$value'</span><span class="token punctuation">,</span>                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                          fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              feedback<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                width<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>                height<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pinkAccent<span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'$value'</span><span class="token punctuation">,</span>                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                          fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              childWhenDragging<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>                width<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>                height<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pinkAccent<span class="token punctuation">,</span>                child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'$value'</span><span class="token punctuation">,</span>                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                          fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              data<span class="token punctuation">:</span> value<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Row</span><span class="token punctuation">(</span>              mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                <span class="token function">Container</span><span class="token punctuation">(</span>                  height<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>                  width<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">DragTarget</span><span class="token punctuation">(</span>                    builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>BuildContext context<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>int<span class="token operator">&gt;</span> candidateData<span class="token punctuation">,</span>                        List rejectedData<span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token keyword">return</span> <span class="token function">Center</span><span class="token punctuation">(</span>                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                          <span class="token string">'Even'</span><span class="token punctuation">,</span>                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                              fontSize<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>                              fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>                              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    onWillAccept<span class="token punctuation">:</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    onAccept<span class="token punctuation">:</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        scaffoldKey<span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">showSnackBar</span><span class="token punctuation">(</span><span class="token function">SnackBar</span><span class="token punctuation">(</span>                          content<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Correct!'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        scaffoldKey<span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">showSnackBar</span><span class="token punctuation">(</span><span class="token function">SnackBar</span><span class="token punctuation">(</span>                          content<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Wrong!'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token punctuation">}</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token function">Container</span><span class="token punctuation">(</span>                  height<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>                  width<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>                  color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>deepPurpleAccent<span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">DragTarget</span><span class="token punctuation">(</span>                    builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>BuildContext context<span class="token punctuation">,</span> List<span class="token operator">&lt;</span>int<span class="token operator">&gt;</span> candidateData<span class="token punctuation">,</span>                        List rejectedData<span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token keyword">return</span> <span class="token function">Center</span><span class="token punctuation">(</span>                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                          <span class="token string">'Odd'</span><span class="token punctuation">,</span>                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                              fontSize<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>                              fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>                              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    onWillAccept<span class="token punctuation">:</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                    onAccept<span class="token punctuation">:</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>                      <span class="token keyword">if</span> <span class="token punctuation">(</span>data <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        scaffoldKey<span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">showSnackBar</span><span class="token punctuation">(</span><span class="token function">SnackBar</span><span class="token punctuation">(</span>                          content<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Correct!'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        scaffoldKey<span class="token punctuation">.</span>currentState<span class="token punctuation">.</span><span class="token function">showSnackBar</span><span class="token punctuation">(</span><span class="token function">SnackBar</span><span class="token punctuation">(</span>                          content<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Wrong!'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token punctuation">}</span>                    <span class="token punctuation">}</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span>              <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      floatingActionButton<span class="token punctuation">:</span> FloatingActionButton<span class="token punctuation">.</span><span class="token function">extended</span><span class="token punctuation">(</span>        icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>refresh<span class="token punctuation">)</span><span class="token punctuation">,</span>        label<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Refresh Number'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            value <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token function">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="A-few-more-things"><a href="#A-few-more-things" class="headerlink" title="A few more things"></a>A few more things</h3><h4 id="Draggable-customizations"><a href="#Draggable-customizations" class="headerlink" title="Draggable customizations"></a>Draggable customizations</h4><p><em>Draggable</em> gives us a few more customizations.</p><p>One such customization is <strong>maxSimultaneousDrags</strong>.Multi-touch devicesare able to drag the same <em>Draggable</em> with two or more pointers and hence we can have multiple feedback on screen.For instance if the user is using a second finger to drag a child while one drag is already progress,we receive two feedback widgets at the same time.</p><p><strong>maxSimulataneousDrags</strong> lets us decide the maximum number of times a <em>Draggable</em> can be dragged at one time.</p><p>The <strong>feedbackOffset</strong> property also lets us set the offset of the feedback widget that displays on the screen.</p><h3 id="Common-error-DragTarget-not-accepting-data"><a href="#Common-error-DragTarget-not-accepting-data" class="headerlink" title="Common error:DragTarget not accepting data"></a>Common error:DragTarget not accepting data</h3><p>In the builder function,consider giving a type to the parameter <strong>candidateData</strong>.It returns a <strong>List</strong> by default,so if the data you’re passing is a string,the type would be <strong>List</strong>.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">builder<span class="token punctuation">:</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>List<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> candidateData<span class="token punctuation">,</span>rejectedData<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//...}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>This solves a few type errors that occasionally comes up when passing data.</p><h3 id="A-more-complete-real-world-example-using-Draggable-and-DragTarget"><a href="#A-more-complete-real-world-example-using-Draggable-and-DragTarget" class="headerlink" title="A more complete real-world example using Draggable and DragTarget"></a>A more complete real-world example using Draggable and DragTarget</h3><p>Somebody wrote a complete chessboard package using <em>Draggables</em> and <em>DragTarget</em>.</p><p>For the complete source code,you can check it out <a href="https://github.com/deven98/flutter_chess_board">here</a>.</p>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Draggable </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>如何更改Mac OS的Brew地址源</title>
      <link href="/2022/01/06/ru_he_geng_gai_brew_di_zhi_yuan/"/>
      <url>/2022/01/06/ru_he_geng_gai_brew_di_zhi_yuan/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="如何更改brew地址源"><a href="#如何更改brew地址源" class="headerlink" title="如何更改brew地址源"></a>如何更改brew地址源</h4><h5 id="替换brew-git-仓库地址"><a href="#替换brew-git-仓库地址" class="headerlink" title="替换brew.git 仓库地址:"></a>替换brew.git 仓库地址:</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew --repo<span class="token variable">)</span></span>"</span><span class="token function">git</span> remote set-url origin https://mirrors.aliyun.com/homebrew/brew.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>还原</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew --repo<span class="token variable">)</span></span>"</span><span class="token function">git</span> remote set-url origin https://github.com/Homebrew/brew.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="替换homebrew-core-git-仓库地址"><a href="#替换homebrew-core-git-仓库地址" class="headerlink" title="替换homebrew-core.git 仓库地址:"></a>替换homebrew-core.git 仓库地址:</h5><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew --repo<span class="token variable">)</span></span>/Library/Taps/homebrew/homebrew-core"</span><span class="token function">git</span> remote set-url origin https://mirrors.aliyun.com/homebrew/homebrew-core.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>还原</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token string">"<span class="token variable"><span class="token variable">$(</span>brew --repo<span class="token variable">)</span></span>/Library/Taps/homebrew/homebrew-core"</span><span class="token function">git</span> remote set-url origin https://github.com/Homebrew/homebrew-core.git<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h5 id="替换homebrew-bottles-访问地址"><a href="#替换homebrew-bottles-访问地址" class="headerlink" title="替换homebrew-bottles 访问地址"></a>替换homebrew-bottles 访问地址</h5><p>这个步骤跟你的 macOS 系统使用的 shell 版本有关系,先来查看当前使用的 shell 版本</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token environment constant">$SHELL</span>/bin/zsh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li>zsh替换成阿里巴巴的 homebrew-bottles 访问地址:</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.aliyun.com/homebrew/homebrew-bottles'</span> <span class="token operator">&gt;&gt;</span> ~/.zshrc<span class="token builtin class-name">source</span> ~/.zshrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>还原</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> ~/.zshrc<span class="token comment"># 然后，删除 HOMEBREW_BOTTLE_DOMAIN 这一行配置</span><span class="token builtin class-name">source</span> ~/.zshrc<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="2"><li>bash替换成阿里巴巴的 homebrew-bottles 访问地址:</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'export HOMEBREW_BOTTLE_DOMAIN=https://mirrors.aliyun.com/homebrew/homebrew-bottles'</span> <span class="token operator">&gt;&gt;</span> ~/.bash_profile<span class="token builtin class-name">source</span> ~/.bash_profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>还原</strong></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">vi</span> ~/.bash_profile<span class="token comment"># 然后，删除 HOMEBREW_BOTTLE_DOMAIN 这一行配置</span><span class="token builtin class-name">source</span> ~/.bash_profile<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>配置完后再去安装下某些工具就能发现畅快无比了。</p>]]></content>
      
      
      <categories>
          
          <category> Mac OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Brew </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to Install Linux on an M1 Mac With Apple Silicon</title>
      <link href="/2021/12/21/how_to_install_linux_on_an_m1_mac_with_apple_silicon/"/>
      <url>/2021/12/21/how_to_install_linux_on_an_m1_mac_with_apple_silicon/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://s2.loli.net/2021/12/21/1WqQRbpjOJG4HMK.png" alt="ubuntu_on_utm"></p><h1 id="You-Can’t-Run-Linux-Natively-on-Apple-Silicon-Yet"><a href="#You-Can’t-Run-Linux-Natively-on-Apple-Silicon-Yet" class="headerlink" title="You Can’t Run Linux Natively on Apple Silicon (Yet)"></a>You Can’t Run Linux Natively on Apple Silicon (Yet)</h1><p>Native Linux support for Apple Silicon chips is coming. If you can’t wait any longer, you can run Linux right now in a virtual machine.</p><p>You can do this for free with a virtual machine (VM) app called <a href="https://mac.getutm.app/">UTM</a>. There’s also a paid $9.99 <a href="https://apps.apple.com/au/app/utm-virtual-machines/id1538878817?mt=12">Mac App Store version</a> that you can buy to support developers and gain access to automatic updates through the store interface.</p><p>You can use this app to emulate a large number of processor architectures, including x86-64 (“proper” desktop Linux) as well as <strong>ARM</strong> and <strong>PowerPC</strong>.</p><p>To get started, download UTM and a Linux distribution of your choosing, then get started on creating a virtual machine with UTM.</p><p><strong>Note:</strong> You can use UTM to run ARM64 versions of Linux at “near native” speeds,     while lower performance emulation can be achieved in 32-bit and 64-bit x86 versions. It’s up to you what you choose, but you’ll need to match your version to your system architecture in the instructions below.</p><h1 id="Install-Ubuntu-on-an-M1-Mac-With-Apple-Silicon"><a href="#Install-Ubuntu-on-an-M1-Mac-With-Apple-Silicon" class="headerlink" title="Install Ubuntu on an M1 Mac With Apple Silicon"></a>Install Ubuntu on an M1 Mac With Apple Silicon</h1><h2 id="Downloads"><a href="#Downloads" class="headerlink" title="Downloads"></a>Downloads</h2><ul><li><a href="https://github.com/utmapp/UTM/releases">UTM for Mac</a> (v2.0.15 or higher)</li><li><a href="https://ubuntu.com/download/server/arm">Ubuntu Server for ARM</a> (20.04.1 or higher)</li></ul><h2 id="Instructions"><a href="#Instructions" class="headerlink" title="Instructions"></a>Instructions</h2><ol><li>Open UTM and create a new virtual machine.</li></ol><p><img src="https://s2.loli.net/2021/12/21/1FPGJY3NLCfkecV.png" alt="ubuntu_screen_1"></p><ol start="2"><li>Give the VM a name and optionally choose an icon.</li></ol><p><img src="https://s2.loli.net/2021/12/21/AYebBKH1FgkmILu.png" alt="ubuntu_screen_2"></p><ol start="3"><li>In System, select the “ARM64 (aarch64)” architecture, and specify the amount of memory. At least half of your computer’s total memory is recommended for performance.</li></ol><p><img src="https://s2.loli.net/2021/12/21/1VtA7DmFJeHyLRl.png" alt="ubuntu_screen_3"></p><ol start="4"><li>In Drives, create a new drive. This will be your install drive. It is recommended to give it at least 10,240 MB (10 GB).</li></ol><p><img src="https://s2.loli.net/2021/12/21/sbYVoixw7E9JSuC.png" alt="ubuntu_screen_4"></p><ol start="5"><li>Create another drive. This will be the installation disk drive. Make sure “removable” is checked.</li></ol><p><img src="https://s2.loli.net/2021/12/21/dMjcHx2igpUqWJF.png" alt="ubuntu_screen_5"></p><ol start="6"><li>Save the VM and select it in the sidebar. Click the Browse button on the bottom right and select the Ubuntu installation ISO.</li></ol><p><img src="https://s2.loli.net/2021/12/21/WBjVQA3zYbxT9Nh.png" alt="ubuntu_screen_6"></p><ol start="7"><li>Start the VM and choose to install Ubuntu server. (If you cannot boot to the installer, go to the troubleshooting section at the bottom.) Follow the installation wizard, all the default options are recommended.</li></ol><p><img src="https://s2.loli.net/2021/12/21/eSdyhpHcl95QWgb.png" alt="ubuntu_screen_7"></p><ol start="8"><li>At the end of the installation, the screen will be black with a blinking cursor. Eject the ISO with the CD icon on the toolbar. Press the restart icon on the toolbar (third from the left) to restart into your installed Ubuntu.</li></ol><h2 id="Installing-Ubuntu-Desktop"><a href="#Installing-Ubuntu-Desktop" class="headerlink" title="Installing Ubuntu Desktop"></a>Installing Ubuntu Desktop</h2><p>At the end of the installation, you will have Ubuntu Server installed without any GUI. To install Ubuntu Desktop, log in and run:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> tasksel$ <span class="token function">sudo</span> tasksel <span class="token function">install</span> ubuntu-desktop$ <span class="token function">sudo</span> <span class="token function">reboot</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>(Note <code>tasksel</code> may fail the first time and you can just run it again.)</p><h2 id="Enable-clipboard-and-directory-sharing"><a href="#Enable-clipboard-and-directory-sharing" class="headerlink" title="Enable clipboard and directory sharing"></a>Enable clipboard and directory sharing</h2><p>With the VM turned off, open the settings, and make sure these two options are checked.</p><p><img src="https://s2.loli.net/2021/12/21/Pw1bG4nBYUSqCFu.png" alt="ubuntu_screen_sharing"></p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> spice-vdagent spice-webdavd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Your shared directory shows up as a WebDAV server on <code>http://127.0.0.1:9843/</code>. You can use a WebDAV client to access it, or <code>mount.davfs</code> to mount it.</p><h2 id="Troubleshooting"><a href="#Troubleshooting" class="headerlink" title="Troubleshooting"></a>Troubleshooting</h2><h3 id="Cannot-boot-into-installer"><a href="#Cannot-boot-into-installer" class="headerlink" title="Cannot boot into installer"></a>Cannot boot into installer</h3><p>If you start the VM and are stuck at the EFI screen (<code>BdsDxe: failed to load Boot0001</code> or <code>UEFI Interactive Shell</code>), try the following in order.</p><ol><li>Make sure you have the installer ISO selected. Click the disk icon on the toolbar and check that there is a menu option for <code>CD/DVD (ISO) Image (usb): ubuntu-xxx.iso</code>. If it says <code>CD/DVD (ISO) Image (usb): none</code>, then highlight that menu and choose <code>Change</code> and then select the ISO. If you don’t have any selectable menu option, follow the guide again and make sure you have added a removable drive. Then restart the VM.</li><li>Next, try to get into the EFI Shell. If you see <code>UEFI Interactive Shell</code> then you are already in the shell. Otherwise, restart the VM and quickly press the Esc key to enter the shell.</li><li>In the EFI shell make sure you see <code>FS0: Alias(s):CD0h0a0a::BLK1:</code> near the top or something similar. If not, then double check your configuration and make sure you have a removable drive configured and the installer ISO mounted. Also check that your ISO is valid.</li><li>Type in: <code>fs0:\efi\boot\bootaa64.efi</code> and you should see GRUB. Then select <code>Ubuntu Server</code> to continue with the install.</li></ol><h3 id="Networking-is-unavailable-after-switching-between-Console-Only-and-Full-Graphics-modes"><a href="#Networking-is-unavailable-after-switching-between-Console-Only-and-Full-Graphics-modes" class="headerlink" title="Networking is unavailable after switching between Console Only and Full Graphics modes"></a>Networking is unavailable after switching between Console Only and Full Graphics modes</h3><p>When switching between display modes, the network adapter may be renamed by Ubuntu. To fix this, you need to set up networking again.</p><ol><li>Run <code>ip link show</code> and look at the last adapter name. For example, it may be listed as <code>enp0s9</code>.</li><li>Edit <code>/etc/netplan/00-installer-config.yaml</code> and copy your configuration for <code>enp0s8</code> (or whatever the old adapter was named) and paste it immediately after for <code>enp0s9</code> (or whatever the new adapter is named).</li><li>Reboot and you should be able to use networking in both display modes.</li></ol>]]></content>
      
      
      <categories>
          
          <category> Mac OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> virtual machine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>小程序登录的正确打开方式</title>
      <link href="/2021/12/21/xiao_cheng_xu_deng_lu_de_zheng_que_da_kai_fang_shi/"/>
      <url>/2021/12/21/xiao_cheng_xu_deng_lu_de_zheng_que_da_kai_fang_shi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="小程序网络组件"><a href="#小程序网络组件" class="headerlink" title="小程序网络组件"></a>小程序网络组件</h4><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.html">RequestTask</a> <a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html">wx.request(Object object)</a></p><p><strong>RequestTask说明</strong></p><table><thead><tr><th>方法</th><th>说明</th></tr></thead><tbody><tr><td><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.abort.html">RequestTask.abort()</a></td><td>中断请求任务。</td></tr><tr><td><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.onHeadersReceived.html">RequestTask.onHeadersReceived(function callback)</a></td><td>监听 HTTP Response Header 事件。会比请求完成事件更早。</td></tr><tr><td><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.offHeadersReceived.html">RequestTask.offHeadersReceived(function callback)</a></td><td>取消监听 HTTP Response Header 事件。</td></tr><tr><td><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.onChunkReceived.html">RequestTask.onChunkReceived(function callback)</a></td><td>监听 Transfer-Encoding Chunk Received 事件。当接收到新的chunk时触发。</td></tr><tr><td><a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/RequestTask.offChunkReceived.html">RequestTask.offChunkReceived(function callback)</a></td><td>取消监听 Transfer-Encoding Chunk Received 事件。</td></tr></tbody></table><p><strong>wx.request(Object object)属性</strong></p><p><em>此处只列比较常用的属性，全部属性请查看<a href="https://developers.weixin.qq.com/miniprogram/dev/api/network/request/wx.request.html">链接</a>。</em></p><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>url</td><td>string</td><td></td><td>是</td><td>开发者服务器接口地址</td></tr><tr><td>data</td><td>string/object/ArrayBuffer</td><td></td><td>否</td><td>请求的参数</td></tr><tr><td>header</td><td>Object</td><td></td><td>否</td><td>设置请求的 header，header 中不能设置 Referer。 <code>content-type</code> 默认为 <code>application/json</code></td></tr><tr><td>timeout</td><td>number</td><td></td><td>否</td><td>超时时间，单位为毫秒</td></tr><tr><td>method</td><td>string</td><td>GET</td><td>否</td><td>HTTP 请求方法</td></tr><tr><td>success</td><td>function</td><td></td><td>否</td><td>接口调用成功的回调函数</td></tr><tr><td>fail</td><td>function</td><td></td><td>否</td><td>接口调用失败的回调函数</td></tr><tr><td>complete</td><td>function</td><td></td><td>否</td><td>接口调用结束的回调函数（调用成功、失败都会执行）哪怕是abort掉的请求！</td></tr></tbody></table><p><strong>总结一下：所有的小程序接口基本上都有两个特征：</strong></p><ol><li><p>参数都是一个对象。便于记忆的同时方便扩展。</p></li><li><p>都有相同的结果处理方式：都有success、fail、complete三个回调属性。</p></li></ol><p><strong>接口执行的各种情况下的errMsg对象介绍。</strong></p><table><thead><tr><th>回调属性</th><th>errMsg对象</th></tr></thead><tbody><tr><td>success</td><td>{errMsg:”request:ok”…}</td></tr><tr><td>fail</td><td>{errMsg:”request:fail “…} 有的系统这个fail后面有个空格，所以要使用这个判断，最好是使用正则表达式。也可以使用indexOf函数，大于-1进行判断。</td></tr><tr><td>abort</td><td>{errMsg:”request:fail abort”…}</td></tr></tbody></table><p>   <strong>示例代码</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> reqTask <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    url<span class="token operator">:</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>api<span class="token punctuation">,</span>    <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>errMsg <span class="token operator">===</span> <span class="token string">"request:ok"</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"res"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// if(err.errMsg.indexOf('request:fail')&gt;-1) console.log('err', err);</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^request:fail</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"err"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token function">complete</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"resOrErr"</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">const</span> <span class="token function-variable function">reqTaskOnHeadersReceived</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">headers</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    reqTask<span class="token punctuation">.</span><span class="token function">offHeadersReceived</span><span class="token punctuation">(</span>reqTaskOnHeadersReceived<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"headers"</span><span class="token punctuation">,</span> headers<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 由于请求还未完全结束，所以我们没办法获得请求的状态码，但是我们可以通过返回的requestBody的长度来进行判断。</span>    <span class="token comment">// 两点说明：1. 两个~~可以把字符串数字快速转化为数字。</span>    <span class="token comment">// 2. 为什么取小于19，是由于后台返回没有权限的requestBody的时候Content-length为“18”，正常情况下是大于19的。所以具体多少得看一下具体情况。</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">~</span>headers<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">"Content-length"</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">19</span><span class="token punctuation">)</span> reqTask<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  reqTask<span class="token punctuation">.</span><span class="token function">onHeadersReceived</span><span class="token punctuation">(</span>reqTaskOnHeadersReceived<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="小程序登录接口"><a href="#小程序登录接口" class="headerlink" title="小程序登录接口"></a>小程序登录接口</h4><ol><li><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/user-info/wx.getUserProfile.html">wx.getUserProfile(Object object)</a></p><p>获取用户信息。页面产生点击事件（例如 <code>button</code> 上 <code>bindtap</code> 的回调中）后才可调用，每次请求都会弹出授权窗口，用户同意后返回 <code>userInfo</code>。该接口用于替换 <code>wx.getUserInfo</code>，详见 <a href="https://developers.weixin.qq.com/community/develop/doc/000cacfa20ce88df04cb468bc52801?highLine=login">用户信息接口调整说明</a>。</p></li><li><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.checkSession.html">wx.checkSession(Object object)</a></p><p>检查登录态是否过期。 通过 wx.login 接口获得的用户登录态拥有一定的时效性。用户越久未使用小程序，用户登录态越有可能失效。反之如果用户一直在使用小程序，则用户登录态一直保持有效。具体时效逻辑由微信维护，对开发者透明。开发者只需要调用 wx.checkSession 接口检测当前用户登录态是否有效。</p><p>登录态过期后开发者可以再调用 wx.login 获取新的用户登录态。调用成功说明当前 session_key 未过期，调用失败说明 session_key 已过期。更多使用方法详见 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html">小程序登录</a>。</p></li><li><p><a href="https://developers.weixin.qq.com/miniprogram/dev/api/open-api/login/wx.login.html">wx.login(Object object)</a></p><p>调用接口获取登录凭证（code）。通过凭证进而换取用户登录态信息，包括用户在当前小程序的唯一标识（openid）、微信开放平台帐号下的唯一标识（unionid，若当前小程序已绑定到微信开放平台帐号）及本次登录的会话密钥（session_key）等。用户数据的加解密通讯需要依赖会话密钥完成。更多使用方法详见 <a href="https://developers.weixin.qq.com/miniprogram/dev/framework/open-ability/login.html">小程序登录</a>。</p></li></ol><h4 id="后端登录接口代码实现"><a href="#后端登录接口代码实现" class="headerlink" title="后端登录接口代码实现"></a>后端登录接口代码实现</h4><p><strong>后端使用NodeJS，web框架KOA版本^2.13.4，路由框架@koa/router版本^10.1.1，框架request，版本 ^2.88.2，jsonwebtoken用来加密解密token信息，版本^8.5.1</strong></p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// app.js</span><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"koa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@koa/router"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> WeixinAuth <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./lib/koa2-weixin-auth"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> jsonwebtoken <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"jsonwebtoken"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 小程序机票信息</span><span class="token keyword">const</span> miniProgramAppId <span class="token operator">=</span> <span class="token string">"*********"</span><span class="token punctuation">;</span><span class="token keyword">const</span> miniProgramAppSecret <span class="token operator">=</span> <span class="token string">"***********"</span><span class="token punctuation">;</span><span class="token keyword">const</span> weixinAuth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WeixinAuth</span><span class="token punctuation">(</span>miniProgramAppId<span class="token punctuation">,</span> miniProgramAppSecret<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token constant">JWT_SECRET</span> <span class="token operator">=</span> <span class="token string">"JWTSECRET"</span><span class="token punctuation">;</span><span class="token comment">// 路由中间件需要安装@koa/router</span><span class="token comment">// 开启一个带群组的路由</span><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  prefix<span class="token operator">:</span> <span class="token string">"/user"</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 这是正规的登陆方法</span><span class="token comment">// 添加一个参数，sessionKeyIsValid，代表sessionKey是否还有效</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">"/weixin-login"</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> <span class="token punctuation">{</span> code<span class="token punctuation">,</span> userInfo<span class="token punctuation">,</span> encryptedData<span class="token punctuation">,</span> iv<span class="token punctuation">,</span> sessionKeyIsValid <span class="token punctuation">}</span> <span class="token operator">=</span>    ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>   <span class="token comment">// 解析openid</span>  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> weixinAuth<span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>  userInfo<span class="token punctuation">.</span>openid <span class="token operator">=</span> token<span class="token punctuation">.</span>data<span class="token punctuation">.</span>openid<span class="token punctuation">;</span>  <span class="token comment">// 这里可以自己进行处理，比方说记录到数据库,处理token等</span>  <span class="token keyword">let</span> authorizationToken <span class="token operator">=</span> jsonwebtoken<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>    <span class="token punctuation">{</span> name<span class="token operator">:</span> userInfo<span class="token punctuation">.</span>nickName <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token constant">JWT_SECRET</span><span class="token punctuation">,</span>    <span class="token punctuation">{</span> expiresIn<span class="token operator">:</span> <span class="token string">"1d"</span> <span class="token punctuation">}</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span>  Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">,</span> <span class="token punctuation">{</span> authorizationToken <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>    code<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>    msg<span class="token operator">:</span> <span class="token string">"ok"</span><span class="token punctuation">,</span>    data<span class="token operator">:</span> userInfo<span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// lib/koa2-weixin-auth.js</span><span class="token keyword">const</span> querystring <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"querystring"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"request"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">const</span> <span class="token function-variable function">AccessToken</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">AccessToken</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AccessToken</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/*! * 检查AccessToken是否有效，检查规则为当前时间和过期时间进行对比 * * Examples: * ``` * token.isValid(); * ``` */</span><span class="token class-name">AccessToken</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">isValid</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token punctuation">(</span>    <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>session_key <span class="token operator">&amp;&amp;</span>    <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>create_at <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>expires_in <span class="token operator">*</span> <span class="token number">1000</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/** * 根据appid和appsecret创建OAuth接口的构造函数 * 如需跨进程跨机器进行操作，access token需要进行全局维护 * 使用使用token的优先级是： * * 1. 使用当前缓存的token对象 * 2. 调用开发传入的获取token的异步方法，获得token之后使用（并缓存它）。 * Examples: * ``` * var OAuth = require('oauth'); * var api = new OAuth('appid', 'secret'); * ``` * @param {String} appid 在公众平台上申请得到的appid * @param {String} appsecret 在公众平台上申请得到的app secret */</span><span class="token keyword">const</span> <span class="token function-variable function">Auth</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">appid<span class="token punctuation">,</span> appsecret</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>appid <span class="token operator">=</span> appid<span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>appsecret <span class="token operator">=</span> appsecret<span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span>store <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">getToken</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">openid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">[</span>openid<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">saveToken</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">openid<span class="token punctuation">,</span> token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">this</span><span class="token punctuation">.</span>store<span class="token punctuation">[</span>openid<span class="token punctuation">]</span> <span class="token operator">=</span> token<span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/** * 获取授权页面的URL地址 * @param {String} redirect 授权后要跳转的地址 * @param {String} state 开发者可提供的数据 * @param {String} scope 作用范围，值为snsapi_userinfo和snsapi_base，前者用于弹出，后者用于跳转 */</span><span class="token class-name">Auth</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getAuthorizeURL</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">redirect_uri<span class="token punctuation">,</span> scope<span class="token punctuation">,</span> state</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"https://open.weixin.qq.com/connect/oauth2/authorize"</span><span class="token punctuation">;</span>    <span class="token keyword">let</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>      appid<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appid<span class="token punctuation">,</span>      redirect_uri<span class="token operator">:</span> redirect_uri<span class="token punctuation">,</span>      scope<span class="token operator">:</span> scope <span class="token operator">||</span> <span class="token string">"snsapi_base"</span><span class="token punctuation">,</span>      state<span class="token operator">:</span> state <span class="token operator">||</span> <span class="token string">""</span><span class="token punctuation">,</span>      response_type<span class="token operator">:</span> <span class="token string">"code"</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token function">resolve</span><span class="token punctuation">(</span>url <span class="token operator">+</span> <span class="token string">"?"</span> <span class="token operator">+</span> querystring<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"#wechat_redirect"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/*! * 处理token，更新过期时间 */</span><span class="token class-name">Auth</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">processToken</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  data<span class="token punctuation">.</span>create_at <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 存储token</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">saveToken</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>openid<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token function">AccessToken</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/** * 根据授权获取到的code，换取access token和openid * 获取openid之后，可以调用`wechat.API`来获取更多信息 * @param {String} code 授权获取到的code */</span><span class="token class-name">Auth</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getAccessToken</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"https://api.weixin.qq.com/sns/jscode2session"</span><span class="token punctuation">;</span>    <span class="token comment">//由于此框架版本很久没有更新了，此处地址发生了变化，需要修改为以上地址，不然会出现</span>    <span class="token comment">//41008错误。这也是没有直接使用框架，引用本地使用的原因。</span>    <span class="token comment">// const url = "https://api.weixin.qq.com/sns/oauth2/access_token";</span>    <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>      appid<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appid<span class="token punctuation">,</span>      secret<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appsecret<span class="token punctuation">,</span>      js_code<span class="token operator">:</span> code<span class="token punctuation">,</span>      grant_type<span class="token operator">:</span> <span class="token string">"authorization_code"</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    request<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> form<span class="token operator">:</span> info <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processToken</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/** * 根据refresh token，刷新access token，调用getAccessToken后才有效 * @param {String} refreshToken refreshToken */</span><span class="token class-name">Auth</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">refreshAccessToken</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">refreshToken</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"https://api.weixin.qq.com/sns/oauth2/refresh_token"</span><span class="token punctuation">;</span>    <span class="token keyword">var</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>      appid<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>appid<span class="token punctuation">,</span>      grant_type<span class="token operator">:</span> <span class="token string">"refresh_token"</span><span class="token punctuation">,</span>      refresh_token<span class="token operator">:</span> refreshToken<span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    request<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> form<span class="token operator">:</span> info <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processToken</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/** * 根据openid，获取用户信息。 * 当access token无效时，自动通过refresh token获取新的access token。然后再获取用户信息 * @param {Object|String} options 传入openid或者参见Options */</span><span class="token class-name">Auth</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getUser</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">openid</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getToken</span><span class="token punctuation">(</span>openid<span class="token punctuation">)</span><span class="token punctuation">;</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"getUser"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> error <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span>      <span class="token string">"No token for "</span> <span class="token operator">+</span> options<span class="token punctuation">.</span>openid <span class="token operator">+</span> <span class="token string">", please authorize first."</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    error<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"NoOAuthTokenError"</span><span class="token punctuation">;</span>    <span class="token keyword">throw</span> error<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token function">AccessToken</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">var</span> accessToken<span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">isValid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    accessToken <span class="token operator">=</span> token<span class="token punctuation">.</span>data<span class="token punctuation">.</span>session_key<span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> newToken <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">refreshAccessToken</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>data<span class="token punctuation">.</span>refresh_token<span class="token punctuation">)</span><span class="token punctuation">;</span>    accessToken <span class="token operator">=</span> newToken<span class="token punctuation">.</span>data<span class="token punctuation">.</span>session_key<span class="token punctuation">;</span>  <span class="token punctuation">}</span>  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"accessToken"</span><span class="token punctuation">,</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_getUser</span><span class="token punctuation">(</span>openid<span class="token punctuation">,</span> accessToken<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token class-name">Auth</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_getUser</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">openid<span class="token punctuation">,</span> accessToken<span class="token punctuation">,</span> lang</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token string">"https://api.weixin.qq.com/sns/userinfo"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span> info <span class="token operator">=</span> <span class="token punctuation">{</span>      access_token<span class="token operator">:</span> accessToken<span class="token punctuation">,</span>      openid<span class="token operator">:</span> openid<span class="token punctuation">,</span>      lang<span class="token operator">:</span> lang <span class="token operator">||</span> <span class="token string">"zh_CN"</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    request<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{</span> form<span class="token operator">:</span> info <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> res<span class="token punctuation">,</span> body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">/** * 根据code，获取用户信息。 * @param {String} code 授权获取到的code */</span><span class="token class-name">Auth</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getUserByCode</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAccessToken</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>data<span class="token punctuation">.</span>openid<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Auth<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="小程序端登录代码实现"><a href="#小程序端登录代码实现" class="headerlink" title="小程序端登录代码实现"></a>小程序端登录代码实现</h4><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--pages/index.wxml--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page-section<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page-section__title<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>微信登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn-area<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>  <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserProfile<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// pages/index.js</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment">/**   * 页面的初始数据   */</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 正确的登录方式</span>  <span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">// 推荐使用wx.getUserProfile获取用户信息，开发者每次通过该接口获取用户个人信息均需用户确认</span>    <span class="token comment">// 开发者妥善保管用户快速填写的头像昵称，避免重复弹窗</span>    wx<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      desc<span class="token operator">:</span> <span class="token string">"用于完善会员资料"</span><span class="token punctuation">,</span> <span class="token comment">// 声明获取用户个人信息后的用途，后续会展示在弹窗中，请谨慎填写</span>      <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> <span class="token punctuation">{</span> userInfo<span class="token punctuation">,</span> encryptedData<span class="token punctuation">,</span> iv <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>        <span class="token keyword">const</span> <span class="token function-variable function">requestLoginApi</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token comment">// 发起网络请求</span>          wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            url<span class="token operator">:</span> <span class="token string">"http://localhost:3000/user/weixin-login"</span><span class="token punctuation">,</span>            method<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>            header<span class="token operator">:</span> <span class="token punctuation">{</span>              <span class="token string">"content-type"</span><span class="token operator">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            data<span class="token operator">:</span> <span class="token punctuation">{</span>              code<span class="token punctuation">,</span>              userInfo<span class="token punctuation">,</span>              encryptedData<span class="token punctuation">,</span>              iv<span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"请求成功"</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token keyword">let</span> token <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>authorizationToken<span class="token punctuation">;</span>              wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token function">onUserLogin</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"authorization"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"请求异常"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> <span class="token function-variable function">onUserLogin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token <span class="token operator">=</span> token<span class="token punctuation">;</span>          wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            title<span class="token operator">:</span> <span class="token string">"登录成功了"</span><span class="token punctuation">,</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token comment">//必须进行session是否过期检查，不然会出现第一次点击登录，服务器报Illegal Buffer</span>        <span class="token comment">//的错误，但是第二次点击登录正常。</span>        wx<span class="token punctuation">.</span><span class="token function">checkSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// session_key 未过期，并且在本生命周期一直有效</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"在登陆中"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> token <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token function">onUserLogin</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>            <span class="token comment">// session_key已经失效，需要重新执行登录流程</span>            wx<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>              <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>res0<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token function">requestLoginApi</span><span class="token punctuation">(</span>res0<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"登录失败!"</span> <span class="token operator">+</span> res0<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>              <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="针对登录代码可以做哪些优化？"><a href="#针对登录代码可以做哪些优化？" class="headerlink" title="针对登录代码可以做哪些优化？"></a>针对登录代码可以做哪些优化？</h4><p>对于一个软件，就代码层面而言，需要追求最基本的几个方面（远不止这些，但是先姑且先做个好这些吧）：</p><ol><li><p>可维护性（maintainability）</p><p>所谓的“维护”无外乎就是修改 bug、修改老的代码、添加新的代码之类的工作。所谓“代码易维护”就是指，在不破坏原有代码设计、不引入新的 bug 的情况下，能够快速地修改或者添加代码。所谓“代码不易维护”就是指，修改或者添加代码需要冒着极大的引入新 bug 的风险，并且需要花费很长的时间才能完成。</p></li><li><p>可读性（readability）</p><p>软件设计大师 Martin Fowler 曾经说过：“Any fool can write code that a computer can understand. Good programmers write code that humans can understand.”翻译成中文就是：“任何傻瓜都会编写计算机能理解的代码。好的程序员能够编写人能够理解的代码。”Google 内部甚至专门有个认证就叫作 Readability。只有拿到这个认证的工程师，才有资格在 code review 的时候，批准别人提交代码。可见代码的可读性有多重要，毕竟，代码被阅读的次数远远超过被编写和执行的次数。我们需要看代码是否符合编码规范、命名是否达意、注释是否详尽、函数是否长短合适、模块划分是否清晰、是否符合高内聚低耦合等等。</p></li><li><p>可扩展性（extensibility）</p><p>可扩展性也是一个评价代码质量非常重要的标准。代码预留了一些功能扩展点，你可以把新功能代码，直接插到扩展点上，而不需要因为要添加一个功能而大动干戈，改动大量的原始代码。</p></li><li><p>可复用性（reusability）</p><p>代码的可复用性可以简单地理解为，尽量减少重复代码的编写，复用已有的代码。</p></li></ol><p>那么接下来就来优化一下代码吧：</p><h5 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h5><p>可以把登录的代码模块化，代码如下：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// lib/login.js</span><span class="token keyword">function</span> <span class="token function">loginWithCallback</span><span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 推荐使用wx.getUserProfile获取用户信息，开发者每次通过该接口获取用户个人信息均需用户确认</span>  <span class="token comment">// 开发者妥善保管用户快速填写的头像昵称，避免重复弹窗</span>  wx<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    desc<span class="token operator">:</span> <span class="token string">"用于完善会员资料"</span><span class="token punctuation">,</span> <span class="token comment">// 声明获取用户个人信息后的用途，后续会展示在弹窗中，请谨慎填写</span>    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>      <span class="token keyword">let</span> <span class="token punctuation">{</span> userInfo<span class="token punctuation">,</span> encryptedData<span class="token punctuation">,</span> iv <span class="token punctuation">}</span> <span class="token operator">=</span> res<span class="token punctuation">;</span>      <span class="token keyword">const</span> <span class="token function-variable function">requestLoginApi</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">code</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token comment">// 发起网络请求</span>        wx<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          url<span class="token operator">:</span> <span class="token string">"http://localhost:3000/user/weixin-login"</span><span class="token punctuation">,</span>          method<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>          header<span class="token operator">:</span> <span class="token punctuation">{</span>            <span class="token string">"content-type"</span><span class="token operator">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          data<span class="token operator">:</span> <span class="token punctuation">{</span>            code<span class="token punctuation">,</span>            userInfo<span class="token punctuation">,</span>            encryptedData<span class="token punctuation">,</span>            iv<span class="token punctuation">,</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"请求成功"</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">let</span> token <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>authorizationToken<span class="token punctuation">;</span>            wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">onUserLogin</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"authorization"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"请求异常"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      <span class="token keyword">const</span> <span class="token function-variable function">onUserLogin</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">token</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token <span class="token operator">=</span> token<span class="token punctuation">;</span>        wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>          title<span class="token operator">:</span> <span class="token string">"登录成功了"</span><span class="token punctuation">,</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>cb <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> cb <span class="token operator">==</span> <span class="token string">"function"</span><span class="token punctuation">)</span> <span class="token function">cb</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">;</span>      wx<span class="token punctuation">.</span><span class="token function">checkSession</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token comment">// session_key 未过期，并且在本生命周期一直有效</span>          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"在登陆中"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">let</span> token <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token function">onUserLogin</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>          <span class="token comment">// session_key已经失效，需要重新执行登录流程</span>          wx<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">res0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">if</span> <span class="token punctuation">(</span>res0<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">requestLoginApi</span><span class="token punctuation">(</span>res0<span class="token punctuation">.</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"登录失败!"</span> <span class="token operator">+</span> res0<span class="token punctuation">.</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> loginWithCallback<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="Promise化"><a href="#Promise化" class="headerlink" title="Promise化"></a>Promise化</h5><p>回调地狱问题，不利于代码的阅读，所以接下来我们基于<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a>进行代码优化。有了 Promise 对象，就可以将异步操作以同步操作的流程表达出来，避免了层层嵌套的回调函数。此外，Promise 对象提供统一的接口，使得控制异步操作更加容易。</p><p><strong>Promise的几个方法简介</strong></p><table><thead><tr><th>方法名</th><th>说明</th></tr></thead><tbody><tr><td><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/then">Promise.prototype.then</a></td><td>方法返回的是一个新的 Promise 对象，因此可以采用链式写法。这种设计使得嵌套的异步操作，可以被很容易得改写，从回调函数的”横向发展”改为”向下发展”。</td></tr><tr><td><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch">Promise.prototype.catch</a></td><td>是 Promise.prototype.then(null, rejection) 的别名，用于指定发生错误时的回调函数。Promise 对象的错误具有”冒泡”性质，会一直向后传递，直到被捕获为止。也就是说，错误总是会被下一个 catch 语句捕获。</td></tr><tr><td><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/finally">Promise.prototype.finally</a></td><td>方法返回一个<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>Promise</code></a>。在promise结束时，无论结果是fulfilled或者是rejected，都会执行指定的回调函数。这为在<code>Promise</code>是否成功完成后都需要执行的代码提供了一种方式。</td></tr><tr><td><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/all">Promise.all</a></td><td>这避免了同样的语句需要在<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/then"><code>then()</code></a>和<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/catch"><code>catch()</code></a>中各写一次的情况。Promise.all 方法用于将多个 Promise 实例，包装成一个新的 Promise 实例。Promise.all 方法接受一个数组作为参数，<code>var p = Promise.all([p1,p2,p3]);</code>p1、p2、p3 都是 Promise 对象的实例。（Promise.all 方法的参数不一定是数组，但是必须具有 iterator 接口，且返回的每个成员都是 Promise 实例。）p 的状态由 p1、p2、p3 决定，分成两种情况。  （1）只有p1、p2、p3的状态都变成fulfilled，p的状态才会变成fulfilled，此时p1、p2、p3的返回值组成一个数组，传递给p的回调函数。 （2）只要p1、p2、p3之中有一个被rejected，p的状态就变成rejected，此时第一个被reject的实例的返回值，会传递给p的回调函数。</td></tr><tr><td><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/race">Promise.race</a></td><td>Promise.race 方法同样是将多个 Promise 实例，包装成一个新的 Promise 实例。<code>var p = Promise.race([p1,p2,p3]);</code>上面代码中，只要p1、p2、p3之中有一个实例率先改变状态，p的状态就跟着改变。那个率先改变的Promise实例的返回值，就传递给p的返回值。</td></tr><tr><td><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/any">Promise.any</a></td><td>接收一个Promise可迭代对象，只要其中的一个 promise 成功，就返回那个已经成功的 promise 。所有子实例都处于rejected状态，总的promise才处于rejected状态。</td></tr><tr><td><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled">Promise.allSettled</a></td><td>返回一个在所有给定的promise都已经<code>fulfilled</code>或<code>rejected</code>后的promise，并带有一个对象数组，每个对象表示对应的promise结果。相比之下，<code>Promise.all()</code> 更适合彼此相互依赖或者在其中任何一个<code>reject</code>时立即结束。</td></tr></tbody></table><h5 id="小程序API接口Promise化并且把需要登录的调用接口模块化"><a href="#小程序API接口Promise化并且把需要登录的调用接口模块化" class="headerlink" title="小程序API接口Promise化并且把需要登录的调用接口模块化"></a>小程序API接口Promise化并且把需要登录的调用接口模块化</h5><ol><li>安装插件。请先查看<a href="https://developers.weixin.qq.com/miniprogram/dev/devtools/npm.html">npm支持</a>文档。</li></ol><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span> --save miniprogram-api-promise<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="2"><li>在微信开发者工具右方详情中勾选使用npm模块，并在菜单栏工具中点击构建npm。</li><li>初始化代码。</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// app.js</span><span class="token keyword">import</span> <span class="token punctuation">{</span>promisifyAll<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'miniprogram-api-promise'</span><span class="token keyword">import</span> login <span class="token keyword">from</span> <span class="token string">"../lib/login"</span><span class="token punctuation">;</span><span class="token keyword">const</span> wxp <span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token function">promisifyAll</span><span class="token punctuation">(</span>wx<span class="token punctuation">,</span>wxp<span class="token punctuation">)</span><span class="token comment">// 需要token的请求统一处理登录和设置header，并且处理错误信息</span>wxp<span class="token punctuation">.</span><span class="token function-variable function">requestNeedLogin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">let</span> token <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>    token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">loginWithPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>args<span class="token punctuation">.</span>header<span class="token punctuation">)</span> args<span class="token punctuation">.</span>header <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  args<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">"Authorization"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Bearer </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>token<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>  <span class="token keyword">return</span> wxp<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">// app.js</span><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  wxp<span class="token operator">:</span>wxp<span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="4"><li>改写login.js代码</li></ol><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// lib/login.js</span><span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>    <span class="token comment">// 推荐使用wx.getUserProfile获取用户信息，开发者每次通过该接口获取用户个人信息均需用户确认</span>    <span class="token comment">// 开发者妥善保管用户快速填写的头像昵称，避免重复弹窗</span>    wx<span class="token punctuation">.</span><span class="token function">getUserProfile</span><span class="token punctuation">(</span><span class="token punctuation">{</span>      desc<span class="token operator">:</span> <span class="token string">"用于完善会员资料"</span><span class="token punctuation">,</span> <span class="token comment">// 声明获取用户个人信息后的用途，后续会展示在弹窗中，请谨慎填写</span>       <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res0</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>        <span class="token keyword">let</span> <span class="token punctuation">{</span>          userInfo<span class="token punctuation">,</span>          encryptedData<span class="token punctuation">,</span>          iv        <span class="token punctuation">}</span> <span class="token operator">=</span> res0<span class="token punctuation">;</span>        <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">try</span> <span class="token punctuation">{</span>          app<span class="token punctuation">.</span>wxp<span class="token punctuation">.</span><span class="token function">checkSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">let</span> token <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getStorageSync</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>token<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">let</span> res1 <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span>wxp<span class="token punctuation">.</span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">let</span> code <span class="token operator">=</span> res1<span class="token punctuation">.</span>code<span class="token punctuation">;</span>          <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> app<span class="token punctuation">.</span>wxp<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            url<span class="token operator">:</span> <span class="token string">"http://localhost:3000/user/weixin-login"</span><span class="token punctuation">,</span>            method<span class="token operator">:</span> <span class="token string">"POST"</span><span class="token punctuation">,</span>            header<span class="token operator">:</span> <span class="token punctuation">{</span>              <span class="token string">"content-type"</span><span class="token operator">:</span> <span class="token string">"application/json"</span><span class="token punctuation">,</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            data<span class="token operator">:</span> <span class="token punctuation">{</span>              code<span class="token punctuation">,</span>              userInfo<span class="token punctuation">,</span>              encryptedData<span class="token punctuation">,</span>              iv<span class="token punctuation">,</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">err</span> <span class="token operator">=&gt;</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          token <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>authorizationToken<span class="token punctuation">;</span>          wx<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">"token"</span><span class="token punctuation">,</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>          app<span class="token punctuation">.</span>globalData<span class="token punctuation">.</span>token <span class="token operator">=</span> token<span class="token punctuation">;</span>          wx<span class="token punctuation">.</span><span class="token function">showToast</span><span class="token punctuation">(</span><span class="token punctuation">{</span>            title<span class="token operator">:</span> <span class="token string">"登录成功了"</span><span class="token punctuation">,</span>          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token function">resolve</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>      <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token keyword">export</span> <span class="token keyword">default</span> login<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="5"><li>调用代码</li></ol><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container page-head<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>page-section__title<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>需要登录的请求调用<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn-area<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>request1<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>请求1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bindtap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>request2<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>primary<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>请求2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// pages/index.js</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  <span class="token comment">/**   * 页面的初始数据   */</span>  data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">request1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>wxp<span class="token punctuation">.</span><span class="token function">requestNeedLogin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token operator">:</span> <span class="token string">"http://localhost:3000/user/home?name=andying"</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token function">request2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">getApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>wxp<span class="token punctuation">.</span><span class="token function">requestNeedLogin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>        url<span class="token operator">:</span> <span class="token string">"http://localhost:3000/user/home?name=eva"</span><span class="token punctuation">,</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>console<span class="token punctuation">.</span>log<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 微信小程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 登录 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>微信小程序Icon图标的几个实现方案</title>
      <link href="/2021/12/21/wei_xin_xiao_cheng_xu_icon_tu_biao_de_ji_ge_shi_xian_fang_an/"/>
      <url>/2021/12/21/wei_xin_xiao_cheng_xu_icon_tu_biao_de_ji_ge_shi_xian_fang_an/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="小程序Icon图标的几种实现方案"><a href="#小程序Icon图标的几种实现方案" class="headerlink" title="小程序Icon图标的几种实现方案"></a>小程序Icon图标的几种实现方案</h2><h3 id="小程序原生提供的Icon组件"><a href="#小程序原生提供的Icon组件" class="headerlink" title="小程序原生提供的Icon组件 "></a>小程序原生提供的<a href="https://developers.weixin.qq.com/miniprogram/dev/component/icon.html">Icon组件 </a></h3><h5 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h5><table><thead><tr><th>属性</th><th>类型</th><th>默认值</th><th>必填</th><th>说明</th></tr></thead><tbody><tr><td>type</td><td>string</td><td></td><td>是</td><td>icon的类型，有效值：success, success_no_circle, info, warn, waiting, cancel, download, search, clear</td></tr><tr><td>size</td><td>number/string</td><td>23</td><td>否</td><td>icon的大小</td></tr><tr><td>color</td><td>string</td><td></td><td>否</td><td>icon的颜色，同css的color</td></tr></tbody></table><h5 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h5><h6 id="组件size属性的长度单位默认为px，2-4-0起支持传入单位-rpx-px"><a href="#组件size属性的长度单位默认为px，2-4-0起支持传入单位-rpx-px" class="headerlink" title="组件size属性的长度单位默认为px，2.4.0起支持传入单位(rpx/px)"></a>组件size属性的长度单位默认为px，<a href="https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html">2.4.0</a>起支持传入单位(rpx/px)</h6><ol><li>PX 数值类型，默认使用，什么单位都不填，只写一个数值就可以</li><li>RPX（Responsive Pixel）屏幕自适应单位，他将屏幕分为750个单位，每个单位是1/750。</li></ol><img src="https://i.loli.net/2021/11/15/JFTBEusxnKaQ8D4.png" style="zoom:50%;"><p>比方说：iphone6的屏幕宽度是350px，每个rpx就是0.5px。也就是说如果我们在iphone6机器上将size的值设置为60rpx，他与设置为30或者30px的效果是一样的。</p><h6 id="组件color属性是改变图标所有像素点的颜色"><a href="#组件color属性是改变图标所有像素点的颜色" class="headerlink" title="组件color属性是改变图标所有像素点的颜色"></a>组件color属性是改变图标所有像素点的颜色</h6><h4 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h4><h5 id="图标与文本能否放在同一行中？"><a href="#图标与文本能否放在同一行中？" class="headerlink" title="图标与文本能否放在同一行中？"></a>图标与文本能否放在同一行中？</h5><p>可以的，图标本身就是为了更好的布局和更方便使用而诞生的。代码如下：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token property">font-size</span><span class="token punctuation">:</span> 17px<span class="token punctuation">;</span><span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>    我是一行文字，<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>success<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>15<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span>我里面包含了图标！<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="有时候真机上Icon显示空白"><a href="#有时候真机上Icon显示空白" class="headerlink" title="有时候真机上Icon显示空白"></a>有时候真机上Icon显示空白</h5><p>首先此问题肯定不是由于字体文件链接没有加入小程序的安全域名，WXSS加载图片及字体允许外域！如果图标是自定义实现的，要检查一下机型及嵌入的字体文件类型，可能是兼容性引起的，在小程序中推荐使用TTF和WOFF格式的字体。如果使用的是这两种字体，情况依然存在，可以考虑换SVG格式的数据嵌入。</p><h5 id="weui组件库里的icon组件的图标如何取出来，保存在本地？"><a href="#weui组件库里的icon组件的图标如何取出来，保存在本地？" class="headerlink" title="weui组件库里的icon组件的图标如何取出来，保存在本地？"></a>weui组件库里的icon组件的图标如何取出来，保存在本地？</h5><p>直接可以打开<a href="https://weui.io/">weui官网</a>，然后通过浏览器开发者工具查看源码，找到资源地址然后下载。或者在<a href="https://developers.weixin.qq.com/miniprogram/design/#%E5%9B%BE%E6%A0%87">微信的官方文档上下载</a>。</p><h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><p>开箱即用。</p><h5 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h5><p>只支持success, success_no_circle, info, warn, waiting, cancel, download, search, clear这几种类型，远远不能满足开发需求。</p><h3 id="自定义实现图标"><a href="#自定义实现图标" class="headerlink" title="自定义实现图标"></a>自定义实现图标</h3><h4 id="直接使用图片"><a href="#直接使用图片" class="headerlink" title="直接使用图片"></a>直接使用图片</h4><h5 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h5><p>简单粗暴，每个图标对应一个图片。</p><h5 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h5><ol><li>图片在文本中不方便布局。不方便修改颜色。</li><li>图片不能升缩，放大之后会变虚、有锯齿。</li><li>图片需要在本地或者网络上存储，这样将导致大量HTTP请求，使得页面加载速度变慢。</li><li>使用起来不如图标只使用一个名称那么方便。</li></ol><h4 id="使用精灵图"><a href="#使用精灵图" class="headerlink" title="使用精灵图"></a>使用精灵图</h4><p>Sprite，连续图片集，以非重叠、最小化分布的方式排列成一张图片。每次使用的时候通过纵横显示的起始坐标及区域大小，以达到动态切换的效果。</p><img src="https://i.loli.net/2021/11/15/7BH5gdkbLynrfM3.png" alt="2" style="zoom: 33%;"><h5 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h5><p>通过精灵图实现一个爆炸效果。图片大小为（650x650） px；所以每一个小图标大小为（130x130）px；这是css样式设置的width和height为130px的原因，也是js代码移动step设置为130的原因。js中left和top均为负数，这是由于这里不是显示图标的坐标，而是背景图片所要向左上方移动的距离。</p><p><strong>注意：在wxss中只可以使用网络图片，不能使用本地图片！</strong></p><p>代码如下：</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token comment">&lt;!--icon.wxml--&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sprite scale<span class="token punctuation">"</span></span> <span class="token style-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token style language-css"><span class="token selector">background-position:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>left<span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>top<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token comment">/* icon.wxss */</span><span class="token selector">.sprite</span><span class="token punctuation">{</span>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 130px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 130px<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"https://i.loli.net/2021/11/15/7BH5gdkbLynrfM3.png"</span><span class="token punctuation">)</span></span> no-repeat<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">.scale</span><span class="token punctuation">{</span>    <span class="token property">transform-origin</span><span class="token punctuation">:</span> 0 0 0<span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">scale</span><span class="token punctuation">(</span>2<span class="token punctuation">,</span>2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">// icon.js</span><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{</span>    <span class="token comment">/**     * 页面的初始数据     */</span>    data<span class="token operator">:</span> <span class="token punctuation">{</span>        left<span class="token operator">:</span><span class="token string">'0px'</span><span class="token punctuation">,</span>        top<span class="token operator">:</span><span class="token string">'0px'</span><span class="token punctuation">,</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span>    <span class="token comment">/**     * 生命周期函数--监听页面加载     */</span>    <span class="token function-variable function">onLoad</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">var</span> that <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> top <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> step <span class="token operator">=</span> <span class="token number">130</span><span class="token punctuation">;</span>        <span class="token keyword">const</span> stop <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">650</span><span class="token operator">-</span><span class="token number">130</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>             <span class="token keyword">if</span> <span class="token punctuation">(</span>left <span class="token operator">&gt;=</span> stop <span class="token operator">&amp;&amp;</span> top <span class="token operator">&gt;=</span>stop<span class="token punctuation">)</span> <span class="token punctuation">{</span>                  <span class="token function">clearInterval</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>             <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                left <span class="token operator">+=</span> step<span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>left <span class="token operator">&gt;=</span> <span class="token number">650</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                    top <span class="token operator">+=</span> step<span class="token punctuation">;</span>                <span class="token punctuation">}</span>                that<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>                    left<span class="token operator">:</span> <span class="token string">'-'</span> <span class="token operator">+</span> left <span class="token operator">+</span><span class="token string">'px'</span><span class="token punctuation">,</span>                    top<span class="token operator">:</span> <span class="token string">'-'</span> <span class="token operator">+</span> top <span class="token operator">+</span><span class="token string">'px'</span>                  <span class="token punctuation">}</span><span class="token punctuation">)</span>             <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="优点-2"><a href="#优点-2" class="headerlink" title="优点"></a>优点</h5><ol><li>在加载的时候，只加载一次。减少了HTTP请求。</li></ol><h4 id="使用CSS样式绘制"><a href="#使用CSS样式绘制" class="headerlink" title="使用CSS样式绘制"></a>使用CSS样式绘制</h4><h5 id="使用示例-1"><a href="#使用示例-1" class="headerlink" title="使用示例"></a>使用示例</h5><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>icon-close<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.icon-close</span><span class="token punctuation">{</span>    <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 17px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>45deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token selector">.icon-close::after</span> <span class="token punctuation">{</span>    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 17px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 2px<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">rotate</span><span class="token punctuation">(</span>-90deg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="缺点-2"><a href="#缺点-2" class="headerlink" title="缺点"></a>缺点</h5><ol><li>每个图标都需要写CSS样式代码，劳动量大。</li><li>这种图标不是字符，每个图标在绘制时要统一一个中心点，不然使用起来控制位置会比较麻烦。</li><li>大小与颜色也不方便控制。所以这并不是一种好的图标方案。</li></ol><h4 id="使用矢量字体-（推荐使用）"><a href="#使用矢量字体-（推荐使用）" class="headerlink" title="使用矢量字体 （推荐使用）"></a>使用矢量字体 （推荐使用）</h4><p>当浏览器渲染一个字符的时候，首先看font-family样式，确定使用字体名是哪一个。接着以此字符的Unicode在字体文件里查找对应的字符信息。</p><p>字体类型有两种，一种是点阵字体，一种是矢量字体。现在使用最广泛的是矢量字体。矢量字体大概分成三类：Adobe主导的Type1、Apple和Microsoft主导的TrueType、Adobe，Apple和Microsoft共同主导的开源字体OpenType。</p><p>在矢量字体里面每个Unicode只是每个字符的一个索引，每个字符描述信息是一个几何矢量绘图描述信息。以Type1为例，它使用三次贝塞尔曲线来绘制字形。TrueType则使用二次贝塞尔曲线描述字形。正是由于矢量字体是绘制出来的，所以它可以实时填充任何颜色，并且可以无极缩放而没有锯齿。</p><p><a href="https://iconfont.cn/">阿里巴巴的图标网站</a>，我们可以在此网站上搜索到任何图片在线编辑，并下载样式文件，在小程序里面使用。</p><p>字体源说明：</p><ol><li>EOT是微软IE浏览器专用的OpenType字体类型。</li><li>TTF是TrueType字体。</li><li>WOFF与WOFF2是移动开发专用的矢量字体格式。是对三种矢量字体格式的再封装。</li></ol><p>链接各种字体文件源可以兼容不同浏览器宿主环境。浏览器会选择自己支持的格式，从列表中的第一个开始尝试加载。一旦获得一个可以使用的，就不会再加载剩下的字体格式了。小程序里面建议使用TTF和WOFF这两个格式。WOFF2在低版本的IOS设备上会有不兼容的问题。</p><h5 id="使用示例可以参考此文章"><a href="#使用示例可以参考此文章" class="headerlink" title="使用示例可以参考此文章"></a>使用示例可以参考<a href="https://www.jianshu.com/p/25db60f77531">此文章</a></h5><h4 id="使用SVG矢量文件"><a href="#使用SVG矢量文件" class="headerlink" title="使用SVG矢量文件"></a>使用SVG矢量文件</h4><p>很多作图软件都可以导出SVG格式的矢量文件，比方说<a href="https://www.sketch.com/">Sketch</a>，但是它导出的SVG格式的矢量文件有没有用的垃圾信息。可以到<a href="https://iconfont.cn/">阿里巴巴的图标网站</a>编辑好之后下载SVG格式的矢量文件，它不带什么垃圾信息。然后我们拿这个文件找一个Image2base64工具，将文件内容转化为base64的字符串。然后就可以在小程序里使用这个base64的字符串作为图片源，实现自定义图标了。</p><h5 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h5><ol><li>准备SVG图片</li></ol><p><svg t="1636971106558" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="1338" width="200" height="200"><path d="M326.2 429.7L710 428 525.4 892.1z" fill="#83A4FF" p-id="1339"></path><path d="M370.2 271.1l292.4 2.6 51.7 113-379.5-2.6z" fill="#FF7E71" p-id="1340"></path><path d="M296.1 380.7L64.9 284.1l124.2-92.3 148.4 76.7z" fill="#A4BEFF" p-id="1341"></path><path d="M64.9 330.5L284 428l235.5 460.6zM755.6 427.1L960.9 321 528.8 886z" fill="#5B79FB" p-id="1342"></path><path d="M751.3 379.8l-57.8-119 132-73.4 113.8 95.8z" fill="#A4BEFF" p-id="1343"></path><path d="M365.8 233.4l-50-12.9-94-52.7 110.4-39.6h360.6l109.5 45.7-105.2 50.9-35.4 8.6z" fill="#C7D8FF" p-id="1344"></path></svg></p><ol start="2"><li><p>使用<a href="https://www.sojson.com/image2base64.html">线上Image2base64</a>转换图片为：</p><pre class="line-numbers language-svg" data-language="svg"><code class="language-svg">data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM2OTcwNTk4NjAyIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI2MDAiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMzI2LjIgNDI5LjdMNzEwIDQyOCA1MjUuNCA4OTIuMXoiIGZpbGw9IiM4M0E0RkYiIHAtaWQ9IjI2MDEiPjwvcGF0aD48cGF0aCBkPSJNMzcwLjIgMjcxLjFsMjkyLjQgMi42IDUxLjcgMTEzLTM3OS41LTIuNnoiIGZpbGw9IiNGRjdFNzEiIHAtaWQ9IjI2MDIiPjwvcGF0aD48cGF0aCBkPSJNMjk2LjEgMzgwLjdMNjQuOSAyODQuMWwxMjQuMi05Mi4zIDE0OC40IDc2Ljd6IiBmaWxsPSIjQTRCRUZGIiBwLWlkPSIyNjAzIj48L3BhdGg+PHBhdGggZD0iTTY0LjkgMzMwLjVMMjg0IDQyOGwyMzUuNSA0NjAuNnpNNzU1LjYgNDI3LjFMOTYwLjkgMzIxIDUyOC44IDg4NnoiIGZpbGw9IiM1Qjc5RkIiIHAtaWQ9IjI2MDQiPjwvcGF0aD48cGF0aCBkPSJNNzUxLjMgMzc5LjhsLTU3LjgtMTE5IDEzMi03My40IDExMy44IDk1Ljh6IiBmaWxsPSIjQTRCRUZGIiBwLWlkPSIyNjA1Ij48L3BhdGg+PHBhdGggZD0iTTM2NS44IDIzMy40bC01MC0xMi45LTk0LTUyLjcgMTEwLjQtMzkuNmgzNjAuNmwxMDkuNSA0NS43LTEwNS4yIDUwLjktMzUuNCA4LjZ6IiBmaWxsPSIjQzdEOEZGIiBwLWlkPSIyNjA2Ij48L3BhdGg+PC9zdmc+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ol start="3"><li>编写代码</li></ol><pre class="line-numbers language-css" data-language="css"><code class="language-css"><span class="token selector">.svg-icon</span><span class="token punctuation">{</span>    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>    <span class="token property">width</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>    <span class="token property">height</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>      <span class="token property">background-repeat</span><span class="token punctuation">:</span> no-repeat<span class="token punctuation">;</span>    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjM2OTcwNTk4NjAyIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI2MDAiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PGRlZnM+PHN0eWxlIHR5cGU9InRleHQvY3NzIj48L3N0eWxlPjwvZGVmcz48cGF0aCBkPSJNMzI2LjIgNDI5LjdMNzEwIDQyOCA1MjUuNCA4OTIuMXoiIGZpbGw9IiM4M0E0RkYiIHAtaWQ9IjI2MDEiPjwvcGF0aD48cGF0aCBkPSJNMzcwLjIgMjcxLjFsMjkyLjQgMi42IDUxLjcgMTEzLTM3OS41LTIuNnoiIGZpbGw9IiNGRjdFNzEiIHAtaWQ9IjI2MDIiPjwvcGF0aD48cGF0aCBkPSJNMjk2LjEgMzgwLjdMNjQuOSAyODQuMWwxMjQuMi05Mi4zIDE0OC40IDc2Ljd6IiBmaWxsPSIjQTRCRUZGIiBwLWlkPSIyNjAzIj48L3BhdGg+PHBhdGggZD0iTTY0LjkgMzMwLjVMMjg0IDQyOGwyMzUuNSA0NjAuNnpNNzU1LjYgNDI3LjFMOTYwLjkgMzIxIDUyOC44IDg4NnoiIGZpbGw9IiM1Qjc5RkIiIHAtaWQ9IjI2MDQiPjwvcGF0aD48cGF0aCBkPSJNNzUxLjMgMzc5LjhsLTU3LjgtMTE5IDEzMi03My40IDExMy44IDk1Ljh6IiBmaWxsPSIjQTRCRUZGIiBwLWlkPSIyNjA1Ij48L3BhdGg+PHBhdGggZD0iTTM2NS44IDIzMy40bC01MC0xMi45LTk0LTUyLjcgMTEwLjQtMzkuNmgzNjAuNmwxMDkuNSA0NS43LTEwNS4yIDUwLjktMzUuNCA4LjZ6IiBmaWxsPSIjQzdEOEZGIiBwLWlkPSIyNjA2Ij48L3BhdGg+PC9zdmc+"</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>icon</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>svg-icon<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>icon</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h5 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h5><p>此种方法仍旧需要一张图片处理一次，然后在页面中引用。注意：样式文件中的width和height属性的值需要和下载的SVG文件的width和height保持一致的（在svg标签中可以看到）。</p></li></ol><h4 id="使用Canvas绘制SVG绘制"><a href="#使用Canvas绘制SVG绘制" class="headerlink" title="使用Canvas绘制SVG绘制"></a>使用Canvas绘制SVG绘制</h4><p>这种绘制用于制作动画还是可以的，但是用来做图标有点大材小用了。<a href="https://developers.weixin.qq.com/community/develop/article/doc/000ca493bc09c0d03a8827b9b5b013">腾讯的将SVG绘制成图像的 Cax 引擎</a></p>]]></content>
      
      
      <categories>
          
          <category> 微信小程序 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Icon </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>物联网通信协议</title>
      <link href="/2021/12/21/wu_lian_wang_tong_xin_xie_yi/"/>
      <url>/2021/12/21/wu_lian_wang_tong_xin_xie_yi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="发布-订阅模式协议"><a href="#发布-订阅模式协议" class="headerlink" title="发布 - 订阅模式协议"></a>发布 - 订阅模式协议</h3><h4 id="MQTT"><a href="#MQTT" class="headerlink" title="MQTT"></a>MQTT</h4><p>MQTT（MQ Telemetry Transport）协议，是 IBM 公司在 1999 年开发的轻量级网络协议，采用的是发布 - 订阅通信模式，它有三个主要特点：</p><ol><li><strong>采用二进制的消息内容编码格式</strong>，所以二进制数据、JSON 和图片等负载内容都可以方便传输。</li><li><strong>协议头很紧凑，协议交互也简单</strong>，保证了网络传输流量很小。</li><li><strong>支持 3 种 QoS（Quality of Service，服务质量）级别</strong>，便于应用根据不同的场景需求灵活选择。</li></ol><p><strong>什么是 QoS？</strong>它是指通信双方关于消息传送可靠程度的协商。</p><p><strong>QoS 0级别</strong>，消息只发送一次，消息可能丢失；</p><p><strong>QoS 1级别</strong> ，发送方会接收反馈，保证消息的送达，但是可能消息会重复。</p><p><strong>QoS 2 级别</strong>，通过发送方和接收方的多次交互，保证消息有且只有一次。</p><p>MQTT 协议非常适合计算能力有限、网络带宽低、信号不稳定的远程设备，所以它成为了物联网系统事实上的网络协议标准。</p><h4 id="AMQP"><a href="#AMQP" class="headerlink" title="AMQP"></a>AMQP</h4><p>除了 MQTT 协议以外，也有其他采用发布 - 订阅模式的网络协议，比如 AMQP 协议。虽然 AMQP 协议拥有庞大的特性集，比较重，不适合计算资源有限、对功耗要求严苛的物联网设备，但是它可以满足后台系统对于<strong>可靠性和可扩展性</strong>的要求。因此，它在物联网的平台系统中应用广泛。比如，在分布式系统中应用广泛的 RabbitMQ 消息中间件软件，就是基于 AMQP 实现的。</p><p>AMQP 和 MQTT 一样，也是基于 TCP 协议，采用二进制消息格式，也支持 3 个 QoS 级别。现在被广泛使用 <strong>AMQP 1.0 和 AMQP 0.9.1</strong> 这两个版本，在设计上有<strong>很大的差异</strong>。你在查询资料或者应用这两个版本的 AMQP 协议时，一定要注意看版本，<strong>避免用错</strong>。</p><h3 id="请求-响应模式"><a href="#请求-响应模式" class="headerlink" title="请求 - 响应模式"></a>请求 - 响应模式</h3><p>发布 - 订阅模式的很多好处，但是凡事都有例外，也有一些物联网应用场景，并不适合使用这种模式。比如，现在小区里面都有智能快递柜，当你输入取件码后，服务器会向对应的柜门发送开门指令。在发布 - 订阅模式下，服务器知道指令发送成功了，但是它无法知道柜门是否真的打开了。这时，你就需要让柜门能够向服务器反馈一下命令的执行结果。当然，你也可以让服务器订阅一个“柜门关闭”的主题消息，然后等待柜门发布这个消息。但是这样的话就非常繁琐、不够直接。在这种场景下，另一种通信模式就能派上用场了，那就是<strong>请求 - 响应模式</strong>。</p><p>请求 - 响应模式有两个角色，一个是客户端（Client），另一个是服务器（Server）。<strong>客户端</strong>是请求数据或者服务的一方。<strong>服务器</strong>则用来接收客户端的请求，并提供相应的数据或者服务。服务器在收到请求后，会获取数据，对资源数据（比如数据库）进行加工处理，准备好响应，然后返回给客户端。</p><p>请求 - 响应模式是无状态的通信方式，每个完整的请求 - 响应都是相互独立的。进一步细分的话，它还可以分为同步和异步两种。你可以看下这张图片。</p><p><img src="https://s2.loli.net/2021/12/10/9GKdHniMWIecA6N.png" alt="请求响应模式协议"></p><h4 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h4><p>HTTP 就是采用请求 - 响应模式典型的代表。HTTP/2 协议还引入了异步请求 - 响应模式，客户端可以对请求设置不同的优先级，服务器可以根据优先级决定先响应哪个请求。虽然 HTTP 协议的报文格式非常重，光是报文头就能达到 KB 大小，不太适合资源有限的嵌入式设备。但在一些计算资源和网络资源都比较充足的物联网设备上，HTTP 协议仍然是一个可选项。而且它和现有的 Web 系统兼容，可以利用已有的 Web 服务器资源。</p><h4 id="CoAP"><a href="#CoAP" class="headerlink" title="CoAP"></a>CoAP</h4><p> CoAP（Constrained Application Protocol）协议，跟 HTTP 协议一样，CoAP 协议同样有 GET、POST、PUT、DELETE 等方法和响应状态码，同样使用 URI 而不是 Topic 来标识资源。比如我们需要访问服务器 iotdemo.com 下面的 bedroom/temp 这个资源，那完整的资源地址是：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">coap://iotdemo.com:5683/bedroom/temp <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>CoAP 的消息采用二进制格式，支持可确认消息和不可确认消息两种 QoS 级别。可确认消息（Confirmable Message）与 MQTT 协议的 QoS 1 类似，不可确认消息（Non-confirmable Message）对应 MQTT 协议的 QoS 0 级别。</p><p>另外，CoAP 协议基于的传输层协议是 <strong>UDP</strong>，而不是 HTTP 、 MQTT 协议的 TCP 协议，所以对于设备的计算资源要求更低。传感器设备一般只需要上传数据，不用随时接收服务器的控制命令，这都说明 CoAP 协议适合电池供电的传感器设备。</p><h4 id="LwM2M"><a href="#LwM2M" class="headerlink" title="LwM2M"></a>LwM2M</h4><p>LwM2M（Lightweight M2M）协议。LwM2M 协议定义在 CoAP 协议之上，不过它在消息传输的基础上更进一步。因为它基于 <strong>IPSO （IP-base Smart Object）</strong>对设备模型进行了标准化，提供了一组轻量级设备管理和交互接口协议。</p><p>LwM2M 协议目前主要的实现是 <strong>C 语言的 Wakaama 和 Java 语言的 Leshan</strong>，相对来说应用还比较少。CoAP 协议的应用场景同样适合 LwM2M 协议，如果你希望在 <strong>CoAP 协议的基础上更方便地实现设备的管理</strong>，可以考虑 LwM2M 协议。</p><h3 id="通信模式的共存"><a href="#通信模式的共存" class="headerlink" title="通信模式的共存"></a>通信模式的共存</h3><p> MQTT 5.0 中增加了请求 - 响应模式的新特性；AMQP 1.0 版本也定义了请求 - 响应模式。而 CoAP 协议呢，在新的初稿版本（Draft）中也增加了发布 - 订阅模式特性。这种网络协议中的通信模式的共存，相比单一模式的设计都大大方便了具体场景中的应用，代表了一种网络协议的发展方向。</p><h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>物联网应用是一个复杂的综合性系统，这要求你了解不同网络协议的功能特性和局限，并且为系统的不同部分做出合适的选择。这些选择原则，我总结为下面三点：</p><ol><li>物联网设备通常需要运行在网络不太可靠的环境中，而且在功耗、体积和计算资源方面也有诸多限制，所以我们在设备的开发中可以考虑使用 <strong>MQTT 和 CoAP 协议</strong>。</li><li>云平台各服务之间需要快速、可靠地进行消息转发，这种情况可以选择 <strong>AMQP 协议</strong>。</li><li>一些应用需要兼容 Web 系统的 RESTful 架构，比如通过 REST 开放物联网中的资源能力，供其他应用调用，这时 <strong>HTTP 和 CoAP 协议是合适的选择</strong>。</li></ol><p><img src="https://s2.loli.net/2021/12/10/Ju59GTfKmzlcUZp.png" alt="网络协议总结"></p>]]></content>
      
      
      <categories>
          
          <category> IOT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 通信协议 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>物联网网关</title>
      <link href="/2021/12/21/wu_lian_wang_wang_guan/"/>
      <url>/2021/12/21/wu_lian_wang_wang_guan/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="物联网网关：设备和云平台之间的桥梁"><a href="#物联网网关：设备和云平台之间的桥梁" class="headerlink" title="物联网网关：设备和云平台之间的桥梁"></a>物联网网关：设备和云平台之间的桥梁</h4><p>举个例子，设计过一个冷库温湿度监测系统，它是基于 LoRa 通信技术的。我们知道，冷库的环境是非常复杂的。</p><p>首先，库房内部的蜂窝网络信号一般都很差，一方面是因为要增强保温性能，所以墙壁做得比普通的墙体要厚；另一方面是因为库房位置通常位于城市的郊区，比较偏远，所以经常是完全没有网络信号。</p><p>其次，库房的信号环境是千变万化的，因为会出现满仓、空仓等多种情况。所以，在冷库内部部署的监测设备，如果直接连接蜂窝网络的话，完全不能实现可靠和稳定的通信。</p><p>这种情况下，可以选择的解决方案就是，<strong>在有稳定网络信号的地方部署物联网网关，让冷库里面的监测设备，通过 LoRa 这种穿透能力强、空旷环境通信范围可以达到几公里的技术跟网关通信，从而间接地实现设备的联网。</strong></p><p><img src="https://s2.loli.net/2021/12/12/z2b4fRsgKNh7VWr.png" alt="冷库物联网网关图"></p><p>物联网网关正在成为整个物联网体系中不可或缺的角色。它作为物联网设备与云平台之间的桥梁，变得越来越重要。</p><h4 id="协议转换：搭建桥梁的关键"><a href="#协议转换：搭建桥梁的关键" class="headerlink" title="协议转换：搭建桥梁的关键"></a>协议转换：搭建桥梁的关键</h4><p>BLE 、ZigBee 和 LoRa 设备在跟网关通信的时候，需要网关基于开放的或者内部私有的协议，解析出数据；然后网关再使用跟云平台的连接协议来组织数据，完成数据传输。</p><p>这个过程自然就要求网关设备能够支持不同的通信技术。下面给出了一张网关通信接口的结构示意图。</p><p><img src="https://s2.loli.net/2021/12/12/OQ2R9JHGSlTBeuV.png" alt="网关协议转换"></p><p>上北下南，上半部分叫“北向接口”，下半部分叫“南向接口”。这是行业内约定俗成的说法。</p><p><strong>北向接口</strong>需要接入互联网，所以通常的选择有 RJ45 以太网口、光纤接口、Wi-Fi 和 4G、NB-IoT 等蜂窝网络模组等。</p><p><strong>南向接口</strong>用来连接物联网设备，除了刚说的 BLE、ZigBee、LoRa、Wi-Fi 这些无线技术的接口，常见的还有用在工控机（Industrial Personal Computer，工业控制计算机）上的 RJ45 以太网口、RS232、RS485 等有线接口。</p><p>这里需要注意的是，每个网关设备的接口类型和个数不是固定的，因为网关产品一般会根据应用场景确定几个不同的规格型号。不同型号的网关需要支持不同类型的协议，以及不同个数协议的转换，所以网关的协议转换功能一般采用插件的软件架构方式。</p><p><strong>插件机制</strong>这种二次开发能力非常重要。一方面，它让我们可以根据接口的情况，动态、灵活地配置协议转换功能；另一方面，它也可以方便我们开发私有协议的解析功能。</p><p>比如通过 BLE、ZigBee 或 LoRa 技术跟网关通信的设备，它们通常采用的是私有的应用层协议，这就需要我们基于设备架构设计时定义的私有协议，专门编写解析代码。</p><p>至于使用 RJ45 网口或 Wi-Fi 跟网关连接的物联网设备，除了采用基于 TCP 或者 UDP 的私有协议之外，也可能采用我们之前讲过的 MQTT 或者 CoAP 这样标准的协议。这时，我们就需要按照这些协议的格式来处理。</p><p>另外，工控机 和 PLC （Programmable Logic Controller，可编程逻辑控制器）中经常使用的标准协议有 Modbus、ProfiBus、OPC UA 和 BACnet 等。</p><h4 id="网关的其他功能"><a href="#网关的其他功能" class="headerlink" title="网关的其他功能"></a>网关的其他功能</h4><p>经过协议转换，网关就得到了通用格式的数据。对于这些数据，网关还需要进行持久化，把数据临时存储起来。</p><p>网关的<strong>存储功能</strong>可以防止因网络临时故障等原因，导致设备数据的丢失。另外，网关和设备的配置信息也需要存储在网关中，以便设备运行过程中快速读取。</p><p>同时，数据的安全性也非常重要，物联网网关需要做好这几个方面的事情：</p><ol><li>完善的<strong>本地身份认证</strong>。这样可以防止网关设备被随意修改软件或者数据。</li><li>网关保证<strong>数据的加密传输</strong>。因为很多物联网设备的计算能力非常弱，不具备进行数据加密的能力，这时就需要借助网关来保证数据或者控制命令的加密和解密。</li><li>网关能够<strong>支持运营商专网接入</strong>，或者支持 VPN（Virtual Private Network，虚拟专用网络）技术。这里我补充说明一下，VPN 技术的好处是基于互联网网络建立加密通道。这样既保证了数据传输的安全可靠，又比建立专线成本要低。常用的 VPN 协议有 IPsec、OpenVPN 等。</li></ol><p>除了我刚才讲到的<strong>协议转换</strong>、<strong>存储功能和安全管理</strong>，物联网网关一般还有<strong>设备管理</strong>、<strong>网关配置</strong>、<strong>空中升级</strong>这些功能模块。</p><h4 id="在网关上做数据分析"><a href="#在网关上做数据分析" class="headerlink" title="在网关上做数据分析"></a>在网关上做数据分析</h4><p>在行业内已经开始尝试将云平台上的部分计算服务，下沉到靠近数据发生地的“<strong>边缘设备</strong>”上进行，这就是<strong>边缘计算</strong>的由来，而物联网网关是边缘计算中<strong>最轻量级</strong>的解决方案的关键。</p><p><strong>边缘设备</strong>，比如物联网网关，完成<strong>初步</strong>的数据处理，和需要<strong>及时响应</strong>的计算任务；而<strong>云平台</strong>负责需要<strong>大规模数据</strong>和<strong>复杂计算</strong>的数据分析工作，以及<strong>完成整体的协调和控制</strong>。</p><p>具体来说，云平台将原有的云计算模型的部分计算任务迁移到网络边缘设备上来；网络边缘设备（比如路由器、移动网络基站等），在数据源附近执行数据处理和数据分析任务。这样一来，就降低了云计算中心的计算负载，减轻了物联网对于网络带宽的压力，提高了数据处理的效率。</p><p>边缘计算模型的好处：</p><ol><li><strong>延迟低</strong>。数据只需要从产生设备传输到边缘设备，传输距离短，数据不需要通过其他网络，网络延迟低。</li><li><strong>节约了主干网带宽</strong>。缓解大量数据传输所造成的网络拥堵想象。尤其像一些银行的专有网络，本身带宽非常有限，只能用于传输关键性的数据。</li><li><strong>计算可用性好</strong>。数据在网络中的路径长度显著变短，因网络波动引起的计算服务不可用情况将有所减少。</li><li><strong>隐私性更好</strong>。由于边缘设备距离用户近，用户的隐私数据不再需要上传到云平台，因此，在边缘计算场景下，用户的隐私也可以得到更好的保护。</li></ol><h5 id="边缘计算对网关的影响"><a href="#边缘计算对网关的影响" class="headerlink" title="边缘计算对网关的影响"></a>边缘计算对网关的影响</h5><p>技术架构的变化，一般也会对系统提出新的需求。边缘计算对网关的影响，主要体现在三个方面。</p><ol><li>首先，为了更好地在网关中运行边缘计算任务，网关需要支持<strong>虚拟化技术</strong>，这在目前的实践中通常是采用<strong>容器技术</strong>实现。容器天然具有轻量和可移植的优点，非常适合开发人员快速测试应用程序，也方便维护人员在网关上大规模部署和更新应用程序。另外，容器技术也更利于网关使用容器自动运维平台技术，比如 Kubernetes，来实现应用程序的编排等功能。</li><li>其次，因为网络环境的不确定性，网关需要具备一定的<strong>自治能力</strong>。当网关与云平台的通信中断时，这种情况不应该影响网关处理数据的计算任务，和对物联网设备的管理。</li><li>最后，因为边缘计算的引入，我们需要在网关侧实现数据分析处理的任务。而网关的硬件资源非常多样，业务需求也千差万别，所以网关上提供<strong>统一的开发框架</strong>变得更加重要。开发框架可以为开发人员提供一致的 API 和组件的互操作能力。这样开发人员可以更加高效地实现业务功能，也更容易和其他厂商协作。</li></ol><p>加入边缘计算能力后的网关架构图：</p><p><img src="https://s2.loli.net/2021/12/12/ITWlmh2Ki5PJLyO.png" alt="网关架构图"></p><h4 id="怎样实现边缘计算？"><a href="#怎样实现边缘计算？" class="headerlink" title="怎样实现边缘计算？"></a>怎样实现边缘计算？</h4><p>首先说一下<strong>标准化组织</strong>。目前，在推进边缘计算的标准组织主要有三个，分别是：</p><ol><li>Linux 基金会下的 <a href="https://www.lfedge.org/">LF Edge</a> （Linux Foundation Edge）和致力于推进 Cloud Native 的 <a href="https://www.cncf.io/">CNCF</a>（Cloud Native Computing Foundation）</li><li>Eclipse 基金会下面的 <a href="https://iot.eclipse.org/">Eclipse IoT</a> 项目</li><li><a href="https://www.openstack.org/">OpenStack 基金会</a></li></ol><p><strong>容器技术</strong>：主要有 <a href="https://kubeedge.io/zh/">KubeEdge</a> 项目，它的主要思路是将 Kubernetes 从云端扩展到边缘设备，方便应用程序在边缘网关上的编排和调度，同时实现云端和边缘设备的协同数据处理。</p><p><strong>开发框架</strong>：比较知名的是 <a href="https://cn.edgexfoundry.org/">EdgeX Foundry</a> 项目，定位是为工业物联网提供通用的边缘计算框架。为此，它适配了很多协议，提供出标准的 API 接口。</p><p>专门针对<strong>智能家居领域</strong>的项目有 <a href="https://www.lfedge.org/projects/homeedge/">Home Edge</a> ，它是三星贡献的一个开源项目，用于加速智能家居设备的边缘部署。</p><h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>随着物联网应用场景越来越多，物联网网关正在成为“边缘中心”。它成为物联网的<strong>“云、边、端</strong>”架构（即云平台、边缘、终端三部分）中非常重要的组成部分。做物联网网关的架构设计和功能开发中，需要重点关注的内容有：</p><ol><li>物联网网关是设备与云平台之间的桥梁，网关的南向接口和北向接口都非常多样。因此协议转换功能是必须包含的功能。它保证了物联网设备数据的可靠上传，和云平台控制命令的有效执行。</li><li>关注网关基础功能的实现。这些功能包括存储功能、安全管理、设备管理、网关配置和空中升级这些功能模块。它们既保证了数据的安全和可靠传输，也为远程维护提供了支持。</li><li>需要根据业务场景，决定网关对于边缘计算的支持能力。边缘计算对于物联网网关的架构有 3 个方面的影响：（1） 容器技术。容器技术的应用利于开发人员快速开发、测试应用程序，也方便维护人员在网关上大规模部署、更新应用程序。同时，基于容器自动运维平台技术可以实现应用程序的编排等功能。（2）自治能力。它可以保证网络环境不稳定时，网关的数据分析处理任务的正常执行。（3）开发框架。开发框架利于开发人员的开发工作，也有益于各部分组件的协同互操作。</li></ol>]]></content>
      
      
      <categories>
          
          <category> IOT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>物联网之数据</title>
      <link href="/2021/12/21/wu_lian_wang_zhi_shu_ju/"/>
      <url>/2021/12/21/wu_lian_wang_zhi_shu_ju/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="从数据的角度审视物联网"><a href="#从数据的角度审视物联网" class="headerlink" title="从数据的角度审视物联网"></a>从数据的角度审视物联网</h4><p><img src="https://s2.loli.net/2021/12/10/LZsxP1Yogat3cKd.png" alt="数据视角看物联网"></p><h5 id="第一步：数据源数据采集"><a href="#第一步：数据源数据采集" class="headerlink" title="第一步：数据源数据采集"></a>第一步：数据源数据采集</h5><p>数据源数据采集，就是通过各种物联网设备，实现各种数据数字化的任务，同时也可能需要将数据临时存储起来，准备好数据的上传工作。</p><p>因为数据类型多种多样，比如我们常说的温度、湿度、甲醛含量，另外还有图像、声音、震动等等，所以采集这些数据的设备也具有明显的<strong>多样性</strong>。</p><p>除了传统的嵌入式系统涉及的软件和硬件开发外，传感器是这一部分需要重点关注的关键元器件。随着物联网的发展，新的应用在不断涌现，比如监测人体心率和血氧饱和度的可穿戴设备，以及在智慧农业中用来测量土壤反射率和植物颜色的光学传感器等等。</p><p>采集完数据后，你就要利用网络将数据传输到云服务器。</p><h5 id="第二步：数据传输"><a href="#第二步：数据传输" class="headerlink" title="第二步：数据传输"></a>第二步：数据传输</h5><p>数据传输，就是把采集的数据快速地、可靠地上报到云平台。这里的技术难点是实现高并发。因为物联网设备的数量巨大，而且它们在时刻不断地产生数据，所以海量的数据对云平台的性能构成了挑战。云平台只有具备高并发的能力，才能有效地、可靠地实现数据的传输。<strong>高并发</strong>的实现，需要借助<strong>分布式</strong>的架构设计，同时使用<strong>负载均衡、消息队列和缓存</strong>等相关技术。</p><h5 id="第三步：数据存储"><a href="#第三步：数据存储" class="headerlink" title="第三步：数据存储"></a>第三步：数据存储</h5><p>数据传输完成之后，你要面对问题是<strong>海量数据</strong>的存储。</p><p>比如，一辆共享单车一天会产生 1MB 的数据，如果按照 2000 万辆的保有量计算，每天就会产生 20TB 的新增数据。而在智慧城市的系统中，一个 800 万像素的摄像头，一个小时就能产生 3.6GB 的数据。那么一座城市，光是摄像头，一个月的数据量就可以达到数百 PB。</p><p>除了数据量大，数据的种类也很丰富，它们大体上可以分为 3 类，分别需要有不同的存储手段：</p><ol><li><strong>结构化数据（Structured data）</strong></li><li><strong>半结构化数据（Semi-structured data）</strong></li><li><strong>非结构化数据（Unstructured data）</strong></li></ol><h6 id="结构化数据（Structured-data）"><a href="#结构化数据（Structured-data）" class="headerlink" title="结构化数据（Structured data）"></a>结构化数据（Structured data）</h6><p>比如用户和设备的关系，用户信息、设备参数等。这类数据还是适合<strong>关系型数据库</strong>，基于关系型数据库，我们可以很容易地实现数据的“增删改查”，而且可以方便地实现事务操作，保证数据操作满足 ACID 特性（也就是原子性 Atomic，一致性 Consistency，隔离性 Isolation 和持久性 Durability）。</p><p>为了应对大数据对计算和读写性能的挑战，数据库系统需要借助分布式架构的威力（横向扩展），你可以采用<strong>分布式数据库</strong>。</p><p><strong>分布式关系型数据库</strong></p><p>行业内一开始的实践是<strong>对数据库进行分库分表</strong>，然后借助<strong>数据库中间件</strong>实现关联查询、主键避免重复、分页查询和事务一致性等功能。但是这种方式有很多弊端，比如分库分表需要根据业务数据的特点仔细设计，而且这种分库分表操作一定会涉及非常麻烦的数据迁移工作；通过中间件执行 SQL 的效率不高；事务一致性很难保证，往往需要在应用中实现“最终的一致性”。</p><p>为了解决这些问题，<strong>分布式关系型数据库</strong>出现了。它也经常被称为 <strong>NewSQL 数据库</strong>。它的优势主要体现以下 3 个方面。</p><ol><li><strong>高扩展性</strong>。NewSQL 天生支持数据分片，支持动态增加节点，不需要进行麻烦的数据迁移工作，所以能够轻松地满足数据不断增大时的存储需求。</li><li><strong>高并发性</strong>。相比于单机关系型数据库基于磁盘的设计，NewSQL 在设计上更好地利用了内存，所以 SQL 执行效率很高。在事务的支持上，NewSQL 有着高效的分布式事务特性。所以它可以实现海量数据的读取和写入，以及大量用户的查询和更新等操作。</li><li><strong>高可用性</strong>。NewSQL 采用 Paxos 或者 Raft 协议来实现多副本的存储，而且还支持自动选择主节点，保证了数据库的故障切换时间很短。</li></ol><p>所以，对于需要<strong>强一致性事务</strong>的场景（比如共享单车物联网系统中的支付交易），以及需要基于关系模型进行复杂查询的场景（比如共享单车中涉及用户信息表、单车信息表和骑行记录表的丢失单车查询），当单机关系型数据库已经无法满足大数据需求时，可以考虑分布式关系型数据库。尤其是当之前的业务已经基于关系型数据库开发完成，并且在实际服务环境中运行的时候，分布式关系型数据库简直是业务开发人员的福音。因为这种情况下想改用其他类型的数据库，如果数据库不支持 SQL 语言，业务代码就需要进行大量的修改和调整。</p><p>在实践中，分布式数据库的开源选择有 <a href="https://pingcap.com/zh/product/#SelectProduct">TiDB</a>、<a href="https://www.cockroachlabs.com/">CockroachDB</a> 等，也有商业化的产品，比如阿里巴巴的 <a href="https://www.oceanbase.com/">OceanBase</a> 等。</p><p>另外，物联网中的传感器设备，<strong>随时间不断产生新数据</strong>。要存储这类数据，你可以选择<strong>时序数据库</strong>，来获得更高的读写和查询性能。</p><p><strong>时序数据库</strong></p><p>分布式关系型数据库这个方案，是从增加能力的角度得到的。那么，我们能不能从简化问题的角度出发，找到其他解决方案呢？</p><p>物联网中传感器的应用系统就是这样的场景，比如监控冷库中温度和湿度条件的传感器。这些传感器会按照一定的周期不断地上报数据（比如每 1 分钟上报 1 次）。这样的数据按照时间顺序排列，形成了一系列的数据点，所以被称为<strong>时间序列数据（Time Series Data）</strong>，简称<strong>时序数据</strong>。</p><p>时序数据在读写、存储和分析处理方面有下面这些特点：</p><ol><li><strong>时序数据是持续地写入</strong>，一般是采用固定的频率，没有写入量忽大忽小的明显变化。数量非常大，而且并发写入的需求也很高。但是数据很少做更新，旧数据除了特殊情况下的修改，基本是不需要更新的写入操作。</li><li><strong>时序数据的读取很少</strong>，相比写入的高并发和高频率，读取的需求主要是进行数据分析的应用，而分析应用的并发访问量是比较少的。</li><li><strong>时序数据时效性很强</strong>，一般是<strong>越新的数据价值就越大</strong>，旧数据会迅速失去价值。</li><li><strong>时序数据的数据分析主要关心的是新数据</strong>，旧数据被查询和分析的概率不高。旧数据一般是粗颗粒度的读取分析。而且在被分析时，一般是基于时间范围读取分析，读取某一条记录的几率很小。</li></ol><p>基于时序数据结构和应用上的特点，人们开发出了<strong>时序数据库</strong>，它在近些年随着物联网的应用变得非常流行。时序数据库简化了关系型数据库很多不必要的功能，比如<strong>采用读取性能不高的 LSM 树代替 B+ 树的存储结构</strong>。它专注于支持高并发的数据写入，采用<strong>更高压缩比的压缩算法</strong>来支持海量数据的存储，降低存储的成本，同时，通过<strong>预处理</strong>等方法来支持海量数据的<strong>高效分组聚合</strong>计算。</p><p>序数据库的具体产品有哪些呢？</p><p>首先是开源软件，你可以选择 <a href="https://www.influxdata.com/">InfluxDB</a>，<a href="http://kairosdb.github.io/">KairosDB</a> 和 <a href="http://opentsdb.net/">OpenTSDB</a> 等产品。</p><p>另外，云服务企业一般都开发了自己的时序数据库，比如<a href="https://www.aliyun.com/product/hitsdb?spm=a2c4g.11174283.h2v3icoap.114.42341426br5G1P">阿里巴巴的 TSDB</a> 和亚马逊的 AWS Timestream 等。其中，TSDB 还扩展支持了空间信息，以便处理地理围栏和空间轨迹等需求。</p><h6 id="半结构化数据（Semi-structured-data）"><a href="#半结构化数据（Semi-structured-data）" class="headerlink" title="半结构化数据（Semi-structured data）"></a>半结构化数据（Semi-structured data）</h6><p>比如 <strong>JSON 结构的数据，日志记录</strong>等。这些数据的存储一般采用 <strong>NoSQL 数据库</strong>产品。</p><p>半结构化数据包含相关标记，用来分隔语义元素，以及对记录和字段进行分层。比如，JSON 格式的数据JSON 中大括号“{}”，中括号”[]”，冒号”:”，逗号”,”就是分隔语义元素，每个冒号前面的内容是字段，后面的是记录。</p><p><img src="https://s2.loli.net/2021/12/13/SdgJLbIkXtv6pw3.png" alt="JSON"></p><p>半结构化数据的特点是，它的<strong>结构并不固定，属于同一类实体可以有不同的属性，这表明它有很好的可扩展性</strong>。另外，即使它们被组合在一起，这些属性的顺序并不重要。这些特点决定了我们很难按照关系型数据库的数据模型来建立半结构数据的结构和相互之间的关联。除了 JSON，常见的半结构数据还有 XML 等。在应用系统中呢，日志文件就是典型的半结构化数据。</p><p>为了更有效地存储半结构化数据，我们可以选择 <strong>NoSQL 数据库</strong>。它以键值对存储，且结构不固定，每一个元组可以有不一样的字段。每个元组可以根据需要增加一些自己的键值对，这样数据库就不会局限于固定的结构，可以减少一些时间和空间的开销。</p><p>其实，我们知道 SQL 只是一种操作数据库数据的接口，所以 NoSQL 中的“No”真正表达的意思是 No Relational，专业的叫法应该是<strong>非关系型数据库</strong>。</p><p>非关系型数据库由于<strong>不再强调数据的一致性，不支持事务操作，也不再关注复杂的关联表查询</strong>，所以它对海量数据的处理性能更好，而且存储的数据格式比较丰富，易于扩展。有些非关系型数据库会使用内存来存储数据，以便支持更快的查询速度。</p><p>非关系型数据库也有很多的开源产品，比如 <a href="https://couchdb.apache.org/">CouchDB</a>、<a href="https://redis.io/">Redis</a>、<a href="https://hbase.apache.org/">HBase</a>、<a href="https://cassandra.apache.org/_/index.html">Cassandra</a> 等，你可以根据熟悉程度和生态支持选择。商业化的选择也有 <a href="https://www.mongodb.com/">MongoDB</a> 和 <a href="https://www.oracle.com/cloud/sign-in.html?redirect_uri=https://cloud.oracle.com/zh_CN/nosql">Oracle NoSQL</a> 等产品。</p><h6 id="非结构化数据（Unstructured-data）"><a href="#非结构化数据（Unstructured-data）" class="headerlink" title="非结构化数据（Unstructured data）"></a>非结构化数据（Unstructured data）</h6><p>非结构化数据没有预定义的数据模型，无法简单地用数据库二维表结构来表现。它的格式非常多样，标准也不是统一的。对于这一类数据的大规模存储，我们只能使用<strong>分布式文件系统</strong>。</p><p>比如视频、音频等数据。它们一般采用文件的形式存储，Hadoop 体系中应用广泛的分布式文件系统 <strong><a href="https://hadoop.apache.org/docs/r1.0.4/cn/hdfs_design.html">HDFS</a></strong> 是常用的选项。其他的分布式文件系统还有 <a href="https://gitee.com/fastdfs100/fastdfs">FastDFS</a> 和 <a href="https://ceph.com/en/">Ceph</a> 等。</p><p><img src="https://s2.loli.net/2021/12/13/8yqM9GUeJsRQPCu.png" alt="数据存储总结"></p><p>只有当实现了海量数据的存储，我们也才能为数据的处理打好基础。</p><h6 id="数据迁移工具"><a href="#数据迁移工具" class="headerlink" title="数据迁移工具"></a>数据迁移工具</h6><p>数据的迁移工作比较麻烦，需要在设计阶段就尽量避免。但是，有些数据迁移的需求可能是你避免不了的。比如你要把已运行系统中 MySQL 数据库里的数据，导入到 NoSQL 数据库 HBase 中，以便使用大数据技术进行分析处理。</p><p>对于这样的需求，我们就得借助工具来完成，比较有名的工具就是 <a href="https://sqoop.apache.org/">Sqoop</a> 项目。它在 Hadoop 大数据存储系统和关系型数据库等系统之间架起了桥梁，借助 Sqoop，你就可以很方便地把 MySQL 数据导入到 HBase 中。另外，Sqoop 采用了被称为 <strong>Connector</strong> 的插件架构，不同的 Connector 还可以对接不同的数据源，而且你也可以根据自己的需求定制专属的 Connector 来完成一些特殊的迁移工作。所以，Sqoop 也可以完成 NoSQL 数据库（比如 CouchDB）和文件存储系统（比如 FTP）之间的迁移任务。</p><p><img src="https://s2.loli.net/2021/12/13/eHMpqibD34vTYa2.png" alt="sqoop"></p><p>当然，Sqoop 也有一个缺点，那就是<strong>不太适合增量的数据更新</strong>，又叫 <strong>CDC（Change Data Capture）</strong>。如果基于 Sqoop 采用定时扫描整张表的方法，那么执行会比较低效，延时也比较严重。这时，你可以考虑 LinkedIn 开源的 <a href="https://github.com/linkedin/databus">Databus</a> 项目，或者阿里巴巴的 <a href="https://github.com/alibaba/canal">Canal</a>，它们都是基于<strong>分析数据库日志文件</strong>来高效地实现数据的增量更新。</p><h5 id="第四步：数据处理"><a href="#第四步：数据处理" class="headerlink" title="第四步：数据处理"></a>第四步：数据处理</h5><p>数据处理阶段，非常考验你对海量数据的处理能力，你需要用到<strong>大数据计算引擎</strong>。大数据的处理，从应用场景划分的话，可以分成两个大类：</p><ol><li><strong>批处理</strong>，顾名思义，它是对批量的数据进行统一处理的方法。批处理适合海量静态数据的非实时处理，延迟比较高，也叫离线计算，主要用于离线报表、历史数据汇总等场景。比如我们需要知道一个月里，共享单车的总骑行时长和距离，骑行距离最远的单车等信息，就需要对所有单车的数据做汇总的计算，得出想要的结果。批处理的计算过程可能<strong>耗时</strong>较长，几分钟、几个小时，甚至几天都有可能。</li><li><strong>流处理</strong>，它是对数据流做<strong>及时</strong>的处理计算。相比批处理，它具有低延时的特点，一般可以达到毫秒甚至微秒的级别。这样可以满足海量数据对于大吞吐量的处理能力的需求。主要用于实时监控、趋势预测、实时推荐等场景。比如温度、湿度数据基于高、低阈值的实时判断，就需要采用流处理的方式。</li></ol><h6 id="批处理之经典思路：MapReduce-的分而治之"><a href="#批处理之经典思路：MapReduce-的分而治之" class="headerlink" title="批处理之经典思路：MapReduce 的分而治之"></a>批处理之经典思路：MapReduce 的分而治之</h6><p>首先，谷歌（Google）基于公司内部的实践，在 2004 年发表了分布式计算框架的<a href="https://users.soe.ucsc.edu/~sbrandt/221/Papers/DataManagement/dean-osdi04.pdf">论文</a>。这篇论文提出了 MapReduce 计算框架的设计思想，主要用于解决海量网页的索引生成问题。接着，开源搜索引擎项目 <strong>Nutch</strong> 的开发人员，基于这个设计思想开发出了开源的  <a href="https://hadoop.apache.org/docs/r1.2.1/mapred_tutorial.html">Hadoop MapReduce</a>  实现。</p><p>具体来说，就是把数据分成相同大小的多份，然后相应地创建多个任务，并行地处理这些数据分片，这个的过程被定义为 Map 过程；接着，再将 Map 过程中生成的计算结果进行最终的汇总，生成输出结果，这个过程被定义为 Reduce 过程。这两个过程合起来就是 MapReduce 了。</p><h6 id="批处理之高效率开源框架：以“快如闪电”为目标的-Spark"><a href="#批处理之高效率开源框架：以“快如闪电”为目标的-Spark" class="headerlink" title="批处理之高效率开源框架：以“快如闪电”为目标的 Spark"></a>批处理之高效率开源框架：以“快如闪电”为目标的 <a href="https://spark.apache.org/">Spark</a></h6><p>Spark 是如何打造高效率框架的呢？</p><p>首先，在计算模型上，Spark 抛弃了 MapReduce 的两个过程模型，采用了 <strong>DAG</strong>（Directed Acyclic Graph，有向无环图）模型。采用 DAG 来描述数据处理的过程，应该说是反映了数据处理过程的本质。这样一方面开发人员可以更容易地描述复杂的计算逻辑，另一方面计算框架也能更方便地自动优化整个数据流，比如避免重复计算。</p><p>其次，Spark 的数据存取充分地利用了<strong>内存</strong>。</p><p>它的数据分片被称为 <strong>Partition</strong>。然后它基于 Partition，提出了 <strong>RDD</strong>（Resilient Distributed Datasets，<strong>弹性分布式数据集</strong>）的概念。所谓的“弹性”就是指，数据既可以存储在磁盘中，也可以存储在内存中，而且可以根据内存的使用情况动态调整存储位置。这就提高了计算的效率。</p><h6 id="流处理开源框架：Storm、Spark-Streaming-和-Flink"><a href="#流处理开源框架：Storm、Spark-Streaming-和-Flink" class="headerlink" title="流处理开源框架：Storm、Spark Streaming 和 Flink"></a>流处理开源框架：Storm、Spark Streaming 和 Flink</h6><p>这其中最早的代表就是社交网络公司 Twitter 开发的 <a href="https://storm.apache.org/">Storm</a> 框架。Storm 的一个重要概念就是数据流（Stream）。相对于批处理针对数据块的处理方式，所谓的流处理，就是针对数据流的处理方式。Storm 把 Stream 描述成是<strong>元组</strong>（Tuple）构成的一个无限的序列。Stream 从水龙头（Spout）中产生，也就是说，Spout 把需要处理的数据转换为由 Tuple 构成的 Stream。然后 Stream 经过转接头（Bolt）的处理，输出新的 Stream。其中，Bolt 的处理可以是过滤、函数操作、Join 等任何操作。你可以参见下面的流程图示例：</p><p><img src="https://s2.loli.net/2021/12/13/39EqseaRk2pun7h.png" alt="storm拓扑"></p><p>图片中的 Spout、Bolt 和 Stream 共同构成了 Storm 中另一个重要概念，拓扑（Topology）。你应该可以看出来 Topology 是一个 DAG（有向无环图）。Storm 框架中运行的正是一个个 Topology，而且因为是流处理，它会一直运行直到被手动终止。</p><p>基本上和 Storm 同时出现的流处理开源框架是 <a href="https://spark.apache.org/streaming/">Spark Streaming</a>。Spark Streaming 正是将数据流转换成一小段一小段的 <strong>RDD</strong>。这些小段的 RDD 构成一个流式的 RDD 序列，称为 <strong>DStream</strong>，所以它的流处理被称为“<strong>微批处理</strong>”。</p><p><img src="https://s2.loli.net/2021/12/13/mdcFMBR3kVSYGUL.png" alt="Spark stream"></p><p>显然，它的实时性取决于每小段 RDD 的大小，实时性不如 Storm 框架；不过，这种方式也使它的吞吐能力要大于 Storm。整体来看，你可以认为 Spark（包括 Spark Streaming）基于数据块的数据模型，同时提供了批处理和流处理的能力。</p><p><strong><a href="https://flink.apache.org/">Flink</a></strong> 将数据块作为一种特殊的数据流，通过从文件等持久存储系统中按照 Stream（流）的方式读入和处理，来提供批处理的能力。在这个基础之上，Flink 提供了统一的批处理和流处理框架，也就是所谓的“流批一体”的数据处理框架。</p><p>Flink 虽然出现的时间不长，但凭借着优秀的设计，性能非常强，延迟可以低到微秒级别，是对实时计算性能要求的高的场景的理想选择。行业内，阿里云和腾讯云对于 Flink 的支持都非常好；很多企业也在实践中逐渐尝试使用 Flink 来替代 Storm 框架。</p><p><img src="https://s2.loli.net/2021/12/13/2SmuGNljZci1PCD.png" alt="数据处理框架"></p><h5 id="第五步：数据应用"><a href="#第五步：数据应用" class="headerlink" title="第五步：数据应用"></a>第五步：数据应用</h5><p>数据应用处于整个体系的最顶端，是物联网系统的最终目的。我们关注的核心点是通过数据<strong>创造价值</strong>，而实现的基础是<strong>各种算法</strong>。</p><h4 id="数据如何产生价值呢？"><a href="#数据如何产生价值呢？" class="headerlink" title="数据如何产生价值呢？"></a>数据如何产生价值呢？</h4><p>数据产生价值的方法，概况来说，可以分为 4 种：</p><ol><li><strong>可视化</strong></li><li><strong>挖掘</strong></li><li><strong>预测</strong></li><li><strong>控制决策</strong></li></ol><p>最直接的方法是可视化，也可以称为图表分析。可视化可以非常直观地向人们展示数据的含义。比如共享单车的地理位置，如果给用户一个经纬度坐标，那无异于没有给这个信息；而在地图上以光标的方式显示出来，那用户就可以马上知道这个单车相对于自己的方位和距离。类似的还有以<strong>曲线、柱状图表示数据变化趋势</strong>，以<strong>饼状图表示百分比数据</strong>，用<strong>网络图表示的事物关系</strong>等等。它们都可以为原始数据，和分析结果数据提供理想的展示手段。</p><p>比图表分析更进一步的方法是<strong>挖掘分析</strong>。我们可以基于各类算法来分析数据的规律和关联关系等。这种方法基于各种现成的模型，或者自定义的模型，可以从数据中提取出<strong>人工分析无法看出来</strong>的、<strong>隐藏</strong>着的<strong>规律和联系</strong>。</p><p>还有一种进阶的方法是<strong>预测分析</strong>。随着积累的数据和经验越来越多，我们可以用算法来构建预测模型。当新收集的数据输入给模型时，我们就可以<strong>预测出未来的状况</strong>。</p><p>最后一种方法是<strong>控制决策</strong>。物联网设备可能具备<strong>执行器</strong>，物联网系统可以基于业务目标控制这些执行器。而控制决策是采集的数据基于算法计算得到的。</p><h4 id="数据分析可以使用的算法有哪些？"><a href="#数据分析可以使用的算法有哪些？" class="headerlink" title="数据分析可以使用的算法有哪些？"></a>数据分析可以使用的算法有哪些？</h4><p>挖掘分析、预测分析和控制决策要用到统计分析、机器学习，包括人工智能的各种算法。这些算法分为<strong>监督学习和非监督学习</strong>两类。</p><ol><li><strong>督学习算法</strong>需要我们像尽心尽责的父母，明确告诉它“什么是正确的”，“什么是错误的”。</li><li><strong>非监督学习算法</strong>面对的是“放羊式”父母，需要自己将数据中的“异常值”区分出来。</li></ol><p><strong>常见的监督学习算法有决策树和 SVM（支持向量机）算法</strong>等。<strong>决策树类</strong>似我上面描述的<strong>专家系统</strong>；<strong>SVM 算法</strong>是一种<strong>分类算法</strong>，也可以用于线性和非线性回归问题，比如基于骑行习惯构建用户的画像。</p><p><strong>非监督学习算法有 K-means 算法</strong>等。K-means 算法是<strong>聚类算法</strong>，比如，基于共享单车的使用次数和时间段，我们可以区分出故障车和正常单车。</p><p>总之，<strong>使用算法的一个原则是，你先要分析数据的特征，掌握大体的倾向，然后结合你要实现的目标，再选择合适的算法</strong>。</p><p><img src="https://s2.loli.net/2021/12/10/u7o1CJ9SthpNZrE.png" alt="物联网数据技术体系"></p>]]></content>
      
      
      <categories>
          
          <category> IOT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> data </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>体验物联网之MQTT协议</title>
      <link href="/2021/12/21/ti_yan_wu_lian_wang_zhi_mqtt_xie_yi/"/>
      <url>/2021/12/21/ti_yan_wu_lian_wang_zhi_mqtt_xie_yi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="MQTT介绍"><a href="#MQTT介绍" class="headerlink" title="MQTT介绍"></a>MQTT介绍</h4><p>MQTT（MQ Telemetry Transport）协议，是 IBM 公司在 1999 年开发的轻量级网络协议，采用的是发布 - 订阅通信模式，它有三个主要特点：</p><ol><li><strong>采用二进制的消息内容编码格式</strong>，所以二进制数据、JSON 和图片等负载内容都可以方便传输。</li><li><strong>协议头很紧凑，协议交互也简单</strong>，保证了网络传输流量很小。</li><li><strong>支持 3 种 QoS（Quality of Service，服务质量）级别</strong>，便于应用根据不同的场景需求灵活选择。</li></ol><p>MQTT 协议非常适合计算能力有限、网络带宽低、信号不稳定的远程设备，所以它成为了物联网系统事实上的网络协议标准。</p><h4 id="MQTT-自身的“基因”很强大"><a href="#MQTT-自身的“基因”很强大" class="headerlink" title="MQTT 自身的“基因”很强大"></a>MQTT 自身的“基因”很强大</h4><p> MQTT 协议作为物联网设备的“第一语言”，不仅是因为 MQTT 的生态完善，MQTT 协议本身的优秀设计也是重要的因素。</p><h5 id="契合物联网大部分应用场景的发布-订阅模式。"><a href="#契合物联网大部分应用场景的发布-订阅模式。" class="headerlink" title="契合物联网大部分应用场景的发布 - 订阅模式。"></a>契合物联网大部分应用场景的<strong>发布 - 订阅模式</strong>。</h5><p>采用了发布 - 订阅模式，MQTT 协议具有很多优点，比如能让一个传感器数据触发一系列动作；网络不稳定造成的临时离线不会影响工作；方便根据需求动态调整系统规模等。这使得它能满足绝大部分物联网场景的需求。</p><h5 id="能够满足物联网中资源受限设备需要的轻量级特性。"><a href="#能够满足物联网中资源受限设备需要的轻量级特性。" class="headerlink" title="能够满足物联网中资源受限设备需要的轻量级特性。"></a>能够满足物联网中资源受限设备需要的<strong>轻量级</strong>特性。</h5><p>MQTT 是一个<strong>轻量</strong>级的网络协议，这一点也是它在物联网系统中流行的重要原因。毕竟物联网中大量的都是计算资源有限、网络带宽低的设备。这种“轻量级”体现在两个方面。</p><p>一方面，MQTT 消息采用<strong>二进制的编码格式</strong>，而不是 HTTP 协议那样的文本的表述方式。在 HTTP 协议传输的这段文本中，每个字符都要占用  1 个字节。而如果使用 MQTT 协议，一个字节就可以表示很多内容。下面的图片展示了 MQTT 的固定头的格式，这个固定头只有 2 个字节：</p><p><img src="https://s2.loli.net/2021/12/10/zbO423dNKXkIHa9.png" alt="MQTT协议格式"></p><p>第一个字节分成了高 4 位（4～7）和低 4 位（0～3）；低  4  位是数据包标识位，其中的每一比特位又可以表示不同的含义；高 4 位是不同数据包类型的标识位。第二个字节表示数据包头部和消息体的字节共个数，其中最高位表示有没有第三字节存在，来和第二个字节一起表示字节共个数。如果有第三个字节，那它的最高位表示是否有第四个字节，来和第二个字节、第三个字节一起表示字节总个数。依此类推，还可能有第四个字节、第五个字节，不过这个表示可变头部和消息体的字节个数的部分，<strong>最多也只能到第五个字节</strong>，所以可以表示的最大数据包长度有 256MB。</p><p>比如，一个请求建立连接的 CONNECT 类型数据包，头部需要 14 个字节；发布消息的 PUBLISH 类型数据包头部只有 2～4 个字节。</p><p>另一方面，体现在消息的具体<strong>交互流程设计非常简单</strong>，所以 MQTT 的交互消息类型也非常少。</p><p><img src="https://s2.loli.net/2021/12/10/SGUYFe6bgjKaV71.png" alt="MQTT消息类型"></p><p>从表格可以看出，MQTT 3.1.1 版本一共定义了 14 种数据包的类型，在第一个字节的高 4 位中分别对应从 1 到 14 的数值。</p><h5 id="时刻关注物联网设备低功耗需求的优化设计。"><a href="#时刻关注物联网设备低功耗需求的优化设计。" class="headerlink" title="时刻关注物联网设备低功耗需求的优化设计。"></a>时刻关注物联网设备<strong>低功耗</strong>需求的优化设计。</h5><p>除了让协议足够轻量，MQTT 协议还很注重低功耗的优化设计，这主要体现在对能耗和通信次数的优化。</p><p>比如，MQTT 协议有一个 <strong>Keepalive 机制</strong>。它的作用是，在 Client 和 Broker 的连接中断时，让双方能及时发现，并重新建立 MQTT 连接，保证主题消息的可靠传输。这个机制工作的原理是：Client 和 Broker 都基于 Keepalive 确定的时间长度，来判断一段时间内是否有消息在双方之间传输。这个  Keepalive 时间长度是在 Client 建立连接时设置的，如果超出这个时间长度，双方没有收到新的数据包，那么就判定连接断开。</p><p>虽然 Keepalive 要求一段时间内必须有数据包传输，但实际情况是，Client 和 Broker 不可能时时刻刻都在传输主题消息，这要怎么办呢？</p><p>MQTT 协议的解决方案是，定义了 PINGREQ 和 PINGRESP 这两种消息类型。它们都没有可变头部和消息体，也就是说都只有  2  个字节大小。Client 和 Broker 通过分别发送 PINGREQ 和 PINGRESP 消息，就能够满足 Keepalive 机制的要求。我猜你也想到了，如果要一直这样“傻傻地”定期发送消息，那也太浪费电量和网络资源了。所以，如果在 Keepalive 时间长度内，Client 和 Broker 之间有数据传输，那么 Keepalive 机制也会将其计算在内，这样就不需要再通过发送 PINGREQ 和 PINGRESP 消息来判断了。</p><p>除了 Keepalive 机制，MQTT 5.0 中的重复主题特性也能帮助我们节省网络资源。Client 在重复发送一个主题的消息时，可以从第二次开始，将主题名长度设置为 0，这样 Broker  会自动按照上次的主题来处理消息。这种情况对传感器设备来说十分常见，所以这个特性在工作中很有实际意义。</p><h5 id="针对物联网中多变的网络环境提供的多种服务质量等级。"><a href="#针对物联网中多变的网络环境提供的多种服务质量等级。" class="headerlink" title="针对物联网中多变的网络环境提供的多种服务质量等级。"></a>针对物联网中多变的网络环境<strong>提供的多种服务质量等级</strong>。</h5><p>MQTT 协议设计了  3 种不同的 QoS  （Quality of Service，服务质量）级别。你可以根据场景灵活选择，在不同环境下保证通信是可靠的。</p><p><strong>什么是 QoS？</strong>它是指通信双方关于消息传送可靠程度的协商。</p><p><strong>QoS 0级别</strong>，消息只发送一次，消息可能丢失；</p><p><strong>QoS 1级别</strong> ，发送方会接收反馈，保证消息的送达，但是可能消息会重复。</p><p><strong>QoS 2 级别</strong>，通过发送方和接收方的多次交互，保证消息有且只有一次。</p><p><img src="https://s2.loli.net/2021/12/10/DsrPoIh3TJ5xbqp.png" alt="MQTT协议服务等级"></p><p>可以看到，QoS 0 和 QoS 1 的流程相对比较简单；而 QoS 2 为了保证有且只有一次的可靠传输，流程相对复杂些。正常情况下，QoS 2 有 PUBLISH、PUBREC、PUBREL 和 PUBCOMP 4 次交互。至于“不正常的情况”，发送方就需要重复发送消息。比如一段时间内没有收到 PUBREC 消息，就需要再次发送 PUBLISH 消息。不过要注意，这时要把消息中的 “重复”标识设置为 1，以便接收方能正确处理。同样地，如果没有收到 PUBCOMP 消息，发送方就需要再次发送 PUBREL 消息。</p><h5 id="支持在物联网应用中越来越被重视的数据安全。"><a href="#支持在物联网应用中越来越被重视的数据安全。" class="headerlink" title="支持在物联网应用中越来越被重视的数据安全。"></a>支持在物联网应用中越来越被重视的<strong>数据安全</strong>。</h5><p>说到安全传输，首先我们需要验证 Client 是否有权限接入 MQTT Broker。为了控制 Client 的接入，MQTT 提供了<strong>用户名 / 密码</strong>的机制。在建立连接过程中，它可以通过判断用户名和密码的正确性，来筛选有效连接请求。但是光靠这个机制，还不能保证网络通信过程中的数据安全。因为在明文传输的方式下，不止设备数据，甚至用户名和密码都可能被其他人从网络上截获而导致泄漏，于是其他人就可以伪装成合法的设备发送数据。所以，我们还需要通信加密技术的支持。MQTT 协议支持 SSL/TLS 加密通信方式。采用 SSL/TLS 加密之后，<strong>MQTT</strong> 将转换为 <strong>MQTTS</strong>。这有点类似于 HTTP 和 HTTPS 的关系。</p><h4 id="体验-MQTT"><a href="#体验-MQTT" class="headerlink" title="体验 MQTT"></a>体验 MQTT</h4><h5 id="使用hbmqtt简单体验MQTT"><a href="#使用hbmqtt简单体验MQTT" class="headerlink" title="使用hbmqtt简单体验MQTT"></a>使用hbmqtt简单体验MQTT</h5><p>第一步是安装 <strong>hbmqtt</strong>，它是一个开源的基于 Python 语言的 MQTT Broker  软件，正好包括我们需要使用一些工具。跟其他选择相比，这个软件安装起来非常方便，因为它在 Python 的 PYPI 软件仓库中就有，所以你通过 pip 命令就可以安装。这也是选择使用它的主要原因。不过要注意的是，hbmqtt 是基于 <strong>Python3</strong> 实现的，因此这里使用的是 pip3 工具。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip3 <span class="token function">install</span> hbmqtt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>安装完成后，我们就可以使用 hbmqtt 中提供的  <strong>hbmqtt_sub</strong> 和 <strong>hbmqtt_pub</strong> 这两个命令行工具了。通过名字，你应该也可以看出 hbmqtt_sub 可以充当订阅者的角色；hbmqtt_pub 可以作为消息的发布者。</p><p>至于订阅者和发布者之间的经纪人，也就是 MQTT Broker，我们使用  Eclipse 免费开放的<a href="https://test.mosquitto.org/">在线 Broker</a> 服务。打开链接，你可以看到关于端口的介绍信息，加密和非加密方式都支持，而且还有基于 Websocket 的实现，这对基于前端网页的应用来说是非常有利的。</p><p>我们先使用 1883 端口的非加密方式，然后为消息传输确定一个主题（Topic）。主题确定了消息的类别，用于消息过滤。比如我们待会儿要测试的消息可以设为“**/mqtt/test**”。</p><p>接着，我们在电脑的终端界面输入下面的命令，就可以订阅这个主题消息：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hbmqtt_sub --url mqtt://test.mosquitto.org:1883 -t /mqtt/test<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在，我们启动另外一个终端界面，通过 hbmqtt_pub 发布一个 “**/mqtt/test**” 主题的消息：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">hbmqtt_pub --url mqtt://test.mosquitto.org:1883 -t /mqtt/test -m Hello,World<span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="搭建自己的MQTT-Broker，进行深度体验"><a href="#搭建自己的MQTT-Broker，进行深度体验" class="headerlink" title="搭建自己的MQTT Broker，进行深度体验"></a>搭建自己的MQTT Broker，进行深度体验</h5><p><strong>使用<a href="https://docs.vernemq.com/">VerneMQ</a>作为MQTT Broker</strong></p><p>第一步，使用docker安装VerneMQ。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker run -p <span class="token number">1883</span>:1883 -e <span class="token string">"DOCKER_VERNEMQ_ACCEPT_EULA=yes"</span> -e <span class="token string">"DOCKER_VERNEMQ_ALLOW_ANONYMOUS=on"</span> --name vernemqtt -d vernemq/vernemq<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第二步，使用VSCode连接VerneMQ，安装VsMqtt插件。</p><p><img src="https://s2.loli.net/2021/12/10/MbhGoytjguXYNLq.png" alt="使用VsMqtt连接VerneMQ"></p><p>MQTT 的客户端（Client）代码实现，可以使用<a href="http://www.eclipse.org/paho/index.php?page=downloads.php">Eclipse Paho</a> 项目。</p>]]></content>
      
      
      <categories>
          
          <category> IOT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MQTT </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IOT通信技术</title>
      <link href="/2021/12/21/iot_tong_xin_ji_zhu/"/>
      <url>/2021/12/21/iot_tong_xin_ji_zhu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="无线通信技术的-4-个重要参数"><a href="#无线通信技术的-4-个重要参数" class="headerlink" title="无线通信技术的 4 个重要参数"></a>无线通信技术的 4 个重要参数</h4><h5 id="频段"><a href="#频段" class="headerlink" title="频段"></a>频段</h5><p>无线通信当然用的是电磁波，在实际应用中，电磁波是按照频段来使用的。频段是指电磁波频率的一个范围，对应到频谱中就像是一段一段切割开。你看“频段”这个名词，是不是很形象？</p><p><img src="https://s2.loli.net/2021/12/09/vxNEnkDtcA51is3.png" alt="频谱分布图"></p><p>上面这张图展示了整个<a href="http://www.c-fol.net/baike/content/3/1712.html">频谱的频段</a>分布。图中的分段基于电磁波不同的特性，而通信技术则需要考虑不同的使用需求和管理，对无线电波做更进一步的分段。</p><p>在这个频谱图中，Wi-Fi 的频段是 2.412GHz-2.484GHz。这是一个非授权频段，其他的通信技术也可以使用，所以在后面你会看到蓝牙技术也基本是这个频率范围。理解了这一点，也许你就能明白，为什么 Wi-Fi 路由器和蓝牙耳机、键鼠，在某些情况下会相互干扰了。有没有什么办法能解决通信干扰呢？答案是肯定的，其中一种有效的方法是基于信道的跳频技术。</p><h5 id="信道"><a href="#信道" class="headerlink" title="信道"></a>信道</h5><p>它是信息通过无线电波传送的具体通道介质。每种通信技术的频段会被划分、规划成多个<a href="https://en.wikipedia.org/wiki/List_of_WLAN_channels">信道</a>来使用。比如，Wi-Fi 的频段被分为 14 个信道（中国可用的是 13 个信道，信道 14 排除在外）。这里需要注意的是，相邻信道的频段是存在重叠的。比如，Wi-Fi 的信道 1 频段是 2.401GHz～2.423GHz，信道 2 频段是 2.406GHz～2.428GHz。</p><h5 id="信道带宽"><a href="#信道带宽" class="headerlink" title="信道带宽"></a>信道带宽</h5><p>信道频段的最大值和最小值之差，就是信道覆盖的范围大小，也叫信道带宽。比如，Wi-Fi  信道 1 的带宽是 22MHz，它是由 2.423GHz 减去 2.401GHz 得到的。需要注意的是，22MHz 是信道 1 的实际带宽，而它的有效带宽只有 20MHz，因为其中有 2MHz 是隔离频带。隔离频带主要是起保护作用的，就像高速公路上的隔离带。</p><h5 id="传输速率"><a href="#传输速率" class="headerlink" title="传输速率"></a>传输速率</h5><p>选择通信技术的时候，传输速率就是我们需要关注的重要指标。它是指数据传输的快慢，单位是比特 / 秒（bit per second，简记为 <strong>bps</strong>）。</p><p>不同的传输速率可以支撑不同的应用场景。比如，5G 峰值 20Gbps 的传输速率为移动 VR/AR 应用提供了技术可能。在 4G 时代，这种应用就会受到限制，我们只能在室内拖根线来感受 VR/AR 的魅力。</p><p>传输速率受很多因素的影响，比如信道带宽和频率。一般来说，带宽越大，传输速率就越大，就像路面越宽可以承载的通行车辆越多一样；频率比较高时，电磁环境相对比较干净、干扰少，传输速率会更高，就像道路更平坦自然可以通行更多车辆一样。</p><p>另外，为了提高传输速率，越来越多的<strong>提高频段利用率</strong>的技术也被开发出来并投入使用，比如正交频分复用。也许你对这个技术比较陌生，我再举一个更为人熟知的例子好了，<strong>MIMO</strong>（Multiple-Input Multiple-Output）技术，你可能在 Wi-Fi 路由器上或者手机宣传资料中见到过它，它是通过使用多重天线收发信号来提高传输速率的。</p><p><img src="https://s2.loli.net/2021/12/09/uMiHCBTqeFmG369.png" alt="无线通信4要素"></p><p>实际应用中，不同的通信技术有不同的信道个数；同一种技术，不同的版本也会对信道做不同的划分。</p><h4 id="Wi-Fi"><a href="#Wi-Fi" class="headerlink" title="Wi-Fi"></a>Wi-Fi</h4><p><a href="https://en.wikipedia.org/wiki/Wi-Fi#Versions">Wi-Fi</a> 是 IEEE 802.11 无线网络标准的商品名。所以，支持 Wi-Fi 功能的设备上，都会标注 “兼容 IEEE 802.11b/g/n 2.4GHz” 之类的说明。其中，802.11b、802.11g、802.11n 就是 Wi-Fi 的不同版本。</p><p>这种版本命名方式当然不够直观，所以 Wi-Fi 联盟从 2018 年开始推进数字版本号，比如，Wi-Fi 5、Wi-Fi 6。我在这里放了一张表格，展示了新旧版本号的对应关系。</p><p><img src="https://s2.loli.net/2021/12/09/4F69bw3KqsEWfZM.png" alt="wifi"></p><p>Wi-Fi 网络分布广泛，在家里、在办公场所，包括很多公共区域都有覆盖。所以，它自然也成了很多智能设备的选择，尤其是<strong>连接电源线、不需要关心功耗的设备</strong>，往往优先考虑 Wi-Fi。</p><p>实践中有一个事情需要注意，那就是 <strong>Wi-Fi 的配网</strong>。之所以需要“Wi-Fi 配网绑定”这个操作流程，根本原因是，物联网设备不像手机、电脑，没有便利的信息输入手段，也没有完备的信息显示器件。因此，我们无法像在手机上一样，帮设备搜索、连接上 Wi-Fi 热点。相反，我们需要借助其他手段来完成两件事情：</p><ol><li>Wi-Fi 设备需要连接上路由器（Wi-Fi 热点或者 AP）实现数据上传和远程控制，即获取到 Wi-Fi 热点的名称（称为 SSID）和密码。</li><li>获取到 Wi-Fi 设备的 MAC 地址，或者设备生产时预存的信息，并与用户账号一起上传服务器完成绑定。</li></ol><p>完成这两步之后，设备才可以联网使用。</p><h5 id="一键配网技术（SmartConfig）"><a href="#一键配网技术（SmartConfig）" class="headerlink" title="一键配网技术（SmartConfig）"></a>一键配网技术（SmartConfig）</h5><p>一键配网技术的工作原理，是通过手机或 Wi-Fi 路由器发送 UDP 广播包的形式，将 Wi-Fi 的 SSID 和密码广播出去。Wi-Fi 设备在进入配网模式后，会将接收到的广播包进行解析，从而获取到 Wi-Fi 的 SSID 和密码，然后连接上路由器。同样地，Wi-Fi 设备连接上路由器后，也会广播自己的 MAC 地址，这样手机 App 就可以接收到设备的 MAC 地址完成绑定。</p><p>这个原理看着不复杂，但却有几个容易出错的地方：</p><ol><li>很多路由器不支持 UDP 广播，例如 Wi-Fi 放大器或者关闭 UDP 广播的路由器，会导致在发广播包这步就失败了。</li><li>目前很多路由器已经支持 2.4GHz 和 5GHz 两个频段（Wi-Fi 4 之后），这两个频段的网络是相互隔离的。手机很可能连接的是 5GHz 频段，那包含 SSID 和密码的广播包也在 5GHz 频段，而目前所有 Wi-Fi 智能设备都只支持 2.4GHz 频段，这就导致无法收到广播包。</li><li>2018 年之前的 Wi-Fi 产品（比如微信 AirKiss 2.0）存在广播包解析错误的问题，很可能发生解析的密码不正确的情况，导致无法连接路由器。</li><li>路由器不支持局域网通信（比如路由器的访客网络），或者空间中有几个 SSID 相同的 Wi-Fi 热点，手机和 Wi-Fi 设备分别在不同的路由器下面，会导致设备即使连接上了路由器，但是手机无法获取设备信息的广播包的情况。</li></ol><h5 id="设备热点配网技术"><a href="#设备热点配网技术" class="headerlink" title="设备热点配网技术"></a>设备热点配网技术</h5><p>设备热点配网技术是让 Wi-Fi 设备先进入 Wi-Fi AP 的模式，也就是说，由设备创建出一个 Wi-Fi 热点，然后让手机连接到这个热点，接着把路由器 Wi-Fi 的 SSID 和密码发送给 Wi-Fi 设备，同时手机也可以直接获取到设备的 MAC 地址。</p><p>这种方式的麻烦之处在于，你需要手动输入路由器 Wi-Fi 的密码。在苹果手机上，你还需要进入设置界面，手动选择连接智能设备的 Wi-Fi 热点。</p><p>其他 Wi-Fi 配网技术还有零配置配网、蓝牙配网、手机热点配网和路由器配网等技术方式。<a href="https://help.aliyun.com/document_detail/97570.html">下图</a>展示了各种配网技术中角色之间的关系，供你参考。</p><p><img src="https://s2.loli.net/2021/12/09/8SArZ9fMdvwjckF.png" alt="配网"></p><h4 id="BLE"><a href="#BLE" class="headerlink" title="BLE"></a>BLE</h4><p>连接电源线、不需要关心功耗的设备往往优先考虑 Wi-Fi，那么功耗要求严格的设备要怎么办呢？</p><p>BLE （Bluetooth Low Energy）是一个不错的选择。它的频段是非授权的 2.400GHz-2.4835GHz，采用 40 个带宽 2MHz 的通道。BLE也叫低功耗蓝牙，是对 Bluetooth 4.0 / 4.1 / 4.2 的统称。现在它已经成为低功耗物联网设备的首选，仅仅依靠一颗纽扣电池供电就可以工作数年。</p><p>而蓝牙 5 更是针对物联网增加了很多特性，比如 Mesh 组网、更远的通信距离、更快传输速率（BLE 4.2 的 2 倍）和更大数据承载量的广播包（BLE 4.2 的 8 倍），此外还有厘米级精度的定位功能。</p><p>除了这些，蓝牙技术还有一个优势，那就是应用实践非常广泛，是智能手机等设备的标配。因此，无论是从芯片模组的价格考虑，还是从生态的丰富度考虑，它都是电池供电的智能设备的理想选择。</p><p>BLE 的数据通信主要基于<strong>广播包</strong>和 <strong><a href="https://learn.adafruit.com/introduction-to-bluetooth-low-energy/gatt">GATT</a></strong> 协议。</p><p>连接参数的调节对于 BLE 设备的扫描和连接等影响很大。这些参数包括广播间隔、最大连接间隔、最小连接间隔和连接监听时间等，它们都可以在设备的固件开发中进行调整。比如广播间隔会影响扫描的响应速度，也会对设备的功耗有影响，所以需要平衡功耗和响应速度的不同需求，选择一个合适的值。</p><p>如果扫描连接体验需要非常流畅迅速，你可以选择 20ms 的间隔，但是这会增加设备的功耗，减少待机时间；如果你能够容忍一定的扫描等待时间，那么可以选择 1-2 秒的广播间隔来降低功耗。</p><p>如果你在 Android 手机上开发 BLE 相关的应用，还有两点是我想提醒你的。</p><p>一是不同品牌 Android 手机的芯片解决方案往往是不同的，它们的蓝牙协议栈实现也存在很大的差异。所以开发者需要针对不同的手机进行充分的测试，保证开发的应用在不同的手机上都可以正常运行。</p><p>二是因为基于 BLE 可以进行地理位置定位，所以从 Android 6.0 开始，进行 BLE 开发时需要请求位置权限。这一点经常被忽略，也是需要注意的。</p><h4 id="2G"><a href="#2G" class="headerlink" title="2G"></a>2G</h4><p>2G 是相对早期的蜂窝通信技术，你可能觉得这个词听起来都已经有些年代感了。不过，在一些传输数据量不大的场景中，采用 2G 技术的联网设备还有不少，比如路灯控制器、冷链运输监测设备等。</p><p>但是，你在新产品的设计中要尽量避免使用 2G 模组，因为 2G 的退网已经不可避免。联通已经率先推进，移动也开始逐步实施，腾出的频段会用于发展 5G 网络通信。如果新产品仍然采用 2G 模组，未来无网可用时会非常麻烦，甚至在那之前你就会遇到很多因网络引起的产品体验问题。</p><h4 id="LTE-Cat1-amp-NB-IoT"><a href="#LTE-Cat1-amp-NB-IoT" class="headerlink" title="LTE-Cat1 &amp; NB-IoT"></a><a href="http://www.gov.cn/zhengce/zhengceku/2020-05/08/content_5509672.htm">LTE-Cat1 &amp; NB-IoT</a></h4><p>那么，2G 的替代选择是什么呢？从目前国内通信产业的发展看，LTE-Cat1 和 NB-IoT 是你值得关注的选项。NB-IoT 模组的价格已经和 2G 模组基本持平；LTE-Cat1 的模组相比要贵一些，但是也要远低于 4G 模组的价格。</p><p>LTE-Cat1 有一个独特优势是网络覆盖，它属于 4G 网络的低速类别，可以直接使用我们国家完善的 4G 的网络设施。而 NB-IoT 虽然已经发展多年，但是目前网络覆盖仍然不够理想，这也限制了这些年 NB-IoT 的广泛应用。不过，NB-IoT 大概率会成为 5G 的重要组成部分。随着 5G 产业的发展，我相信 NB-IoT 仍然会广泛应用在低速率、广域网络的场景中。</p><p>LTE-Cat1 的带宽是 20MHz，上行速率 5Mbps，下行速率 10Mbps。它有良好的移动特性，功耗比 NB-IoT 大些，但是低于传统的 2G/3G 设备。所以它适合可穿戴设备、ATM 机、自助售货机和无人机等场景。这些场景对数据传输速率有一定要求，但是又不需要达到 4G 的水平。</p><p>NB-IoT 的带宽是 180KHz，上行速率 16.9Kbps，下行速率是 26Kbps，功耗很低。所以它不适合移动环境，但却很适合智能抄表、智能灯杆和烟感报警器等低数据速率的场景。</p><p><img src="https://s2.loli.net/2021/12/10/qijXkv29Cx7rRla.png" alt="LTE-NB"></p><h4 id="5G"><a href="#5G" class="headerlink" title="5G"></a>5G</h4><p>5G 被分为 3 个主要应用场景，分别对应 eMBB、uRLLC 和 mMTC 3 个标准：</p><ol><li><strong>eMBB</strong> 用于我们日常的手机移动通信，网络传输速率高主要就是指这个标准。</li><li><strong>uRLLC</strong> 应用的场景是无人驾驶、远程手术等，所以强调的是极低时延，而且是稳定的时延和速率，这不难理解，如果远程做手术，那肯定不能出现卡顿和忽长忽短的时延。</li><li><strong>mMTC</strong> 可以支持大规模设备的连接上网，适合智能门锁、烟感传感器、路灯等低速率、低成本、低功耗的物联网设备。</li></ol><p>为物联网场景提供新的想象空间的，其实是 uRLLC 和 mMTC ，但是这两个标准还没有正式发布，真正部署的时间更是不确定。不过，这并没有影响物联网的落地，原因主要有两个：</p><ol><li>像智能门锁等场景可以选择 NB-IoT、LTE-Cat1 等已经成熟的蜂窝网络技术；</li><li>物联网的场景非常多样，Wi-Fi、BLE、LoRa 等非蜂窝技术一样有用武之地。</li></ol><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol><li>无线通信技术有 4 个重要的参数：频段、信道、带宽和传输速率。当遇到新的无线技术时，你可以把它们作为了解、分析的一个角度，进而更好地指导实践。</li><li>Wi-Fi 和 BLE 在移动互联网时代应用广泛，未来仍是理想的技术选择。连接电源线、不怎么关心功耗的设备往往优先考虑 Wi-Fi，而依靠电池供电、比较关心功耗的设备则更加适合 BLE。</li><li>对于 Wi-Fi 智能设备来说，Wi-Fi 配网绑定是比较麻烦的事情，所以很多物联网平台和模组厂家推出了一键配网技术。但是因为其不能保证 100% 的成功率，设备热点配网技术可以作为备选方案一起提供，甚至也可以作为主选方案。</li><li>2G 的退网已是趋势，在实践中可以考虑 LTE-Cat1 和 NB-IoT 两种蜂窝通信技术。对于非移动的、传输数据量很小的设备可以选择 NB-IoT；传输数据量更大，又不需要达到 4G 能力的设备可以考虑模组越来越成熟的 LTE-Cat1 技术。</li></ol><p><img src="https://s2.loli.net/2021/12/10/AaCfbrjNMJ9pTZ3.png" alt="通信技术"></p>]]></content>
      
      
      <categories>
          
          <category> IOT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 通信 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>容器基础</title>
      <link href="/2021/12/21/rong_qi_ji_chu/"/>
      <url>/2021/12/21/rong_qi_ji_chu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>“<strong>容器</strong>”这项技术的来龙去脉：</p><ul><li>容器技术的兴起源于 PaaS 技术的普及；</li><li>Docker 公司发布的 Docker 项目具有里程碑式的意义；</li><li>Docker 项目通过“容器镜像”，解决了应用打包这个根本性难题。</li><li>容器本身没有价值，有价值的是“容器编排”。</li></ul><p>容器其实是一种沙盒技术。顾名思义，<strong>沙盒</strong>就是能够像一个<strong>集装箱</strong>一样，把你的应用“<strong>装</strong>”起来的技术。这样，应用与应用之间，就因为有了<strong>边界</strong>而不至于相互干扰；而被装进集装箱的应用，也可以被方便地搬来搬去，这不就是 <strong>PaaS</strong> 最理想的状态嘛。</p><h4 id="“边界”的实现手段"><a href="#“边界”的实现手段" class="headerlink" title="“边界”的实现手段"></a>“边界”的实现手段</h4><p>假如，现在你要写一个计算加法的小程序，这个程序需要的输入来自于一个文件，计算完成后的结果则输出到另一个文件中。</p><p>由于计算机只认识 0 和 1，所以无论用哪种语言编写这段代码，最后都需要通过某种方式翻译成二进制文件，才能在计算机操作系统中运行起来。而为了能够让这些代码正常运行，我们往往还要给它提供数据，比如我们这个加法程序所需要的输入文件。这些数据加上代码本身的二进制文件，放在磁盘上，就是我们平常所说的一个“程序”，也叫代码的可执行镜像（executable image）。</p><p>然后，我们就可以在计算机上运行这个“程序”了。</p><p>首先，操作系统从“程序”中发现输入数据保存在一个文件中，所以这些数据就会被加载到内存中待命。同时，操作系统又读取到了计算加法的指令，这时，它就需要指示 CPU 完成加法操作。而 CPU 与内存协作进行加法计算，又会使用寄存器存放数值、内存堆栈保存执行的命令和变量。同时，计算机里还有被打开的文件，以及各种各样的 I/O 设备在不断地调用中修改自己的状态。</p><p>就这样，一旦“程序”被执行起来，它就从磁盘上的二进制文件，变成了<strong>计算机内存中的数据</strong>、<strong>寄存器里的值</strong>、<strong>堆栈中的指令</strong>、<strong>被打开的文件</strong>，<strong>以及各种设备的状态信</strong>息的一个集合。像这样一个程序运行起来后的计算机执行环境的总和，就是：<strong>进程</strong>。</p><p>所以，对于进程来说，它的静态表现就是程序，平常都安安静静地待在磁盘上；而一旦运行起来，它就变成了计算机里的数据和状态的总和，这就是它的动态表现。</p><p><strong>容器技术的核心功能，就是通过约束和修改进程的动态表现，从而为其创造出一个“边界”。</strong></p><p>对于 Docker 等大多数 Linux 容器来说，<strong>Cgroups</strong> 技术是用来制造<strong>约束</strong>的主要手段，而 <strong>Namespace</strong> 技术则是用来<strong>修改进程视图</strong>的主要方法。</p><h5 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h5><p>Namespace 的使用方式也非常有意思：它其实只是 Linux 创建新进程的一个可选参数。我们知道，在 Linux 系统中创建进程的系统调用是 clone()，而当我们用 clone() 系统调用创建一个新进程时，就可以在参数中指定 CLONE_NEWPID 参数，比如：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> pid <span class="token operator">=</span> <span class="token function">clone</span><span class="token punctuation">(</span>main_function<span class="token punctuation">,</span> stack_size<span class="token punctuation">,</span> CLONE_NEWPID <span class="token operator">|</span> SIGCHLD<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这时，新创建的这个进程将会“看到”一个全新的进程空间，在这个进程空间里，它的 PID 是 1。之所以说“看到”，是因为这只是一个“障眼法”，在宿主机真实的进程空间里，这个进程的 PID 还是真实的数值，比如 100。</p><p>而除了我们刚刚用到的 <strong>PID Namespace</strong>，Linux 操作系统还提供了 <strong>Mount、UTS、IPC、Network 和 User</strong> 这些 <strong>Namespace</strong>，用来对各种不同的进程上下文进行“障眼法”操作。</p><p>比如，Mount Namespace，用于让被隔离进程只看到当前 Namespace 里的<strong>挂载点</strong>信息；Network Namespace，用于让被隔离进程看到当前 Namespace 里的<strong>网络设备和配置</strong>。</p><p>这，就是 Linux 容器最基本的实现原理了。</p><p>所以，Docker 容器这个听起来玄而又玄的概念，实际上是在创建容器进程时，指定了这个进程所需要启用的一组 Namespace 参数。这样，容器就只能“看”到当前 Namespace 所限定的资源、文件、设备、状态，或者配置。而对于宿主机以及其他不相关的程序，它就完全看不到了。<strong>所以说，容器，其实是一种特殊的进程而已。</strong></p><p>谈到为“进程划分一个独立空间”的思想，相信你一定会联想到虚拟机。而且，你应该还看过一张虚拟机和容器的对比图。</p><p><img src="https://s2.loli.net/2021/12/15/gAGtJROKr1HNY7Z.png" alt="虚拟机与容器对比图"></p><p>这幅图的左边，画出了虚拟机的工作原理。其中，名为 Hypervisor 的软件是虚拟机最主要的部分。它通过硬件虚拟化功能，模拟出了运行一个操作系统需要的各种硬件，比如 CPU、内存、I/O 设备等等。然后，它在这些虚拟的硬件上安装了一个新的操作系统，即 Guest OS。这样，用户的应用进程就可以运行在这个虚拟的机器中，它能看到的自然也只有 Guest OS 的文件和目录，以及这个机器里的虚拟设备。这就是为什么虚拟机也能起到将不同的应用进程相互隔离的作用。</p><p>而这幅图的右边，则用一个名为 Docker Engine 的软件替换了 Hypervisor。这也是为什么，很多人会把 Docker 项目称为“轻量级”虚拟化技术的原因，实际上就是把虚拟机的概念套在了容器上。</p><p><strong>可是这样的说法，却并不严谨。</strong></p><p>在理解了 Namespace 的工作方式之后，你就会明白，跟真实存在的虚拟机不同，在使用 Docker 的时候，并没有一个真正的“Docker 容器”运行在宿主机里面。Docker 项目帮助用户启动的，还是原来的应用进程，只不过在创建这些进程时，Docker 为它们加上了各种各样的 Namespace 参数。这时，这些进程就会觉得自己是各自 PID Namespace 里的第 1 号进程，只能看到各自 Mount Namespace 里挂载的目录和文件，只能访问到各自 Network Namespace 里的网络设备，就仿佛运行在一个个“容器”里面，与世隔绝。</p><p>在这个虚拟机与容器技术的对比图里，不应该把 Docker Engine 或者任何容器管理工具放在跟 Hypervisor 相同的位置，因为它们并不像 Hypervisor 那样对应用进程的隔离环境负责，也不会创建任何实体的“容器”，真正对隔离环境负责的是宿主机操作系统本身。应该把 Docker 画在跟应用同级别并且靠边的位置。这意味着，用户运行在容器里的应用进程，跟宿主机上的其他进程一样，都由宿主机操作系统统一管理，只不过这些被隔离的进程拥有额外设置过的 Namespace 参数。而 Docker 项目在这里扮演的角色，更多的是旁路式的辅助和管理工作。</p><p>基于 Linux Namespace 的隔离机制相比于虚拟化技术也有很多不足之处，其中最主要的问题就是：<strong>隔离得不彻底</strong>。</p><ol><li>首先，既然容器只是运行在宿主机上的一种特殊的进程，那么多个容器之间使用的就还是同一个宿主机的操作系统内核。</li><li>其次，在 Linux 内核中，有很多资源和对象是不能被 Namespace 化的，最典型的例子就是：时间。这就意味着，如果你的容器中的程序使用 settimeofday(2) 系统调用修改了时间，整个宿主机的时间都会被随之修改，这显然不符合用户的预期。相比于在虚拟机里面可以随便折腾的自由度，在容器里部署应用的时候，“什么能做，什么不能做”，就是用户必须考虑的一个问题。所以挂载 localtime 时要设置 ReadOnly。</li></ol><p><em>容器是一个单进程，那比如我有一个镜像里面集成了jdk, netstat, ping等，虽然这个容器启动时里面是一个java进程，但是我可以进到容器里面执行各种命令，比如netstat等，那这些命令在容器的运行过程中是在运行的吗？</em></p><p>是在运行的。但它们不受docker的控制，就像野孩子。所以单<strong>进程意思不是只能运行一个进程，而是只有一个进程是可控的。</strong></p><h5 id="Cgroups"><a href="#Cgroups" class="headerlink" title="Cgroups"></a>Cgroups</h5><p><strong>Linux Cgroups 的全称是 Linux Control Group</strong>。它最主要的作用，就是<strong>限制一个进程组能够使用的资源上限</strong>，包括 CPU、内存、磁盘、网络带宽等等。此外，Cgroups 还能够对进程进行优先级设置、审计，以及将进程挂起和恢复等操作。</p><p>在 Linux 中，Cgroups 给用户暴露出来的操作接口是文件系统，即它以文件和目录的方式组织在操作系统的 /sys/fs/cgroup 路径下。在 Ubuntu 16.04 机器里，我可以用 mount 指令把它们展示出来，这条命令是：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">mount</span> -t cgroup cpuset on /sys/fs/cgroup/cpuset <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,cpuset<span class="token punctuation">)</span>cpu on /sys/fs/cgroup/cpu <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,cpu<span class="token punctuation">)</span>cpuacct on /sys/fs/cgroup/cpuacct <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,cpuacct<span class="token punctuation">)</span>blkio on /sys/fs/cgroup/blkio <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,blkio<span class="token punctuation">)</span>memory on /sys/fs/cgroup/memory <span class="token builtin class-name">type</span> cgroup <span class="token punctuation">(</span>rw,nosuid,nodev,noexec,relatime,memory<span class="token punctuation">)</span><span class="token punctuation">..</span>.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>可以看到，在 /sys/fs/cgroup 下面有很多诸如 cpuset、cpu、 memory 这样的子目录，也叫子系统。这些都是我这台机器当前可以被 Cgroups 进行限制的资源种类。而在子系统对应的资源种类下，你就可以看到该类资源具体可以被限制的方法。比如，对 CPU 子系统来说，我们就可以看到如下几个配置文件，这个指令是：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">ls</span> /sys/fs/cgroup/cpucgroup.clone_children cpu.cfs_period_us cpu.rt_period_us  cpu.shares notify_on_releasecgroup.procs      cpu.cfs_quota_us  cpu.rt_runtime_us cpu.stat  tasks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>如果熟悉 Linux CPU 管理的话，你就会在它的输出里注意到 cfs_period 和 cfs_quota 这样的关键词。这两个参数需要组合使用，可以用来限制进程在长度为 cfs_period 的一段时间内，只能被分配到总量为 cfs_quota 的 CPU 时间。</p><p>而这样的配置文件又如何使用呢？</p><p>你需要在对应的子系统下面创建一个目录，比如，我们现在进入 /sys/fs/cgroup/cpu 目录下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">root@ubuntu:/sys/fs/cgroup/cpu$ <span class="token function">mkdir</span> containerroot@ubuntu:/sys/fs/cgroup/cpu$ <span class="token function">ls</span> container/cgroup.clone_children cpu.cfs_period_us cpu.rt_period_us  cpu.shares notify_on_releasecgroup.procs      cpu.cfs_quota_us  cpu.rt_runtime_us cpu.stat  tasks<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这个目录就称为一个“控制组”。你会发现，操作系统会在你新创建的 container 目录下，自动生成该子系统对应的资源限制文件。现在，我们在后台执行这样一条脚本：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token keyword">while</span> <span class="token builtin class-name">:</span> <span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token builtin class-name">:</span> <span class="token punctuation">;</span> <span class="token keyword">done</span> <span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">226</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>显然，它执行了一个死循环，可以把计算机的 CPU 吃到 100%，根据它的输出，我们可以看到这个脚本在后台运行的进程号（PID）是 226。这样，我们可以用 top 指令来确认一下 CPU 有没有被打满：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">top</span>%Cpu0 :100.0 us, <span class="token number">0.0</span> sy, <span class="token number">0.0</span> ni, <span class="token number">0.0</span> id, <span class="token number">0.0</span> wa, <span class="token number">0.0</span> hi, <span class="token number">0.0</span> si, <span class="token number">0.0</span> st<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>在输出里可以看到，CPU 的使用率已经 100% 了（%Cpu0 :100.0 us）。而此时，我们可以通过查看 container 目录下的文件，看到 container 控制组里的 CPU quota 还没有任何限制（即：-1），CPU period 则是默认的 100  ms（100000  us）：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us -1$ <span class="token function">cat</span> /sys/fs/cgroup/cpu/container/cpu.cfs_period_us <span class="token number">100000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>接下来，我们可以通过修改这些文件的内容来设置限制。比如，向 container 组里的 cfs_quota 文件写入 20  ms（20000  us）：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token number">20000</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/cpu/container/cpu.cfs_quota_us<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>结合前面的介绍，你应该能明白这个操作的含义，它意味着在每 100  ms 的时间里，被该控制组限制的进程只能使用 20  ms 的 CPU 时间，也就是说这个进程只能使用到 20% 的 CPU 带宽。</p><p>接下来，我们把被限制的进程的 PID 写入 container 组里的 tasks 文件，上面的设置就会对该进程生效了：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token builtin class-name">echo</span> <span class="token number">226</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/cpu/container/tasks <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>我们可以用 top 指令查看一下：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">top</span>%Cpu0 <span class="token builtin class-name">:</span> <span class="token number">20.3</span> us, <span class="token number">0.0</span> sy, <span class="token number">0.0</span> ni, <span class="token number">79.7</span> id, <span class="token number">0.0</span> wa, <span class="token number">0.0</span> hi, <span class="token number">0.0</span> si, <span class="token number">0.0</span> st<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>可以看到，计算机的 CPU 使用率立刻降到了 20%（%Cpu0 : 20.3 us）。</p><p>除 CPU 子系统外，Cgroups 的每一个子系统都有其独有的资源限制能力，比如：</p><ul><li>blkio，为块设备设定I/O 限制，一般用于磁盘等设备；</li><li>cpuset，为进程分配单独的 CPU 核和对应的内存节点；</li><li>memory，为进程设定内存使用的限制。</li></ul><p>Linux Cgroups 的设计还是比较易用的，简单粗暴地理解呢，它就是一个子系统目录加上一组资源限制文件的组合。而对于 Docker 等 Linux 容器项目来说，它们只需要在每个子系统下面，为每个容器创建一个控制组（即创建一个新目录），然后在启动容器进程之后，把这个进程的 PID 填写到对应控制组的 tasks 文件中就可以了。</p><p>而至于在这些控制组下面的资源文件里填上什么值，就靠用户执行 docker run 时的参数指定了，比如这样一条命令：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ docker run -it --cpu-period<span class="token operator">=</span><span class="token number">100000</span> --cpu-quota<span class="token operator">=</span><span class="token number">20000</span> ubuntu /bin/bash<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在启动这个容器后，我们可以通过查看 Cgroups 文件系统下，CPU 子系统中，“docker”这个控制组里的资源限制文件的内容来确认：</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ <span class="token function">cat</span> /sys/fs/cgroup/cpu/docker/5d5c9f67d/cpu.cfs_period_us <span class="token number">100000</span>$ <span class="token function">cat</span> /sys/fs/cgroup/cpu/docker/5d5c9f67d/cpu.cfs_quota_us <span class="token number">20000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这就意味着这个 Docker 容器，只能使用到 20% 的 CPU 带宽。</p><p>一个正在运行的 Docker 容器，其实就是一个启用了多个 Linux Namespace 的应用进程，而这个进程能够使用的资源量，则受 Cgroups 配置的限制。</p><p>这也是容器技术中一个非常重要的概念，即：容器是一个“<strong>单进程</strong>”模型。</p><p>由于一个容器的本质就是一个进程，用户的应用进程实际上就是容器里 PID=1 的进程，也是其他后续创建的所有进程的父进程。这就意味着，在一个容器中，你没办法同时运行两个不同的应用，除非你能事先找到一个公共的 PID=1 的程序来充当两个不同应用的父进程，这也是为什么很多人都会用 <strong>systemd</strong> 或者 <strong>supervisord</strong> 这样的软件来代替应用本身作为容器的启动进程。但这是因为容器本身的设计，就是希望容器和应用能够<strong>同生命周期</strong>，这个概念对容器编排非常重要。否则，一旦出现类似于“容器是正常运行的，但是里面的应用早已经挂了”的情况，编排系统处理起来就非常麻烦了。</p><p>跟 Namespace 的情况类似，Cgroups 对资源的限制能力也有很多不完善的地方，被提及最多的自然是 /proc 文件系统的问题。</p><p>众所周知，Linux 下的 /proc 目录存储的是记录当前内核运行状态的一系列特殊文件，用户可以通过访问这些文件，查看系统以及当前正在运行的进程的信息，比如 CPU 使用情况、内存占用率等，这些文件也是 top 指令查看系统信息的主要数据来源。</p><p>但是，你如果在容器里执行 top 指令，就会发现，它显示的信息居然是宿主机的 CPU 和内存数据，而不是当前容器的数据。造成这个问题的原因就是，/proc 文件系统并不知道用户通过 Cgroups 给这个容器做了什么样的资源限制，即：/proc 文件系统不了解 Cgroups 限制的存在。</p><p>在生产环境中，这个问题必须进行修正，否则应用程序在容器里读取到的 CPU 核数、可用内存等信息都是宿主机上的数据，这会给应用的运行带来非常大的困惑和风险。这也是在企业中，容器化应用碰到的一个常见问题，也是容器相较于虚拟机另一个不尽如人意的地方。</p><p>当然容器中 top 等命令看到的CPU和内存等是宿主机的信息，**<a href="https://github.com/lxc/lxcfs">lxcfs</a>** 可解决此问题。</p><p><strong>原理</strong>：<strong>top</strong> 是从 /prof/stats 目录下获取数据，所以道理上来讲，容器不挂载宿主机的该目录就可以了。lxcfs就是来实现这个功能的，做法是把宿主机的 /var/lib/lxcfs/proc/memoinfo 文件挂载到Docker容器的/proc/meminfo位置后。容器中进程读取相应文件内容时，LXCFS的FUSE实现会从容器对应的Cgroup中读取正确的内存限制。从而使得应用获得正确的资源约束设定。kubernetes环境下，也能用，以ds 方式运行 lxcfs ，自动给容器注入争取的 proc 信息。</p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算机基础知识</title>
      <link href="/2021/12/20/ji_suan_ji_ji_chu_zhi_shi/"/>
      <url>/2021/12/20/ji_suan_ji_ji_chu_zhi_shi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="数据量单位"><a href="#数据量单位" class="headerlink" title="数据量单位"></a>数据量单位</h4><p><strong>位（bit）</strong>是计算机中最小的存储单位，每一个位可以存储一个二进制码值的 0 或 1。</p><p><strong>字节（byte）</strong>则通常是由八个位组成的一个存储单元。在计算机中，字节是最小的可寻址单位，这意味着 CPU 在使用数据时，可以以字节为单位，为每一字节内存分配一个相应的独立地址。</p><p><strong>字</strong>的大小并不固定，一个字的大小可能是 2 的幂次个位，比如 16 位、32 位，也有可能是 12 位、27 位等一些并不常见的大小。而这主要是因为字的概念与具体的处理器或硬件体系架构直接相关，它跟位、字节这种较为通用和统一的数据量概念并不相同。</p><p><strong>字</strong>是处理器设计时使用的自然数据单位，通常，这个大小会反映在计算机结构和相关操作的多个方面中。比如，处理器中大多数寄存器的容量是与字同样大小的，处理器单个指令可以操作的最大内存块一般为一个字大小，而用于指定内存中某个具体位置的地址，一般也是以处理器的自然字为宽度的。</p><h4 id="汇编语言"><a href="#汇编语言" class="headerlink" title="汇编语言"></a>汇编语言</h4><p>在计算机编程中，汇编语言（Assembly Language）是一种低级编程语言，语言使用的指令与具体平台紧密相关。这意味着，针对不同 CPU 体系架构设计的汇编语言无法共用，也不具备可移植性。汇编代码可以经由汇编程序（如 as）进行转换，从而得到二进制的可执行代码。不同于高级编程语言，汇编语言在机器指令之上基本不具有任何抽象。因此，通过观察一个程序的汇编代码，我们可以详细了解到程序运行时的每一个具体步骤。</p><h4 id="指令集中的寄存器"><a href="#指令集中的寄存器" class="headerlink" title="指令集中的寄存器"></a>指令集中的寄存器</h4><p><strong>寄存器</strong>有时也被称为“寄存器文件（Register File）”，你可以把它简单理解为由 CPU 提供的一组位于芯片上的高速存储器硬件，可用于存储数据。通常来说，寄存器可以使用 SRAM 来实现。SRAM 是一种高速随机访问存储器，它将每个位的数据存放在一个对应的“双稳态”存储器中，从而保持较强的抗干扰能力和较快的数据访问速度。在整个计算机体系架构中，寄存器拥有最快的数据访问速度和最低的延迟。</p><p>通常来说，我们在汇编代码中使用的寄存器可能并不与 CPU 上的物理寄存器完全一一对应，CPU 会使用额外的方式来保证它们之间的动态对应关系。这些参与到程序运行过程的寄存器，一般可以分为：通用目的寄存器、状态寄存器、系统寄存器，以及用于支持浮点数计算和 SIMD 的 AVX、SSE 寄存器等。</p><p>在这些寄存器中，通用目的寄存器一般用于存放程序运行过程中产生的临时数据，这些寄存器在大多数情况下都可以被当作普通寄存器使用。而在某些特殊情况下，它们可能会被用于存放指令计算结果、系统调用号，以及与栈帧相关的内存地址等信息。状态寄存器一般用于存放与指令执行结果相关的状态信息，比如指令执行是否引起进位、计算结果是否为 0 等。系统寄存器一般由操作系统使用，这些寄存器描述了与虚拟内存、中断、CPU 模式等有关的信息。</p><p>在 x86-64 架构下，CPU 指令集架构（ISA）中一共定义了 16 个通用目的寄存器，这些寄存器最大可以存放 4 个字，即 64 位长的数据。在汇编代码中，我们可以使用每个寄存器不同部分对应的别名，来针对性地访问它们的低 8 位、低 16 位、低 32 位，以及完整的 64 位数据。关于这些寄存器的具体名称，你可以参考下面这张图：</p><p><img src="https://s2.loli.net/2021/12/08/CHE9ASUKNJd3o2F.png" alt="x86-64 架构寄存器图"></p><p>这张图怎么看呢？这里以我们之前遇到的 ebx 寄存器为例：观察上图可以得知，通过 ebx，我们可以访问大小为 32 位的数据，该数据为寄存器 rbx 的低 32 位。因此，直接使用 rbx 便可访问该寄存器的全部 64 位数据。而使用 bx 与 bl ，便可相应访问该寄存器的低 16 位与低 8 位数据。</p><p>另外，还需注意的一点是：我们可以通过不同的寄存器别名来读写同一寄存器不同位置上的数据。当某个指令需要重写寄存器的低 16 位或低 8 位数据时，寄存器中其他位上的数据不会被修改。而当指令需要重写寄存器低 32 位的数据时，高 32 位的数据会被同时复位，即置零。</p><h4 id="数据的存储形式"><a href="#数据的存储形式" class="headerlink" title="数据的存储形式"></a>数据的存储形式</h4><p>对于大多数计算机而言，通常其内部会使用补码（Two’s-complement）的格式来存放有符号整数，使用直接对应的二进制位格式来存放无符号整数，使用 IEEE-754 标准编码格式来存放浮点数，也就是小数。实际上，计算机在看待数据时，并不会区分其符号性，而符号性的差异仅体现在计算机指令操作数据时的具体使用方式上。</p><h5 id="补码"><a href="#补码" class="headerlink" title="补码"></a>补码</h5><p>使用补码来存放有符号整数的一个优点是，CPU 在针对有符号数进行加减法计算时，不需要由于加数的符号性不同而采用多个底层加法电路，这样便可减轻电路设计的负担，另一方面也可以降低 CPU 的物理尺寸。</p><p>一个补码所表示的实际数值，由其负权重位的值与正权重位的值求和而来，其中负权重位对应于最高有效位（MSB）的符号位，即该位的二进制值在计算时按负值累加。其余各位一起对应正权重位，即这些位对应的二进制值在计算时按正值累加。那具体该怎样计算呢？我们来看一个简单的例子。</p><p>假设我们有一组补码 “1101”，那么应该如何得到它对应的有符号整数值呢？按照顺序，我们首先计算得到该补码对应负权重位的值为 -8，而正权重位的值为 5，因此该补码对应的实际值为 -3（-8+5）。具体计算步骤可以参考下图（图中的 B2T 表示 “Binary to Two’s-complement”，即“二进制转补码”）：</p><p><img src="https://s2.loli.net/2021/12/08/8AiXJgCh32a6wrs.png" alt="二进制转补码"></p><p>在计算负权重位时，其权重应取负值，正权重位取正值。通过上面的计算过程，你可以清楚地看到，对于一个 4 位补码，它可以表示的最大值与最小值分别是多少。计算最大值时，符号位置 0，其他位均置 1，可以得到能表示的最大值 7。计算最小值时，符号位置 1，其他位均置 0，可以得到最小值 -8。负整数的值可表示范围比正整数多 1 个，这也是所有有符号整数的一个重要特征。</p><p>首先，我们来计算一下有符号整数 3 对应的四位补码，可以得到一个二进制序列 “0011”。将该二进制序列与上述 -3 对应的二进制序列1101相加，通过进位可以得到序列 “10000”，该序列可以表示无符号正整数 16。</p><p>因此，我们可以得到这样一个结论：对于非负数 x，我们可以用 2w−x 来计算 −x 的 w 位表示。套用在上述的例子中，可以得到“在四位补码的情况下，对于非负数 3，可以用无符号数 13 (即 16−3) 的位模式来表示有符号数 -3 的位模式”这个结论，即两者位模式相同。而补码的英文名称正是对 x、−x 和 2w 三者之间的关系进行的总结。</p><p>所以，补码的英文名称是 Two’s-complement ，可直译为“对数字 2 的补充”。</p><h5 id="IEEE-754"><a href="#IEEE-754" class="headerlink" title="IEEE-754"></a>IEEE-754</h5><p>IEEE-754 是一个被众多硬件浮点计算单元（FPU）采用的浮点数标准，这个标准解决了浮点数在硬件实现上的很多问题，使其更具可移植性。对于 IEEE-754，一个值得介绍的特点是它对浮点数的存储格式设计，使得计算机可以简单地使用对于整数的排序函数，来对浮点数进行排序。</p><p>举个例子，对于无符号数的二进制序列来说，0010 的值肯定要小于1000 （2 &lt; 8）。这对计算机来说很好判断。而对基于 IEEE-754 编码的 8 位浮点数（4 位阶码位，3 位小数位）二进制序列  0 0001 001 和  0 1110 111 来说，判断其大小也同样十分简单。除去最左侧的符号位外，直接将其余各位当作无符号整数序列值进行比较，所得结果同样适用于对应的浮点数序列。</p><p><img src="https://s2.loli.net/2021/12/08/um17pwTvMzaItrV.png" alt="IEEE-754存储格式图"></p><h4 id="图灵机"><a href="#图灵机" class="headerlink" title="图灵机"></a>图灵机</h4><p>大名鼎鼎的阿兰·图灵。在他的众多贡献中，很重要的一个就是提出了一种理想中的机器：图灵机。图灵机是一个抽象的模型，它是这样的：有一条无限长的纸带，纸带上有无限个小格子，小格子中写有相关的信息，纸带上有一个读头，读头能根据纸带小格子里的信息做相关的操作并能来回移动。用图灵机执行一下“1+1=2”的计算，我们定义读头读到“+”之后，就依次移动读头两次并读取格子中的数据，最后读头计算把结果写入第二个数据的下一个格子里，整个过程如下图：</p><p><img src="https://s2.loli.net/2021/12/09/kSN6zKeolhZcEW1.png" alt="图灵机推算过程图"></p><p>这个理想的模型是好，但是理想终归是理想，想要成为现实，我们得想其它办法。</p><h4 id="冯诺依曼体系结构"><a href="#冯诺依曼体系结构" class="headerlink" title="冯诺依曼体系结构"></a>冯诺依曼体系结构</h4><p>冯诺依曼提出了电子计算机使用二进制数制系统和储存程序，并按照程序顺序执行。</p><p>根据冯诺依曼体系结构构成的计算机，必须具有如下功能：</p><ul><li>把程序和数据装入到计算机中；</li><li>必须具有长期记住程序、数据的中间结果及最终运算结果；</li><li>完成各种算术、逻辑运算和数据传送等数据加工处理；</li><li>根据需要控制程序走向，并能根据指令控制机器的各部件协调操作；</li><li>能够按照要求将处理的数据结果显示给用户。</li></ul><p>为了完成上述的功能，计算机必须具备五大基本组成部件：</p><ul><li>装载数据和程序的输入设备；</li><li>记住程序和数据的存储器；</li><li>完成数据加工处理的运算器；</li><li>控制程序执行的控制器；</li><li>显示处理结果的输出设备。</li></ul><p>根据冯诺依曼的理论，我们只要把图灵机的几个部件换成电子设备，就可以变成一个最小核心的电子计算机，如下图：</p><p><img src="https://s2.loli.net/2021/12/09/9kjOPW7GcwFI3ev.png" alt="冯诺依曼计算机结构图"></p><p>是不是非常简单？这次我们发现读头不再来回移动了，而是靠地址总线寻找对应的“纸带格子”。读取写入数据由数据总线完成，而动作的控制就是控制总线的职责了。</p><h4 id="计算机屏幕"><a href="#计算机屏幕" class="headerlink" title="计算机屏幕"></a>计算机屏幕</h4><p>计算机屏幕显示往往是显卡的输出，显卡有很多形式：集成在主板的叫集显，做在 CPU 芯片内的叫核显，独立存在通过 PCIE 接口连接的叫独显，性能依次上升，价格也是。我们要在屏幕上显示字符，就要编程操作显卡。</p><p>其实无论我们 PC 上是什么显卡，它们都支持一种叫 <strong>VESA</strong> 的标准，这种标准下有两种工作模式：字符模式和图形模式。显卡们为了兼容这种标准，不得不自己提供一种叫 VGABIOS 的固件程序。</p><p>下面，我们来看看显卡的字符模式的工作细节。它把屏幕分成 24 行，每行 80 个字符，把这（24*80）个位置映射到以 0xb8000 地址开始的内存中，每两个字节对应一个字符，其中一个字节是字符的 ASCII 码，另一个字节为字符的颜色值。如下图所示：</p><p><img src="https://s2.loli.net/2021/12/09/oNJQFTv5U4ca8OS.png" alt="计算机显卡文本模式"></p><p>明白了显卡的字符模式的工作细节，我们就可以编写自己的printf函数了，代码如下：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">_strwrite</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> string<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">char</span><span class="token operator">*</span> p_strdst <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0xb8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//指向显存的开始地址</span>  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">*</span>string<span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token operator">*</span>p_strdst <span class="token operator">=</span> <span class="token operator">*</span>string<span class="token operator">++</span><span class="token punctuation">;</span>    p_strdst <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">void</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token function">_strwrite</span><span class="token punctuation">(</span>fmt<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">return</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>代码很简单，printf 函数直接调用了 _strwrite 函数，而 _strwrite 函数正是将字符串里每个字符依次定入到 0xb8000 地址开始的显存中，而 p_strdst 每次加 2，这也是为了跳过字符的颜色信息的空间。</p>]]></content>
      
      
      <categories>
          
          <category> System </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>内核结构</title>
      <link href="/2021/12/20/nei_he_jie_gou/"/>
      <url>/2021/12/20/nei_he_jie_gou/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="系统内核"><a href="#系统内核" class="headerlink" title="系统内核"></a>系统内核</h4><p>从抽象角度来看，内核就是计算机资源的管理者，当然管理资源是为了让应用使用资源。既然内核是资源的管理者，我们先来看看计算机中有哪些资源，然后通过资源的归纳，就能推导出内核这个大黑盒中应该有什么。</p><p>计算机中资源大致可以分为两类资源，一种是硬件资源，一种是软件资源。先来看看硬件资源有哪些，如下：</p><ol><li><strong>总线</strong>，负责连接各种其它设备，是其它设备工作的基础。</li><li><strong>CPU</strong>，即中央处理器，负责执行程序和处理数据运算。</li><li><strong>内存</strong>，负责储存运行时的代码和数据。</li><li><strong>硬盘</strong>，负责长久储存用户文件数据。</li><li><strong>网卡</strong>，负责计算机与计算机之间的通信。</li><li><strong>显卡</strong>，负责显示工作。</li><li><strong>各种 I/O 设备</strong>，如显示器，打印机，键盘，鼠标等。</li></ol><p>下面给出一幅经典的计算机内部结构图，如下：</p><p><img src="https://s2.loli.net/2021/12/12/DAwiU6PXCSo5ONl.png" alt="经典计算机结构"></p><p>而计算机中的软件资源，则可表示为计算机中的各种形式的数据。如各种文件、软件程序等。内核作为硬件资源和软件资源的管理者，其内部组成在逻辑上大致如下：</p><ol><li><strong>管理 CPU</strong>，由于 CPU 是执行程序的，而内核把运行时的程序抽象成进程，所以又称为进程管理。</li><li><strong>管理内存</strong>，由于程序和数据都要占用内存，内存是非常宝贵的资源，所以内核要非常小心地分配、释放内存。</li><li><strong>管理硬盘</strong>，而硬盘主要存放用户数据，而内核把用户数据抽象成文件，即管理文件，文件需要合理地组织，方便用户查找和读写，所以形成了文件系统。</li><li><strong>管理显卡</strong>，负责显示信息，而现在操作系统都是支持 GUI（图形用户接口）的，管理显卡自然而然地就成了内核中的图形系统。</li><li><strong>管理网卡</strong>，网卡主要完成网络通信，网络通信需要各种通信协议，最后在内核中就形成了网络协议栈，又称网络组件。</li><li><strong>管理各种 I/O 设备</strong>，我们经常把键盘、鼠标、打印机、显示器等统称为 I/O（输入输出）设备，在内核中抽象成 I/O 管理器。</li></ol><p>内核除了这些必要组件之外，根据功能不同还有安全组件等，最值得一提的是，各种计算机硬件的性能不同，硬件型号不同，硬件种类不同，硬件厂商不同，内核要想管理和控制这些硬件就要编写对应的代码，通常这样的代码我们称之为驱动程序。硬件厂商就可以根据自己不同的硬件编写不同的驱动，加入到内核之中。</p><h5 id="宏内核结构"><a href="#宏内核结构" class="headerlink" title="宏内核结构"></a>宏内核结构</h5><p>宏即大也，这种最简单适用，也是最早的一种内核结构。宏内核就是把以上诸如管理进程的代码、管理内存的代码、管理各种 I/O 设备的代码、文件系统的代码、图形系统代码以及其它功能模块的代码，把这些所有的代码经过编译，最后链接在一起，形成一个大的可执行程序。</p><p>这个大程序里有实现支持这些功能的所有代码，向用户应用软件提供一些接口，这些接口就是常说的系统 API 函数。而这个大程序会在处理器的特权模式下运行，这个模式通常被称为宏内核模式。结构如下图所示。</p><p><img src="https://s2.loli.net/2021/12/12/fdaYzDVZtPv3cLM.png" alt="宏内核结构"></p><p>尽管图中一层一层的，这并不是它们有层次关系，仅仅表示它们链接在一起。为了理解宏内核的工作原理，我们来看一个例子，宏内核提供内存分配功能的服务过程，具体如下：</p><ol><li>应用程序调用内存分配的 API（应用程序接口）函数。</li><li>处理器切换到特权模式，开始运行内核代码。</li><li>内核里的内存管理代码按照特定的算法，分配一块内存。</li><li>把分配的内存块的首地址，返回给内存分配的 API 函数。</li><li>内存分配的 API 函数返回，处理器开始运行用户模式下的应用程序，应用程序就得到了一块内存的首地址，并且可以使用这块内存了。</li></ol><p>上图的宏内核结构有明显的缺点，因为它没有模块化，没有扩展性、没有移植性，高度耦合在一起，一旦其中一个组件有漏洞，内核中所有的组件可能都会出问题。开发一个新的功能也得重新编译、链接、安装内核。其实现在这种原始的宏内核结构已经没有人用了。这种宏内核唯一的优点是性能很好，因为在内核中，这些组件可以互相调用，<strong>性能极高</strong>。</p><h5 id="微内核结构"><a href="#微内核结构" class="headerlink" title="微内核结构"></a>微内核结构</h5><p>微内核架构正好与宏内核架构相反，它提倡内核功能尽可能少：仅仅只有进程调度、处理中断、内存空间映射、进程间通信等功能。</p><p>开发者们把实际的进程管理、内存管理、设备管理、文件管理等服务功能，做成一个个服务进程。和用户应用进程一样，只是它们很特殊，宏内核提供的功能，在微内核架构里由这些服务进程专门负责完成。微内核定义了一种良好的进程间通信的机制——<strong>消息</strong>。应用程序要请求相关服务，就向微内核发送一条与此服务对应的消息，微内核再把这条消息转发给相关的服务进程，接着服务进程会完成相关的服务。服务进程的编程模型就是循环处理来自其它进程的消息，完成相关的服务功能。其结构如下所示：</p><p><img src="https://s2.loli.net/2021/12/12/Pm2EcqK8Gh3iJWY.png" alt="微内核结构"></p><p>为了理解微内核的工程原理，我们来看看微内核提供内存分配功能的服务过程，具体如下：</p><ol><li>应用程序发送内存分配的消息，这个发送消息的函数是微内核提供的，相当于系统 API，微内核的 API（应用程序接口）相当少，极端情况下仅需要两个，一个接收消息的 API 和一个发送消息的 API。</li><li>处理器切换到特权模式，开始运行内核代码。</li><li>微内核代码让当前进程停止运行，并根据消息包中的数据，确定消息发送给谁，分配内存的消息当然是发送给内存管理服务进程。</li><li>内存管理服务进程收到消息，分配一块内存。</li><li>内存管理服务进程，也会通过消息的形式返回分配内存块的地址给内核，然后继续等待下一条消息。</li><li>微内核把包含内存块地址的消息返回给发送内存分配消息的应用程序。</li><li>处理器开始运行用户模式下的应用程序，应用程序就得到了一块内存的首地址，并且可以使用这块内存了。</li></ol><p>微内核的架构实现虽然不同，但是大致过程和上面一样。同样是分配内存，在微内核下拐了几个弯，一来一去的消息带来了非常大的开销，当然各个服务进程的切换开销也不小。这样系统性能就大打折扣。</p><p>但是微内核有很多优点，首先，系统结构相当清晰利于协作开发。其次，系统有良好的移植性，微内核代码量非常少，就算重写整个内核也不是难事。最后，微内核有相当好的伸缩性、扩展性，因为那些系统功能只是一个进程，可以随时拿掉一个服务进程以减少系统功能，或者增加几个服务进程以增强系统功能。</p><p>微内核的代表作有 MACH、MINIX、L4 系统，这些系统都是微内核，但是它们不是商业级的系统，商业级的系统不采用微内核主要还是因为性能差。</p><h4 id="常见操作系统内核"><a href="#常见操作系统内核" class="headerlink" title="常见操作系统内核"></a>常见操作系统内核</h4><h5 id="Linux-内核"><a href="#Linux-内核" class="headerlink" title="Linux 内核"></a>Linux 内核</h5><p>Linux 的基本思想是一切都是文件：每个文件都有确定的用途，包括用户数据、命令、配置参数、硬件设备等对于操作系统内核而言，都被视为各种类型的文件。Linux 支持多用户，各个用户对于自己的文件有自己特殊的权利，保证了各用户之间互不影响。多任务则是现代操作系统最重要的一个特点，Linux 可以使多个程序同时并独立地运行。</p><p>Linux 的内部结构，如下图。</p><p><img src="https://s2.loli.net/2021/12/12/fkG7aJpw4SxIQ6j.png" alt="Linux内核架构"></p><p>上图中大致分为五大重要组件，每个组件又分成许多模块从上到下贯穿各个层次，每个模块中有重要的函数和数据结构。</p><p><img src="https://s2.loli.net/2021/12/12/QYzx9NaFdPRS2yV.png" alt="Linux五大组件"></p><p>Linux属于典型的宏内核架构。</p><h5 id="Darwin-XNU-内核"><a href="#Darwin-XNU-内核" class="headerlink" title="Darwin-XNU 内核"></a>Darwin-XNU 内核</h5><p>Darwin 是由苹果公司在 2000 年开发的一个开放源代码的操作系统。Darwin 是 macOS 与 iOS 操作系统的核心。Darwin 使用了一种微内核（Mach）和相应的固件来支持不同的处理器平台，并提供操作系统原始的基础服务，上层的功能性系统服务和工具则是整合了 BSD 系统所提供的。苹果公司还为其开发了大量的库、框架和服务，不过它们都工作在用户态且闭源。下面我们先从整体看一下 Darwin 的架构。</p><p><img src="https://s2.loli.net/2021/12/12/7ajzem6HQC19UlD.png" alt="Darwin内核"></p><p>显然它有两个内核层——<strong>Mach 层与 BSD 层</strong>。<strong>Mach</strong> 内核是卡耐基梅隆大学开发的经典微内核，意在提供最基本的操作系统服务，从而达到高性能、安全、可扩展的目的，而 <strong>BSD</strong> 则是伯克利大学开发的类 UNIX 操作系统，提供一整套操作系统服务。</p><p>那么应用如何使用 Darwin 系统的服务呢？应用会通过用户层的框架和库来请求 Darwin 系统的服务，即调用 Darwin 系统 API。</p><p>在调用 Darwin 系统 API 时，会传入一个 API 号码，用这个号码去索引 Mach 陷入中断服务表中的函数。此时，API 号码如果小于 0，则表明请求的是 Mach 内核的服务，API 号码如果大于 0，则表明请求的是 BSD 内核的服务，它提供一整套标准的 POSIX 接口。</p><p>Mach 中还有一个重要的组件 Libkern，它是一个库，提供了很多底层的操作函数，同时支持 C++ 运行环境。依赖这个库的还有 IOKit，IOKit 管理所有的设备驱动和内核功能扩展模块。驱动程序开发人员则可以使用 C++ 面向对象的方式开发驱动，这个方式很优雅，你完全可以找一个成熟的驱动程序作为父类继承它，要特别实现某个功能就重载其中的函数，也可以同时继承其它驱动程序，这大大节省了内存，也大大降低了出现 BUG 的可能。</p><h5 id="Windows-NT-内核"><a href="#Windows-NT-内核" class="headerlink" title="Windows NT 内核"></a>Windows NT 内核</h5><p>Windows NT 是微软于 1993 年推出的面向工作站、网络服务器和大型计算机的网络操作系统，也可做 PC 操作系统。它是一款全新从零开始开发的新操作系统，并应用了现代硬件的所有特性，“NT”所指的便是“新技术”（New Technology）。</p><p>NT 内核在设计上层次非常清晰明了，各组件之间界限耦合程度很低。下面我们就来看看 NT 内核架构图，了解一下 NT 内核是如何“庄严宏伟”。如下图：</p><p><img src="https://s2.loli.net/2021/12/09/iCgyHKa3wM7oUJ2.png" alt="NT内核架构图"></p><p>微软自己在 HAL 层上是定义了一个小内核，小内核之下是硬件抽象层 HAL，这个 HAL 存在的好处是：不同的硬件平台只要提供对应的 HAL 就可以移植系统了。小内核之上是各种内核组件，微软称之为内核执行体，它们完成进程、内存、配置、I/O 文件缓存、电源与即插即用、安全等相关的服务。每个执行体互相独立，只对外提供相应的接口，其它执行体要通过内核模式可调用接口和其它执行体通信或者请求其完成相应的功能服务。所有的设备驱动和文件系统都由 I/O 管理器统一管理，驱动程序可以堆叠形成 I/O 驱动栈，功能请求被封装成 I/O 包，在栈中一层层流动处理。Windows 引以为傲的图形子系统也在内核中。</p><p>显而易见，NT 内核中各层次分明，各个执行体互相独立，这种“高内聚、低偶合”的特性，正是检验一个软件工程是否优秀的重要标准。而这些你都可以通过微软公开的 WRK 代码得到佐证，如果你觉得 WRK 代码量太少，也可以看一看<a href="https://reactos.org/">REACT</a> OS这个号称“开源版”的 NT。</p>]]></content>
      
      
      <categories>
          
          <category> System </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CPU的工作模式</title>
      <link href="/2021/12/20/cpu_de_gong_zuo_mo_shi/"/>
      <url>/2021/12/20/cpu_de_gong_zuo_mo_shi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="实模式"><a href="#实模式" class="headerlink" title="实模式"></a>实模式</h4><p>实模式又称实地址模式，实，即真实，这个真实分为两个方面，一个方面是运行真实的指令，对指令的动作不作区分，直接执行指令的真实功能，另一方面是发往内存的地址是真实的，对任何地址不加限制地发往内存。</p><p><strong>实模式寄存器</strong></p><p>由于 CPU 是根据指令完成相应的功能，举个例子：ADD AX,CX；这条指令完成加法操作，AX、CX 为 ADD 指令的操作数，可以理解为 ADD 函数的两个参数，其功能就是把 AX、CX 中的数据相加。指令的操作数，可以是寄存器、内存地址、常数，其实通常情况下是寄存器，AX、CX 就是 x86 CPU 中的寄存器。下面我们就去看看 x86  CPU 在实模式下的寄存器。表中每个寄存器都是 16 位的。</p><p><img src="https://s2.loli.net/2021/12/12/4oBc3fIY95dnPlu.png" alt="实模式下的寄存器"></p><p><strong>实模式下访问内存</strong></p><p>虽然有了寄存器，但是数据和指令都是存放在内存中的。通常情况下，需要把数据装载进寄存器中才能操作，还要有获取指令的动作，这些都要访问内存才行，而我们知道访问内存靠的是地址值。</p><p>那问题来了，这个值是如何计算的呢？计算过程如下图。</p><p><img src="https://s2.loli.net/2021/12/12/K3f8qPso6Ytp1iH.png" alt="实模式下内存访问方式"></p><p>结合上图可以发现，所有的内存地址都是由段寄存器左移 4 位，再加上一个通用寄存器中的值或者常数形成地址，然后由这个地址去访问内存。这就是大名鼎鼎的分段内存管理模型。只不过这里要特别注意的是，<strong>代码段是由 CS 和 IP 确定的，而栈段是由 SS 和 SP 段确定的。</strong></p><p><strong>实模式中断</strong></p><p>中断即中止执行当前程序，转而跳转到另一个特定的地址上，去运行特定的代码。在实模式下它的实现过程是先保存 CS 和 IP 寄存器，然后装载新的 CS 和 IP 寄存器，那么中断是如何产生的呢？</p><p>第一种情况是，中断控制器给 CPU 发送了一个电子信号，CPU 会对这个信号作出应答。随后中断控制器会将中断号发送给 CPU，这是<strong>硬件中断</strong>。</p><p>第二种情况就是 CPU 执行了 INT 指令，这个指令后面会跟随一个常数，这个常数即是软中断号。这种情况是<strong>软件中断</strong>。</p><p>无论是硬件中断还是软件中断，都是 CPU 响应外部事件的一种方式。为了实现中断，就需要在内存中放一个中断向量表，这个表的地址和长度由 CPU 的特定寄存器 IDTR 指向。实模式下，表中的一个条目由代码段地址和段内偏移组成，如下图所示。</p><p><img src="https://s2.loli.net/2021/12/12/9mgEc1pi5zNsVDZ.png" alt="中断向量表"></p><p>有了中断号以后，CPU 就能根据 IDTR 寄存器中的信息，计算出中断向量中的条目，进而装载 CS（装入代码段基地址）、IP（装入代码段内偏移）寄存器，最终响应中断。</p><p>下面我们写一个 DOS 下的 Hello World 应用程序，这是一个工作在实模式下的汇编代码程序，一共 16 位，具体代码如下：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">data SEGMENT ;定义一个数据段存放Hello World!    hello  DB 'Hello World!$' ;注意要以$结束data ENDScode SEGMENT ;定义一个代码段存放程序指令    ASSUME CS:CODE,DS:DATA ;告诉汇编程序，DS指向数据段，CS指向代码段start:    MOV AX,data  ;将data段首地址赋值给AX                    MOV DS,AX    ;将AX赋值给DS，使DS指向data段    LEA DX,hello ;使DX指向hello首地址    MOV AH,09h   ;给AH设置参数09H，AH是AX高8位，AL是AX低8位，其它类似    INT 21h      ;执行DOS中断输出DS指向的DX指向的字符串hello    MOV AX,4C00h ;给AX设置参数4C00h    INT 21h      ;调用4C00h号功能，结束程序code ENDSEND start<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>大多数是操作寄存器，其中 LEA 是取地址指令，MOV 是数据传输指令， INT 中断指令。</p><h5 id="INT-21H-指令说明及使用方法"><a href="#INT-21H-指令说明及使用方法" class="headerlink" title="INT 21H 指令说明及使用方法"></a>INT 21H 指令说明及使用方法</h5><p>例如：需要键盘输入，并且回显。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">MOV AH,01INT 21H<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>通过这样两条指令，输入的字符就会被存储在AL中，AH的值需要查表取得，表在下面：</p><table><thead><tr><th>AH</th><th>功能</th><th>调用参数</th><th>返回参数</th></tr></thead><tbody><tr><td>00</td><td>程序终止(同INT 20H)</td><td>CS=程序段前缀</td><td></td></tr><tr><td>01</td><td>键盘输入并回显</td><td></td><td>AL=输入字符</td></tr><tr><td>02</td><td>显示输出</td><td>DL=输出字符</td><td></td></tr><tr><td>03</td><td>异步通迅输入</td><td></td><td>AL=输入数据</td></tr><tr><td>04</td><td>异步通迅输出</td><td>DL=输出数据</td><td></td></tr><tr><td>05</td><td>打印机输出</td><td>DL=输出字符</td><td></td></tr><tr><td>06</td><td>直接控制台I/O</td><td>DL=FF(输入) DL=字符(输出)</td><td>AL=输入字符</td></tr><tr><td>07</td><td>键盘输入(无回显)</td><td></td><td>AL=输入字符</td></tr><tr><td>08</td><td>键盘输入(无回显)检测Ctrl-Break</td><td></td><td>AL=输入字符</td></tr><tr><td>09</td><td>显示字符串DS:DX=串地址 ‘$’结束字符串</td><td></td><td></td></tr><tr><td>0A</td><td>键盘输入到缓冲区DS:DX=缓冲区首地址 (DS:DX)=缓冲区最大字符数</td><td>(DS:DX+1)=实际输入的字符数</td><td></td></tr><tr><td>0B</td><td>检验键盘状态</td><td></td><td>AL=00 有输入 AL=FF 无输入</td></tr><tr><td>0C</td><td>清除输入缓冲区并 请求指定的输入功能</td><td>AL=输入功能号(1,6,7,8,A)</td><td></td></tr><tr><td>0D</td><td>磁盘复位</td><td></td><td>清除文件缓冲区</td></tr><tr><td>0E</td><td>指定当前缺省的磁盘驱动器</td><td>DL=驱动器号 0=A,1=B,…</td><td>AL=驱动器数</td></tr><tr><td>0F</td><td>打开文件</td><td>DS:DX=FCB首地址</td><td>AL=00 文件找到 AL=FF 文件未找到</td></tr><tr><td>10</td><td>关闭文件</td><td>DS:DX=FCB首地址</td><td>AL=00 目录修改成功 AL=FF 目录中未找到文件</td></tr><tr><td>11</td><td>查找第一个目录项DS:DX=FCB首地址</td><td>AL=00 找到 AL=FF 未找到</td><td></td></tr><tr><td>12</td><td>查找下一个目录项</td><td>DS:DX=FCB首地址(文件中带有*或?)</td><td>AL=00 找到 AL=FF 未找到</td></tr><tr><td>13</td><td>删除文件</td><td>DS:DX=FCB首地址</td><td>AL=00 删除成功 AL=FF 未找到</td></tr><tr><td>14</td><td>顺序读</td><td>DS:DX=FCB首地址</td><td>AL=00 读成功 =01 文件结束,记录中无数据 =02 DTA空间不够 =03 文件结束,记录不完整</td></tr><tr><td>15</td><td>顺序写</td><td>DS:DX=FCB首地址</td><td>AL=00 写成功 =01 盘满 =02 DTA空间不够</td></tr><tr><td>16</td><td>建文件</td><td>DS:DX=FCB首地址</td><td>AL=00 建立成功 =FF 无磁盘空间</td></tr><tr><td>17</td><td>文件改名</td><td>DS:DX=FCB首地址</td><td>(DS:DX+1)=旧文件名 (DS:DX+17)=新文件名</td></tr><tr><td>19</td><td>取当前缺省磁盘驱动器</td><td></td><td>AL=缺省的驱动器号 0=A,1=B,2=C,…</td></tr><tr><td>1A</td><td>置DTA地址</td><td>DS:DX=DTA地址</td><td></td></tr><tr><td>1B</td><td>取缺省驱动器FAT信息</td><td></td><td>AL=每簇的扇区数 DS:BX=FAT标识字节 CX=物理扇区大小 DX=缺省驱动器的簇数</td></tr><tr><td>1C</td><td>取任一驱动器FAT信息</td><td>DL=驱动器号</td><td>同上</td></tr><tr><td>21</td><td>随机读</td><td>DS:DX=FCB首地址</td><td>AL=00 读成功 =01 文件结束 =02 缓冲区溢出 =03 缓冲区不满</td></tr><tr><td>22</td><td>随机写</td><td>DS:DX=FCB首地址</td><td>AL=00 写成功 =01 盘满 =02 缓冲区溢出</td></tr><tr><td>23</td><td>测定文件大小</td><td>DS:DX=FCB首地址</td><td>AL=00 成功(文件长度填入FCB) AL=FF 未找到</td></tr><tr><td>24</td><td>设置随机记录号</td><td>DS:DX=FCB首地址</td><td></td></tr><tr><td>25</td><td>设置中断向量</td><td>DS:DX=中断向量AL=中断类型号</td><td></td></tr><tr><td>26</td><td>建立程序段前缀</td><td>DX=新的程序段前缀</td><td></td></tr><tr><td>27</td><td>随机分块读</td><td>DS:DX=FCB首地址 CX=记录数</td><td>AL=00 读成功 =01 文件结束 =02 缓冲区太小,传输结束 =03 缓冲区不满</td></tr><tr><td>28</td><td>随机分块写</td><td>DS:DX=FCB首地址 CX=记录数</td><td>AL=00 写成功 =01 盘满 =02 缓冲区溢出</td></tr><tr><td>29</td><td>分析文件名</td><td>ES:DI=FCB首地址 DS:SI=ASCIIZ串 AL=控制分析标志</td><td>AL=00 标准文件 =01 多义文件 =02 非法盘符</td></tr><tr><td>2A</td><td>取日期</td><td></td><td>CX=年 DH:DL=月:日(二进制)</td></tr><tr><td>2B</td><td>设置日期 CX:DH:DL=年:月:日</td><td>AL=00 成功 =FF 无效</td><td></td></tr><tr><td>2C</td><td>取时间</td><td></td><td>CH:CL=时:分 DH:DL=秒:1/100秒</td></tr><tr><td>2D</td><td>设置时间</td><td>CH:CL=时:分 DH:DL=秒:1/100秒</td><td>AL=00 成功 =FF 无效</td></tr><tr><td>2E</td><td>置磁盘自动读写标志</td><td>AL=00 关闭标志 AL=01 打开标志</td><td></td></tr><tr><td>2F</td><td>取磁盘缓冲区的首址</td><td></td><td>ES:BX=缓冲区首址</td></tr><tr><td>30</td><td>取DOS版本号</td><td></td><td>AH=发行号,AL=版本</td></tr><tr><td>31</td><td>结束并驻留</td><td>AL=返回码 DX=驻留区大小</td><td></td></tr><tr><td>33</td><td>Ctrl-Break检测</td><td>AL=00 取状态 =01 置状态(DL) DL=00 关闭检测 =01 打开检测</td><td>DL=00 关闭Ctrl-Break检测 =01 打开Ctrl-Break检测</td></tr><tr><td>35</td><td>取中断向量</td><td>AL=中断类型</td><td>ES:BX=中断向量</td></tr><tr><td>36</td><td>取空闲磁盘空间</td><td>DL=驱动器号 0=缺省,1=A,2=B,…</td><td>成功:AX=每簇扇区数 BX=有效簇数 CX=每扇区字节数 DX=总簇数 失败:AX=FFFF</td></tr><tr><td>38</td><td>置/取国家信息</td><td>DS:DX=信息区首地址</td><td>BX=国家码(国际电话前缀码) AX=错误码</td></tr><tr><td>39</td><td>建立子目录(MKDIR)</td><td>DS:DX=ASCIIZ串地址</td><td>AX=错误码</td></tr><tr><td>3A</td><td>删除子目录（RMDIR）</td><td>DS:DX=ASCIIZ串地址</td><td>AX=错误码</td></tr><tr><td>3B</td><td>改变当前目录(CHDIR)</td><td>DS:DX=ASCIIZ串地址</td><td>AX=错误码</td></tr><tr><td>3C</td><td>建立文件</td><td>DS:DX=ASCIIZ串地址 CX=文件属性</td><td>成功:AX=文件代号 错误:AX=错误码</td></tr><tr><td>3D</td><td>打开文件</td><td>DS:DX=ASCIIZ串地址 AL=0 读 =1 写 =3 读/写</td><td>成功:AX=文件代号 错误:AX=错误码</td></tr><tr><td>3E</td><td>关闭文件</td><td>BX=文件代号</td><td>失败:AX=错误码</td></tr><tr><td>3F</td><td>读文件或设备</td><td>DS:DX=数据缓冲区地址 BX=文件代号 CX=读取的字节数</td><td>读成功: AX=实际读入的字节数 AX=0 已到文件尾 读出错:AX=错误码</td></tr><tr><td>40</td><td>写文件或设备</td><td>DS:DX=数据缓冲区地址 BX=文件代号 CX=写入的字节数</td><td>写成功: AX=实际写入的字节数 写出错:AX=错误码</td></tr><tr><td>41</td><td>删除文件</td><td>DS:DX=ASCIIZ串地址</td><td>成功:AX=00</td></tr><tr><td>42</td><td>移动文件指针</td><td>BX=文件代号 CX:DX=位移量 AL=移动方式(0:从文件头绝对位移,1:从当前位置相对移动,2:从文件尾绝对位移)</td><td>成功:DX:AX=新文件指针位置 出错:AX=错误码</td></tr><tr><td>43</td><td>置/取文件属性</td><td>DS:DX=ASCIIZ串地址 AL=0 取文件属性AL=1置文件属性CX=文件属性</td><td>成功:CX=文件属性 失败:CX=错误码</td></tr><tr><td>44</td><td>设备文件I/O控制</td><td>BX=文件代号 AL=0 取状态 =1 置状态DX =2 读数据 =3 写数据 =6 取输入状态 =7 取输出状态</td><td>DX=设备信息</td></tr><tr><td>45</td><td>复制文件代号</td><td>BX=文件代号1</td><td>成功:AX=文件代号2 失败:AX=错误码</td></tr><tr><td>46</td><td>人工复制文件代号</td><td>BX=文件代号1 CX=文件代号2</td><td>失败:AX=错误码</td></tr><tr><td>47</td><td>取当前目录路径名</td><td>DL=驱动器号 DS:SI=ASCIIZ串地址</td><td>(DS:SI)=ASCIIZ串 失败:AX=出错码</td></tr><tr><td>48</td><td>分配内存空间</td><td>BX=申请内存容量</td><td>成功:AX=分配内存首地 失败:BX=最大可用内存</td></tr><tr><td>49</td><td>释放内容空间</td><td>ES=内存起始段地址</td><td>失败:AX=错误码</td></tr><tr><td>4A</td><td>调整已分配的存储块</td><td>ES=原内存起始地址 BX=再申请的容量</td><td>失败:BX=最大可用空间 AX=错误码</td></tr><tr><td>4B</td><td>装配/执行程序</td><td>DS:DX=ASCIIZ串地址 ES:BX=参数区首地址 AL=0 装入执行 AL=3 装入不执行</td><td>失败:AX=错误码</td></tr><tr><td>4C</td><td>带返回码结束</td><td>AL=返回码</td><td></td></tr><tr><td>4D</td><td>取返回代码</td><td></td><td>AX=返回代码</td></tr><tr><td>4E</td><td>查找第一个匹配文件</td><td>DS:DX=ASCIIZ串地址 CX=属性</td><td>AX=出错代码(02,18)</td></tr><tr><td>4F</td><td>查找下一个匹配文件</td><td>DS:DX=ASCIIZ串地址(文件名中带有?或*)</td><td>AX=出错代码(18)</td></tr><tr><td>54</td><td>取盘自动读写标志</td><td></td><td>AL=当前标志值</td></tr><tr><td>56</td><td>文件改名</td><td>DS:DX=ASCIIZ串(旧) ES:DI=ASCIIZ串(新)</td><td>AX=出错码(03,05,17)</td></tr><tr><td>57</td><td>置/取文件日期和时间</td><td>BX=文件代号AL=0 读取 AL=1设置(DX:CX)</td><td>DX:CX=日期和时间 失败:AX=错误码</td></tr><tr><td>58</td><td>取/置分配策略码</td><td>AL=0 取码 AL=1 置码(BX)</td><td>成功:AX=策略码 失败:AX=错误码</td></tr><tr><td>59</td><td>取扩充错误码</td><td></td><td>AX=扩充错误码 BH=错误类型 BL=建议的操作 CH=错误场所</td></tr><tr><td>5A</td><td>建立临时文件</td><td>CX=文件属性 DS:DX=ASCIIZ串地址</td><td>成功:AX=文件代号 失败:AX=错误码</td></tr><tr><td>5B</td><td>建立新文件</td><td>CX=文件属性 DS:DX=ASCIIZ串地址</td><td>成功:AX=文件代号 失败:AX=错误码</td></tr><tr><td>5C</td><td>控制文件存取</td><td>AL=00封锁 =01开启 BX=文件代号 CX:DX=文件位移 SI:DI=文件长度</td><td>失败:AX=错误码</td></tr><tr><td>62</td><td>取程序段前缀</td><td></td><td>BX=PSP地址</td></tr></tbody></table><h4 id="保护模式"><a href="#保护模式" class="headerlink" title="保护模式"></a>保护模式</h4><p>随着软件的规模不断增加，需要更高的计算量、更大的内存容量。内存一大，首先要解决的问题是寻址问题，因为 16 位的寄存器最多只能表示 216 个地址，所以 CPU 的寄存器和运算单元都要扩展成 32 位的。</p><p><strong>保护模式寄存器</strong></p><p>保护模式相比于实模式，增加了一些控制寄存器和段寄存器，扩展通用寄存器的位宽，所有的通用寄存器都是 32 位的，还可以单独使用低 16 位，这个低 16 位又可以拆分成两个 8 位寄存器，如下表。</p><p><img src="https://s2.loli.net/2021/12/12/XIODSGkgh1Mnb5x.png" alt="保护模式下寄存器组成"></p><p><strong>保护模式特权级</strong></p><p>为了区分哪些指令（如 in、out、cli）和哪些资源（如寄存器、I/O 端口、内存地址）可以被访问，CPU 实现了特权级。特权级分为 4 级，R0~R3，每个特权级执行指令的数量不同，R0 可以执行所有指令，R1、R2、R3 依次递减，它们只能执行上一级指令数量的子集。而内存的访问则是靠后面所说的段描述符和特权级相互配合去实现的。如下图：</p><p><img src="https://s2.loli.net/2021/12/12/Kpzj6sleWoMxfy9.png" alt="CPU特权示意图"></p><p>上面的圆环图，从外到内，既能体现权力的大小，又能体现各特权级对资源控制访问的多少，还能体现各特权级之间的包含关系。R0 拥有最大权力，可以访问低特权级的资源，反之则不行。</p><p><strong>保护模式段描述符</strong></p><p>目前为止，内存还是分段模型，要对内存进行保护，就可以转换成对段的保护。由于 CPU 的扩展导致了 32 位的段基地址和段内偏移，还有一些其它信息，所以 16 位的段寄存器肯定放不下。放不下就要找内存借空间，然后把描述一个段的信息封装成特定格式的段描述符，放在内存中，其格式如下：</p><p><img src="https://s2.loli.net/2021/12/12/l3hmQ156WnAwoZd.png" alt="保护模式的段描述符"></p><p>一个段描述符有 64 位 8 字节数据，里面包含了段基地址、段长度、段权限、段类型（可以是系统段、代码段、数据段）、段是否可读写，可执行等。虽然数据分布有点乱，这是由于历史原因造成的。多个段描述符在内存中形成全局段描述符表，该表的基地址和长度由 CPU 和 GDTR 寄存器指示。如下图所示：</p><p><img src="https://s2.loli.net/2021/12/09/xJNYymavLMgFtnW.png" alt="全局段描述符表"></p><p>段寄存器中不再存放段基地址，而是具体段描述符的索引，访问一个内存地址时，段寄存器中的索引首先会结合 GDTR 寄存器找到内存中的段描述符，再根据其中的段信息判断能不能访问成功。</p><p><strong>保护模式段选择子</strong></p><p>如果你认为 CS、DS、ES、SS、FS、GS 这些段寄存器，里面存放的就是一个内存段的描述符索引，那你可就草率了，其实它们是由影子寄存器、段描述符索引、描述符表索引、权限级别组成的。如下图所示：</p><p><img src="https://s2.loli.net/2021/12/09/WDBz3Cr4JNaHXn2.png" alt="保护模式段选择子"></p><p>上图中影子寄存器是靠硬件来操作的，对系统程序员不可见，是硬件为了减少性能损耗而设计的一个段描述符的高速缓存，不然每次内存访问都要去内存中查表，那性能损失是巨大的，影子寄存器也正好是 64 位，里面存放了 8 字节段描述符数据。</p><p>低三位之所以能放 TI 和 RPL，是因为段描述符 8 字节对齐，每个索引低 3 位都为 0，类似1000，10000，11000这样的。所以低3位可以用来做其他事，这里就用来放TI和RPL。由于我们不用关注 LDT，只需要使用 GDT 全局描述符表，所以 TI 永远设为 0。</p><p>通常情况下，CS 和 SS 中 RPL（Request Privilege Level） 就组成了 CPL（Current Privilege Level当前权限级别），所以常常是 RPL=CPL，进而 CPL 就表示发起访问者要以什么权限去访问目标段，当 CPL 大于目标段 DPL 时，则 CPU 禁止访问，只有 CPL 小于等于目标段 DPL（Descriptor Privilege Level） 时才能访问。</p><p><strong>保护模式平坦模型</strong></p><p>分段模型有很多缺陷，其实现代操作系统都会使用分页模型。但是 x86 CPU 并不能直接使用分页模型，而是要在分段模型的前提下，根据需要决定是否要开启分页。因为这是硬件的规定，程序员是无法改变的。但是我们可以简化设计，来使分段成为一种“虚设”，这就是保护模式的平坦模型。</p><p>CPU 32 位的寄存器最多只能产生 4GB 大小的地址，而一个段长度也只能是 4GB，所以我们把所有段的基地址设为 0，段的长度设为 0xFFFFF，段长度的粒度设为 4KB，这样所有的段都指向同一个（0~4GB-1）字节大小的地址空间。段长度需要和 G 位配合，若 G 位为 1 则段长度等于 0xfffff 个 4KB。</p><p><strong>保护模式中断</strong></p><p>实模式下 CPU 不需要做权限检查，所以它可以直接通过中断向量表中的值装载 CS:IP 寄存器就好了。而保护模式下的中断要权限检查，还有特权级的切换，所以就需要扩展中断向量表的信息，即每个中断用一个中断门描述符来表示，也可以简称为中断门，中断门描述符依然有自己的格式，如下图所示：</p><p><img src="https://s2.loli.net/2021/12/09/zpQG4cMEXwyPoI3.png" alt="保护模式下中断门描述符"></p><p>同样的，保护模式要实现中断，也必须在内存中有一个中断向量表，同样是由 IDTR 寄存器指向，只不过中断向量表中的条目变成了中断门描述符，如下图所示：</p><p><img src="https://s2.loli.net/2021/12/09/43SgJ18xC6GwvNn.png" alt="保护模式下段中断表"></p><p>产生中断后，CPU按以下顺序处理中断：</p><ol><li>CPU 首先会检查中断号是否大于最后一个中断门描述符，x86 CPU 最大支持 256 个中断源（即中断号：0~255），然后检查描述符类型（是否是中断门或者陷阱门）、是否为系统描述符，是不是存在于内存中。</li><li>接着，检查中断门描述符中的段选择子指向的段描述符。</li><li>最后做权限检查，如果 CPL 小于等于中断门的 DPL，并且 CPL 大于等于中断门中的段选择子所指向的段描述符的 DPL，就指向段描述符的 DPL。进一步的，CPL 等于中断门中的段选择子指向段描述符的 DPL，则为同级权限不进行栈切换，否则进行栈切换。如果进行栈切换，还需要从 TSS 中加载具体权限的 SS、ESP，当然也要对 SS 中段选择子指向的段描述符进行检查。</li><li>做完这一系列检查之后，CPU 才会加载中断门描述符中目标代码段选择子到 CS 寄存器中，把目标代码段偏移加载到 EIP 寄存器中。</li></ol><p><strong>切换到保护模式</strong></p><p>x86 CPU 在第一次加电和每次 reset 后，都会自动进入实模式，要想进入保护模式，就需要程序员写代码实现从实模式切换到保护模式。切换到保护模式的步骤如下：</p><p>第一步，准备全局段描述符表，代码如下。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">GDT_START:knull_dsc: dq 0kcode_dsc: dq 0x00cf9e000000ffffkdata_dsc: dq 0x00cf92000000ffffGDT_END:GDT_PTR:GDTLEN  dw GDT_END-GDT_START-1GDTBASE  dd GDT_START<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第二步，加载设置 GDTR 寄存器，使之指向全局段描述符表。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">lgdt [GDT_PTR]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第三步，设置 CR0 寄存器，开启保护模式。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">;开启 PEmov eax, cr0bts eax, 0                      ; CR0.PE =1mov cr0, eax         <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>第四步，进行长跳转，加载 CS 段寄存器，即段选择子。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">jmp dword 0x8 :_32bits_mode ;_32bits_mode为32位代码标号即段偏移<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>为什么要进行长跳转，这是因为我们无法直接或间接 mov 一个数据到 CS 寄存器中，因为刚刚开启保护模式时，CS 的影子寄存器还是实模式下的值，所以需要告诉 CPU 加载新的段信息。</p><p>接下来，CPU 发现了 CRO 寄存器第 0 位的值是 1，就会按 GDTR 的指示找到全局描述符表，然后根据索引值 8，把新的段描述符信息加载到 CS 影子寄存器，当然这里的前提是进行一系列合法的检查。到此为止，CPU 真正进入了保护模式，CPU 也有了 32 位的处理能力。</p><h4 id="长模式"><a href="#长模式" class="headerlink" title="长模式"></a>长模式</h4><p>长模式又名 AMD64，因为这个标准是 AMD 公司最早定义的，它使 CPU 在现有的基础上有了 64 位的处理能力，既能完成 64 位的数据运算，也能寻址 64 位的地址空间。这在大型计算机上犹为重要，因为它们的物理内存通常有几百 GB。</p><p><strong>长模式寄存器</strong></p><p>长模式相比于保护模式，增加了一些通用寄存器，并扩展通用寄存器的位宽，所有的通用寄存器都是 64 位，还可以单独使用低 32 位。这个低 32 位可以拆分成一个低 16 位寄存器，低 16 位又可以拆分成两个 8 位寄存器，如下表：</p><p><img src="https://s2.loli.net/2021/12/09/poIn546h1fFRNTd.png" alt="长模式下寄存器"></p><p><strong>长模式段描述符长模式段描述符</strong></p><p>长模式依然具备保护模式绝大多数特性，如特权级和权限检查。相同的部分就不再重述了，这里只会说明长模式和保护模式下的差异。下面我们来看看长模式下段描述的格式，如下图所示：</p><p><img src="https://s2.loli.net/2021/12/09/foRrdeE8z3l5Hcu.png" alt="长模式下段描述符"></p><p>在长模式下，CPU 不再对段基址和段长度进行检查，只对 DPL 进行相关的检查，这个检查流程和保护模式下一样。当描述符中的 L=1，D/B=0 时，就是 64 位代码段，DPL 还是 0~3 的特权级。然后有多个段描述在内存中形成一个全局段描述符表，同样由 CPU 的 GDTR 寄存器指向。长模式弱化段模式管理，只保留了权限级别的检查，忽略了段基址和段长度，而地址的检查则交给了 MMU。</p><p><strong>长模式中断</strong></p><p>护模式下为了实现对中断进行权限检查，实现了中断门描述符，在中断门描述符中存放了对应的段选择子和其段内偏移，还有 DPL 权限，如果权限检查通过，则用对应的段选择子和其段内偏移装载 CS:EIP 寄存器。</p><p>长模式支持 64 位内存寻址，所以要对中断门描述符进行修改和扩展，下面我们就来看看长模式下的中断门描述符的格式，如下图所示：</p><p><img src="https://s2.loli.net/2021/12/09/vVtqepOEMNsJX2C.png" alt="长模式下段中断门描述符"></p><p>结合上图，我们可以看出长模式下中断门描述符的格式变化。</p><ol><li><p>首先为了支持 64 位寻址中断门描述符在原有基础上增加 8 字节，用于存放目标段偏移的高 32 位值。</p></li><li><p>其次，目标代码段选择子对应的代码段描述符必须是 64 位的代码段。</p></li><li><p>最后其中的 IST 是 64 位 TSS 中的 IST 指针。</p></li></ol><p>长模式也同样在内存中有一个中断门描述符表，只不过表中的条目（如上图所示）是 16 字节大小，最多支持 256 个中断源，对中断的响应和相关权限的检查和保护模式一样，这里不再赘述。</p><p><strong>切换到长模式</strong></p><p>我们既可以从实模式直接切换到长模式，也可以从保护模式切换长模式。切换到长模式的步骤如下。</p><p>第一步，准备长模式全局段描述符表。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">ex64_GDT:null_dsc:  dq 0;第一个段描述符CPU硬件规定必须为0c64_dsc:dq 0x0020980000000000  ;64位代码段d64_dsc:dq 0x0000920000000000  ;64位数据段eGdtLen   equ $ - null_dsc  ;GDT长度eGdtPtr:dw eGdtLen - 1  ;GDT界限     dq ex64_GDT<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第二步，准备长模式下的 MMU 页表，这个是为了开启分页模式，切换到长模式必须要开启分页，想想看，长模式下已经不对段基址和段长度进行检查了，那么内存地址空间就得不到保护了。</p><p>而长模式下内存地址空间的保护交给了 MMU，MMU 依赖页表对地址进行转换，页表有特定的格式存放在内存中，其地址由 CPU 的 CR3 寄存器指向。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">mov eax, cr4bts eax, 5   ;CR4.PAE = 1mov cr4, eax ;开启 PAEmov eax, PAGE_TLB_BADR ;页表物理地址mov cr3, eax<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第三步，加载 GDTR 寄存器，使之指向全局段描述表：</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">lgdt [eGdtPtr]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第四步，开启长模式，要同时开启保护模式和分页模式，在实现长模式时定义了 MSR 寄存器，需要用专用的指令 rdmsr、wrmsr 进行读写，IA32_EFER 寄存器的地址为 0xC0000080，它的第 8 位决定了是否开启长模式。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">;开启 64位长模式mov ecx, IA32_EFERrdmsrbts eax, 8  ;IA32_EFER.LME =1wrmsr;开启 保护模式和分页模式mov eax, cr0bts eax, 0    ;CR0.PE =1bts eax, 31mov cr0, eax <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第五步，进行跳转，加载 CS 段寄存器，刷新其影子寄存器。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">jmp 08:entry64 ;entry64为程序标号即64位偏移地址<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>切换到长模式和切换保护模式的流程差不多，只是需要准备的段描述符有所区别，还有就是要注意同时开启保护模式和分页模式。</p>]]></content>
      
      
      <categories>
          
          <category> System </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>控制逻辑：表达式和语句是如何协调程序运行的</title>
      <link href="/2021/12/20/kong_zhi_luo_ji_biao_da_shi_he_yu_ju_shi_ru_he_xie_diao_cheng_xu_yun_xing_de/"/>
      <url>/2021/12/20/kong_zhi_luo_ji_biao_da_shi_he_yu_ju_shi_ru_he_xie_diao_cheng_xu_yun_xing_de/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h4><p>表达式（expression）是由一系列运算符与操作数（operand）组成的一种语法结构。通常来说，表达式的求值（evaluation）过程，实际上就是根据运算符的优先级和结合性，来对表达式和它所包含的子表达式进行<strong>递归求值</strong>的过程。从编译的角度来看，这个过程中所涉及到的操作数的实际求值顺序会在<strong>语法分析阶段被确</strong>定，并体现在源码对应的<strong>抽象语法树</strong>（AST，Abstract Syntax Tree）上。</p><p>表达式提供了这样一种能力：<strong>能够让数据同时参与到多个操作符的不同计算过程中</strong>。而通过提供对运算符优先级与结合性的规则限制，表达式可以控制整个计算过程的有序进行。</p><h4 id="语句"><a href="#语句" class="headerlink" title="语句"></a>语句</h4><p>语句（statement）是用来描述程序的基本构建块。和表达式不同，语句是构成 C 程序的最大粒度单元，在它的内部，可以包含有简单或复杂的表达式结构，但也可以不包含任何内容。除此之外，语句在执行时不返回任何结果，但可能会产生副作用。</p><p>在 C 语言中，语句可以被分为复合语句、表达式语句、选择语句、迭代语句、跳转语句五种类型。<strong>但无论是哪种类型，语句都必须以分号结尾，并按从上到下的顺序依次执行。</strong></p><p>其中，<strong>复合语句</strong>是指由花括号 “{}” 标记的一块区域。在这个区域中，我们可以放置声明（declaration）和语句，而最<strong>常见的一种复合语句便是函数体</strong>。在函数体内部，我们可以定义变量，并通过结合各类其他语句来实现函数的功能。而<strong>表达式语句则是直接由表达式外加一个分号组成的语句</strong>，比如函数调用语句或变量赋值语句。当然，表达式语句中的表达式也可以为空，这样就成为了仅由一个 “;” 组成的空语句。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 复合语句；</span>  <span class="token keyword">int</span> sum <span class="token operator">=</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span> <span class="token comment">// 表达式语句；</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>sum <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// 复合语句；</span>    sum <span class="token operator">=</span> <span class="token operator">-</span>sum<span class="token punctuation">;</span>  <span class="token comment">// 表达式语句；</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> sum<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="选择语句"><a href="#选择语句" class="headerlink" title="选择语句"></a>选择语句</h5><p>同其他大多数语言类似，在 C 语言中，选择语句主要是指由 if…else 和 switch…case 这两种语法结构组成的语句。首先来看 if…else 语句：</p><p><img src="https://s2.loli.net/2021/12/14/WSYf539IT8xjnVu.png" alt="C语言ifelse"></p><p>通过红框内的汇编代码可以看到，变量 v 的值被存放在栈内存中地址为 rbp 寄存器的值减去 4 的位置上。程序使用多个标签（如 .L2、.L3 等），分别划分不同分支对应的处理逻辑，而分支的判断过程则是由指令 cmp 与条件跳转指令 je 与 jne 共同完成的。<strong>汇编代码和 C 代码的整体逻辑基本是一一对应的关系</strong>。因此，在这种情况下，为了尽量保持程序的执行性能，你可以将<strong>命中几率较大的条件语句放在较前的位置</strong>上。</p><p>接着，我们再来看看 switch…case 语句。</p><p><img src="https://s2.loli.net/2021/12/14/YydKzv4CVgj8p1H.png" alt="C语言switchcase"></p><p>首先汇编代码会通过 cmp 指令，判断寄存器 eax 中的值，即变量 v 的值是否大于 60。若判断成立，则直接将程序跳转到标签 .L2 处，并将数字 4 作为返回值；若条件不成立，程序将继续执行。接下来代码会基于变量 v 的值，来产生一个用于参与后续运算符的 “token” 值。这个值的生成步骤如下所示：</p><ol><li>将寄存器 edx 的值设为 1；</li><li>将寄存器 ecx 的值设为变量 v 的值；</li><li>将寄存器 rdx 中的值左移 v 位（值被扩展为 64 位）；</li><li>将此时寄存器 rdx 中的值移动到 rax 中留作待用。</li></ol><p>接下来，程序完成了对变量 v 的值的第一次筛选过程。这个过程很好理解，如果将其中第一行指令 movabs 的立即数操作数 1154047404513689600 以 64 位二进制的形式展开，你会发现其中只有第 50 和 60 位被置位。</p><p>而第二行的 and 指令，会将这个超长的立即数与之前根据变量 v 的值进行移位而得来的 token 值进行“与”操作。若操作得到的结果不为 0，则表示 token 值的第 50 或 60 位肯定不为 0，即变量 v 的值为 50 或 60。否则，变量 v 的值则不符合该 case 语句的筛选条件。到这里，筛选的基本逻辑相信你已经清楚了。</p><p>不过，通过<strong>“位映射”</strong>的方式进行分支筛选，并不能完美地覆盖所有情况。比如，当 case 语句的筛选值过大，无法使用寄存器来进行映射时，默认优化条件下，编译器会将 switch…case 的实现“回退”到与 if…else 类似的方式。也就是说，使用 cmp 指令与条件跳转指令来进行分支的筛选与转移。当然，具体采用哪种实现策略依据编译器的不同而有所不同。</p><p>除了上面介绍的 if…else 与 switch…case 语句实现方式外，在高优化等级下，编译器还可能会采用一种名为“<strong>跳表</strong>”的方式，来实现这两种条件选择语句。</p><p><img src="https://s2.loli.net/2021/12/14/Q2w4n81rXaGKlm7.png" alt="C语言高优化打开后的switchcase语句"></p><p><strong>跳表是一种用空间换时间的条件匹配策略。</strong></p><p>首先，标注为红色的汇编代码将变量 v 的值减去了选择语句中最小匹配条件的值，这里也就是 10。然后，程序通过 cmp 与 ja 指令，判断变量 v 的值是否超过了选择语句中最大匹配条件与最小匹配条件之间的差值，这里也就是 30。若是，则程序直接跳转到标签 .LBB0_3 处，并返回数值 3。</p><p>否则，程序就会使用跳表来寻找变量 v 的值对应的正确分支。<strong>所谓跳表，即在一段连续内存中存放的，可用于辅助查找正确目标地址的地址信息。</strong>在上面这个例子中，跳表从标签 .LJTI0_0 处开始。在这段内存中，连续存放了筛选值 10 到 40 区间内，每一个整数值对应的正确分支处理地址。接下来的蓝色代码保存了当跳表第 0 项“命中”时，函数需要返回的值。</p><p>假设在调用函数 foo 时，传入变量 v 的值为 20。虚线框中的 jmp 指令在执行时，会根据 v 的值在跳表中找到它所对应的正确分支地址。由于这里 rdi 寄存器中的值为 10（20 - 10），因此正确的分支处理地址便是跳表中第十项对应的值。这里可以看到，在 .LJTI0_0 标签 +80 字节的位置（.quad 代表 8 字节数据）处，正对应着标签 .LBB0_4 的地址。而该标签的位置，正是变量 v 为值 20 时的正确分支处理地址。</p><p>除了上面提到的这些编译器在实现分支语句时使用的常用方式外，根据分支语句的具体情况，编译器还可能会采用某些针对特定形态代码的专用优化。而即使针对最“原始”的 cmp 加条件跳转语句组合这种实现方式，编译器也会根据 C 源代码的情况，适当使用“<strong>二分法</strong>”等优化策略，来加快条件的筛选过程。</p><p>总之，选择语句编译器通常会采用位<strong>映射法、跳表法、基于二分法的测试与条件跳转语句</strong>的方式来实现它们。</p><h5 id="迭代语句"><a href="#迭代语句" class="headerlink" title="迭代语句"></a>迭代语句</h5><p>在 C 语言中，迭代语句主要包含 do…while、for、while 这三种基本语法形式。这些语句除了在执行细节上有些许差异外，其对应的汇编实现思路大同小异。这里我以 do…while 语句为例来讲解，具体代码如下所示：</p><p><img src="https://s2.loli.net/2021/12/14/R54azAkhmJGbqiu.png" alt="C语言dowhile语句"></p><p>可以看到，在真正对变量 v 进行条件判断之前，程序已经执行了一次 printf 函数，而这便是 do…while 语句相较于其他迭代语句的特点。迭代过程以 .L2 标签作为每次的起始点，每次迭代都遵循着“<strong>先执行循环体，再判断条件</strong>”的规则。条件的判断和执行转移流程则分别由指令 test 与 jne 负责进行。</p><p>即使是在高优化等级下，C 语言中的这三种基本迭代语句在机器层面的汇编实现方式也不会有较大的差异，但这也并不意味着你可以随意使用它们。至少对于 do…while 与 while 而言，它们在执行细节上存在着差异，如果不假思索地使用，很可能会给你的程序招致不必要且难以调试的 BUG。</p><h5 id="跳转语句"><a href="#跳转语句" class="headerlink" title="跳转语句"></a>跳转语句</h5><p>C 语言中的跳转语句主要指那些可以改变程序执行流程的语法结构，它们主要包括以下四种类型：</p><ul><li>break 语句；</li><li>continue 语句；</li><li>return 语句；</li><li>goto 语句。</li></ul><p>在 C 代码中，用于控制程序执行逻辑的大部分语句，其背后都是通过条件跳转语句来实现的。编译器通过代码分析，可以找到程序中可能的“跳入点”与“跳出点”，并在机器指令层面通过 je 等条件跳转指令，来控制程序的执行流程在这些点之间进行转移。</p>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>计算单元：运算符是如何工作的</title>
      <link href="/2021/12/20/ji_suan_dan_yuan_yun_suan_fu_shi_ru_he_gong_zuo_de/"/>
      <url>/2021/12/20/ji_suan_dan_yuan_yun_suan_fu_shi_ru_he_gong_zuo_de/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>运算符（operator）</strong>、<strong>表达式（expression）</strong>和语句<strong>（statement）</strong>是组成 C 程序的三个最基本的语法结构。在 C 语言中，这三种概念之间一般呈“包含”关系，即表达式中通常含有运算符，而语句中也可以包含有表达式。最终，众多的语句便组成了一个完整的 C 程序。</p><h4 id="C-运算符的分类"><a href="#C-运算符的分类" class="headerlink" title="C 运算符的分类"></a>C 运算符的分类</h4><p>在目前最新的 C17 标准中，C 语言一共有 48 个运算符。按照这些运算符功能的不同，我们可以将它们分为七类（分类方式并不唯一），如下表所示：</p><p><img src="https://s2.loli.net/2021/12/12/C1yITKrt9wldVBQ.png" alt="C运算符"></p><p>这七类运算符在功能上均有所不同，因此，使用机器指令进行表达的具体方式和复杂程度也不同。其中，算数、关系、位与赋值运算符由于功能较为基础，可以与某些机器指令一一对应。而逻辑运算符、成员访问运算符及其他运算符，实现相对复杂。</p><h5 id="算数、关系、位、赋值运算符等算术运算符"><a href="#算数、关系、位、赋值运算符等算术运算符" class="headerlink" title="算数、关系、位、赋值运算符等算术运算符"></a>算数、关系、位、赋值运算符等算术运算符</h5><p>算数、关系、位、赋值这四类运算符在经过编译器处理后，一般都可以直接对应到由目标平台上相应机器指令组成的简单计算逻辑。</p><h5 id="FLAGS-寄存器"><a href="#FLAGS-寄存器" class="headerlink" title="FLAGS 寄存器"></a>FLAGS 寄存器</h5><p><strong>FLAGS 寄存器</strong>是一组用于反映程序当前运行状态的标志寄存器。许多机器指令在执行完毕时，都会同时调整 FLAGS 寄存器中对应位的值，以响应程序状态的变化。setg 便会通过查看 FLAGS 寄存器中的 ZF 位是否为 0，且 SF 与 OF 位的值是否相等，来决定将寄存器 al 中的值置 1，还是置 0。因此，FLAGS 寄存器的状态满足指令 setg 的置位条件（ZF=0 且 SF=OF），al 寄存器的值将被置 1。</p><p><img src="https://s2.loli.net/2021/12/12/tOTfJL5dpoZDBqk.png" alt="FLAGS表示"></p><h5 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h5><p>说完这四种较为直观的运算符，让我们再来看看逻辑运算符。这里，我们直接以逻辑与运算符 “&amp;&amp;” 为例，来看看编译器是如何实现它的。该类别下的其他运算符，实现方式与其类似，区别仅在于使用的具体指令可能有所不同。首先，我们还是来看一段示例代码：</p><p><img src="https://s2.loli.net/2021/12/12/nurgZ1z2vRM5sKP.png" alt="C与没有优化"></p><p>在 C 标准中，逻辑与运算符 “&amp;&amp;” 的语义是：如果它左右两侧的操作数都具有非零值，则产生计算结果值 1。而如果任一操作数为 0，则计算结果为 0。不仅如此，标准还规定了该运算符在执行模型中的求值规则：如果通过逻辑与运算符左侧第一个操作数的求值结果就能确定表达式的值，就不再需要对第二个操作数进行求值了，这也就是我们常说的“短路与”。</p><p>逻辑与运算符并没有可与之直接对应的汇编指令。并且，为了满足“短路”要求，编译器在非优化的实现中通常会使用条件跳转指令，比如 je。<strong>je 指令会判断当前 FLAGS 寄存器中的标志位 ZF 是否为 0。若为 0，则会将程序执行直接跳转到给定标签所在地址上的指令。</strong></p><p>上图中右侧输出的汇编代码里，程序会按顺序将位于栈内存中的变量 x 和 y 的值与数值 0 进行比较。若其中的某个比较结果相等，程序执行将会直接跳转到标签 “.L2” 的所在位置。在这里，值 0 会被直接放入寄存器 eax。而若变量 x 与 y 的值判断均不成立，则值 1 会被放入该寄存器。紧接着，标签 “.L3” 中的指令将接着执行。到这里，寄存器 eax 中的值将会被作为最终结果，赋值给变量 logical。</p><p>在非优化版本的实现中，编译器使用了 je 条件跳转指令。其实，现代流水线 CPU 通常会采用一种名为“<strong>投机执行</strong>”的方式来优化条件跳转指令的执行。所谓投机执行，是指 CPU 会通过分析历史的分支执行情况，来推测条件跳转指令将会执行的分支，并提前处理所预测分支上的指令。而等到 CPU 发现之前所预测的分支是错误的时候，它将不得不丢弃这个分支上指令的所有中间处理结果，并将执行流程转移到正确的分支上。很明显，这样就会浪费较多的时钟周期。</p><p><strong>就逻辑与运算符来说，在使用高编译优化等级时</strong>，编译器还可能会采用下面这种方式来实现该运算符。这里，我们看到了新的汇编指令： test 、setne 和 movzx 。</p><pre class="line-numbers language-assembly" data-language="assembly"><code class="language-assembly">test    edi, edi  ; edi &lt;- x.setne   altest    esi, esi  ; esi &lt;- y.setne   silmovzx   esi, siland     esi, eax<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>test 指令的执行方式与 cmp 类似，只不过它会对传入的两个操作数做隐式的“与”操作，而非减法操作。在操作完成后，根据计算结果，指令会相应地修改 FLAGS 寄存器上的 SF、ZF 以及 PF 标志位。另外的 setne 指令则与 setg 指令类似，该指令将在 ZF 为 0 时把传入的寄存器置位，否则将其复位。最后的指令 movzx 实际上是 mov 指令的一种变体。这个指令将数据从源位置移动到目标位置后，会同时对目标位置上的数据进行零扩展（Zero Extension）。</p><p>编译器在高优化等级下对逻辑与运算符的实现方式：首先，通过 test 指令，程序可以判断参数 x 与 y 是否为非零值。若为非零值，则相应的寄存器会被指令 setne 置位。在这种情况下，寄存器 al 与 sil 中便存放有用于表示变量 x 与 y 是否为零的布尔数字值 0 或 1。接下来，通过数据移动指令，寄存器 sil 中的值被移动到寄存器 esi 中。最后的 and 指令又会对 x 与 y 的布尔数字值再次进行与操作，得到的最终结果将被存放在目的寄存器，即 esi 中。这种实现方式大量减少了对栈内存以及条件跳转指令的使用，使得程序减少了访问内存时产生的延迟，以及由于分支预测失败而导致的 CPU 周期浪费，从而执行性能得到了提升。</p><h5 id="成员访问运算符"><a href="#成员访问运算符" class="headerlink" title="成员访问运算符"></a>成员访问运算符</h5><p>看看成员访问运算符。这里我以取地址运算符 “&amp;”、解引用运算符 “*” 为例，来介绍编译器对它们的实现细节。来看下面这段代码：</p><p><img src="https://s2.loli.net/2021/12/12/Kd4Xhyent5Jpj8l.png" alt="C成员运算符代码"></p><p>如上图中红色框对应的 C 代码和汇编代码所示，对于取地址运算符 “&amp;”，实际上它一般会直接对应到名为 lea 的汇编指令。这个指令的全称为 “Load Effective Address”，顾名思义，它主要用来将操作数作为地址，并将这个地址以值的形式传送到其他位置。比如，上面代码中的 lea 指令将寄存器 rbp 中的值减去 16 后，直接存放到寄存器 rax 中，而此时该寄存器中的值就是局部变量 n 在栈上的地址。</p><p>而解引用运算符 “*”的行为与取地址运算符完全相反。当需要对位于某个地址上的值进行传送时，我们可以直接使用 mov 指令。上图中，在蓝色框的汇编代码里，第一条 mov 指令将变量 n_ptr 的值传送到了寄存器 rax 中。随后，第二条 mov 指令将 rax 寄存器中的值作为地址，并将该地址上的值以 DWORD，即 32 位值（对应  int 类型）的形式传送到 eax 寄存器中。最后，第三条 mov 指令将此时 eax 寄存器中的结果值传送到了变量 m 在栈内存上的存储位置。</p><p>至于该类别下的其他运算符，因为它们的本质都是访问位于某个内存地址上的数据，因此实现方式大同小异。</p><h5 id="其他运算符"><a href="#其他运算符" class="headerlink" title="其他运算符"></a>其他运算符</h5><p>最后，让我们来看看除了上面那六类运算符之外的其他运算符，这里我主要介绍 <strong>sizeof</strong> 运算符和强制类型转换运算符 “**(type) a**”。</p><p><img src="https://s2.loli.net/2021/12/12/JE5lt19CmN76WvP.png" alt="Sizeof代码"></p><p>其中，<strong>sizeof</strong> 运算符是一个<strong>编译期运算符</strong>，这意味着编译器仅通过静态分析就能够将给定参数的大小计算出来。因此，在最终生成的汇编代码中，我们不会看到 sizeof 运算符对应于任何汇编指令。相反，运算符在编译过程中得到的计算结果值，将会<strong>以字面量值的形式直接“嵌入”到汇编代码中</strong>使用。你可以从上图中右侧红框内的汇编代码看到，C 代码 sizeof(int) 的计算结果 4 直接作为了 mov 指令的一个操作数。</p><p>至于强制类型转换运算符呢，其实也很好理解。这里，我们将变量 n 的值类型由原来的 size_t 转换为了 short。你可以从上图中蓝框内的汇编代码里看到，当 mov 指令将变量 n 的值移动到变量 f 所在的内存区域时，它仅移动了这个值从低位开始一个 WORD，即 16 位大小的部分。至于其他类型之间的转换过程，你可以<strong>简单理解成对同一块数据在不同机器指令下的不同“解读”方式。</strong></p><p>在高编译优化等级下，上面介绍的<strong>成员访问运算符与强制类型转换运算符</strong>的实现方式并没<strong>有发生本质的变化</strong>。而与<strong>其他运算符</strong>类似的是，<strong>编译器会减少对栈内存的使用</strong>。同时，基于更强的静态分析能力，编译器甚至可以提前推算出某些变量的取值，并省去在程序运行过程中再进行类型转换的过程，从而进一步提升程序的运行时性能。</p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul><li>通常来说，算数、关系、位、赋值运算符的实现在大多数情况下，都会直接一一对应到特定的汇编指令上；</li><li>逻辑运算符的实现方式则有些不同，它会首先借助 test 、 cmp 等指令，来判断操作数的状态，并在此基础上再进行相应的数值转换过程；</li><li>在成员访问运算符中，取地址运算符一般对应于汇编指令 lea ，解引用运算符则可直接使用 mov 指令来实现；</li><li>对于其他运算符，sizeof 运算符会在编译时进行求值，强制类型转换运算符则直接对应于不同指令对同一块数据的不同处理方式。</li></ul>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>程序基石：数据与量值如何被组织的</title>
      <link href="/2021/12/20/cheng_xu_ji_shi_shu_ju_yu_liang_zhi_ru_he_bei_zu_zhi_de/"/>
      <url>/2021/12/20/cheng_xu_ji_shi_shu_ju_yu_liang_zhi_ru_he_bei_zu_zhi_de/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="C-语言中的量值与数据"><a href="#C-语言中的量值与数据" class="headerlink" title="C 语言中的量值与数据"></a>C 语言中的量值与数据</h4><p>量值可以被粗略地分为变量（variable）与常量（constant），其中变量是指值可以在整个应用程序的生命周期中被多次改变的量；而常量则与之相反，在被定义后便无法被再次修改。</p><h5 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h5><p>C 语言为我们提供了众多的语言关键字（keyword）以用来定义相应类型的数据。比如在下面这个例子中，我们通过以下几步成功定义了多个变量：</p><ol><li>使用 int 等关键字，来指定数据的具体类型；</li><li>为该数据设置一个名称；</li><li>通过 “=” 赋值运算符为该数据设定具体的值。</li></ol><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span>  <span class="token comment">// 定义一个整型变量；</span><span class="token keyword">char</span> y <span class="token operator">=</span> <span class="token string">'c'</span><span class="token punctuation">;</span>  <span class="token comment">// 定义一个字符变量；</span><span class="token keyword">double</span> z <span class="token operator">=</span> <span class="token number">2.0</span><span class="token punctuation">;</span>  <span class="token comment">// 定义一个双精度浮点变量；</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>C 语言中变量类型占用的具体字节大小，还与程序运行所在的硬件体系结构紧密相关，这也是 C 语言与其他高级编程语言有所不同的地方。</p><p>C 语言最初被设计时，高效性就是设计者考虑的一个主要因素。因此 C 标准委员会在考虑语言设计时，会参考来自于底层硬件体系的某些因素。比如，C 标准中规定，int 类型的大小为执行环境架构体系所建议的自然大小。所谓自然大小，可以简单理解为：对于该大小的数据，硬件体系能够以最高的效率进行处理。因此，硬件体系不同，对应的自然大小便也不同，这也就意味着同一种 C 变量类型在不同硬件体系上可能会有着不同的大小。</p><p>除了可以为变量指定不同的数据类型外，同大多数其他静态类型语言类似，在 C 语言中，整型变量本身还需区分它们的“符号性（signedness）”。简单来说，其实就是两种情况：若类型仅可以存放正数，则为无符号（unsigned）类型；若正负数都可以存储，则为有符号（signed）类型。符号性上的区别有利于程序对某些特定的场景需求进行优化。</p><h5 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h5><p>在 C 语言中，通过内联方式直接写到源代码中的字面量值一般被称为“常量”。</p><p>用 const 关键字按照与定义变量相同语法定义的量，不也是常量吗？它与字面量常量有什么区别呢？</p><p>通常来说，在 C 语言中，使用 const 关键字修饰的变量定义语句，表示对于这些变量，我们无法在后续的程序中修改其对应或指针指向的值。因此，我们更倾向于称它们为“只读变量”，而非常量。当然，在程序的外在表现上，二者有一点是相同的：其值在第一次出现时便被确定，且无法在后续程序中被修改。</p><p>只读变量与字面量常量的一个最重要的不同点是，使用 const 修饰的只读变量不具有“常量表达式”的属性，因此无法用来表示定长数组大小，或使用在 case 语句中。常量表达式本身会在程序编译时被求值，而只读变量的值只能够在程序实际运行时才被得知。并且，编译器通常不会对只读变量进行内联处理，因此其求值不符合常量表达式的特征。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token keyword">int</span> vx <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">const</span> <span class="token keyword">int</span> vy <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">int</span> arr<span class="token punctuation">[</span>vx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token comment">// [错误1] 使用非常量表达式定义定长数组；</span>  <span class="token keyword">switch</span><span class="token punctuation">(</span>vy<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">case</span> vx<span class="token operator">:</span> <span class="token punctuation">{</span>  <span class="token comment">// [错误2] 非常量表达式应用于 case 语句；</span>      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Value matched!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">break</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="数据的存储形式"><a href="#数据的存储形式" class="headerlink" title="数据的存储形式"></a>数据的存储形式</h4><p>计算机在看待数据时，并不会区分其符号性，而符号性的差异仅体现在计算机指令操作数据时的具体使用方式上。</p><p>计算机不会区分数据的符号性，符号性的差异仅由计算机指令如何使用数据而定。比如在 C 语言中，当对某类型变量进行强制类型转换时，其底层存储的数据并不会发生实质的变化，而仅是程序对如何解读这部分数据的方式发生了改变。比如下面这个例子：</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">signed</span> <span class="token keyword">char</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span><span class="token punctuation">)</span>x<span class="token punctuation">;</span>  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d\n"</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// output: 246.</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中，有符号整型变量 x 会按照位模式 1111 0110 的补码形式存放有符号数 -10，而如果将该序列按照无符号整数的位模式进行解读，则可得到如程序运行输出一样的结果，即无符号整数值 246。 总之，程序在进行强制类型转换时，不会影响其底层数据的实际存储方式。</p><p>在 C 语言中，关于数据使用还有一个值得注意的问题：<strong>变量类型的隐式转换（Implicit Type Conversion）</strong>。C 语言作为一种弱类型语言，其一大特征就是在某些特殊情况下，变量的实际类型会发生隐式转换。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">;</span>  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"x is smaller than y."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"x is bigger than y."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// this branch is picked!</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实际上，在上面的代码中，程序逻辑在真正进入到条件语句之前，变量 x 的类型会首先被隐式转换为 unsigned int ，即无符号整型。而根据数据类型的解释规则，原先存放有 -10 补码的位模式会被解释为一个十分庞大的正整数，而这个数则远远大于 1。</p><p>同整数一样，C 语言在对浮点数进行类型转换时（无论隐式还是显式），也都不会对底层存放的浮点数据进行改动，而只是将对应位序列的解释方式从浮点数改为了其他方式。在 C 语言中，双精度浮点类型 double 具有作为隐式类型转换的最高优先级。当在一个表达式中存在该类型的变量时，计算机会首先将其他参与变量均转换为该类型，然后再进行表达式求值。</p><h4 id="数据的存储位置"><a href="#数据的存储位置" class="headerlink" title="数据的存储位置"></a>数据的存储位置</h4><p>在 C 语言中，通过不同的语法形式，我们可以定义具有不同数据类型的变量，这些变量按照其定义所在位置，可以被划分为局部变量、全局变量。进一步地，通过添加 static 关键字，可以将变量标记为静态类型，以延长变量的生存期，并限定其可见范围为当前编译单元，即当前所在源文件；通过添加 register 关键字，还可以建议编译器将变量值存放到寄存器中，以提升其读写性能。</p><p>对于上面提到的这些变量形式，其可能的数据存放位置均不尽相同。根据变量定义时使用的不同语法形式，我总结了变量数据的可能存放位置，如下表所示：</p><p><img src="https://s2.loli.net/2021/12/08/Kb6IsVkXQEew3l7.png" alt="C语言数据存储位置"></p><p>需要注意的是，表格里和这一讲后面提到的以 “.” 作为开头的标识，都指代对应的 Section 结构。</p><ol><li><strong>初始化的全局变量和静态变量</strong>：这类变量的值具有与应用程序同样长的生命周期，其值通常会被存放到进程 VAS（Virtual Address Space，虚拟地址空间）内的 .data 中。应用程序在被正常加载和运行前，需要首先将应用程序代码，及其相关依赖项的数据映射到内存中的某个位置，这段包含有应用程序正常运行所必备数据的内存段即进程的 VAS。像 .data 等以 “.” 开头作为标记的 Section 结构，都代表着该内存段中的某个具体位置，这些 Section 结构都为应用的正常运行提供了各方面支持。</li><li><strong>局部变量</strong>：一般来说，这些变量将被存放在寄存器或应用程序 VAS 的栈内存中，具体使用哪种方式则依赖于编译器的选择。</li><li><strong>其他</strong>：未初始化的全局变量和静态变量，以及直接通过 malloc、calloc 等标准库函数创建的内存块中所包含的数据，其存放位置也有所不同。它们被分别存放到进程 VAS 的 .bss 以及堆内存中。不同类型常量数据的存储方式也会有所不同。如下表所示，由于常量本身的不可变特征，它们会按照数据的大小和类型被选择性存放到进程 VAS 的 .rodata 以及 .text 中。其中，.rodata 用于存放只读（Read-only Data）数据，而 .text 通常用于存放程序本身的代码。</li></ol><p><img src="https://s2.loli.net/2021/12/08/gXel6MGnVZfC8h9.png" alt="部分数据存储说明"></p><p>一般的规律是，若内联的常量值较大，则会被单独存放到 .rodata 中保存，否则会直接内联到应用程序代码中，作为机器指令（比如最常见的 mov 指令）的字面量参数。</p>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>函数是如何被调用的</title>
      <link href="/2021/12/20/han_shu_shi_ru_he_bei_diao_yong_de/"/>
      <url>/2021/12/20/han_shu_shi_ru_he_bei_diao_yong_de/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>在编程语言中，函数是一种用于<strong>封装可重用代码</strong>的语法结构。函数可以接收从外部调用环境传入的数据，并在函数体内以复合语句的形式，使用这些数据构建独立的功能逻辑单元。<strong>借助函数</strong>，我们可以将一个程序的实现过程拆分为多个子步骤，并以结构化的方式来构建程序。这种方式可以减少程序中的重复代码，并通过抽象和替换来提高代码的整体可读性，以及可追溯性。</p><h4 id="C-函数的调用约定"><a href="#C-函数的调用约定" class="headerlink" title="C 函数的调用约定"></a>C 函数的调用约定</h4><p>调用约定规定了函数调用时需要关注的一系列问题，比如：如何将实参传递给被调用函数、如何将返回值从被调用函数中返回、如何管理寄存器，以及如何管理栈内存，等等。调用约定并非 C 语言标准的一部分，因此实际上每个编译器都可以使用自己独有的调用约定，来实现 C 函数的调用过程。但相应地，这也会导致另外一个问题：当具有外部链接的函数在多个不同编译单元内被使用，且这些不同编译单元对应的源文件通过不同的编译器进行编译时，那么它们各自生成的对象文件可能无法再被整合在一起，并生成最终的可执行文件。</p><p>幸运的是，对于 C 语言来说，运行在 x86-64 平台上的编译器基本都会根据所在操作系统的不同，选择使用几种常见的调用约定事实标准。比如，对于 Windows 来说，编译器会采用专有的 Microsoft x64 或 Vector 调用约定。而在 Unix 和类 Unix 系统上，则会使用名为 System V AMD64 ABI（后简称 “SysV”）的调用约定。</p><p>接下来，让我们看看 SysV 调用约定中都规定了哪些重要的实现细节。为了更直观地观察这些内容，让我们先来编写一段简单的 C 代码，并在 x86-64 平台上使用默认优化等级，通过 GCC 编译生成它所对应的汇编代码。具体如下图所示：</p><p><img src="https://s2.loli.net/2021/12/15/639ItDfanvj2skr.png" alt="C函数调用示例代码"></p><p>实际上，在 x86-64 的机器指令中，函数调用是通过 <strong>call</strong> 指令来完成。而每一个函数体在执行完毕后，都需要再通过 <strong>ret</strong> 指令来退出函数的执行，并转移代码执行流程到之前函数调用指令的下一条指令上。你可以通过下面这张图来直观地感受这个流程。其中，箭头标注出了代码的整体执行顺序。</p><p><img src="https://s2.loli.net/2021/12/15/z7GLjdiEyZUSCfs.png" alt="C语言函数调用"></p><p>接下来，我们来具体看看 <strong>SysV</strong> 调用约定中都规定了函数调用时的哪些内容。</p><h5 id="参数传递"><a href="#参数传递" class="headerlink" title="参数传递"></a>参数传递</h5><p><strong>SysV</strong> 调用约定的第一个规则是：在调用函数时，对于整型和指针类型的实参，需要分别使用寄存器 <strong>rdi、rsi、rdx、rcx、r8、r9</strong>，按函数定义时参数从左到右的顺序进行传值。而若一个函数接收的参数<strong>超过了 6 个</strong>，则余下参数将通过<strong>栈内存进行传送</strong>。此时，多出来的参数将按照<strong>从右往左（RTL）的顺序被逐个压入栈中</strong>。关于这一点，你可以通过图 （C函数调用示例代码）右侧第 30 到 40 行红框内的汇编代码得到验证。</p><p>这里，函数 foo 在调用前，分别用寄存器 edi、esi 存放局部变量 x 与 y 的值，并用寄存器 edx、ecx、r8d、r9d 存放字面量值 3、4、5、6。而多出来的另外两个字面量值参数 7 和 8 ，则直接通过 push 指令被放在了栈内存中。你需要注意这里指令操作它们的先后顺序，因为要保证这些参数以从右向左的顺序被放入栈中。另外，由于 x、y 为局部变量，因此最开始它们会被存储在栈内存中。</p><p>除此之外，对于浮点参数，编译器将会使用另外的 <strong>xmm0</strong> 到 <strong>xmm7</strong>，共 <strong>8 个寄存器</strong>进行存储。对于更宽的值，也可能会使用 <strong>ymm 与 zmm</strong> 寄存器来替代 <strong>xmm</strong> 寄存器。而上面提到的 <strong>xmm、ymm、zmm</strong> 寄存器，都是由 x86 指令集架构中名为 <strong>AVX（Advanced Vector Extensions）</strong>的扩展指令集使用的。这些指令集一般专门用于<strong>浮点数计算以及 SIMD</strong> 相关的处理过程。</p><h5 id="返回值传递"><a href="#返回值传递" class="headerlink" title="返回值传递"></a>返回值传递</h5><p>对于函数调用产生的返回值，<strong>SysV</strong> 调用约定也有相应的规则：当函数调用<strong>产生整数类型</strong>的返回值，且<strong>小于等于 64</strong> 位时，通过寄存器 <strong>rax</strong> 进行传递；当<strong>大于 64 位，小于等于 128 位</strong>时，则使用寄存器 <strong>rax 与 rdx 分别存储返回值的低 64 位与高 64 位</strong>。你可以参考图 （C函数调用示例代码） 右侧第 4、21、47 行蓝框内的代码，来验证这个规则。这三行代码分别处理了函数 bar、foo，以及 main 的返回值。需要注意的是，对于复合类型（比如结构体）的返回值，编译器可能会直接使用栈内存进行“<strong>中转</strong>”。</p><p>对于浮点数类型的返回值，同参数传递类似，编译器会默认使用 <strong>xmm0 与 xmm1</strong> 寄存器进行存储。而当<strong>返回值过大</strong>时，则会选择性使用 <strong>ymm 与 zmm 来替代 xmm</strong> 寄存器。</p><h5 id="寄存器使用"><a href="#寄存器使用" class="headerlink" title="寄存器使用"></a>寄存器使用</h5><p><strong>SysV</strong> 调用约定对寄存器的使用也作出了规定：对于寄存器 <strong>rbx、rbp、rsp，以及 r12 到 r15</strong>，若被调用函数需要使用它们，则需要该函数在使用之前将这些寄存器中的值进行暂存，并在函数退出之前恢复它们的值（callee-saved）。而对于其他寄存器，则根据调用方的需要，自行保存和恢复它们的值（caller-saved）。</p><h5 id="堆栈清理"><a href="#堆栈清理" class="headerlink" title="堆栈清理"></a>堆栈清理</h5><p>每一个函数在调用结束前，都需要由它自身完成堆栈的清理工作。比如在图（C函数调用示例代码）所示的代码中，foo 函数在被调用时，它在栈内存中分配了对应的空间，用于存放局部变量 n 的值。而在该函数执行完毕，准备退出前，便需要由它自己将之前在栈上分配的数据清理干净。而这个任务是可以由 <strong>leave</strong> 指令来完成的。</p><p>除此之外，对于 foo 函数被调用前所传入实参的清理工作，则是由调用函数，也就是这里的 main 函数来完成的。可以看到，当 foo 函数调用结束，程序执行流程返回到之前 call 指令的下一条指令时，程序通过 add 指令修改了 rsp 寄存器的值。通过这种方式，main 函数对之前放入栈中传递给函数 foo 的实参进行了清理。</p><h5 id="其他约定"><a href="#其他约定" class="headerlink" title="其他约定"></a>其他约定</h5><p>除此之外，<strong>SysV</strong> 调用约定还有下面这几点规定：</p><ul><li>函数在被 call 指令调用前，需要保证栈顶于 16 字节对齐，也就是栈顶的所在地址值（以字节为单位）是 16 的倍数；</li><li>从栈顶向上保留 128 字节作为 “Red Zone”；ed Zone 是位于栈顶向上（低地址方向）的一段固定长度的内存段，这块区域通常可以被函数调用栈中的“叶子”函数（即不再调用其他函数的函数）使用。这样，在需要额外的栈内存时，就能在一定条件下省去先调整栈内存大小的过程。</li><li>不同于用户函数的调用过程，系统调用（System Call）函数需使用寄存器 rdi、rsi、rdx、r10、r8、r9 传递参数。</li></ul>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个C程序的完整生命周期</title>
      <link href="/2021/12/19/yi_ge_c_cheng_xu_de_wan_zheng_sheng_ming_zhou_qi/"/>
      <url>/2021/12/19/yi_ge_c_cheng_xu_de_wan_zheng_sheng_ming_zhou_qi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="用一个程序快速回顾-C-核心语法"><a href="#用一个程序快速回顾-C-核心语法" class="headerlink" title="用一个程序快速回顾 C 核心语法"></a>用一个程序快速回顾 C 核心语法</h4><p>市面上有很多成熟的 C 编译器可以选择，但不同的编译器可能存在着所支持平台（类 Unix、Windows）以及 C 标准（C89、C99、C11、C17）上的差异，因此在选择时需要特别注意这些问题。这门课里使用的 GCC 和 Clang 都支持 C 语言的最新标准 C17，并且都可以运行在类 Unix 与 Windows 系统上。</p><p><a href="https://godbolt.org/z/sdxP66xP4">源码</a></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;assert.h&gt;</span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span><span class="token comment">// 定义用到的宏常量与宏函数</span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BOOL_TRUE</span>  <span class="token expression"><span class="token number">1</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BOOL_FALSE</span> <span class="token expression"><span class="token number">0</span></span></span><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">typename</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">_Generic</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">short</span><span class="token operator">:</span> </span><span class="token string">"unsigned short int"</span><span class="token expression"><span class="token punctuation">,</span></span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token operator">:</span> </span><span class="token string">"unsigned long int"</span><span class="token expression"><span class="token punctuation">,</span></span><span class="token punctuation">\</span>    <span class="token expression"><span class="token keyword">default</span><span class="token operator">:</span> </span><span class="token string">"unknown"</span><span class="token expression"><span class="token punctuation">)</span></span></span><span class="token comment">// 定义枚举类型IP_ADDR_TYPE,用于表示联合中生效的字段</span><span class="token keyword">typedef</span> <span class="token keyword">enum</span> <span class="token punctuation">{</span>HOST<span class="token punctuation">,</span>IP<span class="token punctuation">}</span> IP_ADDR_TYPE<span class="token punctuation">;</span><span class="token comment">// 定义结构 CONN</span><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>    <span class="token class-name">size_t</span> id<span class="token punctuation">;</span>    <span class="token class-name">uint16_t</span> port<span class="token punctuation">;</span>    bool closed<span class="token punctuation">;</span>    IP_ADDR_TYPE addr_type<span class="token punctuation">;</span>    <span class="token keyword">union</span> <span class="token punctuation">{</span>        <span class="token keyword">char</span> host_name<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">char</span> ip<span class="token punctuation">[</span><span class="token number">24</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token punctuation">}</span> CONN<span class="token punctuation">;</span><span class="token comment">// 定义函数 findAddr,用于打印CONN对象信息</span><span class="token keyword">inline</span> <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">findAddr</span><span class="token punctuation">(</span><span class="token keyword">const</span> CONN<span class="token operator">*</span> pip<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//运行时断言，判断传入的CONN指针是否有效</span>    <span class="token function">assert</span><span class="token punctuation">(</span>pip <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> pip<span class="token operator">-&gt;</span>addr_type <span class="token operator">==</span> HOST<span class="token operator">?</span>pip<span class="token operator">-&gt;</span>host_name<span class="token operator">:</span>pip<span class="token operator">-&gt;</span>ip<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment">// 入口函数</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token comment">// 静态断言,判断CONN对象的大小是否符合要求</span>    <span class="token function">static_assert</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONN<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">0x400</span><span class="token punctuation">,</span><span class="token string">"the size of CONN object exceeds limit."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 构造一个数组，包含三个CONN对象</span>    <span class="token keyword">const</span> CONN conns<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">80</span><span class="token punctuation">,</span>BOOL_TRUE<span class="token punctuation">,</span>IP<span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token punctuation">.</span>ip<span class="token operator">=</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">8080</span><span class="token punctuation">,</span>BOOL_FALSE<span class="token punctuation">,</span>IP<span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token punctuation">.</span>ip<span class="token operator">=</span> <span class="token string">"192.168.1.1"</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">{</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">8088</span><span class="token punctuation">,</span>BOOL_FALSE<span class="token punctuation">,</span>HOST<span class="token punctuation">,</span><span class="token punctuation">{</span> <span class="token punctuation">.</span>host_name<span class="token operator">=</span> <span class="token string">"http://localhost"</span><span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">;</span>    <span class="token comment">// 遍历上述CONN数组，并打印其中的内容</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">size_t</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>conns<span class="token punctuation">)</span><span class="token operator">/</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>CONN<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">printf</span><span class="token punctuation">(</span>            <span class="token string">"Port: %d\n"</span>            <span class="token string">"Host/Addr:%s\n"</span>            <span class="token string">"Internal type of `id` is: %s\n\n"</span><span class="token punctuation">,</span>            conns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>port<span class="token punctuation">,</span>            <span class="token function">findAddr</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">typename</span><span class="token punctuation">(</span>conns<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id<span class="token punctuation">)</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">return</span> EXIT_SUCCESS<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这段代码用到了横跨 K&amp;R C 到 C17 标准的许多语言特性，创建了多个基于自定义类型构建的对象，并在程序的最后将这些对象的相关信息打印了出来。</p><h5 id="入口函数"><a href="#入口函数" class="headerlink" title="入口函数"></a>入口函数</h5><p>所有的 C 程序都会使用 main 函数作为入口函数。入口函数，就是指程序开始运行时，代码中会被首先调用的那个函数。在 main 函数中，我们可以通过它接收到的实际参数，来选择性地访问程序在开始运行时，由用户传递给程序的外部参数。</p><p>main 函数在执行结束时会返回一个整数，用于表示程序执行完毕时的状态，通常返回数字 0 表示程序正常退出，返回其他数字则代表异常退出。为了保持代码的可读性，这里我们使用标准库中定义的宏常量 EXIT_SUCCESS ，作为程序退出的返回值。顾名思义，这个宏常量对应的实际值就是数字 0。</p><h5 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h5><p>在 main 函数内部，我们使用了“括号列表（brace-enclosed lists）”的方式，完成了对数组 conns 的初始化过程。而在初始化列表中，我们还使用了指派初始化（为初始化列表中的项设定“指派符”）的方式，来明确指定这些项在数组中的具体位置。比如这里第一项对应的 “[2]” ，就表示将该项设置为数组 conns 中的第 3 个元素（索引从 0 开始）。</p><h5 id="结构与联合"><a href="#结构与联合" class="headerlink" title="结构与联合"></a>结构与联合</h5><p>数组 conns 内部，存放有若干个类型为 CONN 的结构对象。在 C 语言中，结构和联合（有时也被称为结构体与联合体）通常用来组织复杂类型的自定义数据。在结构中，所有定义字段的对应数据按照内存连续的方向排列；而在联合中，定义的字段同一时间只会有一个“生效”。</p><p>对结构 CONN 对象的初始化过程中，也同样使用了类似数组的括号列表初始化，以及指派初始化。但和前面数组初始化不同的是，这里的指派是针对结构与联合类型内部的成员字段的，因此需要使用 “.” 符号来引用某个具体成员，而非数组所使用的形式。</p><h5 id="控制结构"><a href="#控制结构" class="headerlink" title="控制结构"></a>控制结构</h5><p>使用了 for 语句以循环的形式遍历了数组 conns 中的内容。除此之外，C 语言中常用的控制结构还有 switch 语句、while 语句、以及 goto 语句等等。</p><h5 id="指针"><a href="#指针" class="headerlink" title="指针"></a>指针</h5><p>指针是 C 语言中最危险但也最强大的“武器”之一。借助指针，我们能够灵活地操控程序享有的内存资源。</p><p>我们将数组 conns 中各个元素的地址传递给了函数 findAddr，而该函数则接收一个指向 CONN 类型对象的常量指针。所以，通过该指针，我们无法在函数内部修改指针所指向对象的值。而这在一定程度上保证了函数仅能够拥有足够完成其任务的最小权限。</p><h5 id="宏"><a href="#宏" class="headerlink" title="宏"></a>宏</h5><p>编译器对 C 源代码的处理过程分为几个阶段，其中，宏是最先被处理的一个部分。在这段代码的开头处，我们通过宏指令 “#include” 引入了程序正常运行需要的一些外部依赖项，这些引入的内容会在程序编译时得到替换。随后，我们又通过 “#define” 指令定义了相应的宏常量与宏函数，而其中的宏函数 typename 则使用到了 C11 标准新引入的 _Generic 关键字，以用来实现基于宏的泛型。</p><h5 id="断言"><a href="#断言" class="headerlink" title="断言"></a>断言</h5><p>在 C 代码中，我们通常会使用断言，来对某种需要支持程序正常运行的假设性条件进行检查。而当条件不满足时，则在程序编译或运行时终止，并向用户抛出相应的错误信息。C 语言提供静态与动态两种类型的断言，其中静态断言会在代码编译时进行检查；而动态断言则会在程序运行过程中，执行到该断言语句时再进行检查。</p><h5 id="函数内联"><a href="#函数内联" class="headerlink" title="函数内联"></a>函数内联</h5><p>在函数 findAddr 的定义代码中，我们为其添加了名为 inline 的关键字。通过使用该关键字，我们可以“建议”编译器将该函数的内部逻辑直接替换到函数的调用位置处，以减少函数调用时产生的开销。这种方式通常使用在那些函数体较小，且会被多次调用的函数上，以产生较为显著的性能提升。</p><h5 id="其他特性"><a href="#其他特性" class="headerlink" title="其他特性"></a>其他特性</h5><p>如果你对其中的一些特性感到陌生，可以选择在 <a href="https://www.geeksforgeeks.org/c-programming-language/?ref=ghm">GeeksforGeeks</a>网站上直接查找特定主题并学习，或者查阅《C Primer Plus》这些入门书籍。</p><h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><p><img src="https://s2.loli.net/2021/12/08/b84ZigaOhpVvMl9.png" alt="C语法总结"></p><h4 id="C-语言的编程范式"><a href="#C-语言的编程范式" class="headerlink" title="C 语言的编程范式"></a>C 语言的编程范式</h4><p>抛开语法细节，从总体上来看，C 语言是一种“命令式”编程语言，和它类似的还有 Java、C#、Go 等语言。</p><p>命令式编程（Imperative Programming）是这样一种编程范式：使用可以改变程序状态的代码语句，描述程序应该如何运行。这种方式更关注计算机完成任务所需要执行的具体步骤。</p><p>以 C 语言为例，解决这个需求的步骤可能会是这样：使用数组，构造一块可以存放这些数字的内存空间；使用循环控制语句，依次检查内存中的这些数字是否满足要求（即大于 7）；对于满足要求的数字，将它们拷贝到新的内存空间中，暂存为结果。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ARR_LEN</span> <span class="token expression"><span class="token number">5</span></span></span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token keyword">int</span> arr<span class="token punctuation">[</span>ARR_LEN<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ARR_LEN<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">7</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token comment">// save this element somewhere else.</span>    <span class="token punctuation">}</span>  <span class="token punctuation">}</span>  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>相对于命令式编程语言，其他语言一般会被归类为“声明式”编程语言。声明式编程（Declarative Programming）也是一种常见的编程范式。不同的是，这种范式更倾向于表达计算的逻辑，而非解决问题时计算机需要执行的具体步骤。</p><p>比如说，还是刚才那个需求，在使用声明式编程语言时，对应的解决步骤可能是：构建一个容器来存放数据；按照条件对容器数据进行筛选，并将符合条件的数据作为结果返回。如果以 JavaScript 为例，对应的代码可能如下所示：</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token keyword">let</span> result <span class="token operator">=</span> arr<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">n</span> <span class="token operator">=&gt;</span> n <span class="token operator">&gt;</span> <span class="token number">7</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>可以看到的是，相较于命令式编程，声明式编程更倾向于表达在解决问题时应该做什么（构建容器、筛选），而不是具体怎么做（分配内存、遍历、拷贝）。</p><p>通常来说，命令式编程语言和声明式编程语言的差异，主要体现在两者的语言特性相较于计算机指令集的抽象程度。其中，命令式编程语言的抽象程度更低，这意味着该类语言的语法结构可以直接由相应的机器指令来实现。而声明式编程语言的抽象程度更高，这类语言更倾向于以叙事的方式来描述程序逻辑，开发者无需关心语言背后在机器指令层面的实现细节。两种语言在使用上各有其适用场景，并无孰好孰坏之分。</p><h4 id="C-程序的编译和运行"><a href="#C-程序的编译和运行" class="headerlink" title="C 程序的编译和运行"></a>C 程序的编译和运行</h4><p>编写完一段 C 代码，接下来的步骤就是对这段代码进行编译了。在执行编译命令时，为了保证程序的健壮性，我们一般会同时附带参数 “-Wall”，让编译器明确指出程序代码中存在的所有语法使用不恰当的地方。</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">gcc HelloWorld.c -o HelloWorld -Wall <span class="token operator">&amp;&amp;</span> ./HelloWorld<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>一般来说，C 代码的完整编译过程可以分为如下四个阶段：</p><p><img src="https://s2.loli.net/2021/12/08/UVysZtz4vn7AHC2.png" alt="编译过程"></p><p><img src="https://s2.loli.net/2021/12/08/CR7POs58Wy1a9dS.png" alt="HelloWorld编译流程"></p><ol><li><strong>代码预处理</strong>：编译器会首先移除源代码中的所有注释信息，并处理所有宏指令。其中包括进行宏展开、宏替换，以及条件编译等。</li><li><strong>编译优化</strong>：编译器会分析和优化源代码，并将其编译成对应的汇编格式代码，这部分代码中含有使用汇编指令描述的原始 C 程序逻辑。</li><li><strong>汇编</strong>：编译器会将这些汇编代码编译成具有一定格式，可以被操作系统使用的某种对象文件格式。</li><li><strong>链接</strong>：通过链接处理，编译器会将所有程序目前需要的对象文件进行整合、设置好程序中所有调用函数的正确地址，并生成对应的二进制可执行文件。</li></ol>]]></content>
      
      
      <categories>
          
          <category> C </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to open a Mac app from an unidentified developer</title>
      <link href="/2021/12/19/open_a_mac_app_anywhere/"/>
      <url>/2021/12/19/open_a_mac_app_anywhere/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="https://s2.loli.net/2021/12/19/hmrwIpOfZGygvtH.png" alt="macbook_air"></p><p>Some complain about Apple’s walled garden, or if you prefer a less flowery term: closed platform. Apple would say that maintaining a level of control over the apps we can install on our devices protects us from malware and a bad user experience, but it can be frustrating and worrying if you want to run an app and you are confronted by a warning that it is from an unidentified developer.</p><p>Luckily it is possible to open and run these apps and we will show you how. But before you do so be warned: do this only if you are satisfied that the developer and software (and the means of distribution, since innocent apps can be hijacked by guilty parties) are legit. We discuss the safety of unidentified apps later in this article.</p><h4 id="Why-am-I-seeing-an-unidentified-developer-warning"><a href="#Why-am-I-seeing-an-unidentified-developer-warning" class="headerlink" title="Why am I seeing an unidentified developer warning?"></a>Why am I seeing an unidentified developer warning?</h4><p>Apple has a lot of control over the apps available for Macs, iPads and iPhones. While the Mac is a little more open than iOS - the only way to get third party apps onto your iPhone and iPad is to download them from the iOS App Store - there are still a lot of hoops to jump through before you can install and run some third party apps on your Mac.</p><p>As we said above there is good reason for this. These measures are designed to protect us from malware that might arrive on our Macs disguised as an app that we think we can trust. It might even look like a well-known app but have malicious code added to it. While we can all follow the advice not to download apps from file-sharing sites, or via links on dodgy looking emails, Apple’s basically put in measures to make it harder for us to install apps that might be dangerous.</p><p>These measures include Gatekeeper, which is Apple’s name for the security aspect of macOS that checks apps for malware and quaranteens them. It also checks whether the app is written by a developer known to Apple (aka signed). Then, even if it matches those requirements, Gatekeeper will ask you to confirm that you want to open the app. In macOS Catalina, which was introduced in October 2019, Apple made Gatekeeper even more stringent. Previously you could get around Gatekeeper by launching the app via Terminal but now if you open an app via Terminal Gatekeeper will still check it out. Another change is that Gatekeeper will run its list of checks everytime you open an app.</p><p>So, how can you open apps from unidentified developers? And how can you stop seeing the warning everytime you open an app?</p><h4 id="How-to-open-apps-not-from-Mac-App-Store"><a href="#How-to-open-apps-not-from-Mac-App-Store" class="headerlink" title="How to open apps not from Mac App Store"></a>How to open apps not from Mac App Store</h4><p>By default macOS allows you to open apps from the official App Store only. If you have this still set as your default you will be seeing the warning when you try to open an app for the first time.</p><p>Luckily you can make a simple change to your settings that will allow you to open some third-party apps that aren’t on the App Store. It won’t mean that you can open every third party app without issue, but it will certainly mean you see fewer warnings.</p><ol><li>Open System Preferences.</li><li>Go to the Security &amp; Privacy tab.</li><li>Click on the lockand enter your password so you can make changes.</li><li>Change the setting for ‘Allow apps downloaded from’ to ‘App Store and identified developers’ from just App Store.</li></ol><p><img src="https://s2.loli.net/2021/12/19/b4wLS3l7kFyDrpu.png" alt="system_prefs_open_apps"></p><p>You’ll still be prevented from opening anything macOS doesn’t recognise, but at least you will be able to open apps that weren’t purchased from the App Store, assuming that they don’t have malware and they are signed by a developer Apple recognises and trusts.</p><h4 id="How-to-open-a-blocked-app"><a href="#How-to-open-a-blocked-app" class="headerlink" title="How to open a blocked app"></a>How to open a blocked app</h4><p>If you attempt to open an app and macOS stops you from doing so, that doesn’t necessarily mean there is something wrong with the app. But it will indicate that the app isn’t from an ‘identified developer’ - in other words a developer that has signed up to Apple’s developer program and jumped through a few hoops to get Apple to trust it.</p><p>Luckily you can still open the app and override the block. Here’s how:</p><ol><li>Open System Preferences.</li><li>Go to Security &amp; Privacy and select the General tab.</li></ol><p><img src="https://s2.loli.net/2021/12/19/lzqYt5UdBbZ94Hg.jpg" alt="how_to_open_mac_app_unidentified_developer"></p><ol start="3"><li>If you’ve been blocked from opening an app within the past hour, this page will give you the option to override this by clicking the temporary button ‘Open Anyway’.</li><li>You’ll be asked one more time if you’re sure, but clicking Open will run the app.</li></ol><p><img src="https://s2.loli.net/2021/12/19/UF9MGk5P6g1DjOi.jpg" alt="how_to_open_mac_app_unidentified_developer_532b"></p><p>This creates an exception for that app, so you’ll also be able to open it in the future without having to repeat this process.</p><p>Because of Gatekeeper’s other checks this will still stop you from opening an app with known malware attached to it.</p><h4 id="Other-ways-to-open-blocked-apps"><a href="#Other-ways-to-open-blocked-apps" class="headerlink" title="Other ways to open blocked apps"></a>Other ways to open blocked apps</h4><p>Another way to open a blocked app is to locate the app in a Finder window. </p><ol><li>Open the Finder.</li><li>Locate the app (it might be in the Applications folder, or it might still be in your downloads folder).</li><li>Ctrl-Click or right-click on the app.</li></ol><p><img src="https://s2.loli.net/2021/12/19/ZRGFdpOIkcbtgLT.png" alt="open_libraoffice"></p><ol start="4"><li>Select Open from the resultant menu and the app will be opened anyway, and an exception will be created for opening it normally (i.e. by double-clicking) in future.</li></ol><h4 id="How-to-‘Allow-Apps-from-Anywhere’"><a href="#How-to-‘Allow-Apps-from-Anywhere’" class="headerlink" title="How to ‘Allow Apps from Anywhere’"></a>How to ‘Allow Apps from Anywhere’</h4><p>As you can see above, the Security &amp; Privacy section of System Preferences presents you with two settings for the types of apps you allow to run: ones from the App Store, or ones from the App Store or identified developers.</p><p><img src="https://s2.loli.net/2021/12/19/Em5RsM4qocSH3vC.jpg" alt="how_to_allow_apps_from_anywhere_mac"></p><p>But there is a third, hidden option: ‘Allow apps from anywhere’. This used to be an option in earlier versions of macOS, but disappeared when macOS Sierra arrived. However you can get the Anywhere option back.</p><p>We will say right away that we don’t recommend this setting, which puts you at risk of installing malware under the guise of legitimate software. But if you are determined on this course, it’s possible to make that option reappear with a line of code in Terminal.</p><p>Open Terminal and enter the following code to get your Anywhere option:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> spctl --master-disable<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Now press Return, and you will be asked to enter your password. Once that’s done, open System Preferences (if it’s already open, you’ll need to quit it and restart to see the new options) and go to the Security &amp; Privacy section.</p><p><img src="https://s2.loli.net/2021/12/19/xajiu8qvG4XEHkl.png" alt="how_to_allow_apps_from_anywhere_mac"></p><p>A new, third option will have appeared allowing you to ‘Allow apps downloaded from: Anywhere’. You’ll have to click the padlock icon to make changes to the settings on this page.</p><h4 id="How-to-remove-the-‘Anywhere’-option"><a href="#How-to-remove-the-‘Anywhere’-option" class="headerlink" title="How to remove the ‘Anywhere’ option"></a>How to remove the ‘Anywhere’ option</h4><p>If you share your Mac with someone else it might be wise to get rid of the Anywhere option. To hide it again, you’ll need to go to Terminal again, and this time type:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> spctl --master-enable<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="Is-it-safe-to-open-unidentified-apps"><a href="#Is-it-safe-to-open-unidentified-apps" class="headerlink" title="Is it safe to open unidentified apps?"></a>Is it safe to open unidentified apps?</h4><p>It might be, it might not. The point is that you don’t have Apple’s certification that it is, so you will have to rely on your own due diligence to ensure that the software is okay.</p><p>Before installing the software you should search for reviews of the app, information about the company (and distribution site/platform), and advice and testimonials from other users. Bear in mind as ever that dodgy companies are not above planting a few fake reviews to give themselves the sheen of legitimacy, so keep searching after the first few results. If you’re not satisfied, it may be safer to find an alternative that macOS is happier to install.</p><p>When installing unidentified apps you should also make extra-sure that your anti virus software is up to date.</p><p>Note that getting the ‘unidentified developer’ warning dialog doesn’t mean you’re about to install some malware. As Apple acknowledges, there are plenty of reasons why a perfectly legitimate company might not be on the identified list; it might for instance be that the app is older than the company’s developer registration programme.</p>]]></content>
      
      
      <categories>
          
          <category> Mac OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>love</title>
      <link href="/2021/06/24/love/"/>
      <url>/2021/06/24/love/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>I love three things in this world.</p><p>Sun, moon and you.</p><p>Sun for morning, moon for night , and you forever.</p></blockquote><p>浮世三千，挚爱有三：</p><p>喷薄朝阳，皓婉皎月，不及汝尔，沧海桑田。</p><p>浮世万千，吾爱有三。</p><p>日，月与卿。</p><p>日为朝，月为暮，卿为朝朝暮暮。</p>]]></content>
      
      
      <categories>
          
          <category> Life </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Poem </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Deep Dive Into Transform Widgets in Flutter</title>
      <link href="/2021/06/24/a_deep_dive_into_transform_widgets_in_flutter/"/>
      <url>/2021/06/24/a_deep_dive_into_transform_widgets_in_flutter/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Introduction-to-the-Transform-widget"><a href="#Introduction-to-the-Transform-widget" class="headerlink" title="Introduction to the Transform widget"></a>Introduction to the Transform widget</h3><p>A Transform widget “transforms“ (i.e. chanages the shape,size,position,and orientation) its child widget before painting it.</p><p>Distorting the shape of the container using Transform: This is extrememly useful for custom shapes and many different kinds of<br>animations in Flutter. This can be used to transform any widget and distort it to any shape we like or move it around as well.</p><p>Let’s start with the types of Transform widgets.</p><h3 id="Exploring-the-types-of-Transform-widget"><a href="#Exploring-the-types-of-Transform-widget" class="headerlink" title="Exploring the types of Transform widget"></a>Exploring the types of Transform widget</h3><p>The Transform widget gives us a few constructors to help simplify the certain of transformations. Common operations such as scaling,rotation or translation are all provided via constructors.</p><p>The types of Transform widgets are:</p><ol><li>Transform(default constructor)</li><li>Transform.rotate</li><li>Transform.scale</li><li>Transform.translate</li></ol><p>We will look at the single-operation constructors first.</p><h4 id="Transform-rotate"><a href="#Transform-rotate" class="headerlink" title="Transform.rotate"></a>Transform.rotate</h4><p>As the name suggests,Transform.rotate simply rotates the child by an angle. Here the child is a square container.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> Transform<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>        angle<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>            height<span class="token punctuation">:</span> <span class="token number">200.0</span><span class="token punctuation">,</span>            width<span class="token punctuation">:</span> <span class="token number">200.0</span><span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The angle parameter let’s set an angle(in radians) the child will be rotated by. The widget also allows us specify an origin for the rotation of our widget. We specify the origin using the origin parameter. This takes an Offset. The Offset notes the distance of the origin in relation to the center of the child itself. When we don’t need explicitly set the offset however,the child rotates around its own center.</p><p>I made an animation to better visualize where the center of rotation lies.</p><img src="transform_rotate_origin_default.gif" width="50%"><p>If the child is rotated form the lower right point of the square,it would look like this:</p><p>The code for the above rotation is:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> Transform<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>        angle<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>        origin<span class="token punctuation">:</span> <span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>            height<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>            width<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The square has sides of 100.0.This code rotates the container about the lower right vertex of the square.Since the offset is 50.0 to the right and 50.0 below,the center of the child is defined by the offset(50.0.,50.0).</p><h4 id="Transform-scale"><a href="#Transform-scale" class="headerlink" title="Transform.scale"></a>Transform.scale</h4><p>The scale constructor scales the child by the given scale parameter. The container when scaled to half its original size:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> Transform<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>        scale<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>            height<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>            width<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>yellow<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here we set the scale to 0.5 to reduce the size of the container by half. Similar to the rotation transform,we can also set an origin in scaling. When the origin is left blank,the center of the widget is taken. When scaling, the changes on each side are exactly the on each. When no origin is provided for scaling:</p><p>Like the last example,let’s now set the origin to the lower right corner. If we now reload our app,the widget will scale differently compared to the default (the center).</p><p>This is achieved bu providing the origin(50.0,50.0).This offset corresponds to the lower right corner.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> Transform<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>        scale<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>        origin<span class="token punctuation">:</span> <span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>            height<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>            width<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Transform-translate"><a href="#Transform-translate" class="headerlink" title="Transform.translate"></a>Transform.translate</h4><p>Transform.translate translates the child of the transform widget by a specified amount in the X and Y direction. We supply an Offset which has the amount by which we want to move the child by in the X and Y directions.</p><p>Container offset by 100.0 in the X axis:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> Transform<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>        offset<span class="token punctuation">:</span> <span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>            height<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>            width<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Here we supply an Offset which moves the containers 100.0 in the X direction. Any changes in the second parameter would move it in the Y direction.</p><p>We cannot set an origin in translation since translation is not affected by origin. Since we give an offset and not coordinates,the origin doesn’t make a difference.</p><h4 id="Transform-Default-constructor"><a href="#Transform-Default-constructor" class="headerlink" title="Transform(Default constructor)"></a>Transform(Default constructor)</h4><p>Unlike the other constructors in the list,the default constructor allows us to do multiple operations at once. It is the most powerful constructor from the list.</p><p>Instead of taking a specific parameter like an angle or scaling,this constructor takes a 4D Matrix directly in the transform parameter. This allows us to carry out multiple operations.</p><p>An example of this is:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Transform</span><span class="token punctuation">(</span>        transform<span class="token punctuation">:</span> Matrix4<span class="token punctuation">.</span><span class="token function">skewY</span><span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">rotateZ</span><span class="token punctuation">(</span><span class="token number">3.14</span> <span class="token operator">/</span> <span class="token number">12.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        origin<span class="token punctuation">:</span> <span class="token function">Offset</span><span class="token punctuation">(</span><span class="token number">50.0</span><span class="token punctuation">,</span> <span class="token number">50.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>          height<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>          width<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The above code gives us a skew around the Y axis of 0.3 and a rotation of π/12 radians arounf the Z axis.</p><p>A Skew is essentially titling the child in one direction while keeping the sides parallel.</p><p><strong>SkewX</strong></p><p><strong>SkewY</strong></p><p>Matrix4 also lets us set rotation and translation. We use Matrix4.rotationX(),rotationY() and rotationZ() for rotation and Matrix4.translation() or Matrix4.translationValues() for translation.</p><p>We can also set an origin in this constructor using the origin parameter like we did in the first two constructors.</p><h3 id="Now-let’s-apply-pointless-transformations-to-normal-Flutter-widgets"><a href="#Now-let’s-apply-pointless-transformations-to-normal-Flutter-widgets" class="headerlink" title="Now let’s apply pointless transformations to normal Flutter widgets"></a>Now let’s apply pointless transformations to normal Flutter widgets</h3><blockquote><p>“Ok Flutter,do a barrel roll“</p></blockquote><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'dart:math'</span> <span class="token operator">as</span> math<span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span>    <span class="token keyword">with</span> SingleTickerProviderStateMixin <span class="token punctuation">{</span>  Animation<span class="token operator">&lt;</span>double<span class="token operator">&gt;</span> animation<span class="token punctuation">;</span>  AnimationController controller<span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    controller <span class="token operator">=</span>        <span class="token function">AnimationController</span><span class="token punctuation">(</span>duration<span class="token punctuation">:</span> <span class="token function">Duration</span><span class="token punctuation">(</span>seconds<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    animation <span class="token operator">=</span> Tween<span class="token operator">&lt;</span>double<span class="token operator">&gt;</span><span class="token punctuation">(</span>begin<span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span> end<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token operator">*</span> math<span class="token punctuation">.</span>pi<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span>controller<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    controller<span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> Transform<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span>      angle<span class="token punctuation">:</span> animation<span class="token punctuation">.</span>value<span class="token punctuation">,</span>      child<span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Transform Demo'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token metadata symbol">@override</span>  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    controller<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Extra-large-FAB"><a href="#Extra-large-FAB" class="headerlink" title="Extra large FAB"></a>Extra large FAB</h3><p>For some reason,this looks better than the normal FloatingActionButton.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Transform Demo'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      floatingActionButton<span class="token punctuation">:</span> Transform<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span>        scale<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Transform </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Deep Dive Into Hero Widgets in Flutter</title>
      <link href="/2021/06/24/a_deep_dive_into_hero_widgets_in_flutter/"/>
      <url>/2021/06/24/a_deep_dive_into_hero_widgets_in_flutter/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Introduction-to-Hero-Animations"><a href="#Introduction-to-Hero-Animations" class="headerlink" title="Introduction to Hero Animations"></a>Introduction to Hero Animations</h3><p>A Hero animation in one sentence is simply an element of one screen “flying” to the next when the app goes to the next page.</p><img src="hero_animation.gif" width="50%"><p>Hero Animations take an element like an icon which is now called a “Hero“ and once the page transition is triggered,usually by clicking on the icon,the hero “files“ to the next page. When the user navigates back to the earlier page,the animation goes in the other direction and the icon goes back to its place.</p><p>We’ll dicuss not only basic hero animations but things we can customize about it. Let’s see the basics first.</p><h3 id="Creating-a-Basic-Hero-Animation"><a href="#Creating-a-Basic-Hero-Animation" class="headerlink" title="Creating a Basic Hero Animation"></a>Creating a Basic Hero Animation</h3><p>Hero animations are probably one of the easiest animations to do in Flutter and don’t require much setup. Taking a look at the example above,we can see that the same app icon widget exists on both pages,All we need is a way to tell Flutter that both of them are linked.</p><p>We do this by wrapping an element like an icon in a Hero widget.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Hero</span><span class="token punctuation">(</span> tag<span class="token punctuation">:</span><span class="token string">'DemoTag'</span><span class="token punctuation">,</span> child<span class="token punctuation">:</span><span class="token function">Icon</span><span class="token punctuation">(</span>  Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>  size<span class="token punctuation">:</span><span class="token number">70.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>We supply it a tag to give this specific hero a name. This is necessary because if we have multiple heros on the same page,each hero knows where to fly to. Now the app knows that there is a hero widget that wants to fly to the next page. Now all we need is a place to fly to. All we need is a Hero widget on the second page with the same tag.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Hero</span><span class="token punctuation">(</span> tag<span class="token punctuation">:</span><span class="token string">'DemoTag'</span><span class="token punctuation">,</span> child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>  Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>  size<span class="token punctuation">:</span><span class="token number">150.0</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>And this results in:</p><img src="hero_basic_animation.gif" width="50%"><h3 id="Customizing-Hero-Animations"><a href="#Customizing-Hero-Animations" class="headerlink" title="Customizing Hero Animations"></a>Customizing Hero Animations</h3><p>The Hero widget allows us to customize aspects of the animation. Let’s explore a few possibilities.</p><h4 id="Adding-placeholders"><a href="#Adding-placeholders" class="headerlink" title="Adding placeholders"></a>Adding placeholders</h4><p>After the widget flies off the place it used to be in and before the widget arrives at the destination,there is empty space at the destination. We can add a placeholder to this location. Let’s use a CircularProgressIndicator as a placeholder for now.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>          tag<span class="token punctuation">:</span> <span class="token string">'DemoTag'</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      floatingActionButton<span class="token punctuation">:</span> FloatingActionButton<span class="token punctuation">.</span><span class="token function">extended</span><span class="token punctuation">(</span>        icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>forward<span class="token punctuation">)</span><span class="token punctuation">,</span>        label<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hero'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          Navigator<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>              <span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">SomeOtherClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">SomeOtherClass</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hero'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>            size<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          tag<span class="token punctuation">:</span> <span class="token string">'DemoTag'</span><span class="token punctuation">,</span>          placeholderBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> widget<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>              width<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>              height<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>We use the placeholderBuilder to contruct the placeholder and return the widget we would like to have as the placeholder.</p><p>Using a placeholder:</p><img src="hero_placeholder.gif" width="50%"><h3 id="Changing-the-Hero-widget"><a href="#Changing-the-Hero-widget" class="headerlink" title="Changing the Hero widget"></a>Changing the Hero widget</h3><p>Flutter allows us to change the widget which actually files from one page to the other without changing the widgets on the two pages.</p><p>Let’s use a rocket icon instead of a “+” icon as the hero without changing the children of the hero widgets. We do this using the flightShuttleBuilder parameter(Hence,the rocket example).</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:font_awesome_flutter/font_awesome_flutter.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>          tag<span class="token punctuation">:</span> <span class="token string">'DemoTag'</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      floatingActionButton<span class="token punctuation">:</span> FloatingActionButton<span class="token punctuation">.</span><span class="token function">extended</span><span class="token punctuation">(</span>        icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>forward<span class="token punctuation">)</span><span class="token punctuation">,</span>        label<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hero'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          Navigator<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>              <span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">SomeOtherClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">SomeOtherClass</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hero'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>            size<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          tag<span class="token punctuation">:</span> <span class="token string">'DemoTag'</span><span class="token punctuation">,</span>          flightShuttleBuilder<span class="token punctuation">:</span>              <span class="token punctuation">(</span>flightContext<span class="token punctuation">,</span> animation<span class="token punctuation">,</span> direction<span class="token punctuation">,</span> fromContext<span class="token punctuation">,</span> toContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              FontAwesomeIcons<span class="token punctuation">.</span>rocket<span class="token punctuation">,</span>              size<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="hero_rocket.gif" width="50%"><p>The flightShuttleBuilder method has 5 parameters and gives us the animation as well as the direction of the animation.</p><p>For now,the rocket icon size stays at 150.0 for both directions. We can have different configurations for each direction by using the direction parameter of the method.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:font_awesome_flutter/font_awesome_flutter.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>          tag<span class="token punctuation">:</span> <span class="token string">'DemoTag'</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      floatingActionButton<span class="token punctuation">:</span> FloatingActionButton<span class="token punctuation">.</span><span class="token function">extended</span><span class="token punctuation">(</span>        icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>forward<span class="token punctuation">)</span><span class="token punctuation">,</span>        label<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hero'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          Navigator<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>              <span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">SomeOtherClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">SomeOtherClass</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hero'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>            size<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          tag<span class="token punctuation">:</span> <span class="token string">'DemoTag'</span><span class="token punctuation">,</span>          flightShuttleBuilder<span class="token punctuation">:</span>              <span class="token punctuation">(</span>flightContext<span class="token punctuation">,</span> animation<span class="token punctuation">,</span> direction<span class="token punctuation">,</span> fromContext<span class="token punctuation">,</span> toContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> HeroFlightDirection<span class="token punctuation">.</span>push<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>rocket<span class="token punctuation">,</span>                size<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> HeroFlightDirection<span class="token punctuation">.</span>pop<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>rocket<span class="token punctuation">,</span>                size<span class="token punctuation">:</span> <span class="token number">70.0</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><img src="hero_direction.gif" width="50%"><h4 id="Making-Hero-animations-work-with-IOS-back-swipe-gestures"><a href="#Making-Hero-animations-work-with-IOS-back-swipe-gestures" class="headerlink" title="Making Hero animations work with IOS back swipe gestures"></a>Making Hero animations work with IOS back swipe gestures</h4><p>By default,hero animations work when the back button is pressed on IOS but they don’t work on back swipe. To solve this,simply set transitionOnUserGestures to true on both Hero widgets.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">import</span> <span class="token string">'package:font_awesome_flutter/font_awesome_flutter.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>          tag<span class="token punctuation">:</span> <span class="token string">'DemoTag'</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          transitionOnUserGestures<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      floatingActionButton<span class="token punctuation">:</span> FloatingActionButton<span class="token punctuation">.</span><span class="token function">extended</span><span class="token punctuation">(</span>        icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>forward<span class="token punctuation">)</span><span class="token punctuation">,</span>        label<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hero'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>          Navigator<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>              <span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">SomeOtherClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">SomeOtherClass</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hero'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>            size<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          tag<span class="token punctuation">:</span> <span class="token string">'DemoTag'</span><span class="token punctuation">,</span>          transitionOnUserGestures<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>          flightShuttleBuilder<span class="token punctuation">:</span>              <span class="token punctuation">(</span>flightContext<span class="token punctuation">,</span> animation<span class="token punctuation">,</span> direction<span class="token punctuation">,</span> fromContext<span class="token punctuation">,</span> toContext<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> HeroFlightDirection<span class="token punctuation">.</span>push<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>rocket<span class="token punctuation">,</span>                size<span class="token punctuation">:</span> <span class="token number">150.0</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>direction <span class="token operator">==</span> HeroFlightDirection<span class="token punctuation">.</span>pop<span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                FontAwesomeIcons<span class="token punctuation">.</span>rocket<span class="token punctuation">,</span>                size<span class="token punctuation">:</span> <span class="token number">70.0</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>And this will trigger hero animations on back swipe as well.</p><img src="hero_swipe.gif" width="50%">]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hero </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Deep Dive Into FloatingActionButton in Flutter</title>
      <link href="/2021/06/23/a_deep_dive_into_floatingactionbutton_in_flutter/"/>
      <url>/2021/06/23/a_deep_dive_into_floatingactionbutton_in_flutter/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Introduction-to-FloatingActionButton"><a href="#Introduction-to-FloatingActionButton" class="headerlink" title="Introduction to FloatingActionButton"></a>Introduction to FloatingActionButton</h3><p>A FloatingActionButton in material design is a button on a screen that is tied to an obvious action which a user would usually do on that specific screen. This button floats above the content of the screen and usually resides on one corner of the screen.</p><p>For example,in Gmail,the main screen has a FloatingActionButton to compose email. The purpose of the FAB must be something the user might frquently want or needs to do.</p><h3 id="Types-of-FloatingActionButton-in-Flutter"><a href="#Types-of-FloatingActionButton-in-Flutter" class="headerlink" title="Types of FloatingActionButton in Flutter"></a>Types of FloatingActionButton in Flutter</h3><p>Flutter offers two types of FloatingActionButtons out-of-box.</p><ol><li>FloatingActionButton</li><li>FloatingActionButton.extended</li></ol><h4 id="FloatingActionButton"><a href="#FloatingActionButton" class="headerlink" title="FloatingActionButton"></a>FloatingActionButton</h4><p>The default constructor creates a simple circular FAB with a child widget inside it. It takes an onPressed method to react to taps and a child (not compulsory)to display a widget inside the FAB.</p><p>The code is relatively straightforward and is most often used with the floatingActionButton parameter of the Scaffold widget.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="FloatingActionButton-extended"><a href="#FloatingActionButton-extended" class="headerlink" title="FloatingActionButton.extended"></a>FloatingActionButton.extended</h4><p>FloatingActionButton.extended offers a wide FAB,usually with an icon and a label inside it.</p><p>Instead of a child parameter,we now hava label and icon paramters.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        floatingActionButton<span class="token punctuation">:</span> FloatingActionButton<span class="token punctuation">.</span><span class="token function">extended</span><span class="token punctuation">(</span>            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>save<span class="token punctuation">)</span><span class="token punctuation">,</span> label<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Save'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Dealing-with-Colors-in-a-FloatingActionButton"><a href="#Dealing-with-Colors-in-a-FloatingActionButton" class="headerlink" title="Dealing with Colors in a FloatingActionButton"></a>Dealing with Colors in a FloatingActionButton</h3><p>The FAB offers the foregroundColor and backgroundColor parameters to color the elements inside it.</p><p><strong>The foregroundColor colors the child inside the FAB</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">,</span>          foregroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>The backgroundColor colors the background of the button</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">,</span>          backgroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Note: Individual element colors will override the foregroundColor attribute.</strong></p><p>If the icon inside has a user defined color and a foregroundColor at the same time,the icon color will override the foregroundColor. </p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>yellow<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          foregroundColor<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The “+” icon turns yellow even with foregroundColor specifying pink.</p><h3 id="Changing-the-Look-of-the-FloatingActionButton"><a href="#Changing-the-Look-of-the-FloatingActionButton" class="headerlink" title="Changing the Look of the FloatingActionButton"></a>Changing the Look of the FloatingActionButton</h3><p>The FAB gives us multiple options to resize and change the look of the button.</p><h4 id="Switching-to-a-mini-button"><a href="#Switching-to-a-mini-button" class="headerlink" title="Switching to a mini button"></a>Switching to a mini button</h4><p>In material design,the FAB has two sizes:default and mini. To switch to a mini size,set mini in the constructor to true.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          mini<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Changing-the-shape-of-the-FAB"><a href="#Changing-the-shape-of-the-FAB" class="headerlink" title="Changing the shape of the FAB"></a>Changing the shape of the FAB</h4><p>To change the shape of the button,we set the shape parameter in the constructor. The default value of the shape is a CircleBorder().</p><p>Let’s make a square button instead of a round one.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>If you notice,it says RoundedRectangleBorder but it behaves like a square. This is because we haven’t supplied a boardRadius.</p><p>Supplying a border radius:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>              borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>RoundedRectangleBorder and other border classes also have another field called side which let’s us edit the color and width of the border.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>              Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            shape<span class="token punctuation">:</span> <span class="token function">RoundedRectangleBorder</span><span class="token punctuation">(</span>              side<span class="token punctuation">:</span> <span class="token function">BorderSide</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pink<span class="token punctuation">,</span> width<span class="token punctuation">:</span> <span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>You can also define your own border class to do custom borders.</p><p>You can do something like a DiamondBorder class and simple set the border to it. This example is taken from the Flutter Gallery application.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>    <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          shape<span class="token punctuation">:</span> <span class="token function">_DiamondBorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DiamondBorder</span> <span class="token keyword">extends</span> <span class="token class-name">ShapeBorder</span> <span class="token punctuation">{</span>  <span class="token keyword">const</span> <span class="token function">_DiamondBorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  EdgeInsetsGeometry <span class="token keyword">get</span> dimensions <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Path <span class="token function">getInnerPath</span><span class="token punctuation">(</span>Rect rect<span class="token punctuation">,</span> <span class="token punctuation">{</span>TextDirection textDirection<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">getOuterPath</span><span class="token punctuation">(</span>rect<span class="token punctuation">,</span> textDirection<span class="token punctuation">:</span> textDirection<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token metadata symbol">@override</span>  Path <span class="token function">getOuterPath</span><span class="token punctuation">(</span>Rect rect<span class="token punctuation">,</span> <span class="token punctuation">{</span>TextDirection textDirection<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>left <span class="token operator">+</span> rect<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> rect<span class="token punctuation">.</span>top<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>right<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>top <span class="token operator">+</span> rect<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>left <span class="token operator">+</span> rect<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">,</span> rect<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>left<span class="token punctuation">,</span> rect<span class="token punctuation">.</span>top <span class="token operator">+</span> rect<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2.0</span><span class="token punctuation">)</span>      <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token metadata symbol">@override</span>  <span class="token keyword">void</span> <span class="token function">paint</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">,</span> Rect rect<span class="token punctuation">,</span> <span class="token punctuation">{</span>TextDirection textDirection<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token metadata symbol">@override</span>  ShapeBorder <span class="token function">scale</span><span class="token punctuation">(</span>double t<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Or you can just go crazy with it and do a random shape like this one. All you need is to define a new type of ShapeBorder.</p><h4 id="Changing-the-elevation-of-FAB"><a href="#Changing-the-elevation-of-FAB" class="headerlink" title="Changing the elevation of FAB"></a>Changing the elevation of FAB</h4><p>We can change the effect of elevation of the FAB above the screen by setting the elevation and highlightElevation property.Elevation works at all times while highlightElevation is the elevation of button when tapped.</p><p>Let’s set elevation to 0.0:</p><p>And then 20.0:</p><p>You can see the shadow changing around the button indicating an inrease in distance in the z-axis.</p><h3 id="Animating-the-FloatingActionButton"><a href="#Animating-the-FloatingActionButton" class="headerlink" title="Animating the FloatingActionButton"></a>Animating the FloatingActionButton</h3><p>This section is meant to cover some animations related to FloatingActionButtons.</p><h4 id="Defalut-FAB-animation-in-page-transitions"><a href="#Defalut-FAB-animation-in-page-transitions" class="headerlink" title="Defalut FAB animation in page transitions"></a>Defalut FAB animation in page transitions</h4><p>Before we go into something we can implement,I want to mention the default animation Flutter has when navigating between pages which both have a FloatingActionButton. When transitioning form one page to the other,Flutter will automatically animate the FAB change instead of switching instantly. Because the FAB is a Hero.  This requires no code on the user side.</p><p>IMPOETANT: Hero Animations with FloatingActionButtons OR Why can’t I have two FloatingActionButtons on the same pages?</p><p>This upper animation is possible because the FloatingActionButton has a Hero widget weapped around it. A Hero is an element that flies to the next page when a transition occurs.</p><p>A <strong>Hero</strong> widget requires a tag that correlates two separate elements on two different pages and then makes one transition to the other.</p><p>The Hero tag has to be unique. Since each FAB is a Hero,defining two of them on the same page is not allowed without explicitly channging the hero tag of one of them.</p><p>Hence,defining two FABs on one page is not allowed. If we want to have two or more FABs,we need to set the heroTag parameter to another value.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>       appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>         title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token punctuation">)</span><span class="token punctuation">,</span>       body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>         child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>           child<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>             onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>             child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>save<span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token punctuation">)</span><span class="token punctuation">,</span>         <span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token punctuation">)</span><span class="token punctuation">,</span>       floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>         onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>         child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>           Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>         <span class="token punctuation">)</span><span class="token punctuation">,</span>         heroTag<span class="token punctuation">:</span> <span class="token string">'demoValue'</span><span class="token punctuation">,</span>       <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Now,we can hava another FAB on the same page as well.</p><p>Since we just said each FAB is a Hero,we can use the FAB to create Hero animations.</p><p>The code FAB’s heroTag should be same the second page widget’s which also warp with a Hero widget. The code would be:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        floatingActionButton<span class="token punctuation">:</span> <span class="token function">FloatingActionButton</span><span class="token punctuation">(</span>          onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            Navigator<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>                <span class="token function">MaterialPageRoute</span><span class="token punctuation">(</span>builder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">SomeOtherClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          heroTag<span class="token punctuation">:</span> <span class="token string">'demoTag'</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">SomeOtherClass</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hero FAB'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Hero</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            Icons<span class="token punctuation">.</span>add<span class="token punctuation">,</span>            size<span class="token punctuation">:</span> <span class="token number">100.0</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          tag<span class="token punctuation">:</span> <span class="token string">'demoTag'</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This makes the button transition to the icon.Note that now,a FAB on the second page would not affect us as we have changed the default Hero tag. So even if we had a FAB on the second page,the defalut transition would not take place.</p><p>There are a few other animations we can do with a FAB but those fall within the realm of Scaffold and we’ll cover those when we get to the Scaffold deep dive.</p>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> FloatingActionButton </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Adding Local Images to Hexo Posts with Markdown</title>
      <link href="/2021/06/23/adding_local_images_to_hexo_posts_with_markdown/"/>
      <url>/2021/06/23/adding_local_images_to_hexo_posts_with_markdown/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>After testing out a few different static site generators, I settled on Hexo to create this site. Hexo is incredibly simple and flexible and I like the fact that it doesn’t depend on anything other than good old Javascript, HTML and CSS (and of course Node for the build process.)</p><p>Content authoring is simple and very much like other static site generators. I just write Markdown posts in my favourite text editor, and let the build process generate static HTML pages.</p><h3 id="The-Problem-Limitations-of-the-Hexo-asset-img-tag"><a href="#The-Problem-Limitations-of-the-Hexo-asset-img-tag" class="headerlink" title="The Problem: Limitations of the Hexo asset_img tag"></a>The Problem: Limitations of the Hexo asset_img tag</h3><p>I’m very happy with the Hexo experience overall, but there was one fly in the ointment that made editing and previewing my posts a bit fiddly, and that is that Hexo doesn’t support the Markdown format for adding images to a post, e.g:</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url"><span class="token operator">!</span>[<span class="token content">Alt Text</span>](<span class="token url">folder/image-name.png</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Instead, in order to work with the Hexo build process, a <a href="https://hexo.io/docs/asset-folders.html">custom tag is required</a>:</p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown">{% asset_img image-path.png Alt Text %}<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>While this works fine when deploying to a site or previewing locally with hexo serve, it doesn’t play nicely with Markdown tools like the VS Code markdown preview, and so adds extra steps to the authoring workflow.</p><h3 id="The-Solution-Using-standard-Markdown-syntax-to-add-Hexo-images"><a href="#The-Solution-Using-standard-Markdown-syntax-to-add-Hexo-images" class="headerlink" title="The Solution: Using standard Markdown syntax to add Hexo images"></a>The Solution: Using standard Markdown syntax to add Hexo images</h3><p>Thankfully, there is an <a href="https://www.npmjs.com/package/hexo-asset-link">NPM package</a> available that remedies this issue and fits snugly into the Hexo build pipeline, works with Markdown tools and the local Hexo server.</p><p>The package is compatible with the Hexo per-post asset folder, so head over to your root _config.yml and ensure the following is set:</p><pre class="line-numbers language-yaml" data-language="yaml"><code class="language-yaml"><span class="token key atrule">post_asset_folder</span><span class="token punctuation">:</span> <span class="token boolean important">true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Then, in your terminal run</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> i -s hexo-asset-link<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>For example, if you have these files in source/_post/:</p><blockquote><p>+– _posts/<br>|   +– 2019-02-14-Test-Post.md<br>|   +– 2019-02-14-Test-Post/<br>|     |  +– Test-Image.png<br>|     |  +– Test-Other-File.pdf</p></blockquote><p>Then in 2019-02-14-Test-Post.md:</p><p><strong>Images</strong></p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url"><span class="token operator">!</span>[<span class="token content">Alt Text</span>](<span class="token url">Test-Image.png</span> <span class="token string">"Title Text"</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>Other Files</strong></p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token url">[<span class="token content">Text</span>](<span class="token url">Test-Other-File.pdf</span>)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>and it will show correctly in both the markdown preview, the Hexo local server, and when built on your site.</p><h3 id="Changing-image-size-in-Markdown"><a href="#Changing-image-size-in-Markdown" class="headerlink" title="Changing image size in Markdown"></a>Changing image size in Markdown</h3><p>Please use HTML tag <em>img</em></p><pre class="line-numbers language-markdown" data-language="markdown"><code class="language-markdown"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span>  <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Test-Image.png<span class="token punctuation">"</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>50%<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Markdown </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Deep Dive Into Flutter TextField</title>
      <link href="/2021/06/22/a_deep_dive_into_flutter_textfield/"/>
      <url>/2021/06/22/a_deep_dive_into_flutter_textfield/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Introduction-the-TextField"><a href="#Introduction-the-TextField" class="headerlink" title="Introduction the TextField"></a>Introduction the TextField</h3><p>A TextField widget allows collection of information from the user. The code for a basic TextField is as simple as:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>This creates a basic TextField:</p><h3 id="Retrieving-information-from-a-TextField"><a href="#Retrieving-information-from-a-TextField" class="headerlink" title="Retrieving information from a TextField"></a>Retrieving information from a TextField</h3><p>Since TextFields do not have an ID like in Android,text cannot be retrieved upon demand and must instead be stored in a variable on change or use a controller.</p><ol><li>The easiest way to do this is to use the onChanged method and store the current value in a simple variable. Here is the sample code for it:</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">String value <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token function">TextField</span><span class="token punctuation">(</span> onChanged<span class="token punctuation">:</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&gt;</span> value <span class="token operator">=</span> text<span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>The second way to do this is use a TextEditingController. The Controller is attached to the TextField and lets us listen and control the text of the TextField as well.</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  TextEditingController controller <span class="token operator">=</span> <span class="token function">TextEditingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment">//We can listen to changes using:</span>    controller<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>      <span class="token function">print</span><span class="token punctuation">(</span>controller<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//get or set values using</span>    controller<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">'Hello Flutter'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        body<span class="token punctuation">:</span> <span class="token function">TextField</span><span class="token punctuation">(</span>          controller<span class="token punctuation">:</span> controller<span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Other-callbacks-from-the-TextField"><a href="#Other-callbacks-from-the-TextField" class="headerlink" title="Other callbacks from the TextField"></a>Other callbacks from the TextField</h3><p>The TextField widget also provides other callbacks such as</p><ol><li>onEditingCompleted</li><li>onSubmitted</li></ol><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Column</span><span class="token punctuation">(</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">TextField</span><span class="token punctuation">(</span>              <span class="token comment">// controller: controller,</span>              onSubmitted<span class="token punctuation">:</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'submit:$value'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">,</span>              onEditingComplete<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment">//doSomething</span>                <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'editingComplete...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">TextField</span><span class="token punctuation">(</span><span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>These are callbacks called on actions like when the user clicks the “Done” button on IOS. The onEditingCompleted and onSubmitted trigger on user tap the Enter key,and the onEditingCompleted trigger first and onSubmitted trigger on its back. The onSubmitted’s callback function let the TextField’value to parameter,but onEditingCompleted has no parameter.</p><h3 id="Working-with-focus-in-TextFields"><a href="#Working-with-focus-in-TextFields" class="headerlink" title="Working with focus in TextFields"></a>Working with focus in TextFields</h3><p>Having “focus” on a TextField means having a TextField active and any input form the keyboard will result in data entered in the focused TextField.</p><h4 id="Working-with-autofocus"><a href="#Working-with-autofocus" class="headerlink" title="Working with autofocus"></a>Working with autofocus</h4><p>The autofocus on a TextField when the widget is created,set the autofocus field to true.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> autofocus<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>This sets the focus on the TextField by default.</p><h4 id="Working-with-custom-focus-changes"><a href="#Working-with-custom-focus-changes" class="headerlink" title="Working with custom focus changes"></a>Working with custom focus changes</h4><p>What if we want to change the focus on demand and not just autofocus? Since we need some way to refer which TextField we want to focus to next,we attach a FocusNode to the TextField and use it to switch the focus.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token comment">//Initialise outside the build method</span>  FocusNode nodeOne <span class="token operator">=</span> <span class="token function">FocusNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  FocusNode nodeTwo <span class="token operator">=</span> <span class="token function">FocusNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          <span class="token function">TextField</span><span class="token punctuation">(</span>            focusNode<span class="token punctuation">:</span> nodeOne<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">TextField</span><span class="token punctuation">(</span>            focusNode<span class="token punctuation">:</span> nodeTwo<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token function">RaisedButton</span><span class="token punctuation">(</span>            onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              FocusScope<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">requestFocus</span><span class="token punctuation">(</span>nodeTwo<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Next Field'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>We create two focus nodes and attach them to the TextField.  When the button is pressed,we use FocusScope to request focus to the next TextField.</p><img src="textfield_focus_node.gif" width="50%"><h3 id="Changing-Keyboard-Properties-for-TextFields"><a href="#Changing-Keyboard-Properties-for-TextFields" class="headerlink" title="Changing Keyboard Properties for TextFields"></a>Changing Keyboard Properties for TextFields</h3><p>A TextField in Flutter allows you to customise properties related to the keyboard as well.</p><h4 id="Keyboard-Type"><a href="#Keyboard-Type" class="headerlink" title="Keyboard Type"></a>Keyboard Type</h4><p>A TextField allows you to customise the type of keyboard that shows up when the TextField is brought into focus. We change the keyboardType property for this.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextFiled</span><span class="token punctuation">(</span> keyboardType<span class="token punctuation">:</span>TextInputType<span class="token punctuation">.</span>number<span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>The types are:</p><ol><li>TextInputType.text (Normal complete keyboard)</li><li>TextInputType.number (A numerical keyboard)</li><li>TextInputType.emailAddress (Normal keyboard with an “@”)</li><li>TextInputType.datetime (Numerical keyboard with a “/“ and “:”)</li><li>TextInputType.multiline (Numerical keyboard with options to enabled signed and decimal mode)</li><li>TextInputType.url (Normal keyboard with a “/“ and “.com”)</li><li>TextInputType.phone (A phone call keyboard)</li></ol><h4 id="TextInputAction"><a href="#TextInputAction" class="headerlink" title="TextInputAction"></a>TextInputAction</h4><p>Changing textInputAction of the TextField lets you change the action button of the keyboard itself.<br>As an example:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> textInputAction<span class="token punctuation">:</span>TextInputAction<span class="token punctuation">.</span>continueAction<span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>This causes the “Done” button to be replaced by “Continue” button:</p><p>Or</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextFiled</span><span class="token punctuation">(</span> textInputAction<span class="token punctuation">:</span>TextInputAction<span class="token punctuation">.</span>send<span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>Causes</p><p>The complete list is too large to be displayed here,but do be sure to check it out.</p><h4 id="Autocorrect"><a href="#Autocorrect" class="headerlink" title="Autocorrect"></a>Autocorrect</h4><p>Enables or disables autocorrect for the specific TextField.Use the autocorrect field to set this.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> autocorrect<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>This will diable suggetions as well.</p><h4 id="Text-Capitaliation"><a href="#Text-Capitaliation" class="headerlink" title="Text Capitaliation"></a>Text Capitaliation</h4><p>The TextField provides a few options on how to capitalise letters in the input from the user.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> textCapitalization<span class="token punctuation">:</span>TextCapitalization<span class="token punctuation">.</span>sentences<span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>The types are:</p><ol><li><p>TextCapitalization.sentences<br>This is the normal type of capitalization we expect,the first letter of every sentence being capitalised.</p></li><li><p>TextCapitalization.characters<br>Capitalises all characters in the sentences.</p></li><li><p>TextCapitalization.words<br>Capitalises the first letter of each word.</p></li></ol><h3 id="Text-Style-Alignment-and-Cursor-Options"><a href="#Text-Style-Alignment-and-Cursor-Options" class="headerlink" title="Text Style,Alignment and Cursor Options"></a>Text Style,Alignment and Cursor Options</h3><p>Flutter allows customisation pertaining to the styling and alignment of text inside the TextField as well as the cursor inside the TextField.</p><h4 id="Text-alignment-inside-the-TextField"><a href="#Text-alignment-inside-the-TextField" class="headerlink" title="Text alignment inside the TextField"></a>Text alignment inside the TextField</h4><p>Use the textAlign property to adjust where cursor is inside the TextField.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> textAlign<span class="token punctuation">:</span> TextAlign<span class="token punctuation">.</span>center<span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>This causes the cursor and text to start in the middle of the TextField.</p><p>This has the usual alignment properties:start,end,left,right,center,justify.</p><h4 id="Styling-the-text-inside-the-TextField"><a href="#Styling-the-text-inside-the-TextField" class="headerlink" title="Styling the text inside the TextField"></a>Styling the text inside the TextField</h4><p>We use the style property to change how the text inside the TextField looks. Use it to change the color,font size,font weight,etc. This is similar to the style property in the Text widget so we will not spend too much time exploring it.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> style<span class="token punctuation">:</span><span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span>Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span>fontWeight<span class="token punctuation">:</span>FontWeight<span class="token punctuation">.</span>w300<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="Changing-the-cursor-in-the-TextField"><a href="#Changing-the-cursor-in-the-TextField" class="headerlink" title="Changing the cursor in the TextField"></a>Changing the cursor in the TextField</h4><p>The cursor is customisable directly from the TextField widget. You are allowed to change the cursor color,width and radius of the corners. For example,here I make a circular red cursor for no apparent reason.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> cursorColor<span class="token punctuation">:</span>Colors<span class="token punctuation">.</span>red<span class="token punctuation">,</span> cursorRadius<span class="token punctuation">:</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cursorWidth<span class="token punctuation">:</span><span class="token number">16.0</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Controlling-the-Size-and-Maximum-Length-in-a-TextField"><a href="#Controlling-the-Size-and-Maximum-Length-in-a-TextField" class="headerlink" title="Controlling the Size and Maximum Length in a TextField"></a>Controlling the Size and Maximum Length in a TextField</h3><p>TextField can control the maximum number of characters written inside it, the maximum number of lines and expand as text is typed.</p><h4 id="Controlling-max-characters"><a href="#Controlling-max-characters" class="headerlink" title="Controlling max characters"></a>Controlling max characters</h4><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> maxLength<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>By setting the maxLength property, a maximun length is enforced and a counter(IOS) is added by default to the TextField.</p><h3 id="Making-an-expandable-TextField"><a href="#Making-an-expandable-TextField" class="headerlink" title="Making an expandable TextField"></a>Making an expandable TextField</h3><p>Sometimes,we need a TextField that expands when one line is finished. In Flutter it is slight odd(yet easy) to do. To do this,We set maxLines to null, which is 1 by default. Setting to null is not something we’re very used to but nevertheless it’s easy to do.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> maxLines<span class="token punctuation">:</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>Note: Setting the maxLines to a direct value will expand it to that number of lines by default.</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> maxLines<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="Obscuring-Text"><a href="#Obscuring-Text" class="headerlink" title="Obscuring Text"></a>Obscuring Text</h3><p>To obscure text in a TextField,set obscureText to true.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> obscureText<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="And-Finally-Decorating-the-TextField"><a href="#And-Finally-Decorating-the-TextField" class="headerlink" title="And Finally,Decorating the TextField"></a>And Finally,Decorating the TextField</h3><p>Till now we focused on the features Flutter offers for input. Now we’ll move to actually designing a fancy TextField and not saying no to your designer.</p><p>For decorting the TextField,we use the decoration property which takes an InputDecoration. Since the InputDecoration class is enormous,we’ll try to quickly go over most of the important properties.</p><h4 id="Use-the-hint-and-label-properties-to-give-information-to-the-user"><a href="#Use-the-hint-and-label-properties-to-give-information-to-the-user" class="headerlink" title="Use the hint and label properties to give information to the user"></a>Use the hint and label properties to give information to the user</h4><p>Both hint and label are strings which help the user understand the information to be entered in the TextField. The difference is that a hint disappears once the user starts typing while a label floats over the TextField.</p><p>Hint:</p><p>Label:</p><h4 id="You-can-add-icons-using-“icon”-”prefixIcon”-and-“suffixIcon”"><a href="#You-can-add-icons-using-“icon”-”prefixIcon”-and-“suffixIcon”" class="headerlink" title="You can add icons using “icon”,”prefixIcon” and “suffixIcon”"></a>You can add icons using “icon”,”prefixIcon” and “suffixIcon”</h4><p>You can add icons directly to TextField. You can also use prefixText and suffixText for Text instead.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> decoration<span class="token punctuation">:</span><span class="token function">InputDecoration</span><span class="token punctuation">(</span>  icon<span class="token punctuation">:</span><span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>print<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> decoration<span class="token punctuation">:</span><span class="token function">InputDecoration</span><span class="token punctuation">(</span>  prefixIcon<span class="token punctuation">:</span><span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>print<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Simiarly-for-any-other-widget-use-“prefix”-instead-of-“prefixIcon”"><a href="#Simiarly-for-any-other-widget-use-“prefix”-instead-of-“prefixIcon”" class="headerlink" title="Simiarly for any other widget,use “prefix” instead of “prefixIcon”"></a>Simiarly for any other widget,use “prefix” instead of “prefixIcon”</h4><p>To use a generic widget instead of an icon,use the prefix field. Again for no apparent reason,let’s add a circular progress indicator in a TextField.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> decoration<span class="token punctuation">:</span><span class="token function">InputDecoration</span><span class="token punctuation">(</span>  prefix<span class="token punctuation">:</span><span class="token function">CircularProgressIndicator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="Each-property-like-hint-label-etc-has-its-respective-style-fields"><a href="#Each-property-like-hint-label-etc-has-its-respective-style-fields" class="headerlink" title="Each property like hint,label,etc has its respective style fields"></a>Each property like hint,label,etc has its respective style fields</h4><p>To style a hint,use a hintStyle. To style a label,use a labelStyle.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> decoration<span class="token punctuation">:</span><span class="token function">InputDecoration</span><span class="token punctuation">(</span>  hintText<span class="token punctuation">:</span><span class="token string">"Demo Text"</span><span class="token punctuation">,</span>  hintStyle<span class="token punctuation">:</span><span class="token function">TextStyle</span><span class="token punctuation">(</span>   fontWeight<span class="token punctuation">:</span>FontWeight<span class="token punctuation">.</span>w300<span class="token punctuation">,</span>   color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red  <span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Note:Although I have done it in this example,generally do not change the hint color as it is confusing to users.</strong></p><p><strong>Use “helperText” if you do not want a label but you want a persisting message for the user</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> decoration<span class="token punctuation">:</span><span class="token function">InputDecoration</span><span class="token punctuation">(</span>  helperText<span class="token punctuation">:</span><span class="token string">"Hello"</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Use “decoration:null” or InputDecoration. collapsed to remove the default underline on a TextField</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> decoration<span class="token punctuation">:</span>InputDecoration<span class="token punctuation">.</span><span class="token function">collapsed</span><span class="token punctuation">(</span>hintText<span class="token punctuation">:</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>Use “border” to give a border to the TextField</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">TextField</span><span class="token punctuation">(</span> decoration<span class="token punctuation">:</span><span class="token function">InputDecoration</span><span class="token punctuation">(</span>  border<span class="token punctuation">:</span><span class="token function">OutlineInputBorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>There is a vast amount of decoration you can do further,So you can easy to customise Flutter TextField.</p>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TextField </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>A Deep Dive Into Flutter ListView</title>
      <link href="/2021/06/22/a_deep_dive_into_flutter_listview/"/>
      <url>/2021/06/22/a_deep_dive_into_flutter_listview/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>A ListView in Flutter is a linear list of scrollable items. We can use it to make a list of items scrollable or make a list of repeating items.</p></blockquote><h3 id="Exploring-the-types-of-ListView"><a href="#Exploring-the-types-of-ListView" class="headerlink" title="Exploring the types of ListView"></a>Exploring the types of ListView</h3><p>We’ll start with looking at the types of ListViews and later look at the other features and neat modifications for it.</p><p>Let’s look at the types of ListViews there are:</p><ol><li>ListView</li><li>ListView.builder</li><li>ListView.separated</li><li>ListView.custom</li></ol><p>Let’s go around exploring these types one by one:</p><h4 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h4><p>This is the default constructor of the ListView class. A ListView simply takes a list of children and makes it scrollable.</p><p>A List contructed using the default constructor:</p><p>The general format of the code is:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">ListView</span><span class="token punctuation">(</span> children<span class="token punctuation">:</span><span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>  <span class="token function">ItemOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">ItemTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">ItemThree</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Usually this should be used with a small number of children as the List will also construct the invisible elements in the list and a large amount of elements may render this inefficient.</p><h4 id="ListView-builder"><a href="#ListView-builder" class="headerlink" title="ListView.builder()"></a>ListView.builder()</h4><p>The builder() constructor constructs a repeating list of items. The constructor takes two main parameters:An itemCount for the number of items in the list and an itemBuilder for constructed each list item.</p><p>A List contructed using the builder() constructor:</p><p>The general format of the code is:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span> itemCount<span class="token punctuation">:</span>itemCount<span class="token punctuation">,</span> itemBuilder<span class="token punctuation">:</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>position<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">listItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The list items are constructed lazily,meaning only a specific number of list items are constructed and when a user scrolls ahead,the earlier ones are destroyed.</p><p>Neat trick: Since the elements are loaded lazily and only the needed number of elements are loaded,we don’t really need an itemCount as a compulsory parameter and the list can be infinite.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span> itemBuilder<span class="token punctuation">:</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>position<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">Card</span><span class="token punctuation">(</span>   child<span class="token punctuation">:</span><span class="token function">Padding</span><span class="token punctuation">(</span>    padding<span class="token punctuation">:</span><span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>position<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>style<span class="token punctuation">:</span><span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span><span class="token number">22.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>A ListView without the itemCount parameter:</p><h4 id="ListView-separated"><a href="#ListView-separated" class="headerlink" title="ListView.separated()"></a>ListView.separated()</h4><p>In the separated() constructor,we generate a list and we can specify the separator between each item.</p><p>A ListView constructed using the ListView.separated() constructor:</p><p>In essence,we construct two interweaved lists: one as the main list,one as the separator list.</p><p><strong>Note That: the infinite count discussed in the earlier constructor cannot be used here and this constructor enforces an itemCount.</strong></p><p>The code for this type goes as:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">ListView<span class="token punctuation">.</span><span class="token function">separated</span><span class="token punctuation">(</span>          itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">Card</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                    <span class="token string">'main list $position'</span><span class="token punctuation">,</span>                    style<span class="token punctuation">:</span>                        <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">,</span> fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>          separatorBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>context<span class="token punctuation">,</span> position<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> position <span class="token operator">&lt;=</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token function">Card</span><span class="token punctuation">(</span>                child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                  padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                    <span class="token string">'Separator list $position'</span><span class="token punctuation">,</span>                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">22.0</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>redAccent<span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>              <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>          <span class="token punctuation">}</span><span class="token punctuation">,</span>          itemCount<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>This type of list lets you dynamically define separators,have different types of separators for different types of items,add or remove separators when need,etc.</p><p>This implementation can also be used for inserting other types of elements (advertisements for example) easily and without any modification to the main list in the middle of the list items.</p><p><strong>Note: The separator list length is 1 less than the item list as a separator does not exist after the last element.</strong></p><h4 id="ListView-custom"><a href="#ListView-custom" class="headerlink" title="ListView.custom()"></a>ListView.custom()</h4><p>The custom() constructor as its name suggests,lets you build ListViews with custom functionality for how the children of the list are build. The main parameter required for this is a SliverChildDelegate which builds the items.<br>The types of SliverChildDelegtes are:</p><ol><li>SliverChildListDelegate</li><li>SliverChildBuilderDelegate</li></ol><p>SliverChildListDelegate accepts a direct list of children whereas SliverChildBuilderDelegate accepts an IndexedWidgetBuilder(The builder function we use).</p><p>You can either use or subclass these for building your own delegates</p><blockquote><p>ListView.builder is essentially a ListView.custom with a SliverChildBuilderDelegate<br>The ListView default constructor behaves like a ListView.custom with a SliverChildListDelegate</p></blockquote><p>Now that we’re done with the types of ListViews,let’s take a look at ScrollPhysics.</p><h3 id="Exploring-ScrollPhysics"><a href="#Exploring-ScrollPhysics" class="headerlink" title="Exploring ScrollPhysics"></a>Exploring ScrollPhysics</h3><p>To control the way scrolling takes place,we set the physics parameter in the ListView constructor. The different types of physics are:</p><h4 id="NeverScrollablePhysics"><a href="#NeverScrollablePhysics" class="headerlink" title="NeverScrollablePhysics"></a>NeverScrollablePhysics</h4><p>NeverScrollablePhysics renders the list non-scrollable.Use this to disable scrolling of the ListView completely.</p><h4 id="BouncingScrollPhysics"><a href="#BouncingScrollPhysics" class="headerlink" title="BouncingScrollPhysics"></a>BouncingScrollPhysics</h4><p>BouncingScrollPhysics bound back the list when the list ends. A similar effect is used on IOS.</p><h4 id="ClampingScrollPhysics"><a href="#ClampingScrollPhysics" class="headerlink" title="ClampingScrollPhysics"></a>ClampingScrollPhysics</h4><p>This is the default scrolling physics used on Android. The list stops at the end and gives an effect indicating it.</p><h4 id="FixedExtentScrollPhysics"><a href="#FixedExtentScrollPhysics" class="headerlink" title="FixedExtentScrollPhysics"></a>FixedExtentScrollPhysics</h4><p>This is slightly different than the other ones in this list in the sense that is only works with FixedExtendScrollControllers and lists that use them. For an example we will take a ListWheelScrollView which makes a wheel-like list.</p><p>FixedExtentScrollPhysics Only scrolls to items instead of any offset in between.</p><p>The code for this example is incredibly simple:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">DeepDiveHome</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>  _DeepDiveHomeState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">_DeepDiveHomeState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">_DeepDiveHomeState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>DeepDiveHome<span class="token operator">&gt;</span> <span class="token punctuation">{</span>  FixedExtentScrollController fixedExtentScrollController <span class="token operator">=</span>      <span class="token keyword">new</span> <span class="token class-name">FixedExtentScrollController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token keyword">final</span> mothsOfTheYear <span class="token operator">=</span> <span class="token operator">&lt;</span>String<span class="token operator">&gt;</span><span class="token punctuation">[</span>    <span class="token string">"January"</span><span class="token punctuation">,</span>    <span class="token string">"February"</span><span class="token punctuation">,</span>    <span class="token string">"March"</span><span class="token punctuation">,</span>    <span class="token string">"April"</span><span class="token punctuation">,</span>    <span class="token string">"May"</span><span class="token punctuation">,</span>    <span class="token string">"June"</span><span class="token punctuation">,</span>    <span class="token string">"July"</span><span class="token punctuation">,</span>    <span class="token string">"August"</span><span class="token punctuation">,</span>    <span class="token string">"September"</span><span class="token punctuation">,</span>    <span class="token string">"October"</span><span class="token punctuation">,</span>    <span class="token string">"November"</span><span class="token punctuation">,</span>    <span class="token string">"December"</span>  <span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Deep Dive Flutter'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">ListWheelScrollView</span><span class="token punctuation">(</span>        controller<span class="token punctuation">:</span> fixedExtentScrollController<span class="token punctuation">,</span>        physics<span class="token punctuation">:</span> <span class="token function">FixedExtentScrollPhysics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        children<span class="token punctuation">:</span> mothsOfTheYear<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span> <span class="token punctuation">{</span>          <span class="token keyword">return</span> <span class="token function">Card</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                <span class="token function">Expanded</span><span class="token punctuation">(</span>                  child<span class="token punctuation">:</span> <span class="token function">Padding</span><span class="token punctuation">(</span>                    padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">8.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                      month<span class="token punctuation">,</span>                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontSize<span class="token punctuation">:</span> <span class="token number">18.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span>              <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        itemExtent<span class="token punctuation">:</span> <span class="token number">60.0</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="A-few-more-things-to-know"><a href="#A-few-more-things-to-know" class="headerlink" title="A few more things to know"></a>A few more things to know</h3><h4 id="How-to-keep-elements-that-get-destroy-alive-in-a-list"><a href="#How-to-keep-elements-that-get-destroy-alive-in-a-list" class="headerlink" title="How to keep elements that get destroy alive in a list?"></a>How to keep elements that get destroy alive in a list?</h4><p>Flutter provides a KeepAlive() widget which keeps an item alive which would have otherwise be destroyed. In a list,elements are wrapped by default in a AutomaticKeepAlive widget.</p><p>AutomaticKeepAlives can be disabled by setting the addAutomaticKeepAlives field to false. This is useful in cases where the elements don’t need to be kept alive or for a custom implementation of KeepAlive.</p><h4 id="Why-does-my-ListView-have-space-between-the-list-and-the-outer-Widget"><a href="#Why-does-my-ListView-have-space-between-the-list-and-the-outer-Widget" class="headerlink" title="Why does my ListView have space between the list and the outer Widget?"></a>Why does my ListView have space between the list and the outer Widget?</h4><p>By default,a ListView has padding between it and the outer widget,to remove it,set padding to EdgeInsets.all(0.0).</p>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ListView </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Layouts in Flutter</title>
      <link href="/2021/06/21/layouts_in_flutter/"/>
      <url>/2021/06/21/layouts_in_flutter/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>What’s the point?</p><blockquote><p>Widgets are classes used to build UIs.<br>Widgets are used for both layout and UI elements.<br>Compose simple widgets to build complex widgets.</p></blockquote></blockquote><p>The core of Flutter’s layout mechanism is widgets. In Flutter,almost everything is a widget-even layout models are widgets.The images,icons,and text that you see in a Flutter app are all widgets.But things you don’t see are also widgets,such as the rows,columns,and grids that arrange,constrain,and align the visible widgets.</p><p>You create a layout by composing widgets to build more complex widgets. For example,the first screenshot below show 3 icons with a label under each one.</p><p><img src="https://i.loli.net/2021/06/21/21hl3mBvf4EuNZd.png"></p><p>The second screenshot displays the visual layout,showing a row of 3 columns where each column contains an icon and a label.</p><p><strong>Note:Most of the screenshots in this tutorial are display with debugPaintSizeEnabled set to true so you can see the visual layout.For more information,see <a href="https://flutter.dev/docs/testing/debugging#visual-debugging">Visual debugging</a> ,a section in <a href="https://flutter.dev/docs/testing/debugging">Debugging Flutter apps</a>.</strong></p><p>Here’s s diagram of the widget tree for this UI:</p><p><img src="https://i.loli.net/2021/06/21/vm7NdI4Owl31Wz6.png"></p><p>Most of this should look as you might expect,but you might be wondering about the containers(shown in pink).<a href="https://api.flutter.dev/flutter/widgets/Container-class.html">Container</a> is a widget class that allows you to customize its child widget.Use a Container when you want to add padding,margins,borders, or background colors,to name some of its capabilities.</p><p>In this example,each <a href="https://api.flutter.dev/flutter/widgets/Text-class.html">Text</a> widget is placed in a Container to add margins. The entire <a href="https://api.flutter.dev/flutter/widgets/Row-class.html">Row</a> is also placed in a Container to add padding around the row.</p><p>The rest of the UI in this example is controlled by properties. Set an <a href="https://api.flutter.dev/flutter/material/Icons-class.html">Icon‘s</a> color using its color property. Use the Text.style property to set the color,weight,and so on. Columns and Rows have properties that allow you to specify how their children are align vertically or horizontally,and how much space the children should occupy.</p><p>The code is follow:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">FirstLayoutPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'First Layout'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">4.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>            mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>              <span class="token function">Column</span><span class="token punctuation">(</span>                mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>call<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>                    size<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Container</span><span class="token punctuation">(</span>                    margin<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                      <span class="token string">'CALL'</span><span class="token punctuation">,</span>                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>                          fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token function">Column</span><span class="token punctuation">(</span>                mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>navigation<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>                    size<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Container</span><span class="token punctuation">(</span>                    margin<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                      <span class="token string">'ROUTE'</span><span class="token punctuation">,</span>                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>                          fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token function">Column</span><span class="token punctuation">(</span>                mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>share<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>                    size<span class="token punctuation">:</span> <span class="token number">35</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Container</span><span class="token punctuation">(</span>                    margin<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>top<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                      <span class="token string">'SHARE'</span><span class="token punctuation">,</span>                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                          fontSize<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">,</span>                          fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Lay-out-a-widget"><a href="#Lay-out-a-widget" class="headerlink" title="Lay out a widget"></a>Lay out a widget</h3><p>How do you layout a single widget in Flutter? This section shows you how to create and display a simple widget. It also shows the entire code for a simple Hello World app.</p><p>In Flutter,it takes only a few steps to put text,an icon,or an image on the screen.</p><ol><li>Select a layout widget</li></ol><p>Choose from a variety of <a href="https://flutter.dev/docs/development/ui/widgets/layout">layout widgets</a> based on how you want to align or constrain the visible widget,as these characteristics are typically passed on to the contained widget.</p><p>The example uses <a href="https://api.flutter.dev/flutter/widgets/Center-class.html">Center</a> which centers its content horizontally and vertically.</p><ol start="2"><li>Create a visible widget</li></ol><p>For example,create a Text widget.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Create an <a href="https://api.flutter.dev/flutter/widgets/Image-class.html">Image</a> widget.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span> <span class="token string">'images/lake.jpg'</span><span class="token punctuation">,</span> fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>Create an <a href="https://api.flutter.dev/flutter/material/Icons-class.html">Icon</a> widget.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Icon</span><span class="token punctuation">(</span> Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>red<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><ol start="3"><li>Add the visible widget to the layout widgetee</li></ol><blockquote><p>All layout widgets have either of the following:</p><blockquote><p>A child property if they take a single child - for example,Center or Container<br>A children property if they take a list of widgets - for example,Row,Column,ListView,or Stack.</p></blockquote></blockquote><p>Add the Text widget to the Center widget:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Center</span><span class="token punctuation">(</span> child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><ol start="4"><li>Add the layout widget to the page</li></ol><p>A Flutter app is itself a widget,and most widgets have a <a href="https://api.flutter.dev/flutter/widgets/StatelessWidget/build.html">build()</a> method. Instantiating and returning a widget in the app’s build() method displays the widget.</p><h3 id="Material-apps"><a href="#Material-apps" class="headerlink" title="Material apps"></a>Material apps</h3><p>For a Material app, you can use a <a href="https://api.flutter.dev/flutter/material/Scaffold-class.html">Scaffold</a> widget,it provides a default banner,background color,and has API for adding drawers,snack bars,and bottom sheets. Then you can add the Center widget directly to the body property for the home page.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span><span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span> Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">MaterialApp</span><span class="token punctuation">(</span>   title<span class="token punctuation">:</span> <span class="token string">'Flutter layout demo'</span><span class="token punctuation">,</span>   home<span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>    appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>     title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Flutter layout demo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">,</span>    body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>     child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Hello World'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Note: The <a href="https://api.flutter.dev/flutter/material/material-library.html">Material library</a> implements widgets that follow <a href="https://material.io/design/">Material Design</a> principles. When designing your UI, you can exclusively use widgets from the standard <a href="https://api.flutter.dev/flutter/widgets/widgets-library.html">widgets library</a>, or you can use widgets from the Material library. You can mix widgets from both libraries,you can customize existing widgets, or you can build your own set of custom widgets.</strong></p><h3 id="Non-Material-apps"><a href="#Non-Material-apps" class="headerlink" title="Non-Material apps"></a>Non-Material apps</h3><p>For a non-Material app,you can add the Center widget to the app’s build() method:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">MyApp</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span><span class="token punctuation">{</span> <span class="token metadata symbol">@override</span> Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span><span class="token punctuation">{</span>  <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>   decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span>   child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>     <span class="token string">'Hello World'</span><span class="token punctuation">,</span>     textDirection<span class="token punctuation">:</span> TextDirection<span class="token punctuation">.</span>ltr<span class="token punctuation">,</span>     style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>      fontSize<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black87<span class="token punctuation">,</span>     <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Note: The above code is in the main.dart and invoke the main() method directly!</strong><br><strong>A layout widget should add to a page.</strong></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">void</span> main <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">runApp</span><span class="token punctuation">(</span><span class="token function">MyApp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Lay-out-multiple-widgets-vertically-and-horizontally"><a href="#Lay-out-multiple-widgets-vertically-and-horizontally" class="headerlink" title="Lay out multiple widgets vertically and horizontally"></a>Lay out multiple widgets vertically and horizontally</h3><p>One of the most common layout patterns is to arrange widgets vertically or horizontally. You can use a Row widget to arrange widgets horizontally, and a Column widget to arrange widgets vertically.</p><blockquote><p>What’s the point?</p><blockquote><p>Row and Column are two of the most commonly used layout patterns.<br>Row and Column each take a list of child widgets.<br>A child widget can itself be a Row,Column,or other complex widget.<br>You can specify how a Row or Column aligns its children,both vertically and horizontally.<br>You can stretch or constrain specific child widgets.<br>You can specify how child widgets use the Row’s or Column’s available space.</p></blockquote></blockquote><p>To create a row or column in Flutter,you add a list of children widgets to a <a href="https://api.flutter.dev/flutter/widgets/Row-class.html">Row</a> or <a href="https://api.flutter.dev/flutter/widgets/Column-class.html">Column</a> widget. In turn,each child can itself be a row or column,and so on. The following example shows how it is possible to nest rows or columns inside of rows or columns.</p><p>This layout is organized as a Row. The row contains two children:a column on the left,and an image on the right:</p><p><img src="https://i.loli.net/2021/06/21/uQZ1pfkNLY9TtCI.png"></p><p>The left column’s widget tree nests rows and columns.</p><p><img src="https://i.loli.net/2021/06/21/1FDJ4phme8vPGOE.png"></p><h3 id="Nesting-rows-and-columns"><a href="#Nesting-rows-and-columns" class="headerlink" title="Nesting rows and columns"></a>Nesting rows and columns</h3><p>The layout framework allows you to nest rows and columns inside of rows and columns as deeply as you need. Let’s look the code for the outlined section of the following layout:</p><p>The outlined section is implemented as two rows. The ratings row contains five stars and the number of reviews. The icons row contains three columns of icons and text.</p><p>The widgget tree for the ratings row:</p><p><img src="https://i.loli.net/2021/06/21/kq9HwTUil1mSpbQ.png"></p><p>The ratings variable creates a row containing a smaller row of 5 star icons,and text:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">var</span> stars <span class="token operator">=</span> <span class="token function">Row</span><span class="token punctuation">(</span>      mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> ratings <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>        mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          stars<span class="token punctuation">,</span>          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'170 Reviews'</span><span class="token punctuation">,</span>              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>                fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w800<span class="token punctuation">,</span>                fontFamily<span class="token punctuation">:</span> <span class="token string">'Roboto'</span><span class="token punctuation">,</span>                letterSpacing<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>                fontSize<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>Tip: To minimize the visual confusion that can result from heavily nested layout code,implement pieces of the UI in variables and functions!</em></p><p>The icons row,below the ratings row,contains 3 columns;each column contains an icon and two lines of text,as you can see in its widget tree:</p><p><img src="https://i.loli.net/2021/06/21/grVZDsj5ndHJ3hA.png"></p><p>The iconList variable defines the icons row:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">final</span> descTextStyle <span class="token operator">=</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>      fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w800<span class="token punctuation">,</span>      fontFamily<span class="token punctuation">:</span> <span class="token string">'Roboto'</span><span class="token punctuation">,</span>      letterSpacing<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>      fontSize<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>      height<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//DefaultTextStyle.merge() allows you to create a default text</span>    <span class="token comment">//style that is inherited by its child and all subsequent children.</span>    <span class="token keyword">final</span> iconList <span class="token operator">=</span> DefaultTextStyle<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>        style<span class="token punctuation">:</span> descTextStyle<span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>            mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>              <span class="token function">Column</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>kitchen<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'PREP:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'25 min'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token function">Column</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>timer<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'COOK:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'1 hr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token function">Column</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>restaurant<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'FEEDS:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'4-6'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The leftColumn variable contains the ratings and icons rows,as well as the title and text that describes the Pavlova:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">final</span> titleText <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Strawberry Pavlova'</span><span class="token punctuation">,</span>          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w800<span class="token punctuation">,</span>            letterSpacing<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>            fontSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> subTitle <span class="token operator">=</span> <span class="token function">Text</span><span class="token punctuation">(</span>        <span class="token string">'Pavlova is a meringue-based dessert named after the Russian ballerina'</span>        <span class="token string">'Anna Pavlova. Pavlova features a crisp crust and soft,light inside,'</span>        <span class="token string">'topped with fruit and whipped cream.'</span><span class="token punctuation">,</span>        textAlign<span class="token punctuation">:</span> TextAlign<span class="token punctuation">.</span>center<span class="token punctuation">,</span>        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>          fontFamily<span class="token punctuation">:</span> <span class="token string">'Georgia'</span><span class="token punctuation">,</span>          fontSize<span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> leftColumn <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>      padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          titleText<span class="token punctuation">,</span>          subTitle<span class="token punctuation">,</span>          ratings<span class="token punctuation">,</span>          iconList<span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>The left column is placed in a Container to constrain its width. Finally,the UI is constructed with the entire row (containing the left column and the image)inside a Card.</p><p>The Pavlova image is from <a href="https://pixabay.com/images/search/pavlova/">Pixabay</a>. You can embed an image from the net using Image.network() but,for this example,the image is saved to an images directory in the project,added to the pubspec file,and accessed using Image.asset(). For more information,see <a href="https://flutter.dev/docs/development/ui/assets-and-images">Add assets and images</a>.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>          margin<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          height<span class="token punctuation">:</span> <span class="token number">600</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>              crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                <span class="token function">Container</span><span class="token punctuation">(</span>                  width<span class="token punctuation">:</span> <span class="token number">440</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> leftColumn<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                mainImage<span class="token punctuation">,</span>              <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><em>Tip: The Pavlova example runs best horizontally on a wide device,such as a tablet. If you are runing this example in the IOS simulator,you can select a different device using the Hardware &gt; Device meun. For this example,we recommend the iPad Pro. You can its orientation to landscape mode using Hardware &gt; Rotate. You can also change the size of the simulator window (without changing the number of logical pixels) using Window &gt; Scale.</em></p><p>The final code is:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">NestingRowsAndColumnsPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">var</span> stars <span class="token operator">=</span> <span class="token function">Row</span><span class="token punctuation">(</span>      mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> ratings <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>        mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          stars<span class="token punctuation">,</span>          <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'170 Reviews'</span><span class="token punctuation">,</span>              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>                fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w800<span class="token punctuation">,</span>                fontFamily<span class="token punctuation">:</span> <span class="token string">'Roboto'</span><span class="token punctuation">,</span>                letterSpacing<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>                fontSize<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> descTextStyle <span class="token operator">=</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>      fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w800<span class="token punctuation">,</span>      fontFamily<span class="token punctuation">:</span> <span class="token string">'Roboto'</span><span class="token punctuation">,</span>      letterSpacing<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>      fontSize<span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">,</span>      height<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//DefaultTextStyle.merge() allows you to create a default text</span>    <span class="token comment">//style that is inherited by its child and all subsequent children.</span>    <span class="token keyword">final</span> iconList <span class="token operator">=</span> DefaultTextStyle<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>        style<span class="token punctuation">:</span> descTextStyle<span class="token punctuation">,</span>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>          padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>            mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span>            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>              <span class="token function">Column</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>kitchen<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'PREP:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'25 min'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token function">Column</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>timer<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'COOK:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'1 hr'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token function">Column</span><span class="token punctuation">(</span>                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                  <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>restaurant<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'FEEDS:'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'4-6'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">]</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> titleText <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>      padding<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Strawberry Pavlova'</span><span class="token punctuation">,</span>          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w800<span class="token punctuation">,</span>            letterSpacing<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">,</span>            fontSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> subTitle <span class="token operator">=</span> <span class="token function">Text</span><span class="token punctuation">(</span>        <span class="token string">'Pavlova is a meringue-based dessert named after the Russian ballerina'</span>        <span class="token string">'Anna Pavlova. Pavlova features a crisp crust and soft,light inside,'</span>        <span class="token string">'topped with fruit and whipped cream.'</span><span class="token punctuation">,</span>        textAlign<span class="token punctuation">:</span> TextAlign<span class="token punctuation">.</span>center<span class="token punctuation">,</span>        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>          fontFamily<span class="token punctuation">:</span> <span class="token string">'Georgia'</span><span class="token punctuation">,</span>          fontSize<span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> leftColumn <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>      padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>          titleText<span class="token punctuation">,</span>          subTitle<span class="token punctuation">,</span>          ratings<span class="token punctuation">,</span>          iconList<span class="token punctuation">,</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">final</span> mainImage <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pavlova.jpg'</span><span class="token punctuation">,</span> fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Nesting Rows and Columns'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>          margin<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">fromLTRB</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          height<span class="token punctuation">:</span> <span class="token number">600</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>              crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>start<span class="token punctuation">,</span>              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                <span class="token function">Container</span><span class="token punctuation">(</span>                  width<span class="token punctuation">:</span> <span class="token number">440</span><span class="token punctuation">,</span>                  child<span class="token punctuation">:</span> leftColumn<span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                mainImage<span class="token punctuation">,</span>              <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>Note:Row and Column are basic primitive widgets for horizontal and vertical layouts–these low-level widgets allow for maximun customzation. Flutter also offers specialized,higher level widgets that might be sufficient for you needs. For example,instead of Row you might prefer <a href="https://api.flutter.dev/flutter/material/ListTile-class.html">ListTile</a>,an easy-to-use widget with properties for leading and trailing icons,and up to 3 lines of text. Instead of Column,you might prefer <a href="https://api.flutter.dev/flutter/widgets/ListView-class.html">ListView</a>,a column-like layout that automatically scrolls if its content is too long to fit the avaiable space. For more information,see <a href="https://flutter.dev/docs/development/ui/layout#common-layout-widgets">Common layout widgets</a>.</strong></p><h3 id="Aligning-widgets"><a href="#Aligning-widgets" class="headerlink" title="Aligning widgets"></a>Aligning widgets</h3><p>You control how a row or column aligns its children using the mainAxisAlignment and crossAxisAlignment properties. For a row,the main axis runs horizontally and the cross axis run vertically. For a column,the main axis runs vertically and the cross axis runs horizontally.</p><p><img src="https://i.loli.net/2021/06/22/H1iweoCPBmdl6Yg.png"></p><p>The <a href="https://api.flutter.dev/flutter/rendering/RenderFlex/mainAxisAlignment.html">MainAxisAlignment</a> and <a href="https://api.flutter.dev/flutter/rendering/RenderFlex/crossAxisAlignment.html">CrossAxisAlignment</a> classes offer a variety of constants for controlling alignment.</p><p>In the following example,each of the 3 images is 100 pixels wide. The render box(in this case,the entire screen)is more than 300 pixels wide,so setting the main axis alignment to space Evenly divides the free horizontal space evenly between,before,and after each image.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Row</span><span class="token punctuation">(</span> mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span> children<span class="token punctuation">:</span><span class="token punctuation">[</span>  Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic1.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic2.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic3.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>App source:<a href="https://github.com/flutter/website/tree/master/examples/layout/row_column">row_column</a>.</p><p><img src="https://i.loli.net/2021/06/22/1MoBYUCIcprDAHO.png"></p><p>Columns work the same way as rows. The following example shows a column of 3 images,each is 100 pixels high.The height of the render box(in this case,the entire screen) is more than 300 pixels,so setting the main axis alignment to space Evenly divides the free vertical space evenly between,above,and below each image.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Column</span><span class="token punctuation">(</span> mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceEvenly<span class="token punctuation">,</span> children<span class="token punctuation">:</span><span class="token punctuation">[</span>  Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic1.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic2.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic3.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>App source: row_column.</p><p><img src="https://i.loli.net/2021/06/22/vRlrKyc5ZOXgLxM.png"></p><h3 id="Sizing-widgets"><a href="#Sizing-widgets" class="headerlink" title="Sizing widgets"></a>Sizing widgets</h3><p>When a layout is too large to fit a device,a yellow and black striped pattern appears along the affected edge. Here is an <a href="https://github.com/flutter/website/tree/master/examples/layout/sizing">example</a> of a row that is too wide:</p><p><img src="https://i.loli.net/2021/06/22/bEl93CqyVINYGZU.png"></p><p>Widgets can be sized to fit within a row or column by using the <a href="https://api.flutter.dev/flutter/widgets/Expanded-class.html">Expanded</a> widget. To fix the previoud example where the row of images is too wide for its render box,wrap each image with an Expanded widget.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Row</span><span class="token punctuation">(</span> crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span> children<span class="token punctuation">:</span><span class="token punctuation">[</span>  <span class="token function">Expaned</span><span class="token punctuation">(</span>   child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic1.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">Expanded</span><span class="token punctuation">(</span>   child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic2.jpg'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token function">Expanded</span><span class="token punctuation">(</span>   child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic3.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.loli.net/2021/06/22/OYzEk7K2Pa9iVSX.png"></p><p>App source: <a href="https://github.com/flutter/website/tree/master/examples/layout/sizing">sizing</a></p><p>Perhaps you want a widget to occupy twice as much space as its siblings. For this,use the Expanded widget flex property,an integer that determines the flex factor for a widget. The default flex factor is 1. The following code sets the flex factor of the middle image to 2.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token function">Row</span><span class="token punctuation">(</span>      crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>        <span class="token function">Expanded</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic1.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Expanded</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic2.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          flex<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Expanded</span><span class="token punctuation">(</span>child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic3.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.loli.net/2021/06/22/jY9pKnPml1G3W4b.png"></p><p>App source: sizing</p><h3 id="Packing-widgets"><a href="#Packing-widgets" class="headerlink" title="Packing widgets"></a>Packing widgets</h3><p>By default,a row or column occupies as much as space along its main axis as possible,but if you want to pack the children closely together,set its mainAxisSize to MainAxisSize.min.The following example uses this property to pack the star icons together.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">var</span> stars <span class="token operator">=</span> <span class="token function">Row</span><span class="token punctuation">(</span>      mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>min<span class="token punctuation">,</span>      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>green<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>star<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">]</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.loli.net/2021/06/22/vOJi4xuf8h7mcKG.png"></p><p>App source:<a href="https://github.com/flutter/website/tree/master/examples/layout/pavlova">pavlova</a></p><h3 id="Common-layout-widgets"><a href="#Common-layout-widgets" class="headerlink" title="Common layout widgets"></a>Common layout widgets</h3><p>Flutter has a rich library of layout widgets. Here are a few of those most commonly used. The intent is to get you up and running as quickly as possible,rather than overwhelm you with a complete list. For information on other available widgets,refer<br>to the <a href="https://flutter.dev/docs/development/ui/widgets">Widget catalog</a>,or use the Search box in the <a href="https://api.flutter.dev/index.html">API reference docs</a>. Also,the widget pages in the API docs often make suggestions about similar widgets that might better suit your needs.</p><p>The following widgets fall into two categories:standard widgets from the <a href="https://api.flutter.dev/flutter/widgets/widgets-library.html">widgets library</a>,and specialized widgets from the <a href="https://api.flutter.dev/flutter/material/material-library.html">Material library</a>. Any app can use the widgets library but only Material apps can use the Material Components library.</p><h3 id="Standard-widgets"><a href="#Standard-widgets" class="headerlink" title="Standard widgets"></a>Standard widgets</h3><ul><li><p><a href="https://flutter.dev/docs/development/ui/layout#container">Container</a> :Adds padding,margins,borders,background color,or other decorations to a widget.</p></li><li><p> <a href="https://flutter.dev/docs/development/ui/layout#gridview">GridView</a> :Lays widgets out as a scrollable grid.</p></li><li><p><a href="https://flutter.dev/docs/development/ui/layout#listview">ListView</a>:Lays widgets out as a scrollable list.</p></li><li><p><a href="https://flutter.dev/docs/development/ui/layout#stack">Stack</a>:Overlaps a widget on top of another.</p></li></ul><h3 id="Material-widgets"><a href="#Material-widgets" class="headerlink" title="Material widgets"></a>Material widgets</h3><ul><li><a href="https://flutter.dev/docs/development/ui/layout#card">Card</a>:Organizes related info into a box with rounded corners and a drop shadow.</li><li><a href="https://flutter.dev/docs/development/ui/layout#listtile">ListTile</a>:Organizes up to 3 lines of text,and optional leading and trailing icons, into a row.</li></ul><h3 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h3><p>Many layouts make liberal use of <a href="https://api.flutter.dev/flutter/widgets/Container-class.html">Containers</a> to separate widgets using padding,or to add borders or margins. You can change the device’s background by placing the entire layout into a Container and changing its background color or image.</p><blockquote><p>Summary(Container)</p><blockquote><p>Add padding,margins,borders<br>Change background color or image<br>Contains a single child widget,but that child can be a Row,Column,or even the root of a widget tree.</p></blockquote></blockquote><p><img src="https://i.loli.net/2021/06/22/9OfcH2Np5Lj1Gyb.png"></p><h4 id="Examples-Container"><a href="#Examples-Container" class="headerlink" title="Examples(Container)"></a>Examples(Container)</h4><p>This layout consists of a column with two rows,each containing 2 images. A Container is used to change the background color of the column to a lighter grey.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">_buildImageColumn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">Container</span><span class="token punctuation">(</span>          decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black26<span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>              <span class="token function">_buildImageRow</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              <span class="token function">_buildImageRow</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://i.loli.net/2021/06/22/58Stdho9MJyI2Ub.png"></p><p>A Container is also used to add a rounded border and margins to each image:</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">Widget <span class="token function">_buildDecoratedImage</span><span class="token punctuation">(</span>int imageIndex<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">Expanded</span><span class="token punctuation">(</span>          child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>            decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>              border<span class="token punctuation">:</span> Border<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black38<span class="token punctuation">)</span><span class="token punctuation">,</span>              borderRadius<span class="token punctuation">:</span> <span class="token keyword">const</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token keyword">const</span> Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            margin<span class="token punctuation">:</span> <span class="token keyword">const</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic$imageIndex.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    Widget <span class="token function">_buildImageRow</span><span class="token punctuation">(</span>int imageIndex<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">Row</span><span class="token punctuation">(</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">_buildDecoratedImage</span><span class="token punctuation">(</span>imageIndex<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">_buildDecoratedImage</span><span class="token punctuation">(</span>imageIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>You can find more Container examples in <a href="https://flutter.dev/docs/development/ui/layout/tutorial">tutorial</a> and the <a href="https://github.com/flutter/gallery">Flutter Gallery</a>.</p><p>App source: <a href="https://github.com/flutter/website/tree/master/examples/layout/container">container</a></p><h3 id="GridView"><a href="#GridView" class="headerlink" title="GridView"></a>GridView</h3><p>Use <a href="https://api.flutter.dev/flutter/widgets/GridView-class.html">GridView</a> to lay widgets out as a two-dimensional list. GridView provides two pre-fabricated lists,or you can build your own custom grid. When a GridView detects that its contents are too long to fit the render box,it automatically scrolls.</p><blockquote><p>Summary(GridView)</p><blockquote><p>Lays widgets out in a grid<br>Detects when the column content exceeds the render box and automatically privdes scrolling<br>Build your own custom grid,or use one of the provided grids:</p><blockquote><p>GridView.count allows you to specify the number of columns<br>GridView.extent allows you to specify the maximum pixel width of a tile</p></blockquote></blockquote></blockquote><p><strong>Note: When displaying a two-dimensional list where it’s important which row and column a cell occupies(for example,it’s the entry in the “calorie”) column for the “avocado” row),use <a href="https://api.flutter.dev/flutter/widgets/Table-class.html">Table</a> or <a href="https://api.flutter.dev/flutter/material/DataTable-class.html">DataTable</a>.</strong></p><h4 id="Examples-GridView"><a href="#Examples-GridView" class="headerlink" title="Examples(GridView)"></a>Examples(GridView)</h4><p><img src="https://i.loli.net/2021/06/22/EZvN9k7AyDBwpRC.png"></p><p>Uses GridView.extent to create a grid with tiles a maximum 150 pixels wide.</p><p>App source: <a href="https://github.com/flutter/website/tree/master/examples/layout/grid_and_list">grid_and_list</a></p><p><img src="https://i.loli.net/2021/06/22/Oe96qzuIh7DwVs2.png"></p><p>Uses GridView.count to create a grid that’s 2 tiles wide in portrait mode,and 3 tiles wide in landscape mode.The titles are created by setting the footer property for each <a href="https://api.flutter.dev/flutter/material/GridTile-class.html">GridTile</a>.</p><p>Dart code: <a href="https://github.com/flutter/gallery/blob/master/lib/demos/material/grid_list_demo.dart">grid_list_demo.dart</a> from the <a href="https://github.com/flutter/gallery">Flutter Gallery</a></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart">List<span class="token operator">&lt;</span>Container<span class="token operator">&gt;</span> <span class="token function">_buildGridTileList</span><span class="token punctuation">(</span>int count<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> List<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>        count<span class="token punctuation">,</span>        <span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">Container</span><span class="token punctuation">(</span>              child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">asset</span><span class="token punctuation">(</span><span class="token string">'images/pic${i + 1}.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    Widget <span class="token function">_buildGrid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> GridView<span class="token punctuation">.</span><span class="token function">extent</span><span class="token punctuation">(</span>          maxCrossAxisExtent<span class="token punctuation">:</span> <span class="token number">150</span><span class="token punctuation">,</span>          padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          mainAxisSpacing<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>          crossAxisSpacing<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token function">_buildGridTileList</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h3><p><a href="https://api.flutter.dev/flutter/widgets/ListView-class.html">ListView</a>,a column-like widget,automatically provides scrolling when its content is too long for its render box.</p><blockquote><p>Summary(ListView)</p><blockquote><p>A specialized Column for organizing a list of boxes<br>Can be laid out horizontally or vertically<br>Detects when its content won’t fit and provides scrolling<br>Less configurable than Column,but easier to use and supports scrolling</p></blockquote></blockquote><h4 id="Examples-ListView"><a href="#Examples-ListView" class="headerlink" title="Examples(ListView)"></a>Examples(ListView)</h4><p><img src="https://i.loli.net/2021/06/22/b6gIOyCaxqr7fkw.png"></p><p>Uses ListView to display a list of business using ListTiles.  A Divider separates the theatres from the restaurants.</p><p>App source: <a href="https://github.com/flutter/website/tree/master/examples/layout/grid_and_list">grid_and_list</a></p><p><img src="https://i.loli.net/2021/06/22/jDxpOMXao1WReUH.png"></p><p>Uses ListView to display <a href="https://api.flutter.dev/flutter/material/Colors-class.html">Colors</a> from the <a href="https://material.io/design/color/">Material Design palette</a> for a particular color family.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ListViewDemoPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    ListTile <span class="token function">_tile</span><span class="token punctuation">(</span>String title<span class="token punctuation">,</span> String subtitle<span class="token punctuation">,</span> IconData icon<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">ListTile</span><span class="token punctuation">(</span>          title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span>              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                fontSize<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>              <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          subtitle<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>subtitle<span class="token punctuation">)</span><span class="token punctuation">,</span>          leading<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>            icon<span class="token punctuation">,</span>            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    Widget <span class="token function">_buildList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">ListView</span><span class="token punctuation">(</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">_tile</span><span class="token punctuation">(</span><span class="token string">'CineArts at the Empire'</span><span class="token punctuation">,</span> <span class="token string">'85 W Portal Ave'</span><span class="token punctuation">,</span> Icons<span class="token punctuation">.</span>theaters<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">_tile</span><span class="token punctuation">(</span><span class="token string">'The Castro Theater'</span><span class="token punctuation">,</span> <span class="token string">'429 Castro St'</span><span class="token punctuation">,</span> Icons<span class="token punctuation">.</span>theaters<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">_tile</span><span class="token punctuation">(</span><span class="token string">'Alamo Drafthouse Cinema'</span><span class="token punctuation">,</span> <span class="token string">'2550 Mission St'</span><span class="token punctuation">,</span> Icons<span class="token punctuation">.</span>theaters<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">_tile</span><span class="token punctuation">(</span><span class="token string">'Roxie Theater'</span><span class="token punctuation">,</span> <span class="token string">'3117 16th St'</span><span class="token punctuation">,</span> Icons<span class="token punctuation">.</span>theaters<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">_tile</span><span class="token punctuation">(</span><span class="token string">'United Artists Stonestown Twin'</span><span class="token punctuation">,</span> <span class="token string">'501 Buckingham Way'</span><span class="token punctuation">,</span>                Icons<span class="token punctuation">.</span>theaters<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">_tile</span><span class="token punctuation">(</span><span class="token string">'AMC Metreon 16'</span><span class="token punctuation">,</span> <span class="token string">'135 4th St #3000'</span><span class="token punctuation">,</span> Icons<span class="token punctuation">.</span>theaters<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">_tile</span><span class="token punctuation">(</span><span class="token string">'Kescaped_code#39;s Kithen'</span><span class="token punctuation">,</span> <span class="token string">'757 Monterey Blvd'</span><span class="token punctuation">,</span>                Icons<span class="token punctuation">.</span>restaurant<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">_tile</span><span class="token punctuation">(</span><span class="token string">'Emmyescaped_code#39;s Restaurant'</span><span class="token punctuation">,</span> <span class="token string">'1923 Ocean Ave'</span><span class="token punctuation">,</span>                Icons<span class="token punctuation">.</span>restaurant<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">_tile</span><span class="token punctuation">(</span><span class="token string">'Chaiya Thai Restaurant'</span><span class="token punctuation">,</span> <span class="token string">'272 Claremont Blvd'</span><span class="token punctuation">,</span>                Icons<span class="token punctuation">.</span>restaurant<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">_tile</span><span class="token punctuation">(</span><span class="token string">'La Ciccia'</span><span class="token punctuation">,</span> <span class="token string">'291 30th St'</span><span class="token punctuation">,</span> Icons<span class="token punctuation">.</span>restaurant<span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'ListView Demo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">_buildList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><p>Use <a href="https://api.flutter.dev/flutter/widgets/Stack-class.html">Stack</a> to arrange widgets on top of a base widget–often an image. The widgets can completely or partially overlap the base widget.</p><blockquote><p>Summary(Stack)</p><blockquote><p>Use for widgets that overlap another widget<br>The first widget in the list of children is the base widget;subsequent children are overlaid on top of that base widget<br>A Stack’s content can’t scroll<br>You can choose to clip children that exceed the render box</p></blockquote></blockquote><h4 id="Examples-Stack"><a href="#Examples-Stack" class="headerlink" title="Examples(Stack)"></a>Examples(Stack)</h4><p><img src="https://i.loli.net/2021/06/22/i6zoBtuxpN8wIPH.png"></p><p>Uses Stack to overlay a Container(that displays its Text on a translucent black background)on top of a CircleAvatar. The Stack offsets the text using the alignment property and Alignments.</p><p>App source: <a href="https://github.com/flutter/website/tree/master/examples/layout/card_and_stack">card_and_stack</a></p><p><img src="https://i.loli.net/2021/06/22/sIRuXtM43b9ziZl.png"></p><p>Uses Stack to overlay a gradient to the top of the image. The gradient ensures that the toolbar’s icons are distinct against the image.</p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">StackDemoPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Widget <span class="token function">_buildStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">Stack</span><span class="token punctuation">(</span>          alignment<span class="token punctuation">:</span> <span class="token keyword">const</span> <span class="token function">Alignment</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>            <span class="token function">CircleAvatar</span><span class="token punctuation">(</span>              backgroundImage<span class="token punctuation">:</span> <span class="token function">AssetImage</span><span class="token punctuation">(</span><span class="token string">'images/pic.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>              radius<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token function">Container</span><span class="token punctuation">(</span>              decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black45<span class="token punctuation">)</span><span class="token punctuation">,</span>              child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Mia B'</span><span class="token punctuation">,</span>                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                    fontSize<span class="token punctuation">:</span> <span class="token number">20.0</span><span class="token punctuation">,</span>                    fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span>          <span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Stack Demo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">_buildStack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Card"><a href="#Card" class="headerlink" title="Card"></a>Card</h3><p>A <a href="https://api.flutter.dev/flutter/material/Card-class.html">Card</a> from the <a href="https://api.flutter.dev/flutter/material/material-library.html">Material library</a>,contains related nuggets of information and can be composed from almost any widget,but is often used with <a href="https://api.flutter.dev/flutter/material/ListTile-class.html">ListTile</a>. Card has a single child,but its child can be a column,row,list,grid,or other widget that supports multiple children,By default,a Card shrinks its size to 0 by 0 pixels. You can use <a href="https://api.flutter.dev/flutter/widgets/SizedBox-class.html">SizedBox</a> to constrain the size of a card.</p><p>In Flutter,a Card features slightly rounded corners and a drop shadow,giving it a 3D effect. Changing a Card’s elevation property allows you to control the drop shadow effect. Setting the elevation to 24,for example,visually lifts the Card further from the surface and causes the shadow to become more dispersed. For a list of supported elevation values,see <a href="https://material.io/design/environment/elevation.html">Elevation</a> in the <a href="https://material.io/design/">Material guidelines</a>. Specifying an unsupported value disables the drop shadow entirely.</p><blockquote><p>Summary(Card)</p><blockquote><p>Implements a Materical Card<br>Used for presenting related nuggests of information<br>Accepts a single child,but that child can be a Row,Column,or other widget that holds a list of children<br>Displayed with rounded corners and a drop shadow<br>A Card’s content can’t scroll<br>Form the Material library</p></blockquote></blockquote><h4 id="Examples-Card"><a href="#Examples-Card" class="headerlink" title="Examples(Card)"></a>Examples(Card)</h4><p><img src="https://i.loli.net/2021/06/22/k9qK6U8aCO4uEjQ.png"></p><p>A Card containing 3 ListTile and sized by wrapping it with a SizedBox. A Divider separates the first and second ListTiles</p><p>App source: <a href="https://github.com/flutter/website/tree/master/examples/layout/card_and_stack">card_and_stack</a></p><p><img src="https://i.loli.net/2021/06/22/m3BvTxzVuSt2hw6.png"></p><p>A Card containing an image and text.</p><p>Dart code: <a href="https://github.com/flutter/gallery/blob/master/lib/demos/material/cards_demo.dart">cards_demo.dart</a> from the <a href="https://github.com/flutter/gallery">Flutter Gallery</a></p><pre class="line-numbers language-dart" data-language="dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">CardDemoPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>  <span class="token metadata symbol">@override</span>  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>    Widget <span class="token function">_buildCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token function">SizedBox</span><span class="token punctuation">(</span>          height<span class="token punctuation">:</span> <span class="token number">250</span><span class="token punctuation">,</span>          child<span class="token punctuation">:</span> <span class="token function">Card</span><span class="token punctuation">(</span>            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">&gt;</span><span class="token punctuation">[</span>                <span class="token function">ListTile</span><span class="token punctuation">(</span>                  title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>                    <span class="token string">'1625 Main Street'</span><span class="token punctuation">,</span>                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                      fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                    <span class="token punctuation">)</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                  subtitle<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'My City,CA 99984'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  leading<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>                    Icons<span class="token punctuation">.</span>restaurant_menu<span class="token punctuation">,</span>                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                  <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token function">Divider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token function">ListTile</span><span class="token punctuation">(</span>                  title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'(408) 555-1212'</span><span class="token punctuation">,</span>                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>                        fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>w500<span class="token punctuation">,</span>                      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  leading<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>contact_phone<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token function">ListTile</span><span class="token punctuation">(</span>                  title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'costa@example.com'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                  leading<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>contact_mail<span class="token punctuation">,</span> color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>blue<span class="token punctuation">[</span><span class="token number">500</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token punctuation">)</span>              <span class="token punctuation">]</span><span class="token punctuation">,</span>            <span class="token punctuation">)</span><span class="token punctuation">,</span>          <span class="token punctuation">)</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>      appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>        title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Card demo'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token punctuation">)</span><span class="token punctuation">,</span>      body<span class="token punctuation">:</span> <span class="token function">_buildCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ListTile"><a href="#ListTile" class="headerlink" title="ListTile"></a>ListTile</h3><p>Use <a href="https://api.flutter.dev/flutter/material/ListTile-class.html">ListTile</a>,a specialized row widget form the <a href="https://api.flutter.dev/flutter/material/material-library.html">Material library</a>,for an easy way to create a row containing up to 3 lines of text and optional leading and trailing icons.<br>ListTile is most commonly used in Card or ListView,but can be used elsewhere.</p><blockquote><p>Summary(ListTile)</p><blockquote><p>A specialized row that contains up to 3 lines of text and optional icons<br>Less configurable than Row,but easier to use<br>Form the Material library</p></blockquote></blockquote><h4 id="Examples-ListTile"><a href="#Examples-ListTile" class="headerlink" title="Examples(ListTile)"></a>Examples(ListTile)</h4><p><img src="https://i.loli.net/2021/06/22/k9qK6U8aCO4uEjQ.png"></p><p>A Card containing 3 ListTile.</p><p>App source: <a href="https://github.com/flutter/website/tree/master/examples/layout/card_and_stack">card_and_stack</a></p><p><img src="https://i.loli.net/2021/06/22/QK6DITRm2t5zZ3L.png"></p><p>Uses ListTile to list 3 drop down button types.<br>Dart code: <a href="https://github.com/flutter/gallery/blob/master/lib/demos/material/button_demo.dart">button_demo.dart</a> from the <a href="https://github.com/flutter/gallery">Flutter Gallery</a>.</p>]]></content>
      
      
      <categories>
          
          <category> Flutter </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Layouts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>How to install Node.js and NPM on a Chromebook</title>
      <link href="/2021/06/21/how_to_install_node_js_and_npm_on_a_chromebook/"/>
      <url>/2021/06/21/how_to_install_node_js_and_npm_on_a_chromebook/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Installing-Node-js"><a href="#Installing-Node-js" class="headerlink" title="Installing Node.js"></a>Installing Node.js</h3><p>Download the Node.js from this  <a href="https://nodejs.org/">website</a><br>Navigate to the Downloads folder from the command line:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> ~/Downloads<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Extract the downloaded node package:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">tar</span> xf node*.tar.xz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Navigate to the extracted bin file:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> node*<span class="token builtin class-name">cd</span> bin<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>Copy the node file under/usr/local/bin/ (create the bin folder if it doesn’t exist):</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">cp</span> node /usr/local/bin/<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>You should be able to see node version now:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">node -v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>eg.: v8.11.2</p><h3 id="Installing-npm"><a href="#Installing-npm" class="headerlink" title="Installing npm"></a>Installing npm</h3><p>Now navigate to the npm folder:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token punctuation">..</span><span class="token builtin class-name">cd</span> lib/node_modules/npm/scripts<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>And install npm:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">sh</span> install.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Verify that you have npm installed:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">npm</span> -v<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>eg.: 6.0.1</p>]]></content>
      
      
      <categories>
          
          <category> Chrome OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NPM </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Chrome OS install zsh and oh-my-zsh</title>
      <link href="/2021/06/20/chrome_os_install_zsh_and_oh_my_zsh/"/>
      <url>/2021/06/20/chrome_os_install_zsh_and_oh_my_zsh/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Enable-Linux"><a href="#Enable-Linux" class="headerlink" title="Enable Linux"></a>Enable Linux</h3><p>First things first, we need to enable Linux. Head to Settings &gt; Search ‘Linux’ and enable the thing. </p><h3 id="Installing-Zsh-and-Oh-My-Zsh"><a href="#Installing-Zsh-and-Oh-My-Zsh" class="headerlink" title="Installing Zsh and Oh My Zsh"></a>Installing Zsh and Oh My Zsh</h3><p>Linux on Chrome OS does not ask for a password whenever you use commands with super user access, so we first need to do this:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">su</span> <span class="token operator">&amp;&amp;</span> <span class="token function">passwd</span> pushp.vashisht<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>In the same terminal window, we can install Zsh by writing 👇</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> <span class="token function">zsh</span> <span class="token operator">&amp;&amp;</span> chsh -s <span class="token variable"><span class="token variable">$(</span><span class="token function">which</span> <span class="token function">zsh</span><span class="token variable">)</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>After we have Zsh, we need to install Oh My Zsh, which is a framework for managing Zsh. We already have curl, so just paste this on your terminal:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sh</span> -c <span class="token string">"<span class="token variable"><span class="token variable">$(</span><span class="token function">curl</span> -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh<span class="token variable">)</span></span>"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>Type ‘Y’ to set your Oh My Zsh as your default bash. This command always creates a ~/.zshrc file on your home directory, which we’ll alter soon.<br>If you struggle like I did to set Zsh as the default prompt, try using the following command</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">echo</span> <span class="token string">'exec /usr/bin/zsh'</span> <span class="token operator">&gt;&gt;</span>~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="Installing-Powerlevel9k-Theme"><a href="#Installing-Powerlevel9k-Theme" class="headerlink" title="Installing Powerlevel9k Theme"></a>Installing Powerlevel9k Theme</h3><p>I use the much lighter Powerlevel 10k Theme, which is also very easy to configure, however I wasn’t able to install its required font, Meslo LG S, therefore, we’re going with its older cousin P9K, which is a great theme, just a little harder to configure. To install it run this command:</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone https://github.com/bhilburn/powerlevel9k.git ~/.oh-my-zsh/custom/themes/powerlevel9k<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>To change our zsh configuration we need to install a text editor, if you’re like me and don’t know how to vim, 👉 sudo apt install nano . After this, let’s create and change our zsh config and tell it to use our Powerlevel 10k theme. Hit nano ./zshrc and change the ZSH_THEME line to the following 👉 ZSH_THEME=”powerlevel9k/powerlevel9k” . Hit Ctrl + X and ‘Y’ to save and exit.</p><p>Press Ctrl + T to open a new terminal window and type zsh . You should already notice some differences.</p>]]></content>
      
      
      <categories>
          
          <category> Chrome OS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Chrome OS </tag>
            
            <tag> Shell </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
